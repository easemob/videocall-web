(this["webpackJsonpweb-video-call-demo"]=this["webpackJsonpweb-video-call-demo"]||[]).push([[0],{101:function(e,t,n){var r=n(7),i=(r.tagLogger("MouseTrigger"),{LEFT:1,WHEEL:2,RIGHT:4,WHEEL_ROLL_UP:8,WHEEL_ROLL_DOWN:16,KEY_UP:0,KEY_DOWN:1,MOVE:2,KEYBOARD_DOWN:3,KEYBOARD_UP:4});e.exports=r.prototypeExtend({_timeoutMillis:500,_time:(new Date).getTime(),isKeyup:function(){return i.KEY_UP==this.oper},isKeydown:function(){return i.KEY_DOWN==this.oper},isWheelup:function(){return i.WHEEL_ROLL_UP==this.btn},isWheeldown:function(){return i.WHEEL_ROLL_DOWN==this.btn},isLeftKey:function(){return i.LEFT==this.btn},isRightKey:function(){return i.RIGHT==this.btn},isWheelKey:function(){return i.WHEEL==this.btn},isWheelRoll:function(){return this.isWheeldown()||this.isWheelup()},timeout:function(){return(new Date).getTime()-this._time>=this._timeoutMillis},_toString:function(){return r.list("btn:",this.btn,", oper:",this.oper,", timeout:",this.timeout(),", at (",this.xy.x,", ",this.xy.y,")").join("")}}),e.exports.BTN=i},113:function(e,t,n){var r=n(7),i=n(266);emedia.subscribed=function(e){return!!e._located||(2===e.type?!(e._located||!e._webrtc):void 0!==e._webrtc)};var o=r.prototypeExtend({voff:0,aoff:0,__init__:function(){var e=this;if(!e._mediaStream)throw _logger.error("_mediaStream empty"),"_mediaStream empty";if(e.hasEnabledTracks(e._mediaStream)){if(!e.__audioContext)throw _logger.error("require audioContext"),"require audioContext";e.__soundMeter=new i(e.__audioContext),e.__soundMeter.connectToSource(e._mediaStream,(function(t){if(t)throw t;e.__worked=e.__soundMeter.__worked=!0}))}},hasEnabledTracks:function(e){return emedia.hasEnabledTracks(e)},getSoundMeters:function(){if(this.__soundMeter&&this.__worked)if(this._mediaStream.active){if(this.hasEnabledTracks(this._mediaStream))return{instant:this.__soundMeter.instant,slow:this.__soundMeter.slow,clip:this.__soundMeter.clip}}else this.__worked&&this._finally()},_finally:function(){this.__soundMeter&&(this.__soundMeter.stop(),this.__worked=this.__soundMeter.__worked=!1)}});e.exports=r.prototypeExtend({__undefinedEQDelete:!0,Update:r.prototypeExtend({ifAoff:function(e){this.if("aoff",e)},ifVoff:function(e){this.if("voff",e)},ifMediaStream:function(e){this.if("mediaStream",e)},if:function(e,t){"undefined"!==typeof this[e]&&t(this[e])}}),located:function(){return this._located||!1},webrtc:function(e){return e&&(this._webrtc=e),this},getMediaStream:function(){return"undefined"!==typeof this.mediaStream?this.mediaStream:this._located?this._localMediaStream:this._webrtc&&(this._webrtc.getRemoteStream()||this._webrtc.getLocalStream())},requestFrame:function(){this._localMediaStream&&this._localMediaStream.getVideoTracks().forEach((function(e){"function"===typeof e.requestFrame&&e.requestFrame()}))},getLocalMediaStream:function(){return this._localMediaStream},getRemoteMediaStream:function(){if(this._webrtc&&"undefined"!==typeof this._webrtc.getRemoteStream())return this._webrtc.getRemoteStream()},mutedNeed:function(){return this.mutedMuted||!1},ifMediaStream:function(e){"undefined"===typeof this.mediaStream?this._located&&"undefined"!==typeof this._localMediaStream?e(this._localMediaStream):this._located||!this._webrtc||"undefined"===typeof this._webrtc.getRemoteStream()||e(this._webrtc.getRemoteStream()):e(this.mediaStream)},subscribed:function(){return emedia.subscribed(this)},updateAttributes:function(){for(var e=this,t=0;t<arguments.length;t++){var n=arguments[t];if(r.isPlainObject(n))for(var i in n){var o=n[i];e[i]=o}}},getHtmlDOMID:function(){return"_m_"+this.owner.id+"_s_"+this.id},MediaSoundMeter:o,StreamSoundMeter:r.prototypeExtend({__init__:function(){if(!this._stream||"function"!==typeof this._stream.getMediaStream)throw _logger.error("_stream empty or not found method getMediaStream"),"_stream empty or not found method getMediaStream";if(this._streamId=this._stream.id,this._streamCreateId=this._stream.__create_id,this._mediaStream=this._mediaStream,2===this._stream.type&&!this._stream.located()&&!this._webrtc)throw _logger.error("require webrtc. when type = 2 and not located"),"require webrtc. when type = 2 and not located";this.__mediaSoundMeter=this.__mediaSoundMeter||new o({__audioContext:this.__audioContext,_mediaStream:this._mediaStream}),this.__mediaSoundMeter.useCount=(this.__mediaSoundMeter.useCount||0)+1},onSoundMeters:function(e){var t={instant:0,slow:0,clip:0};if(this._stream.aoff)return this._finally(),e(t),t;if(2!==this._stream.type&&this._stream.subArgs&&void 0!==this._stream.subArgs.subSAudio&&!this._stream.subArgs.subSAudio)return this._finally(),e(t),t;if(0==this._stream.id||2===this._stream.type&&!this._stream.located()&&(!this._stream.subArgs||!this._stream.subArgs.subSAudio)){var n,i=this._webrtc.getReceiversOfPeerConnection();if(!i||0===i.length)return e(t),t;for(var o in i)"audio"===i[o].track.kind&&(n=i[o]);if(!n)return e(t),t;if("function"===typeof n.getContributingSources){var a,s=n.getContributingSources();if(emedia.config._printSoundData&&r.logger.debug(this._stream.id,this._stream.csrc,"rtpContributingSources ",s),!s||0===s.length)return e(t),t;for(var o in s)s[o].source==this._stream.csrc&&(a=this._stream.csrc);if(emedia.config._printSoundData&&r.logger.debug(this._stream.id,this._stream.csrc,"source ",a),void 0===a)return e(t),t}}var c=this.__mediaSoundMeter.getSoundMeters()||t,d=2===this._stream.type?this._webrtc:this._stream._webrtc;(emedia.meterWithTrackAudioLevel||0===c.instant)&&d&&!d.closed&&d._rtcPeerConnection&&d._rtcPeerConnection.getStats().then((function(t){t.size>0&&t.forEach((function(t){"track"!==t.type||"audio"!==t.kind&&"audio"!==t.trackIdentifier||(c.trackAudioLevel=t.audioLevel,c.trackTotalAudioEnergy=t.totalAudioEnergy,e(c))}))})),e(c)},_finally:function(){2===this._stream.type&&this._stream.located()&&this._remoteMediaSoundMeters&&this._remoteMediaSoundMeters._finally(),this.__mediaSoundMeter.useCount--,0===this.__mediaSoundMeter.useCount&&this.__mediaSoundMeter._finally()}})})},140:function(e,t,n){var r=n(7),i=(r.tagLogger("MouseTrack"),n(101));e.exports=r.prototypeExtend({_scale:1,__init__:function(){},getTargetPageXY:function(){return this._target&&r.extend({},r.getDomPageRect(this._target))},onMouseTrack:function(e,t,n){},onMouseTrigger:function(e,t){},_onMouseTrack:function(e,t,n){this.onMouseTrack&&this.onMouseTrack(e,t,n)},_onMouseTrigger:function(e,t){this.onMouseTrigger&&this.onMouseTrigger(e,t)},track:function(e){var t=e=r.extend({},e),n=this.getTargetPageXY();n&&(t={x:(e=this._calPosition(e)).x,y:e.y,pageX:n.x+e.x,pageY:n.y+e.y}),this._onMouseTrack(t,this._lastPageXY,this._lastTrigger),this._lastPageXY=t},trigger:function(e){e=new i(e);var t,n=this.getTargetPageXY();n&&(t=this._calPosition(e.xy),e.xy={x:t.x,y:t.y,pageX:n.x+t.x,pageY:n.y+t.y}),e._time||(e._time=(new Date).getTime()),this._onMouseTrigger(e,this._lastTrigger),this._lastTrigger=e},releaseTrigger:function(){this._lastTrigger=void 0,this._lastPageXY=void 0,this.onReleaseTrigger&&this.onReleaseTrigger(this._lastTrigger)},_calPosition:function(e){this._referenceVideo&&(e=emedia.Service.prototype.eventXYAtVideo.call(null,e,this._referenceVideo));var t=this.getTargetPageXY();if(!t)return e;r.isFloat(e.x)&&void 0!==e.width&&(e.x=e.x*e.width*this._scale*(t.width/e.width)),r.isFloat(e.y)&&void 0!==e.height&&(e.y=e.y*e.height*this._scale*(t.height/e.height)),r.isFloat(e.x)&&void 0===e.width&&(e.x=e.x*this._scale*t.width),r.isFloat(e.y)&&void 0===e.height&&(e.y=e.y*this._scale*t.height),r.isInt(e.x)&&void 0!==e.width&&(e.x=e.x*this._scale*(t.width/e.width)),r.isInt(e.y)&&void 0!==e.height&&(e.y=e.y*this._scale*(t.height/e.height)),r.isInt(e.x)&&void 0===e.width&&(e.x=e.x*this._scale),r.isInt(e.y)&&void 0===e.height&&(e.y=e.y*this._scale);var n=Math.floor(e.x),i=Math.floor(e.y);return n<0&&(n=t.width+n),i<0&&(i=t.width+i),{x:n,y:i,width:t.width,height:t.height}}})},171:function(e,t,n){var r=n(7),i=r.tagLogger("Sess"),o=n(34),a=0,s=n(172).default,c=r.prototypeExtend({setSessId:function(e){return e&&(this.sessId=e),this},setOp:function(e){return e&&(this.op=e),200===e&&(this.res={type:emedia.config.clientType,ver:window._emediaVersion||emedia.config.version,agent:emedia.config.userAgent,ops:emedia.config.acptOps}),this},setTsxId:function(e){return e&&(this.tsxId=e),this},setTicket:function(e){return e&&(this.tkt=e),this},setSdp:function(e){return e&&(this.sdp=e),this},setCands:function(e){return e&&(this.cands=e),this},setSubSId:function(e){return e&&(this.subSId=e),this},setMemId:function(e){return e&&(this.memId=e),this},setPubS:function(e){e&&(this.pubS=r.extend(!1,{},e));var t=this.pubS;return t.ext&&r.isPlainObject(t.ext)&&(t.ext=JSON.stringify(t.ext)),t&&r.forEach(t,(function(e,n){(r.isPlainObject(n)||"function"===typeof n)&&"resolution"!=e&&r.removeAttribute(t,e)})),t&&r.removeAttribute(t,"localStream"),t&&r.removeAttribute(t,"_localMediaStream"),t&&r.removeAttribute(t,"_webrtc"),this},setRtcId:function(e){return e&&(this.rtcId=e),this},setCver:function(e){return e&&(this.cver=e),this},setEndReason:function(e){return e&&(this.endReason=e),this},setNickName:function(e){return e&&(this.nickName=e),this},setResource:function(e){return e&&(this.resource=e),this},setReason:function(e){return e&&(this.reason=e),this},setConfrId:function(e){return e&&(this.confrId=e),this},setVoff:function(e){return"undefined"===typeof e||(this.voff=e?1:0),this},setAoff:function(e){return"undefined"===typeof e||(this.aoff=e?1:0),this},setFlag:function(e){return 0===e&&(this.flag=0),1===e&&(this.flag=1),this},setExt:function(e){return e&&r.isPlainObject(e)&&(e=JSON.stringify(e)),e&&(this.ext=e),this}}),d=emedia.__session_globalCount=0;function u(e,t,n){var a=this;function s(e,r){try{a.onWebsocketEvent(new o.WSClose({url:a.thisWsUri,retry:n,online:a.online,cause:e,event:r,session:a}))}finally{t&&t(new o.WSClose({url:a.thisWsUri,retry:n,online:a.online,cause:e,event:r,session:a}))}}function d(e){if(a.connected(a.thisWsUri)){if(r.isPlainObject(e)&&!(e instanceof c))throw i.error("message not a Messages"),"message not a Messages";if(a.sessId&&e.sessId!=a.sessId)i.warn("self.sessId && message.sessId != self.sessId",e);else{var t=JSON.stringify(e);a.thisWsUri===a._websocket.url&&a._websocket.send(t),a.thisWsUri===a._websocket.url&&i.debug("Done send req:",t,a._websocket.url),a.thisWsUri===a._websocket.url||i.debug("Donot send(url not equal): req:",t,a._websocket.url)}}else i.debug("current dont connect. the message = ",e)}if(a.connected(a.thisWsUri))return e&&e(a),i.info("Session connected. dont continue connect"),void(a.notifyNewMessage&&a.notifyNewMessage());if(a.online){a.notifyNewMessage=function(){if(a.connected(a.thisWsUri)){if(0===a._bufferedMessages.length)return;for(var e,t=[];e=a._bufferedMessages.shift();)if(e.sessId||a.sessId||200==e.op){if(200===e.op){d(e);break}a.sessId&&!e.sessId&&(e.sessId=a.sessId);var o=d(e);o&&t.push(o)}else t.push(e),i.warn("tmp store message, util enter success!",e);t.length>0&&Array.prototype.push.apply(a._bufferedMessages,t)}else if(0!==n&&a.online)a.connected();else{var s=r.extend(!1,{},a._callbacks),c=[];for(var u in s){var l=s[u];n>0&&!a.online?c.push(l):a.onMessage({op:1001,tsxId:u,result:-9527,msg:"sdk rsp fail. retry fail or online = "+a.online})}a._bufferedMessages=a._bufferedMessages||[],c.length>0&&Array.prototype.push.apply(a._bufferedMessages,c)}},i.info("Session begin connect.");var u=a._websocket;u&&(i.warn("will close. websocket state",u.readyState,u.url,a.thisWsUri),u.close(1e3));try{i.info("Connecting",a.thisWsUri,n),u=a._websocket=new WebSocket(a.thisWsUri)}catch(l){return i.warn(l),void s(l)}u.onopen=function(n){var r=this.url;if(r===a.thisWsUri)try{i.info("websocket connected:",r),t&&(t=null),e&&e(a),a.onWebsocketEvent(new o.WSConnected({event:n,session:a}))}finally{}else i.warn("ignore the onopen. caused by websocket url not ",a.thisWsUri,r)},u.onmessage=function(e){var t=this.url;if(t===a.thisWsUri){i.debug("recv data",e.data);var n=JSON.parse(e.data);n&&1001==n.op&&i.debug("recv message: rsp:",n),n&&1001!=n.op&&i.debug("recv message: evt:",n),a.onMessage(n)}else i.warn("ignore recv data. caused by websocket url not ",a.thisWsUri,t,e.data)},u.onclose=function(e){var t=this.url;i.info("Disconnected:",t,a.thisWsUri,e),t===a.thisWsUri?(a.notifyNewMessage(),1e3!==e.code&&s(void 0,e)):i.warn("ignore onclose. caused by websocket url not ",a.thisWsUri,t)},u.onerror=function(e){i.info("On error:",e),a.onWebsocketEvent(new o.WSError({event:e,online:a.online,session:a,url:this.url}))}}else s()}e.exports=r.prototypeExtend({_events:{0:"onReqP2P",1:"onNewCfr",2:"onDelCfr",3:"onReqTkt",100:"onPing",101:"onPong",102:"onInitC",103:"onReqC",104:"onAcptC",105:"onTcklC",106:"onAnsC",107:"onTermC",300:"onEnter",301:"onExit",302:"onPub",303:"onUnpub",304:"onMems",204:"onClose",400:"onStreamControl",401:"onJoin",412:"onRoleUpdate",1002:"onRemoteControl",1003:"onRecvRemoteMessage",402:"onConfrAttrsUpdated",413:"onAdminChanged",452:"onLivecfgsChanged"},__init__:function(){var e=this;e._bufferedMessages=[],e._callbacks={},navigator.onLine?e.online=!0:e.online=!1,window.addEventListener("online",(function(t){e.online=!0,i.warn("online online online"),e.closed||e._reconnect(emedia.config.reconnect)}),!0),window.addEventListener("offline",(function(t){e.online=!1,i.warn("offline offline offline"),e.__checkConnectIntervalId&&clearTimeout(e.__checkConnectIntervalId),e.__retryConnectIntervalId&&clearTimeout(e.__retryConnectIntervalId),e.__retryConnectIntervalId&&delete e.__retryConnectIntervalId,e._websocket&&e._websocket.close(1e3)}),!0),i.info("online status = ",e.online)},_nextWsUri:function(){var e=this.ticket.url;emedia.config.useDeployMore&&(emedia.mgr.rtc_url_config=null,emedia.mgr.rtc_url_config=new s(emedia.config.rtcConfigUrl||""),e=emedia.mgr.rtc_url_config.replace_ws(e));var t=emedia.config&&emedia.config.convertWebsocketURLOfTicket||emedia.convertWebsocketURLOfTicket;if("function"===typeof t){var n=e;e=t(e),i.warn(n,"--\x3e",e)}if(e.startsWith("/")){if(emedia.config.wsorigin)e=emedia.config.wsorigin+e;else{var r=window.location.href,o=r.startsWith("https")?"wss://":"ws://",c=r.indexOf("://")+3,d=r.indexOf("/",c);e=o+r.substring(c,d)+e}i.warn("websocket url. update. {} -> {}",this.ticket.url,e)}else emedia.config.wsorigin&&i.warn("emedia.config.wsorigin invalidate. causeby server url {}",e);return e.indexOf("?")>=0?e+="&"+a++:e+="?"+a++,e},_reconnect:function(e){var t=this;function n(){i.warn("Reconnected. at ",e,t._websocket.url),t.__retryConnectIntervalId&&clearTimeout(t.__retryConnectIntervalId),t.__retryConnectIntervalId&&delete t.__retryConnectIntervalId;var n=t.newMessage().setOp(200).setSessId(t._sessionId).setTicket(t.ticket).setNickName(t.nickName||t.ticket.memName).setResource(t.resource).setExt(t.owner.ext);t.postMessage(n,(function(e){if(0==e.result)t.onEvent(new o.EnterSuccess({ip:t.owner.ip})),t.owner.onMembers(e.cver,e.mems),t.owner.onStreams(e.cver,e.streams),t.notifyNewMessage();else try{t.onEvent(new o.EnterFail({me:t.owner,cause:new o.RspFail({request:n,response:e})}))}finally{-9527!==e.result&&t.onEvent(new o.ServerRefuseEnter({failed:e.result,msg:e.msg}))}}))}t.connect(n,(function r(o){if(e<=0)return i.warn("Reconnect end. but fail.",o.url,e),void(t.__retryConnectIntervalId&&delete t.__retryConnectIntervalId);e&&(t.__retryConnectIntervalId=setTimeout((function(){t.connect(n,r,--e)}),emedia.config.reconnectDelay))}),--e)},__checkConnect:function(){var e=this;e.__checkConnectIntervalId&&clearTimeout(e.__checkConnectIntervalId),emedia.config.checkConnectIntervalMillis&&(e.__checkConnectIntervalId=setTimeout((function(){try{e.online&&!e.connected()&&(e.__retryConnectIntervalId&&i.debug("online, reconnecting..."),e.__retryConnectIntervalId||i.debug("online, but disconnect. will reconnect"),e.__retryConnectIntervalId||e._reconnect(emedia.config.reconnect))}finally{e.__checkConnect()}}),emedia.config.checkConnectIntervalMillis))},connect:function(e,t,n){var r=this,a=r.thisWsUri=r._nextWsUri();"undefined"!==typeof n&&i.warn("begin connect... at retry = ",n,a),u.call(r,(function(){try{e.apply(r,arguments)}finally{r.__checkConnect()}}),(function(e){try{t.apply(r,arguments)}finally{n||e.url!==a||r.onEvent(new o.ServerRefuseEnter({failed:-95270,msg:"sdk reconnect fail. "+a+"|"+e.url}))}}),n)},connected:function(e){return this.online&&this._websocket&&(!e||e===this._websocket.url)&&this._websocket.readyState==WebSocket.OPEN},onWebsocketEvent:function(e){this.onEvent(e)},register:function(e){if("object"===typeof e)for(var t in e)this.bind(t,e[t])},bind:function(e,t){var n;if(!(n=this._events[e]))throw i.error("Not supported event = ",e),"Not supported event = "+e;this[n]=t},getSessionId:function(){return this._sessionId},newMessage:function(e){return new c(e)},__modifyMessage:function(e){if(e&&e.sdp&&("string"===typeof e.sdp&&(e.sdp=r.parseJSON(e.sdp)),e.sdp.type&&(e.sdp.type=e.sdp.type.toLowerCase()),e.cctx&&(e.sdp.cctx=e.cctx)),e&&e.cands){"string"===typeof e.cands&&(e.cands=r.parseJSON(e.cands));for(var t=0;t<e.cands.length;t++)"string"===typeof e.cands[t]&&(e.cands[t]=r.parseJSON(e.cands[t])),e.cands[t].sdpMLineIndex=e.cands[t].mlineindex,e.cands[t].sdpMid=e.cands[t].mid,delete e.cands[t].mlineindex,delete e.cands[t].mid,e.cctx&&(e.cands[t].cctx=e.cctx)}if(e&&e.mems){if(!r.isArray(e.mems))return;var n=e.mems;e.mems={},r.forEach(n,(function(t,n){n.name&&(n.memName=n.name),e.mems[n.id]=n;var o=n.acptOps={};if(r.forEach(emedia.config.baseAcptOps,(function(e,t){o[t]=!0})),n.res&&r.forEach(n.res.ops,(function(e,t){o[t]=!0})),n&&n.ext)try{e.mems[n.id].ext=JSON.parse(n.ext)}catch(a){i.debug(a)}}))}if(e&&e.mem){e.mem.name&&(e.mem.memName=e.mem.name);var o=e.mem.acptOps={};if(r.forEach(emedia.config.baseAcptOps,(function(e,t){o[t]=!0})),e.mem.res&&r.forEach(e.mem.res.ops,(function(e,t){o[t]=!0})),e.mem&&e.mem.ext)try{e.mem.ext=JSON.parse(e.mem.ext)}catch(s){i.debug(s)}}if(e&&e.streams){if(!r.isArray(e.streams))return;var a=e.streams;e.streams={},r.forEach(a,(function(t,n){if(e.streams[n.id]=n,n&&n.ext)try{e.streams[n.id].ext=JSON.parse(n.ext)}catch(s){i.debug(s)}}))}if(e&&e.pubS&&e.pubS&&e.pubS.ext)try{e.pubS.ext=JSON.parse(e.pubS.ext)}catch(s){i.debug(s)}if(e&&e.ext)try{e.ext=JSON.parse(e.ext)}catch(s){i.debug(s)}return e},onMessage:function(e){var t=this;function n(e){var n=t._events[e.op],r=t[n];r?r.call(t,e):i.warn("Not supported event = ",e)}if(1001!=e.op&&!e.sessId)throw i.error("message sessId error. server evt data error"),"message sessId error. server evt data error";if(1001!=e.op&&t._sessionId&&t._sessionId!=e.sessId)throw i.error("message sessId error. server and local not equal"),"message sessId error. server and local not equal";if(1004!==e.op){if(1001==e.op&&e.arg){var a=JSON.parse(e.arg).op2;if(21==a){var s=e.result;return void t.onRequestToTalkerReply(s)}if(22==a){var c=e.result;return void t.onRequestToAdminReply(c)}}var d;e=t.__modifyMessage(e);var u=r.removeAttribute(t._callbacks,e.tsxId);if(u&&200===u.op){t._sessionId=e.sessId;var l="string"===typeof e.yourIp?e.yourIp:void 0;if("string"===typeof t._session_ip&&l!=t._session_ip&&(d=t._session_ip),i.info(t._sessionId,"ip is",l,d),t._session_ip=l,t.owner.ip=l,0===e.result){for(var f in t._bufferedMessages){var m=t._bufferedMessages[f];m.sessId||200===m.op||(m.sessId=e.sessId)}setTimeout((function(){t.notifyNewMessage()}),100),1001==e.op&&(e.cattrs||e.cstate)&&t.onConfrAttrsUpdated(e)}else for(var p;p=t._bufferedMessages.shift();)200!==p.op&&t.onMessage({op:1001,tsxId:p.tsxId,result:-9527,msg:"sdk enter fail. sdk callback. enter result = "+e.result})}if(t.owner&&t.owner.closed)i.warn("self closed. me is "+t.owner.getMemberId()+", session_id = "+t.getSessionId()+". drop message",e);else{if(t.onEvent(new o.RecvResponse({request:u,response:e})),u&&u.__callback__&&1004!==e.op)return u.__callback__(e),void(d&&t.onWebsocketEvent(new o.NetworkChanaged({preIp:d,nowIp:t._session_ip})));e.op&&1001!=e.op?(n(e),d&&t.onWebsocketEvent(new o.NetworkChanaged({preIp:d,nowIp:t._session_ip}))):i.debug("Igron message. caused by op not found.",e)}}else n(e)},__modifyMessageForPost:function(e){if(e.cands){for(var t=[],n=e.cands,i=0;i<n.length;i++){var o;0==i&&n[i].cctx&&(e.cctx=n[i].cctx),o="string"===typeof n[i]?{type:"candidate",candidate:n[i],mlineindex:0,mid:"audio"}:{type:"candidate",candidate:n[i].candidate,mlineindex:n[i].sdpMLineIndex,mid:n[i].sdpMid},t.push(JSON.stringify(o))}e.cands=t}if(e.sdp&&"string"!==typeof e.sdp){var a={type:e.sdp.type,sdp:e.sdp.sdp};e.sdp.cctx&&(e.cctx=e.sdp.cctx),e.sdp=a,e.sdp.type=e.sdp.type.toUpperCase(),e.sdp=r.stringifyJSON(e.sdp)}return e.pubS&&r.removeAttribute(e.pubS,"_located"),e.pubS&&r.removeAttribute(e.pubS,"mutedMuted"),e.pubS&&r.removeAttribute(e.pubS,"mediaStream"),e.pubS&&r.removeAttribute(e.pubS,"isRepublished"),e.pubS&&r.removeAttribute(e.pubS,"optimalVideoCodecs"),"function"===typeof e.post&&r.removeAttribute(e,"post"),e},postMessage:function(e,t,n){1002==e.op&&console.log("postMessage 1002",JSON.stringify(e));var o=this;if(e.tsxId||(e.tsxId="MSG"+Date.now()+"-"+d++),e.memId){var a=o.owner._cacheMembers[e.memId],s=e.arg,c=!1;if(s&&(21!=(s=JSON.parse(s)).op2&&22!=s.op2&&23!=s.op2&&24!=s.op2||(c=!0)),!a&&!c)return i.warn("Member not found at local. memberId = "+e.memId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-507,msg:" member not found at local. memberId = "+e.memId}));var u=e._reqOps;if(u||(u=[]).push(e.op),!c)for(var l in u){var f=u[l];if(!a.acptOps[f])return i.warn("Member not accept op "+f+", "+e.memId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-507,msg:" member not accept op "+f+", "+e.memId}))}}if(r.removeAttribute(e,"_reqOps"),o._sessionId&&o._sessionId!=e.sessId)return i.warn("sessionId not excepted. self._sessionId = "+o._sessionId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"sessionId not excepted."}));if(o.closed)return i.warn("session closed.",e),void(t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"session closed"}));var m=r.extend({},e);if(!(e=o.__modifyMessageForPost(e)))return i.warn("Message drop. callback success.",e),void(t&&t({op:1001,tsxId:m.tsxId,result:0,msg:"Message drop. callback success."}));200===e.op?(o._bufferedMessages.unshift(e),t&&setTimeout((function(){o._callbacks[e.tsxId]&&(i.error("Enter timeout. fail."),o.onMessage({op:1001,tsxId:e.tsxId,result:-9527,msg:"enter timeout. millis = "+emedia.config.enterTimeout}))}),emedia.config.enterTimeout)):o._bufferedMessages.push(e),t&&(o._callbacks[e.tsxId]=r.extend(e,{__callback__:t.bind(o.owner)})),o.notifyNewMessage&&o.notifyNewMessage(),n&&t&&setTimeout((function(){var e=o._callbacks[e.tsxId];e&&e.__callback__&&e.__callback__({op:1001,tsxId:m.tsxId,result:-408,msg:"Message request timeout."}),r.removeAttribute(o._callbacks,e.tsxId)}),n)},close:function(e){i.warn("sessiong closing, reason = ",e);this.notifyNewMessage&&this.notifyNewMessage(),this.closed=!0,this.seqno=0,this._websocket&&(0==e||100==e?this._websocket.close(1e3):this._websocket.close()),this.__retryConnectIntervalId&&clearTimeout(this.__retryConnectIntervalId),this.__retryConnectIntervalId&&delete this.__retryConnectIntervalId,this.__checkConnectIntervalId&&clearTimeout(this.__checkConnectIntervalId),this.__checkConnectIntervalId&&delete this.__checkConnectIntervalId,this.owner=null,this._bufferedMessages=[],this._callbacks={},i.warn("session closed")}})},172:function(e,t,n){"use strict";n.r(t);var r=n(44);function i(e){this.rtcconfig=void 0,this.rtcConfigUrl=e,this.get_rtcconfig()}i.prototype={get_rtcconfig:function(){var e={url:"https://rs.easemob.com/easemob/rtcconfig.json",async:!1};this.rtcConfigUrl&&(e.url=this.rtcConfigUrl);var t=this,n=void 0;try{$.ajax(Object(r.a)({},e,{success:function(e){console.log("get_rtcconfig success"),e&&Object.keys(e).length>0&&(t.rtcconfig=e,n=e)},error:function(e){return console.error("DeployMore get error",e),e}}))}catch(i){return}return n},replace_ws:function(e){if(this.rtcconfig&&this.rtcconfig.ws){var t="wss://"+this.rtcconfig.ws+"/";return e.replace(/wss.*com\//,t)}return e},_get_info_from_candifate:function(e){if(!e)return{};var t={};return e=e.split(" "),t.ip=e[4],t.port=e[5],t},_can_replace:function(e,t,n){return!!(e&&t&&n)&&(!!e.src.ip&&(e.src.ip==t&&!(e.src.min_port>n||e.src.max_port<n)))},_replace_candidate:function(e){var t=this._get_info_from_candifate(e),n=t.ip,r=t.port,i=this;return this.rtcconfig.rtc.candidate_map.map((function(t){if(i._can_replace(t,n,r)){var o=t.dst.ip,a=Number(r)-Number(t.src.min_port),s=Number(t.dst.min_port)+Number(a),c=e.split(" ");c[4]=o,c[5]=s,e=c.join(" ")}})),e},replace_candidates:function(e){if(!this.rtcconfig)return e;var t=this;return e=e.map((function(e){return e&&e.candidate?(e.candidate=t._replace_candidate(e.candidate),e):e}))},replace_trun_url:function(e){if(this.rtcconfig&&this.rtcconfig.turn){var t=e.iceServers;if(!t)return e;if(t instanceof Array==0)return e;var n=this.rtcconfig.turn;return t=t.map((function(e){e.url&&(e.url="turn:"+n)})),e}return e}},t.default=i},173:function(e,t,n){var r=n(7),i=r.tagLogger("Me"),o=n(264),a=n(34),s=n(113),c=o.extend({__init__:function(){if(this._session||this.sessionFactory&&(this._session=this.sessionFactory()),!this._session)throw i.error("Require session"),"Require session";this._cver=0,this._cacheMembers={},this._cacheStreams={},this._streamAutomators={},this._mediaMeters={},this._openedRtcMediaStreams={},this._linkedStreams={},this._maybeNotExistStreams={},this._records={},this._ices={},this.audioMixers={},this.closed=!1,this._nextStreamSeqno=0,this.getMediaMeterIntervalMillis=this.getMediaMeterIntervalMillis||emedia.config.getMediaMeterIntervalMillis},getCurrentMembers:function(){var e=[];return r.forEach(this._cacheMembers,(function(t,n){var i=r.extend(!0,{},n);e.push(i)})),e},newStream:function(e){var t=this;return new s(e,{__init__:function(){if(this.rtcId||this._webrtc&&(this.rtcId=this._webrtc.getRtcId()),this._webrtc||this.rtcId&&(this._webrtc=t._ices[this.rtcId]),this.__create_id=t._nextStreamSeqno++,this.memId&&!this.owner&&(this.owner=r.extend({},t._cacheMembers[this.memId]),!this.owner&&!this.located()))throw i.error("Remote stream, not owner. it = ",this.id),"Remote stream, not owner. it = "+this.id}})},getConfrId:function(){return this.ticket.confrId},isCaller:function(){return this.isP2P()&&this.ticket.caller==this.ticket.memName},isCallee:function(){return this.isP2P()&&this.ticket.callee==this.ticket.memName},isP2P:function(){return this.ticket&&("P2P"==this.ticket.type||"p2p"==this.ticket.type)},isConfr:function(){return this.ticket&&("CONFR"==this.ticket.type||"confr"==this.ticket.type)},onEvent:function(e){},join:function(e,t){var n=this;emedia.requireTrustBeforeJoin()?n.someBrowsersRequireGetUserMedia((function(){n._join(e,t)}),t):n._join(e,t)},_join:function(e,t){i.debug("begin join ...");var n,r=this;if(console.log("Attendee self",r),r._memberId)return i.warn("Had joined. igrone it"),void(e&&e(r.memId));function o(e){try{if(e instanceof a.WSClose&&e.retry)return;e instanceof a.EnterFail||(e=new a.EnterFail({attendee:r,cause:e})),r.onEvent(e),t&&t(e)}finally{}}function s(t){if(0==t.result){r.reflushSupportVCodes(t.vcodes),r.setMemberId(t.memId),r.role=t.role,r.onEvent(new a.EnterSuccess({ip:r.ip})),e&&e(t.memId);try{r.__rtc_cfg=t.rtcCfg,"string"===typeof t.rtcCfg&&(r.__rtc_cfg=JSON.parse(t.rtcCfg))}finally{r.onMembers(t.cver,t.mems),r.onStreams(t.cver,t.streams)}}else try{o(new a.RspFail({request:n,response:t}))}finally{-9527!==t.result&&r.onEvent(new a.ServerRefuseEnter({failed:t.result,msg:t.msg}))}}r.connect((function(){n=r.newMessage().setOp(200).setTicket(r.ticket).setNickName(r.nickName||r.ticket.memName).setResource(r.resource).setExt(r.ext),r.postMessage(n,s)}),o),i.debug("join",r.ticket.url)},withpublish:function(e){var t,n=this;if(!e||!e.localStream)throw i.error("pubS null or stream not open"),"pubS null or stream not open";var r,o=e&&e.localStream;return{join:function(s,c){if(1===arguments.length&&(c=s,s=void 0),n._memberId)return i.warn("Had joined. igrone it"),void(s&&s(n.memId));function d(e){try{if(e instanceof a.WSClose&&e.retry)return;e instanceof a.EnterFail||(e=new a.EnterFail({attendee:n,cause:e})),n.onEvent(e),c&&c(e)}finally{emedia.stopTracks(o),r&&n.closeWebrtc(r.getRtcId())}}var u=n.getOptimalVideoCodecs();function l(o){if(0==o.result){n.reflushSupportVCodes(o.vcodes),n.setMemberId(o.memId),n.role=o.role,n.onEvent(new a.EnterSuccess({ip:n.ip}));var c=n.newStream(e);c.updateAttributes({_localMediaStream:e.localStream,rtcId:r.getRtcId(),_webrtc:r,id:o.streamId,csrc:o.csrc,owner:{id:o.memId,nickName:n.nickName,name:n.sysUserId,ext:n.extObj},optimalVideoCodecs:u}),s&&s(o.memId,c),r.useIp=n.ip,n.onEvent(new a.PushSuccess({stream:c,hidden:!0})),o.sdp&&n.ansC(r.getRtcId(),o.sdp),o.cands&&n.tcklC(r.getRtcId(),o.cands);try{n.__rtc_cfg=o.rtcCfg,"string"===typeof o.rtcCfg&&(n.__rtc_cfg=JSON.parse(o.rtcCfg)),n.__rtc_cfg&&n.__rtc_cfg.iceServers&&n.__rtc_cfg.iceServers.length>0&&(i.warn("Server rsp one rtc cfg. publish will republish"),n._service&&setTimeout((function(){n._service._republish(c)}),200))}finally{n.onMembers(o.cver,o.mems),n.onStreams(o.cver,o.streams)}}else try{d(new a.RspFail({request:t,response:o}))}finally{-9527!==o.result&&n.onEvent(new a.ServerRefuseEnter({failed:o.result,msg:o.msg}))}}function f(){i.debug("enter and pubs");var o,a,s=e.localStream;2===e.type&&(o={offerToReceiveAudio:!0,offerToReceiveVideo:!1},a={subSVideo:!1,subSAudio:!0}),r=n.createWebrtc({_rtcId:e.rtcId,optimalVideoCodecs:u,offerOptions:o,subArgs:a,vbitrate:e.vbitrate||e.constaints&&e.constaints.video&&e.constaints.video.bitrate,abitrate:e.abitrate||e.constaints&&e.constaints.audio&&e.constaints.audio.bitrate},e.iceRebuildCount),n.setLocalStream(s,r.getRtcId()),n.doOffer(r.getRtcId(),(function(i){t=n.newMessage().setOp(200).setTicket(n.ticket).setNickName(n.nickName||n.ticket.memName).setResource(n.resource).setSdp(i).setRtcId(r.getRtcId()).setPubS(e).setExt(n.ext),n.postMessage(t,l)}))}n.connect(f,d),i.debug("join",n.ticket.url)}}},push:function(e,t,n,r){i.debug("begin push ...");var o,s=this;if(2===arguments.length&&(n=t,t=void 0),!e||!e.localStream)throw i.error("pubS or stream open"),"pubS or stream open";var c,d=e.localStream;function u(t){try{var i=s.newStream(e);i.updateAttributes({_localMediaStream:e.localStream,_webrtc:c,rtcId:c&&c.getRtcId(),owner:{id:s.getMemberId(),nickName:s.nickName,name:s.sysUserId,ext:s.extObj}});t=new a.PushFail({stream:i,cause:t,hidden:r&&!0===t.hidden});s.onEvent(t),t.hidden||n&&n(t)}finally{d&&!0!==t.hidden&&emedia.stopTracks(d),c&&s.closeWebrtc(c.getRtcId(),!0===t.hidden)}}if(e.rtcId||2!==e.type||emedia.config.allowRepeatAudioMixerPublish||!s._service.hasAudioMixers()){var l=e.optimalVideoCodecs||s.getOptimalVideoCodecs();m(e),i.debug("push",s.ticket.url)}else u(new a.AudioMixerStreamRepeatPublish);function f(n,r){if(0==r.result){var i=s.newStream(e);i.updateAttributes({_localMediaStream:e.localStream,_webrtc:n,rtcId:n.getRtcId(),id:r.streamId,csrc:r.csrc,owner:{id:s.getMemberId(),nickName:s.nickName,name:s.sysUserId,ext:s.extObj},optimalVideoCodecs:l}),i.id&&2===i.type&&(s.audioMixers[i.id]=i);try{s.onEvent(new a.PushSuccess({stream:i,hidden:!0}))}finally{r.sdp&&s.ansC(n.getRtcId(),r.sdp),r.cands&&s.tcklC(n.getRtcId(),r.cands),t&&t(i)}}else u(new a.RspFail({request:o,response:r,hidden:!0===r.retrying}))}function m(e){i.debug("pubs");var t,n,r=e.localStream;if(2===e.type&&(t={offerToReceiveAudio:!0,offerToReceiveVideo:!1},n={subSVideo:!1,subSAudio:!0}),c=s.createWebrtc({_rtcId:e.rtcId,optimalVideoCodecs:l,offerOptions:t,subArgs:n,vbitrate:e.vbitrate||e.constaints&&e.constaints.video&&e.constaints.video.bitrate,abitrate:e.abitrate||e.constaints&&e.constaints.audio&&e.constaints.audio.bitrate},e.iceRebuildCount),s.setLocalStream(r,c.getRtcId()),e.constaints&&e.constaints.video){var a=e.constaints.video,d=a.width,u=a.height;if(d&&u){var m={w:d.exact||d.min,h:u.exact||u.min};e.resolution=m}}s.doOffer(c.getRtcId(),(function(t){o=s.newMessage().setOp(102).setRtcId(c.getRtcId()).setSdp(t).setPubS(e),s.postMessage(o,(function(e){f(c,e)}))}))}},isSafari:function(){return emedia.isSafari},someBrowsersRequireGetUserMedia:function(e,t){var n=this;if(emedia.youInSomeBrowsers()&&!emedia._yetGetUserMedia){if(!0===n.__tryingOpenMedia)n.__tryingOpenMediaWaitSuceess=n.__tryingOpenMediaWaitSuceess||[],n.__tryingOpenMediaWaitFail=n.__tryingOpenMediaWaitFail||[],"function"===typeof e&&n.__tryingOpenMediaWaitSuceess.push(e),"function"===typeof t&&n.__tryingOpenMediaWaitFail.push(t);else{function o(t,i){emedia._yetGetUserMedia=!0,emedia.stopTracks(i),setTimeout((function(){n.__tryingOpenMedia=!1,e&&e.apply(n),n.__tryingOpenMediaWaitSuceess&&r.forEach(n.__tryingOpenMediaWaitSuceess,(function(e,t){t.apply(n)})),n.__tryingOpenMediaWaitSuceess=[],n.__tryingOpenMediaWaitFail=[]}),300)}function a(e){n.__tryingOpenMedia=!1,i.error("Some browsers must getUserMedia, gather cands. now try get audio. fail. subfail"),t&&t.call(n,e),n.__tryingOpenMediaWaitFail&&r.forEach(n.__tryingOpenMediaWaitFail,(function(t,r){r.call(n,e)})),n.__tryingOpenMediaWaitSuceess=[],n.__tryingOpenMediaWaitFail=[]}n.__tryingOpenMedia=!0,n._service.__getUserMedia({audio:!0},o,(function(e){n._service.__getUserMedia({video:!0},o,a)}))}return!0}return!1},createWebrtcAndSubscribeStream:function(e,t,n,o){var s=this;t||(t={});var c=s._cacheStreams[e],d=s._cacheMembers[c.memId],u=c;function l(n){i.warn("sub stream error",e,n),g&&u._webrtc&&u._webrtc.setSubArgs(g),g&&u.updateAttributes({subArgs:g}),n=new a.SubFail({stream:u,hidden:!0===n.hidden,cause:n}),t&&t.onEvent&&t.onEvent(n),s.onEvent&&s.onEvent(n)}function f(){u.updateAttributes(u.subArgs)}o=o||u.subArgs||{subSVideo:!0,subSAudio:2!==c.type};var m=c.vcodes||[],p=d&&d.vcodes||[],h=s.supportVCodes,v=s._getOptimalVideoCodecsSubset(m,p,h);o=o||u.subArgs;var g=u.subArgs,_=!(u.vcodes&&u.vcodes.length>0);emedia.isSafari&&(_=_||!!u.voff);var b={offerToReceiveAudio:!0,offerToReceiveVideo:o.subSVideo&&!_};function A(){var a=s.createWebrtc({iceServerConfig:n,optimalVideoCodecs:v,offerOptions:b,onGotMediaStream:function(e){t.onGotRemote&&t.onGotRemote(u)}},u.iceRebuildCount),c=a.getRtcId();i.warn(c," sub stream ",e,v),u.updateAttributes({_webrtc:a,rtcId:c,owner:r.extend({},d)}),o&&u._webrtc&&u._webrtc.setSubArgs(o),o&&u.updateAttributes({subArgs:o})}b.offerToReceiveAudio||b.offerToReceiveVideo||i.warn("offerToReceiveAudio == false and offerToReceiveVideo == false"),s.someBrowsersRequireGetUserMedia((function(){A(),s.offerCall(u.rtcId,null,e,l,f)}),(function(t){i.error("Some browsers must getUserMedia, gather cands. now try get audio. fail. subfail",e),l(t)}))||(A(),s.offerCall(u.rtcId,null,e,l,f))},_getOptimalVideoCodecsSubset:function(e,t,n){var i=this,o=[];if(e&&e.length>0&&n[e[0]]&&o.push(e[0]),0==o.length)for(var a=0;a<i._orderVCodes.length;a++)r.forEach(t,(function(e,t){t==i._orderVCodes[a]&&o.push(t)}));return o},subscribeStream:function(e,t,n,i,o){var s=this,c=s._ices[e],d=s._cacheStreams[t],u=s._cacheMembers[d.memId],l=d;l.updateAttributes({_webrtc:c,rtcId:e,owner:r.extend({},u)});var f=l.subArgs;if(i=i||{subSVideo:!0,subSAudio:!0},l.updateAttributes({subArgs:l.subArgs||{subSVideo:!0,subSAudio:!0}}),l._webrtc&&l._webrtc.setSubArgs(l._webrtc.subArgs||{subSVideo:!0,subSAudio:!0}),!l.subArgs.subSVideo&&i.subSVideo&&!l.voff){var m=d.vcodes,p=u.vcodes,h=s.supportVCodes;s._getOptimalVideoCodecsSubset(m,p,h)}i&&l._webrtc&&l._webrtc.setSubArgs(i),i&&l.updateAttributes({subArgs:i});var v=s.newMessage().setOp(205).setRtcId(e).setSubSId(t);i&&r.extend(v,i),s.postMessage(v,(function(e){if(0!=e.result){f&&l._webrtc&&l._webrtc.setSubArgs(f),f&&l.updateAttributes({subArgs:f});var t=new a.SubFail({stream:l,cause:new a.RspFail({request:v,response:e})});return n&&n(t),void s.onEvent(t)}l.updateAttributes(l.subArgs);t=new a.SubSuccess({stream:l,hidden:!0});s._updateRemoteStream(l,l._webrtc.getRemoteStream()),s.onEvent(t),"function"===typeof o&&o()}))},unsubscribeStream:function(e){var t=this._cacheStreams[e],n=t._webrtc&&t._webrtc.getRtcId();if(n){try{var r=this.newMessage().setOp(206).setRtcId(n).setSubSId(e);this.postMessage(r)}finally{this.closeWebrtc(n)}return n}},onEnter:function(e,t){var n=this;if(e&&(n._cver=e),t&&!n._cacheMembers[t.id]){n._cacheMembers[t.id]=t;var i={};t.res&&t.res.vcodes&&t.res.vcodes.length>0&&r.forEach(t.res.vcodes,(function(e,t){i[t]||(i[t]=!0,n.supportVCodes[t]&&n.supportVCodes[t]++)})),n.onAddMember(r.extend({},t))}},_onFinally:function(){this._cacheMembers={},this._cacheStreams={},this._linkedStreams={},this._ices={},this._maybeNotExistStreams={};var e=[];if(r.forEach(this._openedRtcMediaStreams,(function(t,n){!1!==n.active&&e.push(n)})),e.length>0)for(var t=0;t<e.length;t++)try{var n=e[t];i.info("exit, close stream = ",n.id),emedia.stopTracks(n)}catch(o){i.error(o)}i.warn("finally. all clean.")},_onRoleUpdate:function(e,t){i.info("Role ",e," <-",this.role),i.info(t),this.role=e,this.roleToken=t,this.onRoleUpdate&&this.onRoleUpdate(e,t)},onExit:function(e,t,n){var o=this;if(e&&(o._cver=e),t!=o.getMemberId()){var s=o._cacheMembers[t];s&&(s.res&&s.res.vcodes&&s.res.vcodes.length>0&&r.forEach(s.res.vcodes,(function(e,t){o.supportVCodes[t]--})),o._onRemoveMember(s,n),o.onEvent(new a.Hangup({reason:n,parnter:s})))}else{i.warn("Me exit. ",n,t);try{o.closed||o.close(n)}catch(c){o.onEvent(new a.Hangup({reason:n,self:{id:o._memberId}})),o.onMeExit&&o.onMeExit(n),i.warn(c)}}},onPub:function(e,t,n){if(!this._cacheMembers[t])throw i.error("No found member. when pub"),"No found member. when pub";var o=this.newStream(n),a=this._cacheStreams[n.id];if(e&&(this._cver=e),a&&o.sver!==a.sver)return i.info("Onpub. the steam ",a.id," republish. sver ",a.sver,o.sver),!o||o.aoff===a.aoff&&o.voff==a.voff||this.onStreamControl(void 0,n.id,o.voff,o.aoff),r.extend(a,o),void this._onRepublishStream(a);var s=o;return s.updateAttributes({owner:this._cacheMembers[t]}),this._cacheStreams[n.id]=s,this._onAddStream(this.newStream(s)),this.autoSub&&this.createWebrtcAndSubscribeStream(n.id,{onGotRemote:function(e){}}),s},onUnpub:function(e,t,n){var r=this._cacheStreams[n];this._onRemovePubstream(this._cacheMembers[t],r),e&&(this._cver=e)},onClose:function(e,t,n){try{this.close(n||0)}finally{this.onConfrClose&&this.onConfrClose(t,n)}},__getWebrtcFor:function(e){var t=this._cacheStreams[e]&&this._cacheStreams[e]._webrtc;return t&&t.getRtcId()},_getWebrtc:function(e){return this._cacheStreams[e]&&this._cacheStreams[e]._webrtc},_updateRemoteStream:function(e,t){e.located()&&2===e.type?emedia.enableAudioTracks(t,!0):emedia.enableAudioTracks(t,!e.aoff&&!(e.subArgs&&!1===e.subArgs.subSAudio)),emedia.enableVideoTracks(t,!e.voff&&!(e.subArgs&&!1===e.subArgs.subSVideo))},onStreamControl:function(e,t,n,r,o){var a=this,s=a._cacheStreams[t];s.updateAttributes({voff:n,aoff:r});var c=s._webrtc;c&&c._remoteStream&&a._updateRemoteStream(s,c._remoteStream);var d=a.newStream(s);a.onUpdateStream&&a.onUpdateStream(d,new d.Update({voff:n,aoff:r})),e&&(a._cver=e),o&&s.updateAttributes({sver:o}),emedia.isSafari&&!n&&c&&!c.closed&&c.offerOptions&&!c.offerOptions.offerToReceiveVideo&&(i.warn("stream video turn on. but sub not video, will close it, repsub stream",c.getRtcId(),c.__id,t),a.closeWebrtc(c.getRtcId(),!0,!1),a.createWebrtcAndSubscribeStream(t,{onGotRemote:function(e){var t=Object.assign(a._service.__safari_subs,{});t&&t instanceof Array&&t.map((function(n,r){n.streamId==e.id&&t.splice(r,1)})),a._service.__safari_subs=t},onEvent:function(e){var t=Object.assign(a._service.__safari_subs,{});t&&t instanceof Array&&t.map((function(e,n){e.streamId==s.id&&t.splice(n,1)})),a._service.__safari_subs=t}},void 0,s.subArgs))},aoff:function(e,t,n){var r=this.__getWebrtcFor(e.id);if(!r)throw i.error("pubS not publish",e.id),"pubS not publish"+e.id;this._linkedStreams[e.id].updateAttributes({aoff:t}),e.updateAttributes({aoff:t});var o=this.newMessage().setOp(400).setRtcId(r).setVoff(e.voff).setAoff(t);this.postMessage(o,n),this.onUpdateStream&&this.onUpdateStream(e,new e.Update({aoff:t}))},voff:function(e,t,n){var r=this.__getWebrtcFor(e.id);if(!r)throw i.error("pubS not publish",e.id),"pubS not publish"+e.id;this._linkedStreams[e.id].updateAttributes({voff:t}),e.updateAttributes({voff:t});var o=this.newMessage().setOp(400).setRtcId(r).setVoff(t).setAoff(e.aoff);this.postMessage(o,n),this.onUpdateStream&&this.onUpdateStream(e,new e.Update({voff:t}))},startRecord:function(e,t){var n=this,o=e.rtcId,a=n.newMessage().setOp(500).setRtcId(o).setFlag(1);n.postMessage(a,(function(a){i.warn("record ",o,a.result,a.msg),t&&t(0===a.result),0===a.result&&(n._records[e.id]=r.extend(!1,{},e))}))},stopRecord:function(e,t){var n=e.rtcId,o=this.newMessage().setOp(500).setRtcId(n).setFlag(0);this.postMessage(o,(function(e){i.warn("stop record ",n,e.result,e.msg),t&&t(0===e.result)})),this._records[e.id]&&r.removeAttribute(this._records,e.id)},onMembers:function(e,t){var n=this,i=[];r.forEach(n._cacheMembers,(function(e,n){t[e]||i.push(n)})),r.forEach(i,(function(e,t){n.onExit(void 0,t.id)}));var o=[];r.forEach(t,(function(e,t){(t.name&&t.name!=n.memName||!t.name&&e!=n.getMemberId())&&(n._cacheMembers[e]||o.push(t),n._cacheMembers[e]&&r.extend(n._cacheMembers[e],t))})),r.forEach(o,(function(e,t){n.onEnter(void 0,t)})),e&&(n._cver=e)},onStreams:function(e,t){var n=this,i=[];r.forEach(n._cacheStreams,(function(e,n){n.located()||t[e]||i.push(n)})),r.forEach(i,(function(e,t){n.onUnpub(void 0,t.memId,t.id)}));var o=[];r.forEach(t,(function(e,t){(t.memName&&t.memName!=n.memName||!t.memName&&t.memId!=n.getMemberId())&&(n._cacheStreams[e]||o.push(t),n._cacheStreams[e]&&r.extend(n._cacheStreams[e],t))})),r.forEach(o,(function(e,t){n.onPub(void 0,t.memId,t)})),r.forEach(n._cacheStreams,(function(e,i){var o;i.located()||(o=t[e]),!o||o.aoff===i.aoff&&o.voff==i.voff||n.onStreamControl(void 0,e,o.voff,o.aoff),o&&o.sver!==i.sver&&(r.extend(i,o),n._onRepublishStream(i))})),e&&(n._cver=e)},_onRemoveMember:function(e,t){var n=this;i.info("remove",e,t);var o=[];r.forEach(n._cacheStreams,(function(t,n){(n.memId||n.owner&&n.owner.id)===e.id&&o.push(n)})),r.forEach(o,(function(e,r){n._onRemovePubstream(r.owner,r,t)})),r.removeAttribute(n._cacheMembers,e.id),n.onRemoveMember&&n.onRemoveMember(e,t)},_onAddStream:function(e){i.info("add stream ",e.id),i.debug("add stream ",e);this.onAddStream(e)},_onRemovePubstream:function(e,t,n){var i=this;if(t&&0!=t.id)try{var o=r.removeAttribute(i._mediaMeters,t.id);o&&o._finally()}finally{!function(e){if(2===e.type&&(r.removeAttribute(i.audioMixers,e.id),e.remotePlayAudioObject&&document.body.removeChild(e.remotePlayAudioObject)),n||(n="Unpub"),e&&!e.closeReason&&e.updateAttributes({closeReason:n}),i.unsubscribeStream(e.id),r.removeAttribute(i._cacheStreams,e.id),i._streamAutomators&&r.removeAttribute(i._streamAutomators,e.id),i._monitSoundChanagedStreams&&r.removeAttribute(i._monitSoundChanagedStreams,e.id),i.onRemoveStream){e=i.newStream(e);i.onRemoveStream(e)}}(t)}},_onRepublishStream:function(e){if(!this._ices[e.rtcId]&&!emedia.subscribed(e)||this._maybeNotExistStreams[e.id])this.onUpdateStream(e);else{this.unsubscribeStream(e.id);this.createWebrtcAndSubscribeStream(e.id,{onGotRemote:function(e){}})}},_onRecvRemoteMessage:function(e,t,n){i.debug("Recv remote message",e,t);var r,o=this._cacheMembers[e];try{r=JSON.parse(t)}catch(a){}this.onRecvRemoteMessage&&this.onRecvRemoteMessage(o||e,r||t,n)},_onSoundChanage:function(e,t,n){emedia.config._printSoundData&&i.info("Stream id "+t.id+", meter "+(n&&n.instant.toFixed(2)+" "+n.slow.toFixed(2)+" "+n.clip.toFixed(2)+" "+(n.trackAudioLevel||"--")+" "+(n.trackTotalAudioEnergy||"--"))),n||(n={instant:0,slow:0,clip:0}),emedia.config.logVolumeWhenInstantGE&&emedia.config.logVolumeWhenInstantGE>0&&n.instant>=emedia.config.logVolumeWhenInstantGE&&n.instant<3*emedia.config.logVolumeWhenInstantGE&&i.info("Stream id "+t.id+", webrtc = "+(t._webrtc?t._webrtc.getRtcId():"null")+", media streamId = "+(t.getMediaStream()?t.getMediaStream().id:"null")+", instant >= "+emedia.config.logVolumeWhenInstantGE+", meter instant="+n.instant+", slow="+n.slow+", clip="+n.clip);0===n.instant&&(n.instant=n.trackAudioLevel||n.trackTotalAudioEnergy||0),this.onSoundChanage(e,t,n),this._service._judgeTalking(n)&&this.onTalking(e,t,n)},onAddMember:function(e){},onRemoveMember:function(e,t){},onAddStream:function(e){},onRemoveStream:function(e){},onUpdateStream:function(e,t){},onRecvRemoteMessage:function(e,t){},onSoundChanage:function(e,t,n){},onTalking:function(e,t,n){},_sendRequestMessage:function(e){if(e){var t=this,n=function(){var e="";for(var n in t._cacheMembers){var r=t._cacheMembers[n];if(r.role==emedia.mgr.Role.ADMIN){e=r.id;break}}return e}();if(n){var r=this._memberId,i=this.memName,o=this.nickName,a=this.newMessage(),s={op:1002,memId:n,arg:JSON.stringify({op2:e,memId:r,memName:i,nickName:o||i}),tsxTime:(new Date).getTime(),_reqOps:["1002".concat(e)]};Object.assign(a,s),this.postMessage(a)}else console.warn("this confrence have not admin")}},requestToTalker:function(){this._sendRequestMessage(21)},_send_action_request_message:function(e,t,n){if(t&&e&&void 0!==n){var r=t.tsxId,i=t.arg.memId,o=this.newMessage(),a={op:1001,arg:JSON.stringify({op2:e,memId:i}),memId:i,result:n,tsxId:r,_reqOps:["1002".concat(e)]};Object.assign(o,a),this.postMessage(o)}},refuseRequestToTalker:function(e){this._send_action_request_message(21,e,1)},refuseRequestToAdmin:function(e){this._send_action_request_message(22,e,1)},requestToAdmin:function(){this._sendRequestMessage(22)},_sendControlAudioMessage:function(e,t){if(e&&t){var n=this.newMessage(),r={op:1002,memId:e,arg:JSON.stringify({op2:t,memId:e}),tsxTime:(new Date).getTime(),_reqOps:[100223,100224]};Object.assign(n,r),this.postMessage(n)}},muteBymemberId:function(e){this._sendControlAudioMessage(e,23)},unmuteBymemberId:function(e){this._sendControlAudioMessage(e,24)}});e.exports=c},174:function(e,t,n){var r=n(7),i=r.tagLogger("Webrtc"),o=n(265),a=n(172).default,s={headerSection:null,audioSection:null,videoSection:null,_parseHeaderSection:function(e,t,n){var r=t;return-1===n||(r=-1===t?n:Math.min(t,n)),r>=0?e.slice(0,r):e},_parseAudioSection:function(e,t,n){var r=t;if(r>=0)return e.slice(r,n<r?e.length:n)},_parseVideoSection:function(e,t,n){var r=n;if(r>=0)return e.slice(r,t<r?e.length:t)},spiltSection:function(e){this._preSDP=e;var t=this._preAudioIndex=e.indexOf("m=audio"),n=this._preVideoIndex=e.indexOf("m=video");this.headerSection=this._parseHeaderSection(e,t,n),this.audioSection=this._parseAudioSection(e,t,n),this.videoSection=this._parseVideoSection(e,t,n)},setVideoBitrate:function(e){e&&this.videoSection&&(this.videoSection=this.setBitrate(this.videoSection,e))},setVideoMinBitrate:function(e){this.setAllFmtpBitrate({"x-google-min-bitrate":e})},setVideoMaxBitrate:function(e){this.setAllFmtpBitrate({"x-google-max-bitrate":e})},setVideoStartBitrate:function(e){this.setAllFmtpBitrate({"x-google-start-bitrate":e})},setAllFmtpBitrate:function(e){if(this.videoSection){var t={};Object.keys(e).forEach((function(n){var r=n+"="+e[n],i=new RegExp("(a=fmtp\\:\\d+\\s\\S*;?)("+n+"=\\d+)(;?\\S*)","g");t[n]={field:r,regex:i}})),this.videoSection=this.videoSection.replace(/(a=fmtp\:\d+[^\r\n]+)([\r\n]+)/g,(function(e,n,r){return n.indexOf("apt=")>=0?e:(Object.keys(t).forEach((function(e){var r=t[e],i=r.regex,o=r.field,a=n.replace(i,(function(e,t,n,r){return t+o+r}));a.indexOf(e)<0?(a.endsWith(";")||(a+=";"),n=a+o):n=a})),n+r)}))}},setFmtpBitrate:function(e,t){if(t&&this.videoSection){var n=e+"="+t,r=new RegExp("(a=fmtp\\:\\d+\\s\\S*;?)("+e+"=\\d+)(;?\\S*)","g");this.videoSection=this.videoSection.replace(/(a=fmtp\:\d+[^\r\n]+)([\r\n]+)/g,(function(t,i,o){var a=i.replace(r,(function(e,t,r,i){return t+n+i}));return a.indexOf(e)<0&&(a.endsWith(";")||(a+=";"),a+=n),a+o}))}},setAudioBitrate:function(e){e&&this.audioSection&&(this.audioSection=this.setBitrate(this.audioSection,e))},setBitrate0:function(e,t){return(e=e.replace(/(b=)(?:AS|TIAS)(\:)\d+/g,"$1AS$2"+t)).indexOf("b=AS")<0&&(e=e.replace(/(m=(?:audio|video)[^\r\n]+)([\r\n]+)/g,"$1$2b=AS:"+t+"$2")),e},setBitrate:function(e,t){var n="AS";return emedia.isFirefox&&(t=1e3*(t>>>0),n="TIAS"),(e=e.replace(/(b=)(?:AS|TIAS)(\:)\d+/g,"$1"+n+"$2"+t)).indexOf("b="+n+":")<0&&(e=e.indexOf("c=IN ")<0?e.replace(/(m=(?:audio|video)[^\r\n]+)([\r\n]+)/g,"$1$2b="+n+":"+t+"$2"):e.replace(/c=IN ([^\r\n]+)([\r\n]+)/,"c=IN $1$2b="+n+":"+t+"$2")),e},updateVideoSection:function(e,t){this.videoSection&&(this.videoSection=this.videoSection.replace(e,t))},updateAudioSection:function(e,t){this.audioSection&&(this.audioSection=this.audioSection.replace(e,t))},updateVideoSendonly:function(){this.videoSection&&(this.videoSection=this.videoSection.replace(/sendrecv/g,"sendonly"))},updateVideoRecvonly:function(){this.videoSection&&(this.videoSection=this.videoSection.replace(/sendrecv/g,"recvonly"))},updateAudioSendonly:function(){this.audioSection&&(this.audioSection=this.audioSection.replace(/sendrecv/g,"sendonly"))},updateAudioRecvonly:function(){this.audioSection&&(this.audioSection=this.audioSection.replace(/sendrecv/g,"recvonly"))},updateACodes:function(e){if(e&&this.audioSection){if("string"===typeof e)(n=[]).push(e),e=n;for(var t={},n=this._parseLine(this.audioSection,/a=rtpmap:(\d+) ([A-Za-z0-9]+)\/.*/gi),o=0;o<n.length;o++){var a=n[++o];t[n[++o]]=a}var s=[];for(o=0;o<e.length;o++){var c=t[e[o]];c&&s.push(c)}0==s.length&&(this._webrtc?i.warn("Not found acodes map",e,this._webrtc._rtcId,this._webrtc.__id):i.warn("Not found acodes map",e));var d=this.audioSection.indexOf("\r"),u=this.audioSection.substring(0,d),l=u.split(" ");Array.prototype.push.apply(s,l.slice(3));var f=[],m={};r.forEach(s,(function(e,t){0==f.length?(f.push(t),m[t]=!0):m[t]||(f.push(t),m[t]=!0)})),l.splice(3,l.length-3,f.join(" ")),u=l.join(" "),this._webrtc&&i.warn(u,this._webrtc._rtcId,this._webrtc.__id),this.audioSection=u+this.audioSection.substring(d)}},updateVCodes:function(e){if(e&&this.videoSection){if("string"===typeof e)(n=[]).push(e),e=n;for(var t={},n=this._parseLine(this.videoSection,/a=rtpmap:(\d+) ([A-Za-z0-9]+)\/.*/gi),o=0;o<n.length;o++){var a=n[++o];t[n[++o]]=a}var s=this._parseLine(this.videoSection,/a=fmtp:(\d+) .*profile-level-id=42e01f;?.*/gi);s&&s.length>=2&&(t.H264=s[1]);var c=[];for(o=0;o<e.length;o++){var d=t[e[o]];d&&c.push(d)}0==c.length&&(this._webrtc?i.warn("Not found vcodes map",e,this._webrtc._rtcId,this._webrtc.__id):i.warn("Not found vcodes map",e));var u=this.videoSection.indexOf("\r"),l=this.videoSection.substring(0,u),f=l.split(" ");Array.prototype.push.apply(c,f.slice(3));var m=[],p={};r.forEach(c,(function(e,t){0==m.length?(m.push(t),p[t]=!0):p[t]||(m.push(t),p[t]=!0)})),f.splice(3,f.length-3,m.join(" ")),l=f.join(" "),this._webrtc&&i.warn(l,this._webrtc._rtcId,this._webrtc.__id),this.videoSection=l+this.videoSection.substring(u)}},removeSSRC:function(e){for(var t=[],n=e.split(/a=ssrc:[^\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);return t.join("\n")},removeField_msid:function(e){for(var t=[],n=e.split(/a=msid:[^\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);e=t.join("\n"),t=[],n=e.split(/[\n]+/g);for(r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);return t.join("\n")},updateHeaderMsidSemantic:function(e){var t="a=msid-semantic: WMS "+e,n=this.headerSection.split(/a=msid\-semantic: WMS.*/g),r=[];switch(n.length){case 1:r.push(n[0]);break;case 2:r.push(n[0]),r.push(t),r.push("\n");break;case 3:r.push(n[0]),r.push(t),r.push("\n"),r.push(n[2]),r.push("\n")}return this.headerSection=r.join("")},updateAudioSSRCSection:function(e,t,n,r){this.audioSection&&(this.audioSection=this.removeSSRC(this.audioSection)),this.audioSection&&(this.audioSection=this.removeField_msid(this.audioSection)),this.audioSection&&(this.audioSection=this.audioSection+this.ssrcSection(e,t,n,r))},updateVideoSSRCSection:function(e,t,n,r){this.videoSection&&(this.videoSection=this.removeSSRC(this.videoSection)),this.videoSection&&(this.videoSection=this.removeField_msid(this.videoSection)),this.videoSection&&(this.videoSection=this.videoSection+this.ssrcSection(e,t,n,r))},getUpdatedSDP:function(e){var t,n,r;if(void 0!==e&&null!=e||(e=this._preAudioIndex<this._preVideoIndex),this.videoSection&&this.videoSection.replace(/a=mid:([^\r\n]+)/,(function(e,n){return t=n,e})),this.audioSection&&this.audioSection.replace(/a=mid:([^\r\n]+)/,(function(e,t){return n=t,e})),e){var i=["a=group:BUNDLE"];this.audioSection&&i.push(n),this.videoSection&&i.push(t),r=this.headerSection.replace(/a=group:BUNDLE [^\r\n]+/,i.join(" ")),this.audioSection&&(r+=this.audioSection),this.videoSection&&(r+=this.videoSection)}else{i=["a=group:BUNDLE"];this.videoSection&&i.push(t),this.audioSection&&i.push(n),r=this.headerSection.replace(/a=group:BUNDLE [^\r\n]+/,i.join(" ")),this.videoSection&&(r+=this.videoSection),this.audioSection&&(r+=this.audioSection)}return r},parseMsidSemantic:function(e){var t=this._parseLine(e,/a=msid\-semantic:\s*WMS (\S+)/gi);return t&&2==t.length&&(this.msidSemantic={line:t[0],WMS:t[1]}),this.msidSemantic},ssrcSection:function(e,t,n,r){return["a=ssrc:"+e+" cname:"+t,"a=ssrc:"+e+" msid:"+n+" "+r,"a=ssrc:"+e+" mslabel:"+n,"a=ssrc:"+e+" label:"+r,""].join("\n")},parseSSRC:function(e){var t=new RegExp("a=(ssrc):(\\d+) (\\S+):(\\S+)","ig"),n=this._parseLine(e,t);if(n){for(var r={lines:[],updateSSRCSection:this.ssrcSection},i=0;i<n.length;i++){var o=n[i];if(o.indexOf("a=ssrc")>=0)r.lines.push(o);else switch(o){case"ssrc":case"cname":case"msid":case"mslabel":case"label":r[o]=n[++i]}}return r}},_parseLine:function(e,t){for(var n,r=[];null!=(n=t.exec(e));)for(var i=0;i<n.length;i++)r.push(n[i]);if(r.length>0)return r}},c=function(e,t){r.extend(this,s),this._webrtc=t,this.spiltSection(e)};c.isAudioVideo=function(e){return e.indexOf("m=audio")<e.indexOf("m=video")},c.isVideoPreAudio=function(e){var t=e.indexOf("m=audio"),n=e.indexOf("m=video");return t>=0&&n>=0&&n<t};var d=emedia.__rtc_globalCount=0,u=r.prototypeExtend({closed:!1,sdpConstraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},offerOptions:{offerToReceiveAudio:!0,offerToReceiveVideo:!0},optimalVideoCodecs:null,optimalAudioCodecs:null,__init__:function(){this._rtcId||(this._rtcId="RTC"+d++),this.__id="_i_"+d++,this.__setRemoteSDP=!1,this.__tmpRemoteCands=[],this.__tmpLocalCands=[],this._rtcPeerConnection=null,this.cctx=this.__id,emedia&&emedia.config&&emedia.config.forceUseVideoCodecs&&emedia.config.forceUseVideoCodecs.length>0&&(this.optimalVideoCodecs=emedia.config.forceUseVideoCodecs),emedia&&emedia.config&&emedia.config.forceUseAudioCodecs&&emedia.config.forceUseAudioCodecs.length>0&&(this.optimalAudioCodecs=emedia.config.forceUseAudioCodecs),emedia&&emedia.config&&"number"===typeof emedia.config.forceVideoBitrate&&(this.vbitrate=emedia.config.forceVideoBitrate),emedia&&emedia.config&&"number"===typeof emedia.config.forceMinVideoBitrate&&(this.vminBitrate=emedia.config.forceMinVideoBitrate),emedia&&emedia.config&&"number"===typeof emedia.config.forceAudioBitrate&&(this.abitrate=emedia.config.forceAudioBitrate),i.info("Webrtc created. optimal video codecs:",this.optimalVideoCodecs,"audio codecs:",this.optimalAudioCodecs,"vbitrate:",this.vbitrate,"vminBitrate:",this.vminBitrate,"abitrate:",this.abitrate,this._rtcId,this.__id)},getRtcId:function(){return this._rtcId},iceState:function(){return this._rtcPeerConnection.iceConnectionState},setSubArgs:function(e){this.subArgs=e},getReceiversOfPeerConnection:function(){if(this._rtcPeerConnection&&"closed"!=this._rtcPeerConnection.iceConnectionState)return this._rtcPeerConnection.getReceivers()},updateRemoteBySubArgs:function(){this.subArgs&&this._remoteStream&&(emedia.enableVideoTracks(this._remoteStream,!(this.subArgs&&!1===this.subArgs.subSVideo)),emedia.enableAudioTracks(this._remoteStream,!(this.subArgs&&!1===this.subArgs.subSAudio)),i.info("enable tracks remote stream",this._remoteStream,this.subArgs,this._rtcId,this.__id,this.closed))},createRtcPeerConnection:function(e){var t=this;i.debug("begin create peer connection ......",t._rtcId,t.__id,t.closed),e||(e=t.iceServerConfig),e||emedia.isEdge?(e||(e={}),!e.iceServers&&(e.iceServers=[]),e.rtcpMuxPolicy="require",e.bundlePolicy="max-bundle",e.relayOnly&&(e.iceTransportPolicy="relay")):e=null,emedia&&emedia.config&&"function"===typeof emedia.config.reconfigRTCConfiguration&&(e=emedia.config.reconfigRTCConfiguration(e)),emedia.config.useDeployMore&&(emedia.mgr.rtc_url_config||(emedia.mgr.rtc_url_config=new a(emedia.config.rtcConfigUrl||"")),e&&e.iceServers&&(e=emedia.mgr.rtc_url_config.replace_trun_url(e))),i.info("create pc, set config:",e,t._rtcId,t.__id,t.closed);var n=t._rtcPeerConnection=new RTCPeerConnection(e);function r(e){i.info("states: connectionState",n.connectionState,", iceConnectionState",n.iceConnectionState,"@",t._rtcId,t.__id,t.closed);try{var r=n.iceConnectionState||n.connectionState;"failed"!=n.connectionState&&"failed"!=n.iceConnectionState||(r="failed"),t.lastIceConnectionState!==r&&(t.lastIceConnectionState=r,t.onIceStateChange(r))}finally{}}n.__peerId=t._rtcId,i.debug("created local peer connection object",n,t._rtcId),n.onicecandidate=function(e){var n=e.candidate;if("icecandidate"!=e.type||n&&("string"!==typeof n.protocol||"tcp"!==n.protocol.toLowerCase())&&!/ TCP /.test(n.candidate)){if(!n.candidate)throw i.error("Not found candidate. candidate is error"),"Not found candidate. candidate is error,";if(n.cctx=t.cctx,!t.__setRemoteSDP)return(t.__tmpLocalCands||(t.__tmpLocalCands={})).push(n),void i.debug("On ICE candidate ok: but tmp buffer caused by not set remote sdp: ",n,t._rtcId,t.__id,t.closed);i.debug("On ICE candidate ok: ",n,t._rtcId,t.__id,t.closed),t._onIceCandidate(n)}else i.debug("On ICE candidate: drop",n,t._rtcId,t.__id,t.closed)},t.lastIceConnectionState="",n.onconnectionstatechange=r.bind(t),n.onicestatechange=r.bind(t),n.oniceconnectionstatechange=r.bind(t),n.onsignalingstatechange=function(e){i.info("states: signaling",n.signalingState,"@",t._rtcId,t.__id,t.closed)},null===n.ontrack&&t._onTrack&&(n.ontrack=function(e){t._onTrack(e)}),n.onaddstream=function(e){t._onGotRemoteStream(e)}},addTrack:function(e,t){var n=this;e.forEach((function(e){n._rtcPeerConnection.addTrack(e,t),i.debug("Added track(",e.id,e.kind,e.label,") of stream(",t.id,") to RtcPeerConnection",n._rtcId,n.__id,n.closed)}))},setLocalStream:function(e){var t=this;if(t._localStream=e,t._rtcPeerConnection.addTrack)e.getTracks().forEach((function(n){t._rtcPeerConnection.addTrack(n,e),i.debug("Added track(",n.enabled,n.id,n.kind,n.label,") of localStream(",e.id,") to RtcPeerConnection",t._rtcId,t.__id,t.closed)}));else{t._rtcPeerConnection.addStream(e);var n=e.getVideoTracks(),r=e.getAudioTracks();n&&n.length>0&&i.debug("RtcPeerConnection video: ",n[0].enabled,n[0].id,n[0].kind,n[0].label,t._rtcId,t.__id,t.closed),r&&r.length>0&&i.debug("RtcPeerConnection audio: ",r[0].enabled,r[0].id,r[0].kind,r[0].label,t._rtcId,t.__id,t.closed)}i.debug("Added local stream to RtcPeerConnection",e.id,e.active,t._rtcId,t.__id,this.closed)},removeStream:function(e){this._rtcPeerConnection.removeStream(e),i.debug("Remove stream from RtcPeerConnection",e,self._rtcId,self.__id,this.closed)},getLocalStream:function(){return this._localStream},getRemoteStream:function(){return this._remoteStream},createOffer:function(e,t){i.info("start create offer... self.offerOption str",JSON.stringify(this.offerOptions)),i.info("start create offer... self.offerOption",this.offerOptions);var n=this,o=r.extend({},n.offerOptions),a=n.subArgs?{offerToReceiveAudio:!0,offerToReceiveVideo:!0}:JSON.parse(JSON.stringify(n.offerOptions));return n._rtcPeerConnection.createOffer(a).then((function(t){if(i.info("original offer sdp",t),n.offerDescription=t,emedia.isEdge&&(t.sdp=t.sdp.replace(/profile-level-id=[^;]+/,"profile-level-id=42e01f")),emedia.isFirefox?n.fireFoxOfferVideoPreAudio=n.__offerVideoPreAudio=c.isVideoPreAudio(t.sdp):n.__offerVideoPreAudio=c.isVideoPreAudio(t.sdp),t.sdp=t.sdp.replace(/m=video 0/g,"m=video 9"),i.warn("setLocalDescription. modify offer. if 'm=video 0' -> 'm=video 9'; if H264, 'profile-level-id=42e01f'",n._rtcId,n.__id),n.optimalVideoCodecs&&n.optimalVideoCodecs.length>0||n.optimalAudioCodecs&&n.optimalAudioCodecs.length>0||o&&(!1===o.offerToReceiveVideo||!1===o.offerToReceiveAudio)){var r=new c(t.sdp,n);n.optimalVideoCodecs&&r.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&r.updateACodes(n.optimalAudioCodecs),a&&!1===o.offerToReceiveVideo&&r.updateVideoSection(/a=sendrecv|a=recvonly/g,"a=sendonly"),a&&!1===o.offerToReceiveAudio&&r.updateAudioSection(/a=sendrecv|a=recvonly/g,"a=sendonly"),t.sdp=r.getUpdatedSDP()}if(i.debug("setLocalDescription start",n._rtcId,n.__id,n.closed,n.optimalVideoCodecs,n.optimalAudioCodecs),emedia.config.useDTX){t.sdp=t.sdp.replace(/a=rtpmap:(.*)CN\/(.*)\r\n/g,"");var s=t.sdp.match(/a=rtpmap:(.*)\sopus/)[1];t.sdp=t.sdp.replace(new RegExp("a=fmtp:".concat(s,"(.*)\\r\\n")),"a=fmtp:".concat(s,"$1;usedtx=1\r\n"))}n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then((function(){t.cctx=n.cctx,(e||n.onCreateOfferSuccess.bind(n))(t)}))}),t||n._onCreateSessionDescriptionError.bind(n,a))},createPRAnswer:function(e,t){var n=this;return i.info(" createPRAnswer start",n.closed,n.sdpConstraints),n._rtcPeerConnection.createAnswer(n.sdpConstraints).then((function(t){i.debug("_____________PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),t.type="pranswer",t.sdp=t.sdp.replace(/a=recvonly/g,"a=inactive");var r=new c(t.sdp,n);n.optimalVideoCodecs&&r.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&r.updateACodes(n.optimalAudioCodecs),t.sdp=r.getUpdatedSDP(),n.__prAnswerDescription=t,i.debug("inactive PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),i.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then((function(){r.updateHeaderMsidSemantic("MS_0000"),r.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),r.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=r.getUpdatedSDP(),i.debug("Send PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),n.cctx&&(t.cctx=n.cctx),(e||n.onCreatePRAnswerSuccess.bind(n))(t)}))}),t||n._onCreateSessionDescriptionError.bind(n,n.sdpConstraints))},createAnswer:function(e,t){var n=this;return i.info("createAnswer start",n.closed,n.sdpConstraints),n._rtcPeerConnection.createAnswer(n.sdpConstraints).then((function(t){i.debug("_____________________Answer ",n._rtcId,n.__id,n.closed),t.type="answer";var r=new c(t.sdp,n);n.optimalVideoCodecs&&r.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&r.updateACodes(n.optimalAudioCodecs),emedia.supportPRAnswer?function(e){var n=e.parseMsidSemantic(e.headerSection);if(n){"*"==n.WMS&&e.updateHeaderMsidSemantic(n.WMS="MS_0000");var r=e.parseSSRC(e.audioSection),i=e.parseSSRC(e.videoSection);r&&e.updateAudioSSRCSection(1e3,"CHROME0000",n.WMS,r.label||"LABEL_AUDIO_1000"),i&&e.updateVideoSSRCSection(2e3,"CHROME0000",n.WMS,i.label||"LABEL_VIDEO_2000"),t.sdp=e.getUpdatedSDP()}}(r):t.sdp=r.getUpdatedSDP(),n.__answerDescription=t,i.debug("Answer ",n._rtcId,n.__id,n.closed),i.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then((function(){emedia.supportPRAnswer&&(r.updateHeaderMsidSemantic("MS_0000"),r.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),r.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=r.getUpdatedSDP()),i.debug("Send Answer ",n._rtcId,n.__id,n.closed),n.cctx&&(t.cctx=n.cctx),(e||n.onCreateAnswerSuccess.bind(n))(t)}))}),t||n._onCreateSessionDescriptionError.bind(n,n.sdpConstraints))},_printStats:function(e){var t=this;t.confrAttendee&&emedia.config.remainLastStatsCount&&e&&e.getTracks().forEach((function(e){t._printTrackStats(e)}))},_printTrackStats:function(e){if(this.confrAttendee&&emedia.config.remainLastStatsCount){var t=this.confrAttendee._trackStats&&this.confrAttendee._trackStats[e.id];if(t){for(var n in t){var o=t[n];for(var a in o){var s=o[a];if(s)for(var c=s.curIndex,d=0;d<emedia.config.remainLastStatsCount;d++){var u=s[c=(c-1)%emedia.config.remainLastStatsCount];if(!u||void 0===u.data)break;i.info("[track]",this._rtcId,this.__id,e.kind,e.id,n,a,u.data,u.timestamp.toLocaleString())}}}r.removeAttribute(this.confrAttendee._trackStats,e.id)}}},close:function(e,t,n){var r=this;if(i.warn("webrtc closing",r._rtcId,r.__id,r.closed),r.__iceWaitIntervalId&&clearTimeout(r.__iceWaitIntervalId),!r.closed){t=!0===t,r.closed=!0;try{var o=r._localStream,a=r._remoteStream;function s(){if(r._rtcPeerConnection&&r._rtcPeerConnection.close(),i.info("peer connection close. it is",r._rtcPeerConnection&&r._rtcPeerConnection.__peerId),!n&&emedia.isSafari){r._rtcPeerConnection.iceConnectionState||r._rtcPeerConnection.connectionState;setTimeout((function(){r._rtcPeerConnection.iceConnectionState||r._rtcPeerConnection.connectionState;r.onIceStateChange&&r.onIceStateChange("closed")}),200)}}emedia.config.printStatsWhenPCClose?r.getStats((function(){s(),o&&r._printStats(o),a&&r._printStats(a)})):s()}catch(c){i.warn(c)}finally{r._localStream&&!1===e&&emedia.stopTracks(r._localStream),r._remoteStream&&emedia.stopTracks(r._remoteStream),r._remoteStream=null,t||r.onClose&&r.onClose(),!0===n&&(i.info("Webrtc close. but retry build. will onIceStateChange(failed). eg. emedia.config iceWaitBuildMillis",r._rtcId,r.__id),r.onIceStateChange&&r.onIceStateChange("failed")),i.warn("webrtc closed. closed:",r._rtcId,r.__id,r.closed)}}},addIceCandidate:function(e){console.log("addIceCandidate candidate",JSON.stringify(e));var t=r.isArray(e)?e:[e];if(emedia.mgr.rtc_url_config&&(t=emedia.mgr.rtc_url_config.replace_candidates(t)),emedia&&emedia.config&&"function"===typeof emedia.config.reChanageCandidate){for(var n=[],o=0;o<t.length;o++){e=t[o];var a=emedia.config.reChanageCandidate(e);a&&(i.info("Candidate rechanage. addons. it =",e,"->",a),r.isArray(a)?Array.prototype.push.apply(n,a):n.push(a))}t=n}this._addIceCandidate(t)},_addIceCandidate:function(e){if(this._rtcPeerConnection){i.debug("Add ICE candidate: ",e,this._rtcId,this.__id,this.closed);var t=r.isArray(e)?e:[e];if(!this.__setRemoteSDP)return Array.prototype.push.apply(this.__tmpRemoteCands||(this.__tmpRemoteCands={}),t),void i.debug("Add ICE candidate but tmp buffer caused by not set remote sdp: ",e,this._rtcId,this.__id,this.closed);for(var n=0;n<t.length;n++)if((e=t[n]).cctx&&e.cctx!=this.cctx)i.warn("addIceCandidate fail drop. cctx not equal. ",e,this._rtcId,this.__id,this.closed);else{if(!0===this.fireFoxOfferVideoPreAudio){var o=e.sdpMLineIndex;e.sdpMLineIndex=parseInt(e.sdpMid.replace(/[^0-9]*/,"")),i.warn("Firefox sdp section video pre audio, sdp mline index update ",o,"->",e.sdpMLineIndex)}e.candidate&&""!==e.candidate?this._rtcPeerConnection.addIceCandidate(new RTCIceCandidate(e)).then(this.onAddIceCandidateSuccess.bind(this),this._onAddIceCandidateError.bind(this,e)):i.warn("Add ICE candidate fail. drop it ",e,this._rtcId,this.__id,this.closed)}}},setRemoteDescription:function(e){return this._setRemoteDescription(e)},_setRemoteDescription:function(e){var t=this;if(t.__iceWaitIntervalId&&(clearTimeout(t.__iceWaitIntervalId),t.__iceWaitIntervalId=null,i.info("emedia.config iceWaitBuildMillis, clear ice wait interval id",t._rtcId,t.__id)),i.debug("setRemoteDescription start. ",t._rtcId,t.__id,t.closed),t.offerDescription){if(e.cctx&&e.cctx!=t.cctx)return void i.warn("setRemoteDescription fail drop. cctx not equal. ",e,t._rtcId,t.__id,t.closed);if(!0===t.fireFoxOfferVideoPreAudio||!0===t.__offerVideoPreAudio){var n=new c(e.sdp,t);e.sdp=n.getUpdatedSDP(!1),i.info("Remote sdp.2. switch audio video",e.sdp)}}else e.cctx&&(t.cctx=e.cctx);if(e.sdp=e.sdp.replace(/UDP\/TLS\/RTP\/SAVPF/g,"RTP/SAVPF"),i.warn("setRemoteDescription. UDP/TLS/RTP/SAVPF -> RTP/SAVPF; if firefox: switch audio video;",t._rtcId,t.__id),t.vbitrate||t.abitrate||t.vminBitrate){n=new c(e.sdp,t);t.vbitrate&&n.setVideoBitrate(t.vbitrate),t.vminBitrate&&n.setVideoMinBitrate(t.vminBitrate),t.abitrate&&n.setAudioBitrate(t.abitrate),i.warn("vbitrate = ",t.vbitrate,"vminBitrate = ",this.vminBitrate,", abitrate = ",t.abitrate,t._rtcId,t.__id),e.sdp=n.getUpdatedSDP("undefined"===typeof t.__offerVideoPreAudio||null===t.__offerVideoPreAudio?void 0:!t.__offerVideoPreAudio)}return i.debug("final remote sdp =",e.sdp,t._rtcId,t.__id),e=t.__remoteDescription=new RTCSessionDescription(e),t._rtcPeerConnection.setRemoteDescription(e).then((function(){t.__setRemoteSDP=!0,t._onSetRemoteSuccess.apply(t,arguments),t.__tmpLocalCands&&t.__tmpLocalCands.length>0&&(i.debug("After setRemoteDescription. send cands",t._rtcId,t.__id,t.closed),t._onIceCandidate(t.__tmpLocalCands),t.__tmpLocalCands=[]),t.__tmpRemoteCands&&t.__tmpRemoteCands.length>0&&(i.debug("After setRemoteDescription. add tmp cands",t._rtcId,t.__id,t.closed),t._addIceCandidate(t.__tmpRemoteCands),t.__tmpRemoteCands=[])}),t._onSetSessionDescriptionError.bind(t,e))},iceConnectionState:function(){return this._rtcPeerConnection.iceConnectionState},isConnected:function(){var e=this.lastIceConnectionState;return"connected"===e||"completed"===e},_onGotRemoteStream:function(e){var t=this;t._remoteStream=e.stream||e.streams[0],t._remoteStream._rtcId=t._rtcId,t._remoteStream.__rtc_c_id=t.__id,i.debug("On got remote stream",t._remoteStream?t._remoteStream.id+"_"+t._remoteStream.active:"null",t._rtcId,t.__id),t._remoteStream&&t._remoteStream.getTracks().forEach((function(e){i.debug("remote stream",t._remoteStream.id," track =",e.enabled,e.id,e.kind,e.label,t._rtcId,t.__id)})),t.updateRemoteBySubArgs(),this.onGotRemoteStream(this._remoteStream,e),i.debug("received remote stream, you will see the other.",t._rtcId,t.__id,this.closed)},_onSetRemoteSuccess:function(){i.info("onSetRemoteSuccess success",this._rtcId,this.__id),this.onSetRemoteSuccess.apply(this,arguments),this.offerDescription&&this.__remoteDescription&&this.__remoteDescription.sdp&&this._onAnswerCodes(this.__remoteDescription.sdp)},_onAnswerCodes:function(e){var t=new c(e,this);if(t.videoSection){var n=o.parseRtpParameters(t.videoSection);if(!n.codecs||0===n.codecs.length)return void i.info("not found any video codes. @ ",this._rtcId,this.__id);var a=[],s={};r.forEach(n.codecs,(function(e,t){!0!==s[t.name]&&(s[t.name]=!0,a.push(t.name))})),this.finalVCodeChoices=a,this.onVCodeChoices&&this.onVCodeChoices(a)}},onSetRemoteSuccess:function(){},onAddIceCandidateSuccess:function(){i.debug("addIceCandidate success",this._rtcId,this.__id)},_onAddIceCandidateError:function(e,t){i.error("failed to add ICE Candidate: "+t.toString(),", error candidate:",e,this._rtcId,this.__id),this.onAddIceCandidateError(t)},onAddIceCandidateError:function(e){},_onIceCandidate:function(e){i.debug("onIceCandidate:",e,this._rtcId,this.__id),this.onIceCandidate(e)},onIceCandidate:function(e){},onIceStateChange:function(e){i.debug("onIceStateChange : ICE state ",e)},_onCreateSessionDescriptionError:function(e,t){i.error("Failed to create session description: "+t.toString()," offerOptionsOrSDPConstraints:",e,this._rtcId,this.__id),this.onCreateSessionDescriptionError(t)},onCreateSessionDescriptionError:function(e){},onCreateOfferSuccess:function(e){i.debug("create offer success",this._rtcId,this.__id)},onCreatePRAnswerSuccess:function(e){i.debug("create answer success",this._rtcId,this.__id)},onCreateAnswerSuccess:function(e){i.debug("create answer success",this._rtcId,this.__id)},_onSetSessionDescriptionError:function(e,t){i.error("onSetSessionDescriptionError : Failed to set session description: ",t.toString(),this._rtcId,this.__id),e&&e.type&&e.sdp&&i.error("error sdp: type=",e.type,"sdp=",e.sdp,this._rtcId,this.__id),this.onSetSessionDescriptionError(t)},onSetSessionDescriptionError:function(e){},_onSetLocalSessionDescriptionSuccess:function(){var e=this;i.debug("onSetLocalSessionDescriptionSuccess : setLocalDescription complete",this._rtcId,this.__id),emedia.config.iceWaitBuildMillis&&(this.__iceWaitIntervalId&&clearTimeout(this.__iceWaitIntervalId),this.__iceWaitIntervalId=setTimeout((function(){i.info("emedia.config iceWaitBuildMillis, timeout, will close webrtc, will retry build by onIceStateChange(failed)",e._rtcId,e.__id),e.onIceStateChange&&e.onIceStateChange("failed")}),emedia.config.iceWaitBuildMillis),i.info("emedia.config iceWaitBuildMillis, start timeout",e._rtcId,e.__id)),this.onSetLocalSessionDescriptionSuccess(),this.__answerDescription&&this.__answerDescription.sdp&&this._onAnswerCodes(this.__answerDescription.sdp)},onSetLocalSessionDescriptionSuccess:function(){},onGotRemoteStream:function(e){i.debug("Got remote stream. ",e,this._rtcId,this.__id)},getStats:function(e){var t=this;return t._rtcPeerConnection?"function"!==typeof emedia.config.rtcStatsTypeMath?(i.warn("Get stats, but config rtcStatsTypeMather, ",this._rtcId,this.__id),void(e&&e())):void t._rtcPeerConnection.getStats(null).then((function(n){n.forEach((function(e,n){emedia.config.rtcStatsTypeMath(e,n)&&i.info("Rtc stats",e,t._rtcId,t.__id)})),e&&e(n)})):(i.warn("Get stats, but peer connection not exsits, ",this._rtcId,this.__id),void(e&&e()))}});e.exports=u},175:function(e,t,n){var r,i=n(7),o=i.tagLogger("PCStats");e.exports=r=i.prototypeExtend({__init__:function(){this._webrtc||this._stream&&(this._webrtc=this._stream._webrtc),this.samplesDatas={},this.gatherResults={},this._bysamples={},!1!==this._inbound_&&(this._bysamples["inbound-rtp"]=["bytesRateReceived","packageLossRate","bytesReceived","packetsLost","packetsReceived","pliCount","framesDecoded"]),!1!==this._outbound_&&(this._bysamples["outbound-rtp"]=["bytesRateSent","bytesSent","packetsSent","qpSum","pliCount"])},_onGatherResult:function(e,t,n,r){if(this._service&&this._service.current&&emedia.config.remainLastStatsCount){var i=this._service.current._trackStats;i||(i=this._service.current._trackStats={});var o=(i[e]||(i[e]={}))[t];o||(o=i[e][t]={});var a=o[n];a||(a=o[n]=new Array(emedia.config.remainLastStatsCount)),void 0===a.curIndex&&(a.curIndex=0),a[a.curIndex]={data:r,timestamp:new Date},a.curIndex=(a.curIndex+1)%emedia.config.remainLastStatsCount}"function"===typeof this.onGatherResult&&this.onGatherResult(e,t,n,r)},stats:function(e){if(this._webrtc&&this._webrtc._rtcPeerConnection)return this._webrtc._rtcPeerConnection.getStats(e);o.warn("not found webrtc or peer connection")},statsOfTrack:function(e){if(!e instanceof window.MediaStreamTrack)throw o.error("selector not a MediaStreamTrack"),"selector not a MediaStreamTrack";return this.stats(e)},audioTrack:function(e){var t=e&&e.getAudioTracks();return t&&t.length?t[0]:void 0},videoTrack:function(e){var t=e&&e.getVideoTracks();return t&&t.length?t[0]:void 0},gatherTrack:function(e,t){var n=this;t=(t=e.kind||t)&&t.toLowerCase();var r=e.id;this.statsOfTrack(e).then((function(i){n.samplesDatas[r]||(n.samplesDatas[r]={});var a=n.samplesDatas[r];i.forEach((function(r,i){var s=n._bysamples[r.type],c=r.mediaType||i.indexOf("ideo")>=0&&"video"||i.indexOf("udio")>=0&&"audio"||void 0;if(s&&s.length&&(!0===emedia.config._printDebugStats&&o.debug(i,r,e,c,t),!c||c===t)){var d=a[r.type]||(a[r.type]={});s.forEach((function(n){var i=d[n]||(d[n]=[]),o={timestamp:r.timestamp,kind:r.mediaType||e.kind||t};o[n]="packageLossRate"===n?{packetsLost:r.packetsLost,packetsReceived:r.packetsReceived}:"bytesRateReceived"===n?r.bytesReceived:"bytesRateSent"===n?r.bytesSent:r[n],i.push(o)}))}}))}))},gatherWebrtcMediaStream:function(e,t){var n=this;t?"audio"!==t.toLowerCase()?"video"!==t.toLowerCase()||e.getVideoTracks().forEach((function(e){n.gatherTrack(e,e.kind||t.toLowerCase())})):e.getAudioTracks().forEach((function(e){n.gatherTrack(e,e.kind||t.toLowerCase())})):e.getTracks().forEach((function(e){n.gatherTrack(e)}))},gatherWebrtc:function(){this._webrtc._localStream&&this.gatherWebrtcMediaStream(this._webrtc._localStream),this._webrtc._remoteStream&&this.gatherWebrtcMediaStream(this._webrtc._remoteStream)},_gather_inbound_rtp_packageLossRate:function(e){if(!e||0===e.length)return 0;var t=0,n=0;if(e.length>1)for(var r=1;r<e.length;r++){var i=e[r],o=e[r-1];i.packageLossRate.packetsReceived!=o.packageLossRate.packetsReceived?(t+=(i.packageLossRate.packetsLost-o.packageLossRate.packetsLost)/(i.packageLossRate.packetsReceived-o.packageLossRate.packetsReceived),n++):(t=0,n=0)}return e.length>=emedia.config.statsSeconds&&e.shift(),0==n?0:t/n},_gatherBytesRate:function(e,t,n){if(!n||0===n.length)return 0;var r=n[n.length-1][t]-n[0][t],i=n[n.length-1].timestamp-n[0].timestamp;return n.length>=emedia.config.statsSeconds&&n.shift(),0===i?0:parseFloat(1e3*r/i).toFixed(2)},_gather:function(e,t,n){e=e.replace(/[^\w]/g,"_"),t=t.replace(/[^\w]/g,"_");var r=i.list("_gather",e,t).join("_");if("function"===typeof this[r])return this[r](n);if(t.startsWith("bytesRate"))return this._gatherBytesRate(e,t,n);var o=n.shift();return o&&o[t]||0},_statsCount:function(){var e=this;i.forEach(e.samplesDatas,(function(t,n){!function(t,n,r){i.forEach(r,(function(r,o){var a=n[r]||(n[r]={});!function(t,n,r,o){i.forEach(o,(function(i,o){var a=n[i]=e._gather(r,i,o);e._onGatherResult(t,r,i,a)}))}(t,a,r,o)}))}(t,e.gatherResults[t]=e.gatherResults[t]||{},n)}))},gather:function(){this.gatherWebrtc(),this._statsCount()},intervalGather:function(e){this._intervalId&&clearInterval(this._intervalId),this._intervalId=setInterval(this.gather.bind(this),e||1e3)},stopIntervalGather:function(){this._intervalId&&clearInterval(this._intervalId)}});var a={},s=r.echo=function(e){i.forEach(e,(function(e,t){var n;!a[t.id]&&t._webrtc&&!t._webrtc.closed&&t.getMediaStream()?(a[t.id]=n=new r({_webrtc:t._webrtc}),n._mediaStream=t.getMediaStream()):!a[t.id]||t._webrtc&&!t._webrtc.closed&&t.getMediaStream()||i.removeAttribute(a,t.id)}));var t=[];i.forEach(a,(function(n,r){e&&e[n]?(r.gatherWebrtcMediaStream(r._mediaStream),r._statsCount()):t.push(n)})),i.forEach(t,(function(e,t){i.removeAttribute(a,t)}))};r.intervalEcho=function(e,t){return setInterval((function(){s(e)}),t)},i.forEach(["inbound","outbound"],(function(e,t){i.forEach(["Audio","Video"],(function(e,n){!function(e,t){var n;r[e+t]=n=function(o,a,s){var c;n.__intervalIds||(n.__intervalIds={}),c=this instanceof emedia.XService?this:emedia.useCurrentXService;var d=o.id+"___"+c.namespace,u=n.__intervalIds&&n.__intervalIds[d];return u&&clearInterval(u),u=setInterval((function(){var s,l=n[d];(!l&&o&&o._webrtc&&!o._webrtc.closed&&o.getMediaStream()?(n[d]=l=new r({_webrtc:o._webrtc,_inbound_:"inbound"===e,_outbound_:"outbound"===e}),l._service=c,a&&(l.onGatherResult=a),l._mediaStream=o.getMediaStream()):!l||o&&o._webrtc&&!o._webrtc.closed&&o._webrtc.__id===l._webrtc.__id&&o.getMediaStream()&&l._mediaStream&&l._mediaStream.id===o.getMediaStream().id||(i.removeAttribute(n,d),l=null),l)?(l.gatherWebrtcMediaStream(l._mediaStream,t),l._statsCount()):o&&c&&(s=c.getStreamById(o.id))?o=s:u&&clearInterval(u)}),s),n.__intervalIds[d]=u,u}}(t,n)}))}))},176:function(e,t,n){var r,i=n(7).tagLogger("DefaultTrack"),o=n(140);e.exports=r=o.extend({__init__:function(){this._canvas||(this._canvas=function(e){var t;return t=document.createElement("canvas"),e.appendChild(t),t.style.cssText="position: absolute; background: transparent; width: 100%; height: 100%",t.width=e.offsetWidth,t.height=e.offsetHeight,i.warn("Canvas",t.width,t.height),t}(this._target)),this._canvasContext||(this._canvasContext=this._canvas.getContext("2d"))},resizeCanvas:function(){},_calPosition:function(){var e=o.prototype._calPosition.apply(this,arguments);return e.x=Math.floor(e.x*this._canvas.width/e.width),e.y=Math.floor(e.y*this._canvas.height/e.height),e},_draw:function(e,t,n,r,i,o){var a=this._canvasContext;(!t||t<=1)&&(t=2);var s=a.getImageData(e.x-t/2,e.y-t/2,t,t);s&&function(e,t,n,r,i){for(var o=0,a=e.data;o<a.length;o+=4){var s={r:void 0===t?a[o]:t,g:void 0===n?a[o+1]:n,b:void 0===r?a[o+2]:r,alpha:void 0===i?a[o+3]:i};a[o]=s.r,a[o+1]=s.g,a[o+2]=s.b,a[o+3]=s.alpha}}(s,n,r,i,o),a.putImageData(s,e.x,e.y)},redraw:function(e,t,n,i,o,a){r.prototype._draw.bind(this)({x:e,y:t},2)},onMouseTrigger:function(e,t){e.isLeftKey()&&this._draw(e.xy,8,189,56,51,255),e.isRightKey()&&this._draw(e.xy,8,45,23,189,255),e.isWheelKey()&&this._draw(e.xy,8,58,189,76,255)},onMouseTrack:function(e,t,n){this._draw(e,2,227,18,247,255)}})},202:function(e,t){var n=function(){},r=function(e){e=e||!0;var t=function(){try{return new window.XMLHttpRequest}catch(e){return!1}}()||function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}}();if("withCredentials"in t)return t;if(!e)return t;if("undefined"===typeof window.XDomainRequest)return t;var r=new XDomainRequest;return r.readyState=0,r.status=100,r.onreadystatechange=n,r.onload=function(){r.readyState=4,r.status=200;var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false",e.loadXML(r.responseText),r.responseXML=e,r.response=r.responseText,r.onreadystatechange()},r.ontimeout=r.onerror=function(){r.readyState=4,r.status=500,r.onreadystatechange()},r},i={102:{error_code:102,error_msg:"Server disconnect"},10:{error_code:10,error_msg:"Whiteboards don't exist"},15:{error_code:15,error_msg:"Wrong roomname or password"},20:{error_code:20,error_msg:"Token authentication failed"},25:{error_code:25,error_msg:"Whiteboard creation failed"},30:{error_code:30,error_msg:"Whiteboard name can't be null"},35:{error_code:35,error_msg:"Permission Denied"},40:{error_code:40,error_msg:"Wrong roomname or password"},45:{error_code:45,error_msg:"The whiteboard name has been used"},50:{error_code:50,error_msg:"Wrong data, please login again"},99:{error_code:99,error_msg:"Unpredictable error"}},o=function(e){var t=e.dataType||"text",o=e.success||n,a=e.error||n,s=r();s.onreadystatechange=function(){if(4===s.readyState){if(200!==(s.status||0))return void a({data:s.responseText});try{switch(t){case"text":o(s.responseText);break;case"json":var e=function(e){if(window.JSON&&window.JSON.parse)return window.JSON.parse(e+"");var t,n=null,r=utils.trim(e+"");return r&&!utils.trim(r.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,(function(e,r,i,o){return t&&r&&(n=0),0===n?e:(t=i||r,n+=!o-!i,"")})))?Function("return "+r)():Function("Invalid JSON: "+e)()}(s.responseText);if(0==e.status&&e.error_code)return a(Object.assign({status:0},i[e.error_code]));o(e,s);break;case"xml":s.responseXML&&s.responseXML.documentElement?o(s.responseXML.documentElement,s):a({data:s.responseText});break;default:o(s.response||s.responseText,s)}}catch(n){console.warn(n),a(Object.assign({status:0},i[99]))}}0===s.readyState&&a({data:s.responseText})},e.responseType&&s.responseType&&(s.responseType=e.responseType),e.mimeType&&utils.hasOverrideMimeType&&s.overrideMimeType(e.mimeType);var c=e.type||"POST",d=e.data||null,u="";if("get"===c.toLowerCase()&&d){for(var l in d)d.hasOwnProperty(l)&&(u+=l+"="+d[l]+"&");u=u?u.slice(0,-1):u,e.url+=(e.url.indexOf("?")>0?"&":"?")+(u?u+"&":u)+"_v="+(new Date).getTime(),d=null,u=null}if(s.open(c,e.url,s.setRequestHeader),s.setRequestHeader){var f=e.headers||{};for(var m in f)f.hasOwnProperty(m)&&s.setRequestHeader(m,f[m])}return window.XDomainRequest&&(s.readyState=2),s.send(d),s},a=function(e){"http:"!=e.restApi&&"https:"!=e.restApi||(e.restApi=""),this.restApi=e.restApi,this.appKey=e.appKey,this.orgName=e.appKey.split("#")[0],this.appName=e.appKey.split("#")[1],this.dnsArr=["https://rs.easemob.com","http://182.92.174.78","http://112.126.66.111"],this.dnsIndex=0,this.restIndex=0,this.restHosts=[]};a.prototype.getRestFromHttpDNS=function(e){if(this.restIndex>=this.restHosts.length)return!1;var t="",n=this.restHosts[this.restIndex],r=n.domain,i=n.ip;if(i){var o=n.port;t=("https:"===location.protocol?"https:":"http:")+"//"+i+":"+o}else t=("https:"===location.protocol?"https:":"http:")+"//"+r;return""!=t&&(this.apiUrl=t),t},a.prototype.getHttpDNS=function(e){var t=this;if(this.appKey){var n={url:this.dnsArr[this.dnsIndex]+"/easemob/server.json",dataType:"json",type:"GET",data:{app_key:encodeURIComponent(this.appKey)},success:function(n,r){var i=n.rest.hosts;if(i){for(var o=location.protocol,a=0;a<i.length;a++)if(i[a].protocol===o){var s=i[a];i.splice(a,1),i.unshift(s)}t.restHosts=i,e.suc({restHosts:i})}},error:function(n,r,i){if(t.dnsIndex++,t.dnsIndex<t.dnsArr.length)return t.getHttpDNS.call(t,e);e.error(n)}};o(n)}else console.warn("appKey illegal")},a.prototype.create=function(e){if(this.restApi)i.call(this);else{var t=this,n=function(e){t.restApi=t.getRestFromHttpDNS(),i.call(t)},r=function(r){if(t.restIndex++,t.getRestFromHttpDNS())return n();e.error(r)};this.getHttpDNS({suc:n,error:r})}function i(){var t={url:this.restApi+"/"+this.orgName+"/"+this.appName+"/whiteboards/",dataType:"json",type:"POST",data:JSON.stringify({userId:e.userName,whiteBoardName:e.roomName,password:e.password}),headers:{Authorization:"Bearer "+e.token,"Content-Type":"application/json"},success:e.suc,error:r};o(t)}},a.prototype.join=function(e){if(this.restApi)i.call(this);else{var t=this,n=function(e){t.restApi=t.getRestFromHttpDNS(),i.call(t)},r=function(r){if(t.restIndex++,t.getRestFromHttpDNS())return n();e.error(r)};this.getHttpDNS({suc:n,error:r})}function i(){var t={url:this.restApi+"/"+this.orgName+"/"+this.appName+"/whiteboards/joinorcreate/byname/",dataType:"json",type:"POST",data:JSON.stringify({userId:e.userName,whiteBoardName:e.roomName,password:e.password}),headers:{Authorization:"Bearer "+e.token,"Content-Type":"application/json"},success:e.suc,error:r};o(t)}},a.prototype.joinByRoomName=function(e){if(this.restApi)i.call(this);else{var t=this,n=function(e){t.restApi=t.getRestFromHttpDNS(),i.call(t)},r=function(r){if(t.restIndex++,t.getRestFromHttpDNS())return n();e.error(r)};this.getHttpDNS({suc:n,error:r})}function i(){var t={url:this.restApi+"/"+this.orgName+"/"+this.appName+"/whiteboards/url-by-name/",dataType:"json",type:"POST",data:JSON.stringify({userId:e.userName,whiteBoardName:e.roomName,password:e.password}),headers:{Authorization:"Bearer "+e.token,"Content-Type":"application/json"},success:e.suc,error:r};o(t)}},a.prototype.joinByRoomId=function(e){if(this.restApi)i.call(this);else{var t=this,n=function(e){t.restApi=t.getRestFromHttpDNS(),i.call(t)},r=function(r){if(t.restIndex++,t.getRestFromHttpDNS())return n();e.error(r)};this.getHttpDNS({suc:n,error:r})}function i(){var t={url:this.restApi+"/"+this.orgName+"/"+this.appName+"/whiteboards/"+e.roomId+"/url/",dataType:"json",type:"POST",data:JSON.stringify({userId:e.userName,roomId:e.roomId,password:e.password}),headers:{Authorization:"Bearer "+e.token,"Content-Type":"application/json"},success:e.suc,error:r};o(t)}},a.prototype.destroy=function(e){if(this.restApi)i.call(this);else{var t=this,n=function(e){t.restApi=t.getRestFromHttpDNS(),i.call(t)},r=function(r){if(t.restIndex++,t.getRestFromHttpDNS())return n();e.error(r)};this.getHttpDNS({suc:n,error:r})}function i(){var t={url:this.restApi+"/"+this.orgName+"/"+this.appName+"/whiteboards/"+e.roomId+"/",dataType:"json",type:"DELETE",data:JSON.stringify({userId:e.userName}),headers:{Authorization:"Bearer "+e.token,"Content-Type":"application/json"},success:e.suc,error:r};o(t)}},e.exports=a},218:function(e,t,n){e.exports=n(487)},223:function(e,t,n){},258:function(e,t,n){},259:function(e,t,n){"use strict";n.r(t);var r=emedia.singleWebrtcAdapter;emedia.util.logger.warn("webrtc-adapter must load once. if more, safari may initC sdp error(too many audio video, easemob server dont work)"),r?emedia.util.logger.error("webrtc-adapter repeated load, safari may dont work"):function(){if(document.documentMode){var e=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],t=parseInt(e[1],10);t||(e=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],t=parseInt(e[1]||"0",10)),emedia.util.logger.error("adapter.ie not required"),r.__browser="IE",r.__browserVersion=t}else r=n(260),emedia.util.logger.info("webrtc-adapter load first"),function(){function e(e,t){e.srcObject=t,emedia.isSafari&&(e.pause(),e.play());var n=emedia.util.logger||window.console||console;if(n){if(t&&n.info("stream attach videoTag.",t.id,t._located,">>",e.id,e.muted,e.volume,e),t||n.info("stream(null) attach videoTag.",e.id,e.muted,e.volume,e),!e.hxSetOnvolumechange){var r=e.onvolumechange;e.onvolumechange=function(){n.debug("stream attach detail: video tag volume chanage",e.volume,t?t.id:t),r&&r.apply(e,arguments)},e.hxSetOnvolumechange=!0}if(!e.hxSetOnstalled){var i=e.onstalled;e.onstalled=function(){n.debug("stream attach detail: video tag onstalled",t?t.id:t),i&&i.apply(e,arguments)},e.hxSetOnstalled=!0}if(!e.hxSetOnabort){var o=e.onabort;e.onabort=function(){n.debug("stream attach detail: video tag onabort",t?t.id:t),o&&o.apply(e,arguments)},e.hxSetOnabort=!0}if(!e.hxSetOncanplay){var a=e.oncanplay;e.oncanplay=function(){t&&t.getTracks().forEach((function(e){"function"===typeof e.getSettings&&n.debug("stream attach detail",t.id," track setting =",e.enabled,e.id,e.kind,e.label,e.getSettings())})),n.debug("stream attach detail: video tag",e.videoWidth,"x",e.videoHeight,t?t.id:t),a&&a.apply(e,arguments)},e.hxSetOncanplay=!0}}}window.attachMediaStream&&!0!==window.attachMediaStream._wrapped&&(window.__attachMediaStream=window.attachMediaStream);window.attachMediaStream=function(t,n,r,i){function o(){r=!!(void 0===r?n._located:r),t.muted=!1,r!==t.muted&&(t.muted=!0)}if(i||(i=window.__attachMediaStream)||(i=e.bind(this)),t){if(n)return t.srcObject&&t.srcObject._located&&n._located&&t.srcObject.id===n.id?t.srcObject:(o(),i(t,n),t);i(t,n)}},window.attachMediaStream._wrapped=!0,console&&"function"===typeof console.info&&console.info("Wrap the attachMediaStream ",r.__browser,r.__browserVersion)}();emedia.singleWebrtcAdapter=r}(),r.__browser=r.__browser||r.browserDetails.browser,r.__browserVersion=r.__browserVersion||r.browserDetails.version,emedia.util.logger.info("Current browser",r.__browser,r.__browserVersion),"Not a supported browser."===r.__browser&&emedia.util.logger.error("Not a supported browser"),t.default=r},260:function(e,t,n){e.exports=function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,(function(e){return i(t[a][1][e]||e)}),d,d.exports,e,t,n,r)}return n[a].exports}for(var o=!1,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";console.warn("webrtc adapter version: 7.6.1");var r=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=r},{"./adapter_factory.js":2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.adapterFactory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},d=r.log,u=r.detectBrowser(t),l={browserDetails:u,commonShim:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(u.browser){case"chrome":if(!i||!i.shimPeerConnection||!n.shimChrome)return d("Chrome shim is not included in this adapter release."),l;if(null===u.version)return d("Chrome shim can not determine version, not shimming."),l;d("adapter.js shimming chrome."),l.browserShim=i,i.shimGetUserMedia(t),i.shimMediaStream(t),i.shimPeerConnection(t),i.shimOnTrack(t),i.shimAddTrackRemoveTrack(t),i.shimGetSendersWithDtmf(t),i.shimGetStats(t),i.shimSenderReceiverGetStats(t),i.fixNegotiationNeeded(t),c.shimRTCIceCandidate(t),c.shimConnectionState(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t),c.removeAllowExtmapMixed(t);break;case"firefox":if(!a||!a.shimPeerConnection||!n.shimFirefox)return d("Firefox shim is not included in this adapter release."),l;d("adapter.js shimming firefox."),l.browserShim=a,a.shimGetUserMedia(t),a.shimPeerConnection(t),a.shimOnTrack(t),a.shimRemoveStream(t),a.shimSenderGetStats(t),a.shimReceiverGetStats(t),a.shimRTCDataChannel(t),a.shimAddTransceiver(t),a.shimCreateOffer(t),a.shimCreateAnswer(t),c.shimRTCIceCandidate(t),c.shimConnectionState(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t);break;case"edge":if(!o||!o.shimPeerConnection||!n.shimEdge)return d("MS edge shim is not included in this adapter release."),l;d("adapter.js shimming edge."),l.browserShim=o,o.shimGetUserMedia(t),o.shimGetDisplayMedia(t),o.shimPeerConnection(t),o.shimReplaceTrack(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t);break;case"safari":if(!s||!n.shimSafari)return d("Safari shim is not included in this adapter release."),l;d("adapter.js shimming safari."),l.browserShim=s,s.shimRTCIceServerUrls(t),s.shimCreateOfferLegacy(t),s.shimCallbacksAPI(t),s.shimLocalStreamsAPI(t),s.shimRemoteStreamsAPI(t),s.shimTrackEventTransceiver(t),s.shimGetUserMedia(t),s.shimAudioContext(t),c.shimRTCIceCandidate(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t),c.removeAllowExtmapMixed(t);break;default:d("Unsupported browser!")}return l};var r=d(e("./utils")),i=d(e("./chrome/chrome_shim")),o=d(e("./edge/edge_shim")),a=d(e("./firefox/firefox_shim")),s=d(e("./safari/safari_shim")),c=d(e("./common_shim"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),n.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},n.shimOnTrack=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})),t.stream.getTracks().forEach((function(r){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else a.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},n.shimGetSendersWithDtmf=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},n.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],i=n[1],o=n[2];if(arguments.length>0&&"function"===typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!==typeof r))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(a(e)))};return t.apply(this,[c,r])}return new Promise((function(n,r){t.apply(e,[function(e){n(s(a(e)))},r])})).then(i,o)}}},n.shimSenderReceiverGetStats=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return a.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),a.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return a.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],n=void 0,r=void 0,i=void 0;return this.getSenders().forEach((function(e){e.track===t&&(n?i=!0:n=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(r?i=!0:r=e),e.track===t})),i||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}},n.shimAddTrackRemoveTrackWithNative=c,n.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=a.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return c(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find((function(e){return e.track===t}));if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[n.id]=s,this._reverseStreams[s.id]=n,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=s({},t,(function(){var e=this,t=arguments,r=arguments.length&&"function"===typeof arguments[0];return r?n.apply(this,[function(n){var r=u(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return u(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=l(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=d.get.apply(this);return""===e.type?e:u(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach((function(r){t._streams[r].getTracks().find((function(t){return e.track===t}))&&(n=t._streams[r])})),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function u(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function l(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}},n.shimPeerConnection=function(e){var t=a.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=s({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},n.fixNegotiationNeeded=function(e){var t=a.detectBrowser(e);a.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils.js"));function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),i.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"===typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var n=i.detectBrowser(e),a=function(e){if("object"!==("undefined"===typeof e?"undefined":r(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===r(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"===typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"===typeof i.ideal?(a[o("min",n)]=i.ideal,t.optional.push(a),(a={})[o("max",n)]=i.ideal,t.optional.push(a)):(a[o("",n)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!==typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===r(e.audio)){var s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};s((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"===r(e.video)){var c=e.video.facingMode;c=c&&("object"===("undefined"===typeof c?"undefined":r(c))?c:{ideal:c});var d=n.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var u=void 0;if("environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u)return t.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return u.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&u.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=a(e.video),o("chrome: "+JSON.stringify(e)),i(e)}))}e.video=a(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){s(e,(function(e){t.webkitGetUserMedia(e,n,(function(e){r&&r(c(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return s(e,(function(e){return d(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(c(e))}))}))}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils.js")),o=i.log},{"../utils.js":15}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimRTCIceCandidate=function(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=a.default.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,s.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},n.shimMaxMessageSize=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=a.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=a.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!==n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=a.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),a=e.sdpSemantics;"plan-b"===a&&Object.defineProperty(this,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var s=r(arguments[0]),d=i(s),u=o(arguments[0],s),l=void 0;l=0===d&&0===u?Number.POSITIVE_INFINITY:0===d||0===u?Math.max(d,u):Math.min(d,u);var f={};Object.defineProperty(f,"maxMessageSize",{get:function(){return l}}),this._sctp=f}return c.apply(this,arguments)}}},n.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},s.wrapPeerConnectionEvent(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}},n.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}},n.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),n.apply(this,arguments)}}}};var i,o=e("sdp"),a=(i=o)&&i.__esModule?i:{default:i},s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),n.shimPeerConnection=function(e){var t=a.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=(0,d.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,s.filterIceServers)(e.iceServers,t.version),a.log("ICE servers after filtering:",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype},n.shimReplaceTrack=function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var o,a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils")),s=e("./filtericeservers"),c=e("rtcpeerconnection-shim"),d=(o=c)&&o.__esModule?o:{default:o}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.filterIceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"===typeof t;return i&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),n.shimOnTrack=function(e){"object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimPeerConnection=function(e){var t=a.detectBrowser(e);if("object"===("undefined"===typeof e?"undefined":r(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n,r,i,o=e.RTCPeerConnection.prototype[t],a=(i=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)},(r=t)in(n={})?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n);e.RTCPeerConnection.prototype[t]=a[t]})),t.version<68){var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),n=e[0],r=e[1],a=e[2];return o.apply(this,[n||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,a)}}},n.shimSenderGetStats=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},n.shimReceiverGetStats=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),a.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},n.shimRemoveStream=function(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;a.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})},n.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},n.shimAddTransceiver=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var i=r.sender,o=i.getParameters();"encodings"in o||(o.encodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(o).catch((function(){}))))}return r})}},n.shimCreateOffer=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,n)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}}},n.shimCreateAnswer=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,n)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}}};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(e){var t=i.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===("undefined"===typeof e?"undefined":r(e))&&"object"===r(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},o&&o.prototype.getSettings){var c=o.prototype.getSettings;o.prototype.getSettings=function(){var e=c.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var d=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===("undefined"===typeof e?"undefined":r(e))&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimLocalStreamsAPI=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i&&i.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}},n.shimRemoteStreamsAPI=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}},n.shimCallbacksAPI=function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var c=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}},n.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(o(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))},n.shimConstraints=o,n.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[o])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},n.shimTrackEventTransceiver=function(e){"object"===("undefined"===typeof e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio"),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}},n.shimAudioContext=function(e){"object"!==("undefined"===typeof e?"undefined":r(e))||e.AudioContext||(e.AudioContext=e.webkitAudioContext)};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"));function o(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.extractVersion=a,n.wrapPeerConnectionEvent=function(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},n.disableLog=function(e){return"boolean"!==typeof e?new Error("Argument type: "+("undefined"===typeof e?"undefined":r(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},n.disableWarnings=function(e){return"boolean"!==typeof e?new Error("Argument type: "+("undefined"===typeof e?"undefined":r(e))+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},n.log=function(){if("object"===("undefined"===typeof window?"undefined":r(window))){if(i)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}},n.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},n.detectBrowser=function(e){var t=e.navigator,n={browser:null,version:null};if("undefined"===typeof e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=a(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=a(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=a(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=a(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n},n.compactObject=function e(t){return s(t)?Object.keys(t).reduce((function(n,r){var i=s(t[r]),o=i?e(t[r]):t[r],a=i&&!Object.keys(o).length;return void 0===o||a?n:Object.assign(n,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,o))}),{}):t},n.walkStats=c,n.filterStats=function(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&c(e,n,i)}))})),i};var i=!0,o=!0;function a(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function s(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(r){r.endsWith("Id")?c(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((function(t){c(e,e.get(t),n)}))})))}},{}],16:[function(e,t,n){"use strict";var r=e("sdp");function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var u=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=o[e].bind(o)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"===typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"===typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},u.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},u.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},u.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},u.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},u.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},u.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},u.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var d=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(d)),a.candidate.candidate=d,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var u=r.getMediaSections(i._localDescription.sdp);u[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+u.join("");var l=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){a.forEach((function(e){o.onlocalcandidate(e)}))}),0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},u.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var a=i.transceivers[t],c=a.iceGatherer,d=a.iceTransport,u=a.dtlsTransport,l=a.localCapabilities,f=a.remoteCapabilities;if((!r.isRejected(e)||0!==r.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var m=r.getIceParameters(e,n),p=r.getDtlsParameters(e,n);s&&(p.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===d.state&&d.start(c,m,s?"controlling":"controlled"),"new"===u.state&&u.start(p));var h=o(l,f);i._transceive(a,h.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(i){var u=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,u.signalingState)||u._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+u.signalingState));var l={};u.remoteStreams.forEach((function(e){l[e.id]=e}));var f=[],m=r.splitSections(i.sdp),p=m.shift(),h=r.matchPrefix(p,"a=ice-lite").length>0,v=r.matchPrefix(p,"a=group:BUNDLE ").length>0;u.usingBundle=v;var g=r.matchPrefix(p,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,m.forEach((function(a,c){var d=r.splitLines(a),m=r.getKind(a),g=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,_=d[0].substr(2).split(" ")[2],b=r.getDirection(a,p),A=r.parseMsid(a),y=r.getMid(a)||r.generateIdentifier();if(g||"application"===m&&("DTLS/SCTP"===_||"UDP/DTLS/SCTP"===_))u.transceivers[c]={mid:y,kind:m,protocol:_,rejected:!0};else{var S,w,C,k,I,x,E,R,T;!g&&u.transceivers[c]&&u.transceivers[c].rejected&&(u.transceivers[c]=u._createTransceiver(m,!0));var M,P,O=r.parseRtpParameters(a);g||(M=r.getIceParameters(a,p),(P=r.getDtlsParameters(a,p)).role="client"),E=r.parseRtpEncodingParameters(a);var D=r.parseRtcpParameters(a),N=r.matchPrefix(a,"a=end-of-candidates",p).length>0,j=r.matchPrefix(a,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!g&&v&&c>0&&u.transceivers[c]&&(u._disposeIceAndDtlsTransports(c),u.transceivers[c].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[c].iceTransport=u.transceivers[0].iceTransport,u.transceivers[c].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[c].rtpSender&&u.transceivers[c].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[c].rtpReceiver&&u.transceivers[c].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==i.type||g)"answer"!==i.type||g||(w=(S=u.transceivers[c]).iceGatherer,C=S.iceTransport,k=S.dtlsTransport,I=S.rtpReceiver,x=S.sendEncodingParameters,R=S.localCapabilities,u.transceivers[c].recvEncodingParameters=E,u.transceivers[c].remoteCapabilities=O,u.transceivers[c].rtcpParameters=D,j.length&&"new"===C.state&&(!h&&!N||v&&0!==c?j.forEach((function(e){s(S.iceTransport,e)})):C.setRemoteCandidates(j)),v&&0!==c||("new"===C.state&&C.start(w,M,"controlling"),"new"===k.state&&k.start(P)),!o(S.localCapabilities,S.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&S.sendEncodingParameters[0].rtx&&delete S.sendEncodingParameters[0].rtx,u._transceive(S,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!I||"sendrecv"!==b&&"sendonly"!==b?delete S.rtpReceiver:(T=I.track,A?(l[A.stream]||(l[A.stream]=new e.MediaStream),n(T,l[A.stream]),f.push([T,I,l[A.stream]])):(l.default||(l.default=new e.MediaStream),n(T,l.default),f.push([T,I,l.default]))));else{(S=u.transceivers[c]||u._createTransceiver(m)).mid=y,S.iceGatherer||(S.iceGatherer=u._createIceGatherer(c,v)),j.length&&"new"===S.iceTransport.state&&(!N||v&&0!==c?j.forEach((function(e){s(S.iceTransport,e)})):S.iceTransport.setRemoteCandidates(j)),R=e.RTCRtpReceiver.getCapabilities(m),t<15019&&(R.codecs=R.codecs.filter((function(e){return"rtx"!==e.name}))),x=S.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var B,U=!1;"sendrecv"===b||"sendonly"===b?(U=!S.rtpReceiver,I=S.rtpReceiver||new e.RTCRtpReceiver(S.dtlsTransport,m),U&&(T=I.track,A&&"-"===A.stream||(A?(l[A.stream]||(l[A.stream]=new e.MediaStream,Object.defineProperty(l[A.stream],"id",{get:function(){return A.stream}})),Object.defineProperty(T,"id",{get:function(){return A.track}}),B=l[A.stream]):(l.default||(l.default=new e.MediaStream),B=l.default)),B&&(n(T,B),S.associatedRemoteMediaStreams.push(B)),f.push([T,I,B]))):S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===S.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),S.associatedRemoteMediaStreams=[]),S.localCapabilities=R,S.remoteCapabilities=O,S.rtpReceiver=I,S.rtcpParameters=D,S.sendEncodingParameters=x,S.recvEncodingParameters=E,u._transceive(u.transceivers[c],!1,U)}}})),void 0===u._dtlsRole&&(u._dtlsRole="offer"===i.type?"active":"passive"),u._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(l).forEach((function(t){var n=l[t];if(n.getTracks().length){if(-1===u.remoteStreams.indexOf(n)){u.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){u._dispatchEvent("addstream",r)}))}f.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&d(u,t,r,[n])}))}})),f.forEach((function(e){e[2]||d(u,e[0],e[1],[])})),e.setTimeout((function(){u&&u.transceivers&&u.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},u.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter((function(e){return"audio"===e.kind})).length,a=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)}));o>0||a>0;)o>0&&(n._createTransceiver("audio"),o--),a>0&&(n._createTransceiver("video"),a--);var d=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter((function(e){return"rtx"!==e.name}))),d.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),d.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=d,i.sendEncodingParameters=u})),"max-compat"!==n._config.bundlePolicy&&(d+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,d+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))}));var u=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(u)},u.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var d=o(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,d,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}}));var d=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(d)},u.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,o){if(!n._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<n.transceivers.length;d++)if(n.transceivers[d].mid===e.sdpMid){a=d;break}var u=n.transceivers[a];if(!u)return o(c("OperationError","Can not add ICE candidate"));if(u.rejected)return i();var l=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return i();if(l.component&&1!==l.component)return i();if((0===a||a>0&&u.iceTransport!==n.transceivers[0].iceTransport)&&!s(u.iceTransport,l))return o(c("OperationError","Can not add ICE candidate"));var f=e.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[a]+="a="+(l.type?f:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var m=0;m<n.transceivers.length&&(n.transceivers[m].rejected||(n.transceivers[m].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[m]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));m++);i()}))},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var l=["createOffer","createAnswer"];return l.forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"===typeof e[0]||"function"===typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"===typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"===typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"===typeof e[1]||"function"===typeof e[2]?t.apply(this,arguments).then((function(){"function"===typeof e[1]&&e[1].apply(null)}),(function(t){"function"===typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"===typeof e[1]?t.apply(this,arguments).then((function(){"function"===typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),u}},{sdp:17}],17:[function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=r.writeExtmap(e)})),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(r))}})),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"===typeof t&&(t.exports=r)},{}]},{},[1])(1)},261:function(e,t,n){var r=n(12),i=n(262),o=n(7),a=n(55),s=o.tagLogger("Service"),c=n(171),d=n(173),u=n(34),l=n(267),f=new(n(268))({onExtLoaded:function(){s.info("Share desktop ext. had loaded.")}}),m=n(113),p=n(175),h=n(176);e.exports=o.prototypeExtend({__init__:function(){s.warn("emedia version: ",window._emediaVersion||"unkown"),s.warn("UserAgent: ",navigator.userAgent);var e=o.parseURL("__log_level___");e&&(emedia.LOG_LEVEL=parseInt(e)),this.namespace=Math.uuidFast(),emedia.useCurrentXService=this,void 0===this.useRTCCfg&&(this.useRTCCfg=emedia.config.useRTCCfgIfServerReturn),"string"===typeof this.useRTCCfg&&(this.useRTCCfg=JSON.parse(this.useRTCCfg)),this.inboundAudio=p.inboundAudio.bind(this),this.inboundVideo=p.inboundVideo.bind(this),this.outboundAudio=p.outboundAudio.bind(this),this.outboundVideo=p.outboundVideo.bind(this),this._cache_receive_sessions=[]},AVPubstream:m.extend({__init__:function(){this.type=0,this._located=!0,this.mutedMuted=!0,this.constaints&&(this.constaints.video||(this.voff=1),this.constaints.audio||(this.aoff=1)),this.constaints||(this.constaints={audio:!0,video:!0}),emedia.config.maxVideoBitrate&&(this.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(this.abitrate=emedia.config.maxAudioBitrate)}}),AudioMixerPubstream:new m.extend({__init__:function(){if(this.type=2,this._located=!0,this.mutedMuted=!0,this.constaints||(this.constaints={audio:!0,video:!1}),this.constaints){var e=!!this.constaints.audio;this.constaints.video||(this.constaints.video=!1),this.constaints.video||(this.voff=1),this.constaints.audio||(this.aoff=1),!1===e&&(this.aoff=1)}emedia.config.maxVideoBitrate&&(this.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(this.abitrate=emedia.config.maxAudioBitrate)},onGotRemoteMediaStream:function(e){if(!this.remotePlayAudioObject){var t="__o_remote_play_audio_"+this.id,n=document.querySelector("#"+t);n||((n=document.createElement("audio")).style.display="none",n.id="__o_remote_play_audio_"+this.id,n.autoplay=!0,n.playsinline=!0,document.body.appendChild(n)),this.remotePlayAudioObject=n}this.remotePlayAudioObject.srcObject=e}}),ShareDesktopPubstream:m.extend({voff:0,__init__:function(){this.type=1,this._located=!0,this.mutedMuted=!0,this.constaints={audio:!this.aoff,video:!0},emedia.config.maxVideoBitrate&&(this.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(this.abitrate=emedia.config.maxAudioBitrate)}}),__assertCurrent:function(){if(!this.current)throw s.error("Please call emedia.service.setup(ticket)"),"Please call emedia.service.setup(ticket)";if(this.current.closed)throw s.error("current closed"),"current closed"},hasAudioMixers:function(){for(var e in this.__assertCurrent(),this.current.audioMixers){var t=this.current.audioMixers[e];if(t&&t.located())return!0}},getMediaDevices:function(e,t,n){"function"===typeof e&&(n=t,t=e,e=void 0),navigator.mediaDevices.enumerateDevices().then((function(n){for(var r=[],i=0;i!==n.length;++i){var o=n[i];e?e===o.kind?r.push(o):"audioinput"===o.kind||"audiooutput"===o.kind||"videoinput"===o.kind||s.info("Some other kind of source/device: ",o):r.push(o)}t&&t(r)})).catch((function(e){s.warn("navigator.getUserMedia error: ",e),n&&n(e)}))},attachSinkId:function(e,t){"undefined"!==typeof e.sinkId?e.setSinkId(t).then((function(){s.info("Success, audio output device attached: "+t)})).catch((function(e){var t=e;"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device: "+e),s.warn(t)})):s.warn("Browser does not support output device selection.")},_stopTracks:function(e){emedia.stopTracks(e),e&&s.warn("Stream tracks stop. it = ",e)},_enableVideoTracks:function(e,t){emedia.enableVideoTracks(e,t)},_enableAudioTracks:function(e,t){emedia.enableAudioTracks(e,t)},openUserMedia:function(e){s.debug("begin open user media",e);var t=this;if(!e)throw s.error("require pubS"),"require pubS";return{then:function(n,r){function i(){n.apply(null,arguments);var r=e.localStream;r&&(r.oninactive=t._onStreamInactive.bind(t,e,r),r.onactive=t._onStreamActive.bind(t,e,r))}if(e instanceof t.AVPubstream)t._openCamera(e,i,r);else if(e instanceof t.ShareDesktopPubstream)t._openSharedDesktop(e,i,r);else{if(!(e instanceof t.AudioMixerPubstream))throw s.error("Unspported pubS"),"Unspported pubS";t._openCamera(e,i,r)}}}},_openSharedDesktop:function(e,t,n){var r,i=this;function a(e){var r={audio:!0};e.constaints&&("object"===typeof e.constaints.audio&&e.constaints.audio||e.constaints.audio||(r.audio=!1)),i.__getUserMedia(r,(function(n,r){var o=new MediaStream;o._located=!0,r&&r.getAudioTracks().forEach((function(e){o.addTrack(e)})),e.localStream&&e.localStream.getVideoTracks().forEach((function(e){o.addTrack(e)})),e.localStream=o,t&&t(i.current,o)}),n)}if(e._localMediaStream&&(r=e._localMediaStream.getVideoTracks())&&r.length>0)return e.localStream=e._localMediaStream,void(e.constaints.audio?a(e):t&&t(i.current,stream));f.openDesktopMedia(e.screenOptions||["screen","window","tab"],(function(r){if(r instanceof u.OpenDesktopMedia){var c=r.desktopStreamId;s.warn("desktop streamId",c);var d={audio:!1,video:{mandatory:o.extend(e.mandatory||{},{chromeMediaSource:"desktop",chromeMediaSourceId:c}),optional:[]}};i.__getUserMedia(d,(function(n,r){e.localStream=r,e.constaints.audio?a(e):t&&t(i.current,r)}),n)}else i.current&&i.current.onEvent(new u.ShareDesktopExtensionNotFound({member:i.current})),n&&n(r)}))},_openCamera:function(e,t,n){var r=this,i=e.constaints||{audio:!0,video:!0};r.__getUserMedia(i,function(n,i){r.__controlStream(e,i),e.localStream=i,t&&t(r.current,i)}.bind(i),n)},__controlStream:function(e,t){emedia.enableVideoTracks(t,!e.voff),emedia.enableAudioTracks(t,!e.aoff)},__getUserMedia:function(e,t,n){s.debug("get user media. using constaints",e);var r,i=this;function a(e){s.debug("[WebRTC-API] getUserMedia() error: ",e),emedia.stopTracks(r),i.current&&i.current.onEvent(new u.OpenMediaError({member:i.current,event:e})),n&&n(new u.OpenMediaError({member:i.current,event:e}))}e=o.extend({},e),i.__sysGetUserMedia(e,(function(n){i.current&&!i.current.closed&&(i.current._openedRtcMediaStreams[n.id]=n,n._bindAttendee=i.current,n._bindAttendeeId=i.current.getMemberId(),s.info("stream bind attendee.",n.id,i.current.ticket&&i.current.ticket.id,i.current.getMemberId(),i.current.memName)),emedia._yetGetUserMedia=!0,r=n;var o=n.getVideoTracks(),c=n.getAudioTracks();if(o.length>0){var d=o[0];s.debug(n.id,"using video device: ",d.id,d.label,d.kind,d.enabled)}if(c.length>0){var u=c[0];s.debug(n.id,"using audio device: ",u.id,u.label,u.kind,u.enabled)}if(n._located=!0,"boolean"===typeof n.active&&!n.active)return s.error("media stream not active. it is",n.id),void a({constraint:e,name:"NotAllowedStreamNonactive",message:"stream non-active"});t&&t(i.current,n)}),a)},_onStreamInactive:function(e,t,n){var r=this;s.warn("media stream inactive. it =",t.id),e.onMediaInactive&&r.current&&o.forEach(r.current._cacheStreams,(function(i,o){o.located()&&o.localStream&&o.localStream.id===t.id&&(o._webrtc&&o._webrtc.closed||e.onMediaInactive.call(o,t,n,r))}))},_onStreamActive:function(e,t,n){var r=this;s.warn("media stream active. it =",t.id),e.onMediaActive&&r.current&&o.forEach(r.current._cacheStreams,(function(i,o){o.located()&&o.localStream&&o.localStream.id===t.id&&e.onMediaActive.call(o,t,n,r)}))},__sysGetUserMedia:function(e,t,n){function a(){return(a=i(r.mark((function e(t,n,i){var a,c,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"===typeof emedia.config.globalConstraints&&("object"===typeof emedia.config.globalConstraints.audio&&t.audio&&("boolean"===typeof t.audio?t.audio=o.extend({},emedia.config.globalConstraints.audio):t.audio=o.extend({},emedia.config.globalConstraints.audio,t.audio)),"object"===typeof emedia.config.globalConstraints.video&&t.video&&("boolean"===typeof t.video?t.video=o.extend({},emedia.config.globalConstraints.video):t.video=o.extend({},emedia.config.globalConstraints.video,t.video))),s.info("navigator.mediaDevices.getUserMedia constaints = ",JSON.stringify(t)),a=new MediaStream,!t.audio){e.next=13;break}return e.prev=4,e.next=7,navigator.mediaDevices.getUserMedia({audio:!0});case 7:c=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.error("getUserMedia audio error",e.t0);case 13:if(!t.video){e.next=23;break}return e.prev=14,e.next=17,navigator.mediaDevices.getUserMedia({video:!0});case 17:d=e.sent,e.next=23;break;case 20:e.prev=20,e.t1=e.catch(14),console.error("getUserMedia video error",e.t1);case 23:c&&c.getAudioTracks().forEach((function(e){a.addTrack(e)})),d&&d.getVideoTracks().forEach((function(e){a.addTrack(e)})),c||d?n(a):i({message:"getUserMedia error: not have input device"});case 26:case"end":return e.stop()}}),e,null,[[4,10],[14,20]])})))).apply(this,arguments)}!function(e,t,n){a.apply(this,arguments)}(e,t,n)},attachMediaStream:window.attachMediaStream.bind({logger:s}),setup:function(e,t){var n=this;s.count(),s.debug("recv ticket",e,t),s.debug("use sdk version",window._emediaVersion),s.debug(navigator.userAgent);var r,i,a=t=t||{};if(o.isPlainObject(t))t=JSON.stringify(t);else try{a=JSON.parse(t)}catch(m){}if("string"===typeof e&&(e=JSON.parse(e)),r=i=e.memName,emedia._lastSetupConfr=e.confrId,emedia._lastSetupMemName=i,emedia._lastSetupDate=new Date,emedia._lastSetupTktId=e.tktId,n.current&&!n.current.closed){var c=new u.CurrentCalling;throw n.current.onEvent(c),s.error("confr not close. calling..."),c}var f=(n.Attendee||d).extend(l);return n.current=new f({_service:n,service:n,autoSub:emedia.config.autoSub,getCopyIntervalMillis:emedia.config.getCopyIntervalMillis,sysUserId:r,memName:i,resource:n.resource,nickName:n.nickName,ticket:e,ext:t,extObj:a,sessionFactory:function(){return n.newSession(this,e)}},n.listeners||{})},getStreamById:function(e){var t=this.current&&this.current._cacheStreams[e];return t&&o.extend(!1,{},t)},getStreamsByRtcId:function(e){if(this.current&&this.current._cacheStreams){var t=[];return o.forEach(this.current._cacheStreams,(function(n,r){r.rtcId===e&&t.push(r)})),t}},getMemberById:function(e){var t=this.current&&this.current._cacheMembers[e];return t&&o.extend(!1,{},t)},exit:function(e){s.warn("User click exit ",e),this.current&&this.current.exit(e)},join:function(e,t){s.debug("begin join ...");if(this.__assertCurrent(),this.current._memberId)return s.warn("Had joined. igrone it"),void(e&&e(this.memId));this.current._session._sessionId=void 0,this.current.join(e,t)},withpublish:function(e){if(!e||!e.localStream)throw s.error("pubS null or stream not open"),"pubS null or stream not open";return this.__assertCurrent(),this.current._memberId?s.warn("Had joined. igrone it"):this.current._session._sessionId=void 0,this.current.withpublish(e)},push:function(e,t,n){s.debug("begin push ...");var r=this;if(2===arguments.length&&(n=t,t=void 0),!e||!e.localStream)throw s.error("pubS or stream open"),"pubS or stream open";r.__assertCurrent(),r.current.push(e,t,n,!1)},subscribe:function(e,t,n,r){var i=this;if(s.info("begin subscribe ",e,r),t&&o.isPlainObject(t)&&(r=t,t=n=void 0),n&&o.isPlainObject(n)&&(r=n,n=t,t=void 0),emedia.isSafari){var a={streamId:e,onSub:t,subfail:n,subArgs:r},c=i.__safari_subs||(i.__safari_subs=[]);function d(){try{var e=c.shift();e&&e.onSub&&e.onSub.apply(e,arguments)}finally{l()}}function u(){try{var e=c.shift();e&&e.subfail&&e.subfail.apply(e,arguments)}finally{l()}}function l(){c.length>0&&i.__subscribe(c[0].streamId,d,u,c[0].subArgs)}c.push(a),1===c.length&&l()}else i.__subscribe(e,t,n,r)},__subscribe:function(e,t,n,r){var i=this;i.__assertCurrent(),2==arguments.length&&(n=t,t=void 0),t&&o.isPlainObject(t)&&(r=t,t=void 0),n&&o.isPlainObject(n)&&(r=n,n=void 0),r||(r={subSVideo:!0,subSAudio:!0});i.current._cacheStreams[e];var a=i.current._getWebrtc(e),c=a&&a.isConnected(),d=c&&a.getRemoteStream();if(d&&(c=d.active)){var u=d.getAudioTracks().length,l=d.getVideoTracks().length;(u||!0!==r.subSAudio)&&(l||!0!==r.subSVideo)||(c=!1)}if(s.info("sub stream",e,", use prertcpeer =",c),c)return i.current.subscribeStream(a._rtcId,e,n,r,t),void(t&&t());a&&!a.closed&&i.current.closeWebrtc(a.getRtcId(),!0,!1),i.current.createWebrtcAndSubscribeStream(e,{onGotRemote:function(e){t&&t(e)},onEvent:function(e){n&&n(e)}},void 0,r)},closePubstream:function(e){e.located()&&(emedia.stopTracks(e._localMediaStream),emedia.stopTracks(e.localStream))},hungup:function(e){var t=this.getStreamById(e);try{this._hungup(e)}finally{this.onHungup&&t&&this.onHungup(t)}},_hungup:function(e){this.__assertCurrent();var t=this.current,n=t._cacheStreams[e];n&&!n.closeReason&&n.updateAttributes({closeReason:"UserHangup"});var r=n&&n.rtcId;if(r&&(t.closeWebrtc(r),n.located()&&(1!==n.type&&n._localMediaStream&&emedia.stopTracks(n._localMediaStream),n.remotePlayAudioObject&&document.body.removeChild(n.remotePlayAudioObject),t._cacheStreams[e]&&t.onRemoveStream(n),o.removeAttribute(t._cacheStreams,e),this._streamAutomators&&o.removeAttribute(this._streamAutomators,e))),n&&!n.located()){if(t._linkedStreams[n.id]&&o.removeAttribute(t._linkedStreams,n.id),s.warn("Hangeup remove from _linkedStreams. stream = ",n.id),!(n=t._cacheStreams[e]))return;n.updateAttributes({rtcId:void 0,_webrtc:void 0,mediaStream:void 0});var i=new m(n);t.onUpdateStream(i,new i.Update(i))}},postMessage:function(e,t,n,r){var i=t;"string"!==typeof t&&(t=JSON.stringify(t)),this.__assertCurrent();var o,a=this.current,s=a._linkedStreams[e];o=s&&s.owner?s.owner.id:e;t=a.newMessage({op:1003,memId:o,arg:t});a.postMessage(t,(n||r)&&function(e){if(r&&r(e,i),0!=e.result){var s=new u.RemoteControlFail({memId:o,failed:e.result,cause:e.msg,type:"postMessage",postMessage:t});return a.onEvent(s),void(n&&n(s,i))}})},torchRemote:function(e,t,n,r){"function"===typeof t&&(r=n,n=t,t=void 0),void 0!==t&&(t=t?1:0),this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var a=o.torch,c={op2:20,streamId:e,tor:t=void 0===t?o.torch?0:1:t},d=i.newMessage({op:1002,memId:o.owner.id,arg:JSON.stringify(c),_reqOps:[100206]});o.updateAttributes({torch:t}),i.postMessage(d,(function(e){if(0!=e.result){var t=new u.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"torch_control"});return i.onEvent(t),o.updateAttributes({torch:a}),void(r&&r(t,o.torch))}n&&n(o.torch)}))},freezeFrameRemote:function(e,t,n){this.__assertCurrent();var r=this.current,i=r._linkedStreams[e];if(!i||i.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var o=!i.freezeFrame,a={op2:20,streamId:e,frz:o?1:0},c=r.newMessage({op:1002,memId:i.owner.id,arg:JSON.stringify(a),_reqOps:[100204]});i.updateAttributes({freezeFrame:o}),r.postMessage(c,(function(e){if(0!=e.result){var o=new u.RemoteControlFail({stream:i,failed:e.result,cause:e.msg,type:"freeze_control"});return r.onEvent(o),i.updateAttributes({freezeFrame:!i.freezeFrame}),void(n&&n(o,i.freezeFrame))}t&&t(i.freezeFrame)}))},base64Img2Blob:function(e){for(var t=e.split(";base64,"),n=t[0].split(":")[1],r=window.atob(t[1]),i=r.length,o=new Uint8Array(i),a=0;a<i;++a)o[a]=r.charCodeAt(a);return new Blob([o],{type:n})},blob2URL:function(e){return URL.createObjectURL(e)},imagesPngContext2URL:function(e){return this.blob2URL(this.blob2URL(e))},downloadFile:function(e,t,n){var r=document.createElement("a");r.style.display="none";var i,o=t?this.base64Img2Blob(t):n;r.download=e,r.href=i=this.blob2URL(o),r.rel="noopener";var a=document.createEvent("HTMLEvents");a.initEvent("click",!1,!1),r.dispatchEvent(a),document.body.appendChild(r),r.click(),r.parentNode.removeChild(r),setTimeout((function(){URL.revokeObjectURL&&URL.revokeObjectURL(i)}),4e4)},videoCaptureBase64Context2URL:function(e){return this.imagesPngContext2URL(this.getCaptureBase64Context(e))},getCaptureBase64Context:function(e){var t=document.createElement("canvas");t.id="__capture_video_"+(new Date).getTime();return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("images/png")},captureVideo:function(e,t,n){var r=this.getCaptureBase64Context(e);return t&&(n=n||"capture_"+(new Date).getTime(),this.downloadFile(n,r)),r},capturePictureRemote:function(e,t,n,r){this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var a={op2:20,streamId:e,pic:1,rspBase64Pic:!0===t},c=i.newMessage({op:1002,memId:o.owner.id,arg:JSON.stringify(a),_reqOps:[100205]});i.postMessage(c,(function(e){if(0!=e.result){var a=new u.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"capture_control"});return i.onEvent(a),void(r&&r(a))}if(t)if(e.arg){var s=JSON.parse(e.arg);n&&n(s.pic)}else r&&r(new u.RemoteControlFail({stream:o,failed:e.result,cause:"Not found base64 pic"}));else n&&n()}))},zoomRemote:function(e,t,n,r){this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";o._zoom||o.updateAttributes({_zoom:1});var a=o._zoom*t;if(!(a<1)){o.updateAttributes({_zoom:a});var c={op2:20,streamId:e,zoom:Math.round(1e4*a)},d=i.newMessage({op:1002,memId:o.owner.id,arg:JSON.stringify(c),_reqOps:[100201]});i.postMessage(d,(function(e){if(0!=e.result){var t=new u.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"zoom_control"});return i.onEvent(t),void(n&&n(t))}r&&r()}))}},_getPosition:function(e){for(var t=0,n=0;e;)n+=e.offsetLeft,t+=e.offsetTop,e=e.offsetParent;return{clientX:n,clientY:t}},eventXYAtMedia:function(e,t){var n=o.getDomPageRect(t),r=n.width,i=n.height,a=t.videoWidth,s=t.videoHeight;if(s/a>i/r){var c=a/s;a=(s=i)*c}else{c=s/a;s=(a=r)*c}var d,u,l=e;if((d=o.isFloat(l.x))&&(l.x=l.x*r),(u=o.isFloat(l.y))&&(l.y=l.y*i),!(Math.abs(l.x)<(r-a)/2||r-Math.abs(l.x)<(r-a)/2)&&!(Math.abs(l.y)<(i-s)/2||i-Math.abs(l.y)<(i-s)/2))return l.x=l.x<0?Math.floor(l.x+(r-a)/2):Math.floor(l.x-(r-a)/2),l.y=l.y<0?Math.floor(l.y+(i-s)/2):Math.floor(l.y-(i-s)/2),d&&(l.x=l.x/a),u&&(l.y=l.y/s),{x:l.x,y:l.y,width:a,height:s}},eventXYAtVideo:function(e,t){var n,r,i=o.getDomPageRect(t),a=i.width,s=i.height,c=t.videoWidth,d=t.videoHeight;if(d/c>s/a){var u=c/d;c=(d=s)*u}else{u=d/c;d=(c=a)*u}return(n=o.isFloat(e.x))&&(e.x=e.x*c),(r=o.isFloat(e.y))&&(e.y=e.y*d),e.x=e.x<0?Math.floor(e.x-(a-c)/2):Math.floor(e.x+(a-c)/2),e.y=e.y<0?Math.floor(e.y-(s-d)/2):Math.floor(e.y+(s-d)/2),n&&(e.x=e.x/a),r&&(e.y=e.y/s),e},getClickXY:function(e,t){var n=t||window.event,r=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop,o=n.pageX||n.clientX+r,a=n.pageY||n.clientY+i,c=this._getPosition(e);s.info("Video tag position ",c.clientX,":",c.clientY);var d=e.videoWidth,u=e.videoHeight;if(u/d>e.offsetHeight/e.offsetWidth){var l=d/u;d=(u=e.offsetHeight)*l,c.clientX+=(e.offsetWidth-d)/2}else{l=u/d;u=(d=e.offsetWidth)*l,c.clientY+=(e.offsetHeight-u)/2}return s.info("Media position ",c.clientX,":",c.clientY),s.info("Media xy ",d,":",u),s.info("Click position ",o,":",a),{mediaWidth:d,mediaHeight:u,x:o-c.clientX,y:a-c.clientY}},focusExpoRemote:function(e,t,n,r,i){var o=n||window.event,a=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,d=o.pageX||o.clientX+a,u=o.pageY||o.clientY+c,l=this._getPosition(t);s.info("Video tag position ",l.clientX,":",l.clientY);var f=t.videoWidth,m=t.videoHeight;if(m/f>t.offsetHeight/t.offsetWidth){var p=f/m;f=(m=t.offsetHeight)*p,l.clientX+=(t.offsetWidth-f)/2}else{p=m/f;m=(f=t.offsetWidth)*p,l.clientY+=(t.offsetHeight-m)/2}s.info("Media position ",l.clientX,":",l.clientY),s.info("Media xy ",f,":",m),s.info("Click position ",d,":",u),this._focusExpo(e,f,m,d-l.clientX,u-l.clientY,r,i)},_focusExpo:function(e,t,n,r,i,o,a){if(!(r<=0||r>t)&&!(i<=0||i>n)){this.__assertCurrent();var c=this.current,d=c._linkedStreams[e];if(!d||d.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var l={op2:20,streamId:e,focus:1,expo:1,x:0===t?0:Math.round(1e4*r/t),y:0===n?0:Math.round(1e4*i/n)},f=c.newMessage({op:1002,memId:d.owner.id,arg:JSON.stringify(l),_reqOps:[100202,100203]});c.postMessage(f,(function(e){if(0!=e.result){var t=new u.RemoteControlFail({stream:d,failed:e.result,cause:e.msg,type:"focus_expo_control"});return c.onEvent(t),void(o&&o(t))}a&&a()}))}},_republish:function(e,t,n){s.info("Republish stream. it = ",e.id);var r,i,o=this;if(e.id){var a=o.current.__getWebrtcFor(e.id);a&&o.current.closeWebrtc(a,!0),r=o.current._getWebrtc(e.id)}switch(e.type){case 0:emedia.stopTracks(e._localMediaStream),i=new o.AVPubstream(e);break;case 1:emedia.stopAndRemoveAudioTracks(e._localMediaStream),i=new o.ShareDesktopPubstream(e);break;case 2:emedia.stopTracks(e._localMediaStream),i=new o.AudioMixerPubstream(e)}setTimeout((function(){o.openUserMedia(i).then((function(){e.localStream=i.localStream,e.isRepublished=!0,e.optimalVideoCodecs=e.optimalVideoCodecs||r&&r.optimalVideoCodecs,o.push(e,t,n)}),n)}),100)},switchMobileCamera:function(e,t,n){if("string"===typeof e?e=this.current._cacheStreams[e]:e.id&&(e=this.current._cacheStreams[e.id]),e.voff)s.warn("Stream id = ",e.id," voff, do not chanage camera.");else{e.constaints||(e.constaints={});var r=o.extend({},e.constaints);e._lastConstaints=r,e.constaints.video="object"===typeof e.constaints.video?e.constaints.video:{},"user"!==e.constaints.video.facingMode&&e.constaints.video.facingMode?e.constaints.video.facingMode="user":e.constaints.video.facingMode={exact:"environment"},this._republish(e,(function(e){n&&n(e)}),(function(n){n instanceof emedia.event.OpenMediaError&&(e.constaints=r),t&&t(n)}))}},chanageCamera:function(e,t,n){var r=this;"string"===typeof e?e=r.current._cacheStreams[e]:e.id&&(e=r.current._cacheStreams[e.id]),e.voff?s.warn("Stream id = ",e.id," voff, do not chanage camera."):r.getMediaDevices("videoinput",(function(i){if(i.length<=1)s.warn("Only video input. not chanage");else{var a=e._cameraIndex;if(null===e._cameraIndex||void 0===e._cameraIndex){var c=e.getLocalMediaStream(),d=(m=c&&c.getVideoTracks())&&m.length&&m[0];if(d&&d.getCapabilities&&"function"===typeof d.getCapabilities){var u=d.getCapabilities(),l=u&&u.deviceId;for(var f in i){if((h=i[f]).deviceId===l||h.label==d.label){a=parseInt(f);break}}}else for(var f in i){if((h=i[f]).label==d.label){a=parseInt(f);break}}}for(;a<i.length;){var m,p=i[a],h=i[a=(a+1)%i.length];if(!(m=e.getLocalMediaStream().getVideoTracks())||0===m.length||h.label!=m[0].label)break}var v=(h=i[a]).label;s.warn("Stream ",e.id,p.label,">>",v),e._cameraIndex=a,e.constaints||(e.constaints={});var g=o.extend({},e.constaints);e._lastConstaints=g,e.constaints.video="object"===typeof e.constaints.video?e.constaints.video:{},e.constaints.video.deviceId={exact:h.deviceId},r._republish(e,(function(e){n&&n(e)}),(function(n){n instanceof emedia.event.OpenMediaError&&(e.constaints=g),t&&t(n)}))}}),t)},chanageConstraints:function(e,t,n,r){if("string"===typeof e?e=this.current._cacheStreams[e]:e.id&&(e=this.current._cacheStreams[e.id]),e){if(s.info("chanage pubstream constraints. it",e.id,t),a.isObject(t)&&!a.isEqual(e.constaints,t)){var i=e.constaints||{},c=e.voff,d=e.aoff;return e._lastConstaints=i,e.constaints=o.extend(!0,{},i,t),e.aoff=e.constaints.audio?0:1,e.voff=e.constaints.video?0:1,void this._republish(e,(function(e){u(),r&&r(e)}),(function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints=i,e.aoff=d,e.voff=c),n&&n(t)}))}u(),r&&r(e.getMediaStream())}else s.warn("Not found pubS");function u(){var t=e.getMediaStream();emedia.enableVideoTracks(t,!e.voff),emedia.enableAudioTracks(t,!e.aoff)}},voff:function(e,t,n,r){var i=this;"string"===typeof e&&(e=i.current._cacheStreams[e]);var o=e.voff;function a(){t!=o?(emedia.enableVideoTracks(e.getMediaStream(),!t),i.current&&i.current.voff(e,t)):s.info("pubstream voff not chanage.")}if(t=t?1:0,e.voff=t,!t&&e.constaints&&!e.constaints.video){var c=e.constaints.video;return e.constaints.video=!0,void i._republish(e,(function(e){a(),r&&r(e)}),(function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.video=c,e.voff=o),n&&n(t)}))}a(),r&&r(e.getMediaStream())},aoff:function(e,t,n,r){var i=this;"string"===typeof e&&(e=i.current._cacheStreams[e]);var o=e.aoff;function a(){t!=o?(emedia.enableAudioTracks(e.getMediaStream(),!t),i.current&&i.current.aoff(e,t)):s.info("pubstream aoff not chanage.")}if(t=t?1:0,e.aoff=t,!t&&e.constaints&&!e.constaints.audio){var c=e.constaints.audio;return e.constaints.audio=!0,void i._republish(e,(function(e){a(),r&&r(e)}),(function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.audio=c,e.aoff=o),n&&n(t)}))}a(),r&&r(e.getMediaStream())},iceing:function(e){return o.isPlainObject(this.current._linkedStreams[e])},recording:function(e){return o.isPlainObject(this.current._records[e])},startRecord:function(e,t){var n=this.current._linkedStreams[e];if(!n)throw s.error("not at linked streams",e),e+" not at linked streams";n._webrtc||t&&t(!1),this.current.startRecord(n,t)},stopRecord:function(e,t){var n=this.current._records[e];if(!n)throw s.error("not at recording streams",e),e+" not at recording streams";this.current.stopRecord(n,t)},getCurrentMembers:function(){return this.current.getCurrentMembers()},_onCapturePicture:function(e){var t,n=e.arg.rspBase64Pic,r=e.arg.streamId,i=this.current._cacheStreams[r];if(n){var o;if("function"!==typeof this.getHTMLVideo||!(o=this.getHTMLVideo(r)))return void s.warn("Not support capture picture. caused by htmlVideo not found");t=this.getCaptureBase64Context(o)}else{if("function"!==typeof this.onCapturePicture)return void s.warn("Not support capture picture. caused by onCapturePicture not found");this.onCapturePicture(i)}var a=this.current.newMessage({op:1001,tsxId:e.tsxId,memId:e.memId,arg:JSON.stringify(t?{pic:t}:{}),result:0});return this.current.postMessage(a,(function(e){s.warn("Send remote control onCapturePicture response. the result = ",e.result,e.msg||"")})),!0},newSession:function(e,t){var n=this;return new(n.Session||c)({ticket:t,owner:e,onTcklC:function(t){e.onTcklC(t.rtcId,t.cands)},onAcptC:function(t){e.onAcptC(t.rtcId,t.sdp,t.cands)},onAnsC:function(t){e.onAnsC(t.rtcId,t.sdp,t.cands)},onTermC:function(t){s.info("Server termc rtc: ",t.rtcId,t.message||t.msg);var r=t.endReason;if(21===r||22===r)o.forEach(e._cacheStreams,(function(n,i){var o;i.rtcId===t.rtcId&&(o=21===r?new emedia.event.SwitchVCodes({stream:i,useVCodes:t.useVCodes}):new emedia.event.SubFailNotSupportVCodes({stream:i}),e.onEvent(o))}));else if(23==r){var i=n.listeners.mgr.onPubVideoTooMuch;if(!i||"function"!=typeof i)return;i()}else if(24==r){var a=n.listeners.mgr.onPubDesktopTooMuch;if(!a||"function"!=typeof a)return;a()}else e.closeWebrtc(t.rtcId,!1,!0)},onEnter:function(t){e.onEnter(t.cver,t.mem)},onExit:function(t){e.onExit(t.cver,t.memId,t.reason||0)},onPub:function(t){e.onPub(t.cver,t.memId,t.pubS)},onUnpub:function(t){e.onUnpub(t.cver,t.memId,t.pubSId)},onMems:function(e){},onClose:function(t){e.onClose(t.cver,t.confrId)},onEvent:function(t){e.onEvent(t)},onStreamControl:function(t){e.onStreamControl(t.cver,t.streamId,t.voff,t.aoff,t.sver)},onRoleUpdate:function(t){e._onRoleUpdate(t.role,t.roleToken)},onRemoteControl:function(t){if("string"===typeof t.arg&&(t.arg=JSON.parse(t.arg)),20!==t.arg.op2||!t.arg.pic||!n._onCapturePicture.call(n,t)){if(30===t.arg.op2&&n._onRemotePannelControl)try{return void n._onRemotePannelControl.call(n,t)}catch(h){s.warn(h)}if(21!==t.arg.op2)if(22!==t.arg.op2){if(23===t.arg.op2){var r=n.listeners.mgr.onMuted;if(r&&"function"==typeof r)return void r()}if(24===t.arg.op2){var i=n.listeners.mgr.onUnmuted;if(i&&"function"==typeof i)return void i()}s.warn("Not support remote control");var o=e.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,arg:JSON.stringify(t.arg),result:t&&t.arg&&30===t.arg.op2?-405:-507,msg:"Not support the remote control."});e.postMessage(o,(function(e){s.warn("Send remote control response. the result = ",e.result,e.msg||"")}))}else{var a=t.arg,c=a.memId,d=a.nickName;if(!c)return void console.warn("onRequestToAdmin not have memberId");n._cache_receive_sessions.push(t);var u=n.listeners.mgr.onRequestToAdmin;u&&"function"==typeof u&&u({memberId:c,nickName:d},(function(e){return n.agreeRequestToAdmin(e)}),(function(e){return n.refuseRequestToAdmin(e)}))}else{var l=t.arg,f=l.memId,m=l.nickName;if(!f)return void console.warn("onRequestToTalker not have memberId");n._cache_receive_sessions.push(t);var p=n.listeners.mgr.onRequestToTalker;p&&"function"==typeof p&&p({memberId:f,nickName:m},(function(e,t){return n.agreeRequestToTalker(e,t)}),(function(e){return n.refuseRequestToTalker(e)}))}}},onRecvRemoteMessage:function(t){e._onRecvRemoteMessage&&e._onRecvRemoteMessage(t.memId,t.arg,t)},onConfrAttrsUpdated:function(e){var t=function(e){if(n.listeners.mgr){var t,r,i=n.listeners.mgr.catrrs||[];e.cattrs instanceof Array==1?(t=i,0==(r=e.cattrs).length||r.forEach((function(e){var n=!1;t.forEach((function(r,i){if(r.key==e.key)return t.splice(i,1,e),void(n=!0)})),n||t.push(e)})),i=t):i=function(e){var t=[];for(var n in e){var r={};r.key=n,r.val=e[n],r.op="",t.push(r)}return t}(e.cattrs),n.listeners.mgr.catrrs=i;var o=n.listeners.mgr.onConfrAttrsUpdated;o&&"function"==typeof o&&(o=o.bind(n.listeners.mgr))(i)}};e.cattrs instanceof Array==1&&e.cattrs.length>0&&t(e),e.cattrs.constructor==Object&&Object.keys(e.cattrs).length>0&&t(e),e.cstate&&function(e){if(e.cstate&&0!=Object.keys(e.cstate).length){var t=n.listeners.mgr.onConfrStateUpdated;t&&"function"==typeof t&&(t=t.bind(n.listeners.mgr))(e.cstate)}}(e)},onAdminChanged:function(e){var t=n.listeners.mgr.onAdminChanged;t&&"function"==typeof t&&t(e)},onRequestToTalkerReply:function(e){var t=n.listeners.mgr.onRequestToTalkerReply;t&&"function"==typeof t&&t(e)},onRequestToAdminReply:function(e){var t=n.listeners.mgr.onRequestToAdminReply;t&&"function"==typeof t&&t(e)},onLivecfgsChanged:function(e){e.liveCfgs&&emedia.config({liveCfgs:e.liveCfgs})}})},_judgeTalking:function(e){return!!e&&e.instant>=emedia.config.judgeTalkingByInstantGE},graffitiVideo:function(e,t,n){var r=this.getStreamById(e),i=new MediaStream;i._located=!0,r._localMediaStream.getAudioTracks().forEach((function(e){i.addTrack(e)})),n.captureStream(25).getVideoTracks().forEach((function(e){i.addTrack(e)})),t.srcObject=i,r.updateAttributes({localStream:i,isRepublished:!0,optimalVideoCodecs:r.optimalVideoCodecs}),this.push(r)},resetCanvas:function(e){var t;if(arguments.length>1)for(var n=0;n<arguments.length;n++)"function"===typeof(t=arguments[n])&&t(e),"function"!==typeof t&&o.isPlainObject(t)&&o.forEach(t,(function(t,n){s.debug("Canvas set ",t," = ",n),e.setAttribute(t,n)}))},_random:function(e){return Math.floor(Math.random()*e)},requestFrame:function(e,t){var n,r=this;if("string"===typeof e)n=this.current._cacheStreams[e];else{if(!e.id)return;n=this.current._cacheStreams[e.id]}function i(){(n.requestFrame(),n.canvas)&&h.prototype.redraw.bind({_canvasContext:n.canvas.getContext("2d")})(3,3)}n&&(t?setTimeout((function(){i(),r.requestFrame(n,t)}),t):i())},graffitiCanvas:function(e,t){o.targetDOM(e)&&(t=e,e=!1);var n=this,r=new n.ShareDesktopPubstream({voff:0,aoff:e?0:1});t||(t=document.createElement("canvas")),t.getContext("2d"),r.canvas=t;var i=function(){};return i.prototype.setCanvas=function(e){return this.canvasTag=t,n.resetCanvas(t,e),this},i.prototype.push=function(e,t){this._push(e,t)},i.prototype._push=function(i,o){"function"===typeof i&&(o=i,i=void 0),t.captureStream&&(t.captureStream.enabled=!0);var a=t.captureStream(i||25);function s(n){n.canvas=t,o&&o(n,t,a),e&&n.requestFrame()}function c(e,t){var r=new MediaStream;r._located=!0,e._localMediaStream&&e._localMediaStream.getAudioTracks().forEach((function(e){r.addTrack(e)})),a.getVideoTracks().forEach((function(e){r.addTrack(e)})),e._localMediaStream=r,e.localStream=r,n.push(e,t)}return e?n.__getUserMedia({audio:!0},(function(e,t){r._localMediaStream=t,c(r,s)})):c(r,s),this},new i},blobRecorder:function(e,t,n,r){var i=this;o.targetDOM(e)&&(e=e.srcObject),t||(t={mimeType:"video/webm;codecs=vp9"}),MediaRecorder.isTypeSupported(t.mimeType)||(s.info(t.mimeType," is not Supported"),t={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(t.mimeType)||(s.info(t.mimeType," is not Supported"),t={mimeType:"video/webm"},MediaRecorder.isTypeSupported(t.mimeType)||(s.info(t.mimeType," is not Supported"),t={mimeType:""})));try{var a=new MediaRecorder(e,t)}catch(u){return void s.error("Exception while creating MediaRecorder: ",u)}var c=[];function d(){this.blobs=c}return a.onstop=r||function(e){s.info("Recorder stopped: ",e)},a.ondataavailable=n||function(e){e.data&&e.data.size>0&&c.push(e.data)},d.prototype.start=function(e){a.start(e)},d.prototype.stop=function(){a.stop()},d.prototype.playurl=function(e){var t=new Blob(this.blobs,e||{type:"video/webm"});return window.URL.createObjectURL(t)},d.prototype.download=function(e,t){var n=new Blob(this.blobs,t||{type:"video/webm"});i.downloadFile(e,void 0,n)},new d},requestToTalker:function(){this.current.requestToTalker()},_get_session_by_memberId_and_op_type:function(e,t){if(e&&t){var n=void 0;return this._cache_receive_sessions.map((function(r){var i=r.arg;if(i&&i instanceof Object&&Object.keys(i).length>0){var o=i.memId,a=i.op2;o==e&&a==t&&(n=r)}})),n}},_delete_session_by_memberId_and_op_type:function(e,t){if(e&&t){var n=this;this._cache_receive_sessions.map((function(r,i){var o=r.arg;if(o&&o instanceof Object&&Object.keys(o).length>0){var a=o.memId,s=o.op2;a==e&&s==t&&n._cache_receive_sessions.splice(i,1)}}))}},agreeRequestToTalker:function(){var e=i(r.mark((function e(t,n){var i,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._get_session_by_memberId_and_op_type(t,21)){e.next=3;break}return e.abrupt("return");case 3:return o=i.arg.memName,a=this.listeners.confrId,e.prev=5,e.next=8,this.listeners.mgr.chanageRoles(3,[o],a);case 8:e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(5),-523!=e.t0.error){e.next=16;break}if(!n||"function"!=typeof n){e.next=16;break}return n(),e.abrupt("return");case 16:this._delete_session_by_memberId_and_op_type(t,21);case 17:case"end":return e.stop()}}),e,this,[[5,10]])})));return function(t,n){return e.apply(this,arguments)}}(),refuseRequestToTalker:function(e){if(e){var t=this._get_session_by_memberId_and_op_type(e,21);t&&(this.current.refuseRequestToTalker(t),this._delete_session_by_memberId_and_op_type(e,21))}else console.warn("refuseRequestToTalker memberId is required")},requestToAdmin:function(){this.current.requestToAdmin()},agreeRequestToAdmin:function(e){var t=this._get_session_by_memberId_and_op_type(e,22);if(t){var n=t.arg.memName,r=this.listeners.confrId;this.listeners.mgr.chanageRoles(7,[n],r),this._delete_session_by_memberId_and_op_type(e,22)}},refuseRequestToAdmin:function(e){if(e){var t=this._get_session_by_memberId_and_op_type(e,22);t&&(this.current.refuseRequestToAdmin(t),this._delete_session_by_memberId_and_op_type(e,22))}else console.warn("refuseRequestToAdmin memberId is required")},muteBymemberId:function(e){this.current&&7==this.current.role&&this.current.muteBymemberId(e)},unmuteBymemberId:function(e){this.current&&7==this.current.role&&this.current.unmuteBymemberId(e)}})},264:function(e,t,n){var r=n(7),i=r.tagLogger("Member"),o=n(34),a=n(174);e.exports=r.prototypeExtend({__init__:function(){if(!this._session)throw i.error("Require session"),"Require session";this.closed=!1,this._ices={},this.supportVCodes={},this.audioMixers={}},reflushSupportVCodes:function(e){var t=this;t.supportVCodes={},t._orderVCodes=e,e&&0!=e.length?r.forEach(e,(function(e,n){t.supportVCodes[n]=1})):i.warn("Not config support vcodes")},getOptimalVideoCodecs:function(){if(!this._orderVCodes||0==this._orderVCodes.length)return/Chrome/.test(navigator.userAgent)?"VP8":/Safari/.test(navigator.userAgent)&&/Version\/11/.test(navigator.userAgent)?"H264":"VP8";var e=0;r.forEach(this._cacheMembers,(function(){e++}));for(var t,n=0,i=0;i<this._orderVCodes.length;i++){var o=this._orderVCodes[i];if(0==n&&(n=this.supportVCodes[o]),this.supportVCodes[o]>e)return o;this.supportVCodes[o]>n&&(n=this.supportVCodes[o],t=o)}return t||this._orderVCodes&&this._orderVCodes.length>0&&this._orderVCodes[0]},setMemberId:function(e){this._memberId=e},getMemberId:function(){return this._memberId||this.id},createWebrtc:function(e,t){var n=this;e||(e={}),r.extend(e,{_rebuildCount:t||0}),!0===n._service.useRTCCfg&&n.__rtc_cfg?e.iceServerConfig=r.extend(!0,{},n.__rtc_cfg):r.isPlainObject(n._service.useRTCCfg)&&(e.iceServerConfig=r.extend(!0,{},n._service.useRTCCfg));var s=new a({confrAttendee:n,useIp:n.ip,onIceStateChange:function(e){var t=e;i.debug("evt.target ice state",t);try{if("failed"==t)return n.onEvent(new o.ICEConnectFail({webrtc:s})),void(s.onEvent&&s.onEvent(new o.ICEConnectFail({webrtc:s})));if("connected"==t)return n.onEvent(new o.ICEConnected({webrtc:s})),void(s.onEvent=null);if("closed"==t)return n.onEvent(new o.ICEClosed({webrtc:s})),void(s.onEvent&&s.onEvent(new o.ICEClosed({webrtc:s})));if("disconnected"==t)return n.onEvent(new o.ICEDisconnected({webrtc:s})),void(s.onEvent&&s.onEvent(new o.ICEDisconnected({webrtc:s})))}finally{n._onIceStateChange&&n._onIceStateChange(s,e)}},onIceCandidate:function(e){n._onIceCandidate&&e&&n._onIceCandidate(s,e)},onGotRemoteStream:function(e){i.info("got stream.",s._rtcId,s.__id,e),s.onGotMediaStream&&s.onGotMediaStream(e),n.onEvent(new o.ICERemoteMediaStream({webrtc:s}))},onAddIceCandidateError:function(e){n.onEvent(new o.AddIceCandError({webrtc:s,event:e}))},onSetSessionDescriptionError:function(e){i.warn("onSetSessionDescriptionError : Failed to set session description: "+e.toString()),n.onEvent&&n.onEvent(new o.ICEConnectFail({webrtc:s,event:e}))},onCreateSessionDescriptionError:function(e){i.warn("Failed to create session description: "+e.toString()),n.onEvent&&n.onEvent(new o.ICEConnectFail({webrtc:s,event:e}))}},e);return n._ices||(n._ices={}),n._ices[s.getRtcId()]&&n._howDoWebrtcWhenCrtExsitsWebrtc(s),n._ices[s.getRtcId()]=s,n._ices[s.__id]=s,n._iceCreateRtcPeerConnection(s.getRtcId()),i.debug("create rtc ",s),s},_howDoWebrtcWhenCrtExsitsWebrtc:function(e){this.closeWebrtc(e.getRtcId(),!0,!1)},connect:function(e,t){this._session.connect(e,t)},connected:function(){return this._session.connected()},newMessage:function(e){var t=this,n=t._session.newMessage(e);return n.post=function(e,n){t.postMessage(this,e,n)},n},message:function(e){var t=this,n=t._session.newMessage(e);return n.post=function(e,n){t.postMessage(this,e,n)},n},postMessage:function(e,t,n){try{e.sessId||(e.sessId=this._session._sessionId),this._session.postMessage(e,t,n)}catch(r){t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"post message. exception"}),i.warn(r)}},onEvent:function(e){},_onIceStateChange:function(e,t){i.info(e.getRtcId(),t),this.onEvent(new o.ICEChanage({webrtc:e,state:t}))},_onIceCandidate:function(e,t){var n,i=this;r.isArray(t)?n=t:(n=[]).push(t);var a=i.newMessage().setOp(105).setRtcId(e.getRtcId()).setCands(n);i.postMessage(a,(function(e){0==e.result||i.onEvent(new o.RspFail({request:a,response:e}))}))},_initC:function(e,t,n,a,s,c){var d=this;if(t&&t.rtcId!==e.getRtcId())throw i.error("stream and webrtc rtcId not equal."),"stream and webrtc rtcId not equal.";var u=d.newMessage().setOp(102).setRtcId(e.getRtcId()).setSdp(n).setSubSId(a);e.subArgs&&r.extend(u,e.subArgs),t&&t.located()&&u.setPubS(t),d.postMessage(u,(function(n){if(0!=n.result)return d.onEvent(new o.RspFail({request:u,response:n})),void(s&&s(new o.RspFail({request:u,response:n,hidden:!0===n.retrying})));t&&!t.id&&n.streamId&&t.updateAttributes({id:n.streamId});try{c&&c()}catch(r){i.warn(r)}n.sdp&&d.ansC(e.getRtcId(),n.sdp,n.cands),n.mems&&d.onMembers&&d.onMembers(n.cver,n.mems),n.streams&&d.onStreams&&d.onStreams(n.cver,n.streams)}))},_acptC:function(e,t,n){var r=this,i=r.newMessage().setOp(104).setRtcId(e.getRtcId()).setSdp(t);r.postMessage(i,(function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:i,response:e})),void(n&&n(new o.RspFail({request:i,response:e})))}))},_ansCAndPubstream:function(e,t,n,a,s){var c=this,d=c.newMessage().setOp(106).setRtcId(e.getRtcId()).setSdp(n);e.subArgs&&r.extend(d,e.subArgs),t&&t.located()&&(t=r.extend({},t),r.removeAttribute(t,"mutedMuted"),r.removeAttribute(t,"_located"),d.setPubS(t)),c.postMessage(d,(function(e){if(0!=e.result)return c.onEvent(new o.RspFail({request:d,response:e})),void(a&&a(new o.RspFail({request:d,response:e,hidden:!0===e.retrying})));t&&!t.id&&e.streamId&&t.updateAttributes({id:e.streamId});try{s&&s()}catch(n){i.warn(n)}}))},_ansC:function(e,t,n){var r=this,i=r.newMessage().setOp(106).setRtcId(e.getRtcId()).setSdp(t);r.postMessage(i,(function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:i,response:e})),void(n&&n(new o.RspFail({request:i,response:e})))}))},_termC:function(e,t,n){var r=this,i="string"===typeof e?e:e.getRtcId(),a=r.newMessage().setOp(107).setRtcId(i).setEndReason(t);r.postMessage(a,(function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:a,response:e})),void(n&&n(new o.RspFail({request:a,response:e})))}))},_iceCreateRtcPeerConnection:function(e){this._ices[e].createRtcPeerConnection(),i.debug("create rtc peer connection",e)},doOffer:function(e,t,n){this._ices[e].createOffer((function(e){t(e)}))},offerCall:function(e,t,n,r,i){var o=this,a=o._ices[e];a.createOffer((function(e){o._initC&&o._initC(a,t,e,n,r,i)}))},accept:function(e,t){var n=this,r=n._ices[e];r.createPRAnswer((function(e){n._acptC&&n._acptC(r,e,t)}))},answerCall:function(e,t,n,r){var i=this,o=i._ices[e];o.createAnswer((function(e){i._ansCAndPubstream&&i._ansCAndPubstream(o,t,e,n,r)}))},answer:function(e,t){var n=this,r=n._ices[e];r.createAnswer((function(e){n._ansC&&n._ansC(r,e,t)}))},onTcklC:function(e,t){this._addIceCandidate(t,e)},onAcptC:function(e,t,n){this._iceSetRemoteSDP(t,e),n&&this._addIceCandidate(n,e)},onAnsC:function(e,t,n){this._iceSetRemoteSDP(t,e),n&&this._addIceCandidate(n,e)},_addIceCandidate:function(e,t){if(e&&0!=e.length){var n=this._ices[t];n&&n.addIceCandidate(e)}else i.warn("drop cands",e)},closeWebrtc:function(e,t,n){var o=this,a=o._ices[e];if(r.forEach(o._cacheStreams,(function(t,n){if(n.rtcId===e&&!n.located())try{var a=r.removeAttribute(o._mediaMeters,t);a&&a._finally()}catch(s){i.warn(s)}n.rtcId===e&&2===n.type&&r.removeAttribute(o.audioMixers,n.id)})),!a||a.closed)return i.warn("Webrtc not exsits or closed",a&&a.closed),n&&a&&r.forEach(o._cacheStreams,(function(t,n){n.rtcId===e&&(r.removeAttribute(o._linkedStreams,t),i.warn("Webrtc close, remvoe from _linkedStreams",t))})),void(n||o._termC(e,0));if(o._records){r.forEach(o._records,(function(t,n){n.rtcId===e&&function(e){try{o.stopRecord(e)}catch(t){i.warn(t)}finally{r.removeAttribute(o._records,e.id)}}(n)}))}try{n||a&&o._termC(a,t&&a._localStream?-10:0)}finally{a&&a.close(t),a&&o.onWebrtcTermC&&o.onWebrtcTermC(a),t||a&&r.forEach(o._cacheStreams,(function(t,a){a.rtcId===e&&(a.located()&&(emedia.stopTracks(a._localMediaStream),a&&!a.closeReason&&a.updateAttributes({closeReason:"WebrtcClose"}),o._cacheStreams[t]&&o._linkedStreams[t]&&o.onRemoveStream(a),r.removeAttribute(o._cacheStreams,t),o._streamAutomators&&r.removeAttribute(o._streamAutomators,t),o._monitSoundChanagedStreams&&r.removeAttribute(o._monitSoundChanagedStreams,t),i.info("Webrtc close. Remove stream",t,". from cache")),n&&(r.removeAttribute(o._linkedStreams,t),i.info("Webrtc close. Remove stream",t,". from _linkedStreams")))}))}return a},__close:function(e){i.warn("closing, reason = ",e);if(!this.closed){if(this.closed=!0,this.__getCopyInterval&&(clearInterval(this.__getCopyInterval),i.warn("Stop interval get copy")),this._ices)for(var t in this._ices)this.closeWebrtc(t,!1);var n=this.newMessage().setOp(201).setReason(e||0);this.postMessage(n)}},exit:function(e){var t=this;e?(e&&t._closeMyConfr(11),setTimeout((function(){t.close(0)}),100)):t.close(0)},_closeMyConfr:function(e){var t=this.newMessage().setOp(204).setReason(e||0);this.postMessage(t,(function(e){i.warn("Close confr ",e.result,e.msg)}))},close:function(e,t){var n=this;if(!n.closed)try{r.forEach(n._cacheStreams||{},(function(e,t){t.located()&&t._localMediaStream&&emedia.stopTracks(t._localMediaStream)})),n.__close(e),r.forEach(n._cacheStreams,(function(e,t){n.onRemoveStream(t)})),r.forEach(n._cacheMembers,(function(e,t){n.onRemoveMember(t)}))}finally{try{setTimeout((function(){n._session&&n._session.close(e)}),500),n.onEvent(new o.Hangup({reason:e,failed:t,self:{id:n._memberId}})),n.onMeExit&&n.onMeExit(e,t)}catch(a){i.error(a)}finally{n._onFinally&&n._onFinally()}}},webrtcState:function(e){return this._ices[e].iceConnectionState()},_iceSetRemoteSDP:function(e,t){var n=this._ices[t];n&&n.setRemoteDescription(e)},setLocalStream:function(e,t){this._ices[t].setLocalStream(e)},onWebrtcTermC:function(e){}})},266:function(e,t,n){"use strict";function r(e){this.context=e,this.instant=0,this.slow=0,this.clip=0,this.script=e.createScriptProcessor(2048,1,1);var t=this;this.script.onaudioprocess=function(e){var n,r=e.inputBuffer.getChannelData(0),i=0,o=0;for(n=0;n<r.length;++n)i+=r[n]*r[n],Math.abs(r[n])>.99&&(o+=1);t.instant=Math.sqrt(i/r.length),t.slow=.95*t.slow+.05*t.instant,t.clip=o/r.length}}r.prototype.connectToSource=function(e,t){console.log("SoundMeter connecting");try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),"undefined"!==typeof t&&t(null)}catch(n){console.error(n),"undefined"!==typeof t&&t(n)}},r.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e.exports=r},267:function(e,t,n){var r=n(7),i=r.tagLogger("Handler"),o=n(34),a=r.prototypeExtend({onEvent:function(e){this.mgr.upload_stats&&this.mgr.upload_stats.upload_event(e);var t=this;function n(){try{t.handleEvent(e)}catch(n){i.warn(n)}}if(e&&i.info("[EVT]",e.message(),e.hidden||""),e instanceof o.ServerRefuseEnter&&e.failed&&-95270===e.failed&&(e.failed=-9527),e instanceof emedia.event.StreamState&&e.stream&&e.stream.located())n();else try{e.hidden||t.onNotifyEvent&&t.onNotifyEvent(e)}finally{n()}},handleEvent:function(e){var t=this;if(e instanceof o.RecvResponse)t._onRecvResponse(e);else if(e instanceof o.ServerRefuseEnter)i.warn("Server refuse, ",e.failed,e.msg),t.onServerRefuseEnter(e);else if(e instanceof o.NetworkChanaged)i.warn("Network chanaged, ",e.preIp,e.nowIp),t.onNetworkChanaged(e);else if(e instanceof o.EnterFail)i.warn("Enter fail, result = ",e.failed),t.onEnterFail();else if(e instanceof o.WSClose)t.onWSClose();else if(e instanceof o.WSConnected)i.warn("Websocket connected");else if(e instanceof o.ICEConnected){var n=e.webrtc;t.onICEConnected(n)}else if(e instanceof o.ICEConnectFail){n=e.webrtc;t.onICEConnectFail(n)}else if(e instanceof o.ICEDisconnected){n=e.webrtc;t.onICEDisconnected(n)}else if(e instanceof o.ICEClosed){n=e.webrtc;t.onICEClosed(n)}else if(e instanceof o.ICERemoteMediaStream)t.onICERemoteMediaStream(e.webrtc);else if(e instanceof o.PushSuccess){t._cacheStreams[e.stream.id]=t._linkedStreams[e.stream.id]=e.stream;var a=t.newStream(e.stream);if(e.hidden&&!t._maybeNotExistStreams[e.stream.id]&&!a.isRepublished)return void t._onAddStream(a);emedia._yetGetUserMedia=!0;try{!0!==e.hidden&&a&&t.onUpdateStream(a,new a.Update({voff:a.voff,aoff:a.aoff,mediaStream:a.getMediaStream()}))}finally{emedia.isSafari&&r.forEach(t._cacheStreams,(function(e,n){!0===n._autoSubWhenPushStream&&(r.removeAttribute(n,"_autoSubWhenPushStream"),t.createWebrtcAndSubscribeStream(n.id))}))}}else if(e instanceof o.SubSuccess)console.log("__event.SubSuccess",e),t._linkedStreams[e.stream.id]=e.stream,e.stream.updateAttributes({_zoom:1});else if(e instanceof o.PushFail){if(!0!==e.hidden){var s=r.removeAttribute(t._linkedStreams,e.stream.id);if(i.warn("PushFail remove from _linkedStreams",e.stream.id,s),s){a=t.newStream(e.stream);t.onRemoveStream(a)}}}else if(e instanceof o.SubFail){if(!0!==e.hidden)r.removeAttribute(t._linkedStreams,e.stream.id),i.warn("SubFail remove from _linkedStreams",e.stream.id),(a=t.newStream(e.stream)).updateAttributes({rtcId:void 0,_webrtc:void 0,mediaStream:void 0}),t.onUpdateStream(a,new a.Update(a))}else if(e instanceof o.SubFailNotSupportVCodes){var c=e.stream;i.warn("Rtc donot support pub VCodes. close. sub fail.",c.rtcId," -> ",c.id);try{t.onNotSupportPublishVideoCodecs&&t.onNotSupportPublishVideoCodecs(c)}catch(l){i.warn(l)}}else if(e instanceof o.EnterSuccess)console.log("__event.EnterSuccess",e),t.onEnterSuccess();else if(e instanceof o.SwitchVCodes){c=e.stream;var d,u=e.useVCodes;n=c._webrtc;if(i.warn("Rtc switch VCodes. ",c.id,u),u&&0!=u.length||i.warn("Rtc switch VCodes. error! useVCodes is empty ",c.id,u),emedia.config&&emedia.config.forceUseVideoCodecs&&emedia.config.forceUseVideoCodecs.length>0&&(d=emedia.config.forceUseVideoCodecs,r.isArray(d)||(d=[]).push(emedia.config.forceUseVideoCodecs)),d){if("string"===typeof d&&d!==u[0])return void i.warn("Rtc switch VCodes. igrone . useVCodes !== forceUseVideoCodecs ",c.id,n._rtcId,u,d);if(r.isArray(d)&&d[0]!==u[0])return void i.warn("Rtc switch VCodes. igrone ddd . useVCodes == forceUseVideoCodecs ",c.id,n._rtcId,u,d)}if(n&&n.optimalVideoCodecs){if("string"===typeof n.optimalVideoCodecs&&n.optimalVideoCodecs==u[0])return void i.warn("Rtc switch VCodes. igrone . useVCodes == optimalVideoCodecs ",c.id,n._rtcId,u);if(r.isArray(n.optimalVideoCodecs)&&n.optimalVideoCodecs.length>0&&n.optimalVideoCodecs[0]==u[0])return void i.warn("Rtc switch VCodes. igrone ddd . useVCodes == optimalVideoCodecs ",c.id,n._rtcId,u)}c.updateAttributes({optimalVideoCodecs:u}),n&&t.closeWebrtc(n.getRtcId(),!0),setTimeout((function(){c.updateAttributes({iceRebuildCount:1}),t.iceRebuild(c),i.warn("Rtc switch VCodes. iceRebuild end.",c.id,u)}),300)}},_onRecvResponse:function(e){var t=e.request,n=e.response;if(t&&n&&200!==t.op&&1002!==t.op&&0!==n.result){i.warn("Server refuse. when request = ",t);var r=e.failed;switch(r){case-9527:case-95270:break;case-500:case-502:case-504:case-508:case-510:this.close(4,r);break;case-506:this.close(11,r);break;case-501:this.close(11,r)}}},onServerRefuseEnter:function(e){var t=e.failed;switch(t){case-9527:case-95270:this.close(4,-9527);break;case-500:case-502:case-504:case-508:case-510:this.close(4,t);break;case-506:this.close(11,t);break;default:this.close(2)}},onEnterFail:function(){this.__getCopyInterval&&clearInterval(this.__getCopyInterval)},onNetworkChanaged:function(e){var t=this,n=e.nowIp;emedia.config.rebuildPeerConnectionWhenNetworkChanaged&&setTimeout((function(){var e={};r.forEach(t._cacheStreams,(function(r,o){if(!t._maybeNotExistStreams[r]&&o._webrtc){var a=o._webrtc;e[o.rtcId]||(a.closed||"string"!==typeof a.useIp||a.useIp===n||(i.warn("network chanage. webrtc will rebuild.",a._rtcId,a.__id),t.onICEClosed(a)),e[o.rtcId]=!0)}}))}),100)},onEnterSuccess:function(){var e=this;setTimeout((function(){e._failIcesRebuild()}),50),e.getCopyIntervalMillis&&e.getCopyIntervalMillis>0&&(i.warn("Run interval get copy. interval = ",e.getCopyIntervalMillis),e.__getCopyInterval&&clearInterval(e.__getCopyInterval),e.__getCopyInterval=setInterval((function(){e._session.connected()?e._sysCopy.apply(e):(i.warn("Warn! cannot get copy. cause offline."),e.__getCopyInterval&&clearInterval(e.__getCopyInterval))}),e.getCopyIntervalMillis)),e.getMediaMeterIntervalMillis&&e.getMediaMeterIntervalMillis>0&&e._intervalGetMediaMeters()},_intervalGetMediaMeters:function(){var e=this;!function t(){e.__getMediaMetersIntervalFlag&&emedia.cancelAnimationFrame(e.__getMediaMetersIntervalFlag),e.getMediaMeterIntervalMillis?e.__getMediaMetersIntervalFlag=emedia.requestAnimationFrame((function(n){"function"===typeof emedia.AudioContext&&e._flushMediaMetersByAudioContext.apply(e),!1===e.closed&&t()}),e.getMediaMeterIntervalMillis):i.warn("Ontalking closed. please use getMediaMeterIntervalMillis")}()},_flushMediaMetersByAudioContext:function(){var e=this;r.forEach(e._cacheStreams,(function(t,n){e._monitSoundChanagedStreams&&!e._monitSoundChanagedStreams[t]||"0"!=n.id&&e._updateMetersOrNewOne.call(e,t,n)}));var t=[];r.forEach(e._mediaMeters,(function(n,r){var i=e._cacheStreams[n];i&&e._updateMetersOrNewOne.call(e,n,i),i||t.push(n)})),r.forEach(t,(function(t,n){r.removeAttribute(e._mediaMeters,n)}))},_updateMetersOrNewOne:function(e,t){var n=this,i=n._mediaMeters[e];if(2===t.type&&!t.located()&&(!t.subArgs||!t.subArgs.subSAudio)){var o=n._oneAudioMixers();if(!o||i&&i._webrtc&&o._webrtc.__id!=i._webrtc.__id)return i&&i._finally(),r.removeAttribute(n._mediaMeters,e),void n._onSoundChanage.call(n,t.owner,t)}return i&&i._streamCreateId===t.__create_id&&i.__mediaSoundMeter.__worked?(i.onSoundMeters((function(e){n._onSoundChanage.call(n,t.owner,t,e)})),i):(i&&(i._streamCreateId!==t.__create_id||i.__mediaSoundMeter.__worked)&&(i&&i._finally(),r.removeAttribute(n._mediaMeters,e),n._onSoundChanage.call(n,t.owner,t)),t.aoff?void 0:((i=n._newMediaMeters(t))&&(n._mediaMeters[e]&&n._mediaMeters[e]._finally(),n._mediaMeters[e]=i),i))},_newAudioContext:function(){if(emedia.__usingWebAudio)return emedia.__audioContext},_newMediaMeters:function(e){var t;if(2===e.type&&e.subArgs&&e.subArgs.subSAudio&&e._webrtc&&e._webrtc.getRemoteStream())return new e.StreamSoundMeter({_stream:e,_mediaStream:e._webrtc.getRemoteStream(),_webrtc:e._webrtc,__audioContext:this._newAudioContext()});if(2===e.type&&e.located())return new e.StreamSoundMeter({_stream:e,_mediaStream:e._localMediaStream,__audioContext:this._newAudioContext()});if(2===e.type&&!e.located()){var n=this._oneAudioMixers();if(!n||!n._webrtc||n._webrtc.closed)return;if(n&&(void 0===n._remoteMediaSoundMeters||!n._remoteMediaSoundMeters.__worked)&&n._webrtc&&n._webrtc.getRemoteStream()&&(n._remoteMediaSoundMeters=new n.MediaSoundMeter({_mediaStream:n._webrtc.getRemoteStream(),__audioContext:this._newAudioContext()})),!n._remoteMediaSoundMeters)return;return new e.StreamSoundMeter({_stream:e,_webrtc:n._webrtc,__mediaSoundMeter:n._remoteMediaSoundMeters})}return!e.aoff&&(t=e.getMediaStream())?new e.StreamSoundMeter({_stream:e,_mediaStream:t,__audioContext:this._newAudioContext()}):void 0},_oneAudioMixers:function(){var e=this._cacheStreams[0];if(e&&e._webrtc&&!e._webrtc.closed)return e;for(var t in this.audioMixers){var n=this.audioMixers[t];if(n.located())return n}},onWSClose:function(){this.__getCopyInterval&&clearInterval(this.__getCopyInterval),i.info("Websocket closed.")},onICEDisconnected:function(e){var t=this;t.__networkWeakInterval&&clearTimeout(t.__networkWeakInterval),t.__networkWeakInterval=setTimeout((function(){t.onNetworkWeak&&t.onNetworkWeak()}),1e3),r.forEach(t._linkedStreams,(function(n,o){o.rtcId==e.getRtcId()&&(t._maybeNotExistStreams[n]||(t._maybeNotExistStreams[n]=r.extend({},o)).updateAttributes({iceRebuildCount:1}),i.info("Stream maybe not exist. caused by disconnected",o.id))}))},onICEConnectFail:function(e){var t=this;for(var n in t._linkedStreams){var a=t._linkedStreams[n];if(a.rtcId==e.getRtcId()){if(a._webrtc&&a._webrtc.__id!==e.__id){i.warn("Stream use other webrtc rtcId = ",a.rtcId,", id: ",a._webrtc.__id,e.__id);continue}var s;if((s=t._maybeNotExistStreams[n])||(s=t._maybeNotExistStreams[n]=r.extend({},a)).updateAttributes({iceRebuildCount:1}),s){var c=new o.StreamState({stream:s});c.iceFail(),t.onEvent(c)}if(i.info("ice fail. webrtc = ",e.getRtcId()," problem stream is ",s.iceRebuildCount,s.id),s.iceRebuildCount>emedia.config.iceRebuildCount)i.info("ice fail. webrtc = ",e.getRtcId()," rebuild fail. problem stream is ",s.id),s.located()?t.onEvent(new o.PushFail({stream:a,cause:"pub ice rebuild failed."})):t.onEvent(new o.SubFail({stream:a,cause:"sub ice rebuild failed."})),t.closeWebrtc(e.getRtcId(),!1);else{var d=t._records[s.id];s._localMediaStream?i.info("ice fail. webrtc = ",e.getRtcId()," will rebuild. remain local stream. ",s.id):i.info("ice fail. webrtc = ",e.getRtcId()," will rebuild.",s.id),t.closeWebrtc(e.getRtcId(),!0),d&&(t._records[s.id]=d),function(e){setTimeout((function(){t.iceRebuild(e)}),emedia.config.iceRebuildIntervalMillis)}(s),i.info("ice fail. webrtc = ",e.getRtcId()," will rebuilding. problem stream is ",s.id)}2===a.type&&r.removeAttribute(t.audioMixers,a.id)}}},onICEClosed:function(e){if(e.closed){i.warn("Webrtc will be removed. by __id = ",e.__id,", rtcId = ",e.getRtcId());var t=r.removeAttribute(this._ices,e.__id);t?i.warn("Webrtc removed. by id = ",t.__id,", rtcId = ",t.getRtcId()):i.warn("Webrtc removed. by id = ",e.__id,", rtcId = ",e.getRtcId());var n=this._ices[e.getRtcId()];n&&n.__id===t.__id&&(t=r.removeAttribute(this._ices,e.getRtcId()),i.warn("Webrtc removed. by rtcId = ",t.getRtcId(),", __id = ",t.__id))}else i.info("ICE self closed. not allow. will rebuild",e.getRtcId()),this.onICEConnectFail(e)},onICEConnected:function(e){var t=this;r.forEach(t._cacheStreams,(function(n,a){if(a.rtcId==e.getRtcId()){if(a.updateAttributes({finalVCodeChoices:e.finalVCodeChoices}),t._maybeNotExistStreams[n]){r.removeAttribute(t._maybeNotExistStreams,a.id),t._linkedStreams[n]=a,i.info("ice reconnected. webrtc = ",e.getRtcId(),"will update stream = ",a.id);var s=t._records[a.id];s&&s.rtcId!==a.rtcId&&(t.startRecord(a),i.warn("Re record. for ",a.id,", after rebuild ice.",s.rtcId,"->",a.rtcId))}else i.info("ice connected. webrtc = ",e.getRtcId(),a.id),a.located()&&t.onEvent(new o.PushSuccess({stream:a})),a.located()||t.onEvent(new o.SubSuccess({stream:a}));2===a.type&&(t.audioMixers[a.id]=a)}}))},onICERemoteMediaStream:function(e){var t=this;r.forEach(t._cacheStreams,(function(n,r){if(r.rtcId==e.getRtcId()&&(!r.located()||2===r.type)){var i=e.getRemoteStream();if(t._updateRemoteStream(r,i),r.onGotRemoteMediaStream)r.onGotRemoteMediaStream.call(r,i);else(r=t.newStream(r)).updateAttributes({mediaStream:e.getRemoteStream()}),t.onUpdateStream(r,new r.Update({mediaStream:r.mediaStream}))}}))},_failIcesRebuild:function(){var e=this;r.forEach(e._maybeNotExistStreams,(function(t,n){setTimeout((function(){e.iceRebuild(n)}),100)}))},iceRebuild:function(e){return this.connected()?this._linkedStreams[e.id]&&this._cacheStreams[e.id]?void(e.iceRebuildCount>emedia.config.iceRebuildCount?(i.info("ice rebuild fail. count too many. stream is ",e.id),e.located()?this.onEvent(new o.PushFail({stream:e,cause:"pub ice rebuild failed."})):this.onEvent(new o.SubFail({stream:e,cause:"sub ice rebuild failed."}))):this.connected()?(i.info("ice try rebuild. count",e.iceRebuildCount,". stream is ",e.id),this.rebuildIce(e),e.iceRebuildCount++):i.warn("ice rebuild. stop. cause by not websocket disconnect",e.id)):(i.info("ice rebuild fail. it yet closed. stream is ",e.id,e.rtcId),r.removeAttribute(this._maybeNotExistStreams,e.id),r.removeAttribute(this._linkedStreams,e.id),void i.warn("iceRebuild, remvoe from _linkedStreams",e.id)):(e.updateAttributes({iceRebuildCount:1}),void i.warn("Websocket disconnect. waiting. rebuild count reset",e.iceRebuildCount,e.id))},rebuildIce:function(e){this._cacheStreams[e.id]?(i.warn("Begin rebuild ice ",e.iceRebuildCount,e.id),e.located()?(e.updateAttributes({isRepublished:!0}),this.push(e,void 0,void 0,!0)):this.createWebrtcAndSubscribeStream(e.id),i.warn("Finish rebuild ice ",e.iceRebuildCount,e.id,this._cacheStreams[e.id].rtcId)):i.warn("Begin rebuild ice. not found stream at local",e.iceRebuildCount,e.id)},_sysCopy:function(){var e=this,t=e.newMessage().setOp(1e3).setCver(e._cver||0);e.postMessage(t,(function(t){0==t.result?(e._cver||0)<t.cver&&(e._cver=t.cver,e.onMembers(t.cver,t.mems||{}),e.onStreams(t.cver,t.streams||{}),i.info("Got copy success.")):i.warn("Get copy fail. result = ",t.result)}))}});e.exports=a},268:function(e,t,n){var r=n(7),i=r.tagLogger("Desktop"),o=n(34);window.__shareDesktopMessageCount__=0,e.exports=r.prototypeExtend({__RTC_PAGE_MSG_TYPE__:"RTC-SD-PAGE",__RTC_EXT_MSG_TYPE__:"RTC-SD-EXT",__init__:function(){var e=this;e.__extLoaded=e.rsdExtLoaded(),e.__extLoaded&&e.__onRsdExtLoad(),window.addEventListener("load",(function(t){if(!e.__extLoaded){var n=e.rsdExtLoaded();e.__extLoaded=n}})),window.addEventListener("message",(function(t){if(t.data){var n=t.data;n.type&&n.type===e.__RTC_EXT_MSG_TYPE__&&n.evname&&(i.info("got ext-msg: ",n),"extLoaded"!==n.evname?e.__onMessage(n):e.__extLoaded||(e.__extLoaded=!0,setTimeout(e.__onRsdExtLoad(),50)))}}))},rsdExtLoaded:function(){var e=document.getElementById("RTC-Share-Deskto-installed-ele-rat1abrr");return!(!emedia.isElectron&&!e)},__sendMessage:function(e,t){var n=this,o="tsx_"+__shareDesktopMessageCount__+++"_"+Math.random().toString(36).substr(2,4);if(!n.__extLoaded)throw i.error("Rtc share desktop not loaded"),"Rtc share desktop not loaded";e.tsxId=o,n["on_"+o]=function(){t&&t.apply(n,arguments),r.removeAttribute(n,"on_"+o)},window.postMessage&&window.postMessage(e,"*")},__onMessage:function(e){var t=e.tsxId;this["on_"+t]&&this["on_"+t](e)},__onRsdExtLoad:function(){this.onExtLoaded&&this.onExtLoaded()},openDesktopMedia:function(e,t){if(emedia.isElectron)this.openDesktopMediaInElectron(e,t);else if(this.__extLoaded&&this.rsdExtLoaded()){var n={type:this.__RTC_PAGE_MSG_TYPE__,evname:"chooseDesktopMedia",screenOptions:e};this.__sendMessage(n,(function(e){"onAccessApproved"===e.evname&&e.streamId?t(new o.OpenDesktopMedia({desktopStreamId:e.streamId})):t(new o.OpenDesktopMediaAccessDenied)}))}else t(new o.ShareDesktopExtensionNotFound)},openDesktopMediaInElectron:function(e,t){e||(e=["screen","window"]);var n={types:e,thumbnailSize:{width:230,height:230}};emedia.electron.desktopCapturer.getSources(n).then((function(e){if("function"===typeof emedia.chooseElectronDesktopMedia){for(var n=0;n<e.length;n++){var r=e[n];r.hxThumbDataURL=r.thumbnail.toDataURL()}emedia.chooseElectronDesktopMedia(e,(function(e){var n;n=e&&e.id?e.id:e,t(new o.OpenDesktopMedia({desktopStreamId:n}))}),(function(){t(new o.OpenDesktopMediaAccessDenied({message:function(){return"User denied access"}}))}))}else t(new o.OpenDesktopMedia({desktopStreamId:e[0].id}))})).catch((function(e){return t(new o.OpenDesktopMediaAccessDenied({error:e}))}))}})},269:function(e,t,n){var r=n(7),i=r.tagLogger("AddonsP2P"),o=n(34);e.exports=function(e){return function(e,t,n){return e.extend({Session:t,Attendee:n,__init__:function(){e.prototype.__init__.call(this),void 0!==this.useRTCCfg&&!1!==this.useRTCCfg&&null!==this.useRTCCfg||(this.useRTCCfg=emedia.config.forceUseRTCCfgIfServerReturnWhenP2P)},push:function(t,n,r){if(this.current&&this.current.isP2P()){if(2===t.type)throw i.error("P2P do not allow audio_mixer"),"P2P do not allow audio_mixer";if(t instanceof this.AVPubstream&&!t.rtcId)this.current._cacheStreams["rtc-"+this.current.ticket.confrId+"__Caller"]||this.current._cacheStreams["rtc-"+this.current.ticket.confrId+"__Callee"]||(t.rtcId="rtc-"+this.current.ticket.confrId)}e.prototype.push.call(this,t,n,r)},newSession:function(t,n){var a=this,s=e.prototype.newSession.call(a,t,n),c=s.onTermC,d=s.onAnsC;return r.extend(s,{onInitC:function(e){if(t.isP2P()){if(e.rtcId==="rtc-"+t.ticket.confrId){var n=e.rtcId+(t.isCaller()?"__Callee":"__Caller");if((i=t._cacheStreams[n])&&i.owner&&i.owner.id!==e.memId)return t.rejectAnswer(e.memId,e.rtcId,10),void t.postMessage(t.newMessage({op:1001,memId:e.memId,tsxId:e.tsxId,result:-554,msg:"Other device call it. you no."}))}var i;e.pubS.sdp=e.sdp,e.pubS.cands=e.cands,e.pubS.id=e.rtcId+(t.isCaller()?"__Callee":"__Caller"),e.pubS._located=!1,e.pubS.memId=e.memId,e.pubS.rtcId=e.rtcId,e.pubS.sver=0,(i=t._cacheStreams[e.pubS.id])&&(e.pubS.sver=i.sver+1,r.removeAttribute(t._maybeNotExistStreams,e.pubS.id)),t.onPub.call(t,++t._cver,e.memId,e.pubS)}},onTermC:function(e){if(t.isP2P()){if(-20===e.endReason){var n=t._cacheStreams[e.rtcId+"__Caller"];return i.warn("Begin re-publish. 20",n),void(n&&a._republish(n))}if(e.memId&&e.memId!==t.getMemberId()){var s=[];return r.forEach(t._cacheStreams,(function(e,t){s.push(t)})),s=s.sort((function(e,n){var r=-1;return e.id>n.id&&(r=1),t.isCallee()?0-r:r})),void r.forEach(s,(function(n,r){r&&r.owner&&r.owner.id===e.memId&&e.rtcId===r.rtcId&&(-10!==e.endReason&&c.call(t,e),e.rtcId==="rtc-"+t.ticket.confrId&&t.onUnpub(++t._cver,e.memId,r.id),10===e.endReason&&t.onEvent(new o.OtherDeviceAnswer({rtcId:e.rtcId,stream:r}))),r&&r.owner&&r.owner.id===t.getMemberId()&&e.rtcId===r.rtcId&&(t.closeWebrtc(e.rtcId),t.onUnpub(++t._cver,r.owner.id,r.id))}))}-10!==e.endReason&&c.call(t,e),10===e.endReason&&t.onEvent(new o.OtherDeviceAnswer({rtcId:e.rtcId}))}else c.call(t,e)},onAnsC:function(e){if(t.isP2P())if(t.__cache_[e.rtcId]){if(!0===t.__cache_[e.rtcId].answered)return i.warn("Webrtc ",e.rtcId,"had been ansC"),t.rejectAnswer(e.memId,e.rtcId,10),void t.postMessage(t.newMessage({op:1001,memId:e.memId,tsxId:e.tsxId,result:-554,msg:"Other device sub it. you no."}));try{if(e.pubS){var n=t.newStream(e.pubS);n.updateAttributes({_webrtc:t._ices[e.rtcId],rtcId:e.rtcId,id:e.rtcId+(t.isCaller()?"__Callee":"__Caller"),owner:t._cacheMembers[e.memId]}),t._cacheStreams[n.id]?t._cacheStreams[n.id]=n:t.onPub.call(t,++t._cver,e.memId,n),t.onEvent(new o.SubSuccess({stream:n,hidden:!0}))}var a=t._cacheMembers[e.memId];d.call(t,e),r.forEach(t._cacheMembers,(function(n,r){n!==e.memId&&a.memName===r.memName&&t.rejectAnswer(n,e.rtcId,10)}))}finally{t.__cache_[e.rtcId].answered=!0}}else i.warn("Webrtc ",e.rtcId,"not created. drop the answer");else d.call(t,e)}})}})}(e,function(e){var t=e.extend({postMessage:function(t,n){var r=this,i=t.tsxId;t.tsxId||(i=t.tsxId="MSG"+Date.now()+"-"+emedia.__session_globalCount++),e.prototype.postMessage.call(r,t,n),function(e){r.owner.isP2P()&&r._callbacks[e]&&setTimeout((function(){var t=r._callbacks[e];if(t&&1004===t.op){var n=r.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,result:0,msg:"3000ms not recv response. will success callback. "+t.tsxId});r.onMessage(n)}}),3e3)}(i)},__modifyMessageForPost:function(t){var n=this;t=e.prototype.__modifyMessageForPost.call(n,t);var i=n.owner;if(i.isP2P()){if(102===t.op||105===t.op){var o=n.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,result:0,streamId:t.rtcId+(i.isCaller()?"__Caller":"__Callee"),sver:1});if(setTimeout((function(){n.onMessage(o)}),100),!t._cached_){var a=r.extend({_cached_:!0},t);r.removeAttribute(a,"tsxId"),102===t.op&&(i.__cache_[t.rtcId]=[]).push(a),105===t.op&&i.__cache_[t.rtcId]&&i.__cache_[t.rtcId].push(a),i.__cache_[t.rtcId]&&(i.__cache_[t.rtcId].selfId=i.getMemberId())}}if(r.removeAttribute(t,"_cached_"),t.memId)t=n.newMessage({op:1004,sessId:r.removeAttribute(t,"sessId"),memId:r.removeAttribute(t,"memId"),tsxId:r.removeAttribute(t,"tsxId"),arg:JSON.stringify(t)});switch(t.op){case 205:o=n.newMessage({op:1001,tsxId:t.tsxId,result:0});return void setTimeout((function(){n.onMessage(o)}),50);case 102:case 104:case 105:case 106:case 107:if(-10===t.endReason)return;case 1001:case 400:t=n.newMessage({op:1004,sessId:r.removeAttribute(t,"sessId"),tsxId:r.removeAttribute(t,"tsxId"),arg:JSON.stringify(t)});break;case 303:case 206:return}}return t},onP2PMessage:function(e){var t=this,n=t.owner;if(t.owner.isConfr())i.warn("Recv p2p ctrl message. when CONFR. ignore");else{var o=JSON.parse(e.arg);if(o.memId=e.memId,o.tsxId=e.tsxId,o.sessId=e.sessId,400===o.op&&(o.streamId=o.rtcId+(t.owner.isCaller()?"__Callee":"__Caller")),1001!==o.op){var a=t.newMessage({op:1001,tsxId:e.tsxId,memId:e.memId,sessId:e.sessId,result:0,msg:"Web sdk success recv"});102!==o.op&&105!==o.op||r.extend(a,{streamId:o.rtcId+(n.isCaller()?"__Callee":"__Caller"),sver:1}),t.postMessage(a)}!function(e){setTimeout((function(){t.onMessage(e)}),10)}(o)}}});return r.extend(t.prototype._events,{1004:"onP2PMessage"}),t}((e.prototype.Session||n(171)).extend({})),function(e){return e.extend({__init__:function(){e.prototype.__init__.call(this),this.__cache_={};var t=this.iceRebuild;this.iceRebuild=function(e){this.isP2P()&&e.rtcId?e._webrtc&&!0===e._webrtc.answerWebrtc?i.warn("Stream not auto iceRebuild. caused by answer webrtc. it = ",e.id,e):e.located()?t.call(this,e):i.warn("Stream not auto iceRebuild. caused by not located. it = ",e.id,e):t.call(this,e)}},onEnter:function(t,n){var i=this;try{e.prototype.onEnter.call(i,t,n)}finally{if(!i.isP2P()||!(n=i._cacheMembers[n.id]))return;r.forEach(i.__cache_,(function(e,t){!0!==t.answered&&r.forEach(t,(function(e,t){!function(e){e.memId=n.id,i.postMessage(e)}(t)}))}))}},rejectAnswer:function(e,t,n,r){var i=this,a=i.newMessage().setOp(107).setRtcId(t).setMemId(e).setEndReason(n);i.postMessage(a,(function(e){if(0!=e.result)return i.onEvent(new o.RspFail({request:a,response:e})),void(r&&r(new o.RspFail({request:a,response:e})))}))},closeWebrtc:function(t,n,o){var a=this,s=!1;if(a.isP2P()){var c=a._ices[t];if(c)s=(s="failed"===c.iceConnectionState())&&c._rebuildCount<emedia.config.iceRebuildCount,i.warn("Webrtc state failed. it is ",t,c._rebuildCount,emedia.config.iceRebuildCount,c.__id)}if(e.prototype.closeWebrtc.call(a,t,n,o||s),a.isP2P()&&!o&&s&&r.forEach(a._cacheStreams,(function(e,n){n.rtcId===t&&(a._linkedStreams[e]=n,i.warn("Reput stream to _linkedStreams",e))})),a.isP2P()&&!n){r.removeAttribute(a.__cache_,t);var d=r.extend({},a._cacheStreams);r.forEach(d,(function(e,n){if(t===n.rtcId){r.removeAttribute(a._linkedStreams,n.id);var o=r.removeAttribute(a._cacheStreams,n.id);if(a._streamAutomators&&r.removeAttribute(a._streamAutomators,n.id),i.warn("P2P close webrtc. remove stream from _cacheStreams. it = ",n.id,n),o._localMediaStream&&a._service._stopTracks(o._localMediaStream),a.onRemoveStream){n=a.newStream(n);a.onRemoveStream(n)}}}))}},subscribeStream:function(t,n,r,a){if(this.isP2P()){var s=this._ices[t],c=this._cacheStreams[n];if(c.updateAttributes({_webrtc:s,rtcId:t}),a=a||{subSVideo:!0,subSAudio:!0},c.updateAttributes({subArgs:c.subArgs||{subSVideo:!0,subSAudio:!0}}),c._webrtc&&c._webrtc.setSubArgs(c._webrtc.subArgs||{subSVideo:!0,subSAudio:!0}),!c.subArgs.subSVideo&&a.subSVideo&&c.voff)throw i.error("Sub not allow. stream voff"),"Sub not allow. stream voff";if(!c.subArgs.subSAudio&&a.subSAudio&&c.aoff)throw i.error("Sub not allow. stream aoff"),"Sub not allow. stream aoff";if(c.subArgs.subSVideo&&!a.subSVideo&&!c.voff&&emedia.isSafari)throw i.error("Sub not allow. safari close sub video. will error"),"Sub not allow. safari close sub video. will error";a&&c._webrtc&&c._webrtc.setSubArgs(a),a&&c.updateAttributes({subArgs:a});var d=new o.SubSuccess({stream:c,hidden:!0});this._updateRemoteStream(c,c._webrtc.getRemoteStream()),this.onEvent(d)}else e.prototype.subscribeStream.call(this,t,n,r,a)},unsubscribeStream:function(t){this.isP2P()||e.prototype.unsubscribeStream.call(this,t)},onPub:function(t,n,r){if(this.isP2P())return e.prototype.onPub.call(this,t,n,r);e.prototype.onPub.call(this,t,n,r)},onStreams:function(t,n){this.isP2P()?i.warn("P2P ingrone the onStreams"):e.prototype.onStreams.call(this,t,n)},_howDoWebrtcWhenCrtExsitsWebrtc:function(t){this.isP2P()?this.closeWebrtc(t.getRtcId(),!0,!0):e.prototype._howDoWebrtcWhenCrtExsitsWebrtc.call(this,t)},createWebrtcAndSubscribeStream:function(t,n,a,s){if((c=this).isP2P()){var c;n||(n={});var d=(c=this)._cacheStreams[t],u=c._cacheMembers[d.owner.id],l=d;s=s||l.subArgs||{subSVideo:!0,subSAudio:!0};var f=d.vcodes,m=u.vcodes,p=c.supportVCodes,h=c._getOptimalVideoCodecsSubset(f,m,p);s=s||l.subArgs;var v=l.subArgs,g=!(l.vcodes&&l.vcodes.length>0),_={offerToReceiveAudio:!0,offerToReceiveVideo:s.subSVideo&&g};_.offerToReceiveAudio||_.offerToReceiveVideo||i.warn("offerToReceiveAudio == false and offerToReceiveVideo == false");var b=c.createWebrtc({_rtcId:l.rtcId,iceServerConfig:a,optimalVideoCodecs:h,offerOptions:_,onGotMediaStream:function(e){var t=new o.SubSuccess({stream:l,hidden:!0});n.onGotRemote&&n.onGotRemote(l),c.onEvent&&c.onEvent(t)}},l.iceRebuildCount),A=b.getRtcId();i.warn(A," sub stream ",t,h);var y=l._webrtc;if(l.updateAttributes({_webrtc:b,rtcId:A,owner:r.extend({},u)}),c._ices[A]=b,b.answerWebrtc=!0,s&&l._webrtc&&l._webrtc.setSubArgs(s),s&&l.updateAttributes({subArgs:s}),A==="rtc-"+c.ticket.confrId){c.__lastCalleePub;var S=c._cacheStreams[A+(c.isCaller()?"__Caller":"__Callee")];S=new c._service.AVPubstream(S||{constaints:{audio:!l.aoff,video:!l.voff}});y&&y.getLocalStream()&&c._service._stopTracks(y.getLocalStream()),c._service.openUserMedia(S).then((function(){var e=c.newStream(S);e.updateAttributes({_localMediaStream:S.localStream,_webrtc:b,rtcId:b.getRtcId(),id:A+(c.isCaller()?"__Caller":"__Callee"),owner:{id:c.getMemberId(),nickName:c.nickName,name:c.sysUserId,ext:c.extObj}}),c.onEvent(new o.PushSuccess({stream:e,hidden:!0})),C(S.localStream),c.answerCall(A,S,w)}),w)}else C(),c.answer(A,w)}else e.prototype.createWebrtcAndSubscribeStream.call(c,t,n,a,s);function w(e){i.warn("sub stream error",t,e),v&&l._webrtc&&l._webrtc.setSubArgs(v),v&&l.updateAttributes({subArgs:v}),e=new o.SubFail({stream:l,hidden:!0===e.hidden,cause:e}),n&&n.onEvent&&n.onEvent(e),c.onEvent&&c.onEvent(e)}function C(e){e&&b.setLocalStream(e),b.setRemoteDescription(l.sdp),l.cands&&l.cands.length>0&&b.addIceCandidate(l.cands)}}})}((e.prototype.Attendee||n(173)).extend({})))}},270:function(e,t,n){"use strict";n.r(t);var r=n(7),i=n.n(r),o=n(490),a=n(19),s=n.n(a);function c(){i.a.extend(this,{subscribe:function(e,t,n){return this.subject.subscribe(e,t,n)}},{onMeExit:function(e,t){this.mgr._onExit(this.confrId,e,t),this.mgr.upload_stats&&this.mgr.upload_stats.upload_event({event:1,reason:e,sessionId:this._session._sessionId})},onAddMember:function(e){if(this.mgr.onMemberJoin(e,this.confrId),this.mgr.upload_stats){var t=e.role,n=e.memName,r=e.id;this.mgr.upload_stats.upload_event({event:10,role:t,addMemName:n,addMemId:r})}},onRemoveMember:function(e,t){if(this.mgr.onMemberLeave(e,t,this.confrId),this.mgr.upload_stats){var n=e.role,r=e.memName,i=e.id;this.mgr.upload_stats.upload_event({event:11,role:n,removeMemName:r,removeMemId:i})}},onAddStream:function(e){if(0!=e.id&&(e.located()||this.onRemoteStream&&this.onRemoteStream(e),this.mgr.streamBindVideo(e,void 0,this.confrId),this.mgr._onAddMemberStream(e,this.confrId),!e.located()&&this.mgr.upload_stats)){var t=e.id,n=e.voff,r=e.aoff,i=e.type,o=e.memId,a=e.memName;this.mgr.upload_stats.upload_event({event:12,sId:t,voff:n,aoff:r,streamType:i,addMemId:o,addMemName:a})}},onRemoveStream:function(e){if(0!=e.id){var t=this.mgr._confr(this.confrId);t&&e&&e.located()&&(t.av&&t.av.id===e.id&&(t.av=void 0),t.desktop&&t.desktop.id===e.id&&(t.desktop=void 0));var n=i.a.removeAttribute(this.mgr._videos,e.id);if(this.mgr._onRemoveMemberStream(e,this.confrId),n&&this.mgr.unloadVideo(e.owner,e,n),!e.located()&&this.mgr.upload_stats){var r=e.id,o=e.type,a=e.memId,s=e.memName;this.mgr.upload_stats.upload_event({event:13,sId:r,streamType:o,removeMemId:a,removeMemName:s})}}},onUpdateStream:function(e,t){if(0!=e.id){var n=this,r=this.mgr._videos[e.id];r&&(t&&t.ifMediaStream((function(e){r&&attachMediaStream(r,e),r&&r.hasAttribute("flow")&&n.mgr.onMediaTransmission(r,(function(e,t,n,i){s()(r).trigger("onMediaTransmission",[e,t,n,i])}))})),e.aoff?r.setAttribute("aoff","aoff"):r.removeAttribute("aoff"),e.voff?r.setAttribute("voff","voff"):r.removeAttribute("voff"));var i={video:!e.voff,audio:!e.aoff};t&&t.ifVoff((function(t){i||(i={}),i.video=!t,e.located()||(i.video=e.subArgs?e.subArgs.subSVideo:!e.voff)})),t&&t.ifAoff((function(t){i||(i={}),i.audio=!t,e.located()||(i.audio=e.subArgs?e.subArgs.subSAudio:!e.aoff,2===e.type&&(i.audio=!0))})),i&&this.mgr._onMemberMediaChanaged(e.owner,e,i,this.confrId),i&&this.mgr._onUpdateMemberStream(e,i,this.confrId)}},onNetworkWeak:function(){},onNotSupportPublishVideoCodecs:function(e){this.mgr._onNotSupportMemberPublishVideoCodecs(e,this.confrId)},onRecvRemoteMessage:function(e,t){this.mgr._onRecvRemoteMessage(e,t,this.confrId)},onSoundChanage:function(e,t,n){this.mgr._onMemberSoundChanaged(e,t,n,this.confrId)},onTalking:function(e,t,n){this.mgr._onTalking(e,t,n,this.confrId)},onRoleUpdate:function(e,t){var n=this.mgr._confrs[this.confrId];t&&(n.roleToken=t),n.role=e,e==this.mgr.Role.AUDIENCE&&(n.av&&this.mgr.hungup(n.av),n.desktop&&this.mgr.hungup(n.desktop)),this.mgr._onRoleUpdated(e,this.confrId),this.mgr.upload_stats&&this.mgr.upload_stats.upload_event({event:21,role:e,sessionId:this._session._sessionId})},onNotifyEvent:function(e){var t=this;try{if(e instanceof emedia.event.ICEChanage){var n=e.webrtc,r=e.state;i.a.forEach(t._cacheStreams,(function(e,o){if(o.rtcId==n.getRtcId()){var a=i.a.extend({},o),s=i.a.extend({},o.owner);t.mgr._onStreamIceStateChanged(s,a,r,t.confrId)}}))}}finally{t.subject.next(e)}}})}t.default=function(e,t,n){this.mgr=e,this.confrId=t,c.apply(this),this.subject=new o.a,this.onRemoteStream=n}},271:function(e,t,n){var r=n(7),i=r.tagLogger("PannelVideo"),o=n(272),a=n(273),s=(n(140),n(101)),c=n(274);function d(e){d._overrideCount++,d.overrideObj!==e&&(d.overrideObj=e,u.override=e.listeners.onRemoveMember,u.overrideService=e,e.listeners.onRemoveMember=u)}function u(e,t){try{var n=e&&e.id&&y(u.overrideService,e.id);n&&n.length&&r.forEach(n,(function(t,n){i.warn("Remove member. free remote controller. it is ",n.id,n._ctrlStream.id,n._controller.memName,e.id),n._free(),n._callbacks&&n._callbacks.onRemoteFreeControl&&n._callbacks.onRemoteFreeControl(n._ctrlStream,n._controller,n._cId)}))}finally{u.override&&u.override.apply(this,arguments)}}function l(e){l._overrideCount++,l.overrideObj!==e&&(l.overrideObj=e,f.override=e.listeners.onRemoveStream,f.overrideService=e,e.listeners.onRemoveStream=f)}function f(e){m(f.overrideService,e),f.override&&f.override.apply(this,arguments)}function m(e,t){T(e,t.id);var n=S(e,t);n&&r.forEach(n,(function(e,t){t._free&&t._free()})),r.removeAttribute(e.current.__remoteControls,t.id)}function p(e){if(p._overrideCount++,p.overrideObj!==e){p.overrideObj=e;var t=e.onHungup;e.onHungup=function(n){m(e,n),t&&t.apply(this,arguments)}.bind(e)}}function h(e,t){if(h._overrideCount++,h.overrideObj!==e){h.overrideObj=e;var n=e._onRemotePannelControl;e._onRemotePannelControl=function(e){w(this,e,!1,t),n&&n.apply(this,arguments)}.bind(e)}}function v(e,t,n){var i=[];n&&r.forEach(n.actions,(function(e,t){t.xy&&i.push({x:Math.round(1e4*t.xy.x),y:Math.round(1e4*t.xy.y),oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time}),t.xy||i.push({oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time})}));var o={op2:30,evt:0,streamId:t.id,actions:i,cId:n.cId};return e.current.newMessage({op:1002,memId:t.owner.id,arg:JSON.stringify(o),_reqOps:[100230]})}d._overrideCount=0,l._overrideCount=0,p._overrideCount=0,h._overrideCount=0;var g=0,_=r.prototypeExtend({__init__:function(){this.id=g++},accept:function(e,t){var n=this;if(n.hasOtherControl())throw n.busy(),i.error("Other has been controled."),"Other has been controled.";var o=!1,a=S(this._service,this._ctrlStream,this._controller);(a&&r.forEach(a,(function(e,t){t.id<n.id?t._free():o=!0})),o)?n._free():((this._service.current.__remoteControls||(this._service.current.__remoteControls={}))[n.id]=n,P(this,e,t),b(this._service,this._reqevt,0))},controlling:function(){var e=this,t=[],n=S(this._service,this._ctrlStream);return n&&r.forEach(n,(function(n,r){r._controller.memName===e._controller.memName&&t.push(r)})),t&&t.length?t:void 0},hasOtherControl:function(){var e=this,t=!1,n=S(this._service,this._ctrlStream);return n&&r.forEach(n,(function(n,r){r._controller.memName!=e._controller.memName&&(t=!0)})),t},busy:function(){b(this._service,this._reqevt,-403)},reject:function(){b(this._service,this._reqevt,-402)},_free:function(){r.removeAttribute(this._service.current.__remoteControls,this.id)},forceDisconnect:function(){var e=S(this._service,this._ctrlStream);e&&r.forEach(e,(function(e,t){t._free&&t._free()})),i.info("remote control force disconnect")}});function b(e,t,n){e.current.message({op:1001,tsxId:t.tsxId,memId:t.memId,arg:JSON.stringify({cId:t.arg.cId}),result:n}).post()}function A(e,t){b(e,t,-405)}function y(e,t,n){var i=[];return e.current.__remoteControls&&r.forEach(e.current.__remoteControls,(function(e,r){n&&r._ctrlStream.id!==n.id||t&&r._controller.id!==t||i.push(r)})),i}function S(e,t,n,i){var o=[];return e.current.__remoteControls&&r.forEach(e.current.__remoteControls,(function(e,r){t&&r._ctrlStream.id!==t.id||n&&r._controller.memName!==n.memName||i&&r._cId!==i||o.push(r)})),o}function w(e,t,n,o){!function(e){"string"===typeof e.arg&&(e.arg=JSON.parse(e.arg));var t=e.arg,n=[],i=[];t&&t.actions&&r.forEach(t.actions,(function(e,t){void 0!==t.x&&void 0!==t.y&&n.push({xy:{x:t.x/1e4,y:t.y/1e4},oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time}),(void 0===t.x||void 0===t.y)&&i.push({oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time})})),t.mouse=n,t.keyboard=i}(t);var a=t.arg,c=a.cId,d=a.streamId,u=e.getMemberById(t.memId),l=e.getStreamById(d);if(n||!function(){if(!u||!l)return A(e,t),!0;if(1===a.evt){var n,i=new _({_service:e,_controller:u,_ctrlStream:l,_cId:c,_reqevt:t,_callbacks:o});return i.hasOtherControl()?(i.busy(),!0):(n=i.controlling())?(r.forEach(n,(function(e,t){t._cId=c})),b(e,t,0),!0):(o&&o.onHasRemoteControl&&o.onHasRemoteControl(l,u,i),!0)}if(2===a.evt){var s=S(e,l,u,c);return s&&r.forEach(s,(function(n,r){r._free&&r._free(),b(e,t,0)})),o&&o.onRemoteFreeControl&&o.onRemoteFreeControl(l,u,c),!0}}()){var f=S(e,l,u,c);if(n||f&&0!==f.length||A(e,t),f&&r.forEach(f,(function(e,t){t._lastRecvTimestamp=(new Date).getTime()})),n){var m=e.current.__remoteControls[l.id];f=f||[],m&&f.push(m)}r.forEach(f,(function(o,c){var d,u=0;if((d=a.mouse)&&d.length>0)try{r.forEach(d,(function(e,t){t.sn>u&&(u=t.sn),t.oper===s.BTN.MOVE?c.mouseTrack&&c.mouseTrack.track(t.xy):c.mouseTrack&&c.mouseTrack.trigger(new s(t))}))}catch(l){i.warn(l)}if((d=a.keyboard)&&d.length>0)try{r.forEach(d,(function(e,t){t.sn>u&&(u=t.sn),c.keyboard&&(t.oper===s.BTN.KEYBOARD_DOWN?c.keyboard.onKeyDown(t.btn):t.oper===s.BTN.KEYBOARD_UP&&c.keyboard.onKeyUp(t.btn))}))}catch(l){i.warn(l)}if(!0!==n)try{e.current.message({op:1001,tsxId:t.tsxId,memId:t.memId,arg:JSON.stringify({sn:u}),result:0}).post((function(e){i.debug("Send remote control response. the result = ",e.result,e.msg||"")}))}catch(l){i.warn(l)}}))}}function C(e,t,n,r,i){r&&r()}function k(e,t,n,r,i){r&&r()}function I(e,t,n,r,i,o,a){var c=e.eventXYAtMedia(r,n);c&&(R(e,{xy:c={x:c.x/c.width,y:c.y/c.height},oper:s.BTN.MOVE,sid:t},a),o&&o(c,i))}function x(e,t,n,i,o,a,s){i.xy=e.eventXYAtMedia(i.xy,n),i.xy&&(i.xy={x:i.xy.x/i.xy.width,y:i.xy.y/i.xy.height},r.extend(i,{sid:t}),R(e,i,s),a&&a(i,o))}function E(e,t,n,r,i,o){R(e,{oper:n,btn:r,sid:t},o),i&&i(n,r)}function R(e,t,n){var o=t.sid,a=e.getStreamById(o);e.current.__remoteControls&&e.current.__remoteControls[o]&&w(e,v(e,a,{actions:[t]}),!0);var s=e.current.__pannelBuffers[o],c=s.getUnclearSize();if(s.put(t),c<emedia.config.allowSendWhenLessThan){!function t(){for(var c=s.getUnread(),d=0,u=0;c&&u<c.length;u++){var l=c[u];r.removeAttribute(l,"sid"),d<l.sn&&(d=l.sn)}c&&0!==c.length&&(i.debug(o,"buffer remain:",s.getUnclearSize(),", send evt:",c.length),e.current.postMessage(v(e,a,{actions:c,cId:s._cId}),(function(e){if(-402!==e.result)if(-403!==e.result)if(-408!==e.result){if(-507===e.result||-405===e.result)return s.clearRead(d),void(n&&n.onNotAllowRemoteControl&&n.onNotAllowRemoteControl(a));0===e.result&&(s._lastRspTimestamp=(new Date).getTime());var c=e.arg;c&&(c=JSON.parse(c))&&!r.isInt(c.sn)?i.warn("rsp.sn not a Number.",c.sn,"for streamId",o):c&&void 0!==c.sn&&s.clearRead(c.sn),t()}else n&&n.onRemoteControlTimeout&&n.onRemoteControlTimeout(a);else n&&n.onBusy&&n.onBusy(a);else n&&n.onReject&&n.onReject(a)})))}()}}function T(e,t){var n,o=e.current.__pannelMouses&&r.removeAttribute(e.current.__pannelMouses,t),a=e.current.__pannelKeyboards&&r.removeAttribute(e.current.__pannelKeyboards,t);if(e.current.__pannelBuffers&&(n=r.removeAttribute(e.current.__pannelBuffers,t)),o&&o.ungrab(),a&&a.ungrab(),n){var s=e.getStreamById(t);if(n._callbacks&&n._callbacks.onDisControlled&&n._callbacks.onDisControlled(s),s){var c=e.current.newMessage({op:1002,memId:s.owner.id,arg:JSON.stringify({op2:30,streamId:s.id,evt:2,cId:n._cId}),_reqOps:[100230]});e.current.postMessage(c,(function(e){0!==e.result&&i.warn("Unkown result\uff1a",e.result)}))}}}function M(e,t,n,r,d,u){var l=Math.uuidFast();l=l.substr(l.length-6,6);var f=e.getStreamById(t);if(!f._webrtc)throw u&&u.onNotAllowRemoteControl&&u.onNotAllowRemoteControl(f),i.error("Not allow control. cause by the stream not sub"),"Not allow control. cause by the stream not sub";var m={op2:30,streamId:f.id,evt:1,cId:l},p=e.current.newMessage({op:1002,memId:f.owner.id,arg:JSON.stringify(m),_reqOps:[100230]});e.current.postMessage(p,(function(m){if(-402!==m.result)if(-403!==m.result)if(-408!==m.result)if(-507!==m.result&&-405!==m.result){if(0===m.result)return function(e,t,n,r,d,u,l,f){void 0===d&&(d=n);var m=e.getStreamById(t),p=(e.current.__pannelMouses||(e.current.__pannelMouses={}))[t];p&&T(e,t);if(!m.located()&&!m.owner.acptOps[1003])throw i.error("which do not recv remote message, it is ",m.owner.memName),m.owner.memName+" do not recv remote message";p=new o({_target:d,_focused:!0,onMouseEnter:function(){C.call(p,e,t,n,u&&u.onMouseEnter,u),h&&h.grab()},onMouseExit:function(){k.call(p,e,t,n,u&&u.onMouseExit,u),h&&h.ungrab()},onMouseButton:function(i,o){!0===r&&(i.xy.x=-i.xy.x),x.call(p,e,t,n,i,o,u&&u.onMouseButton,u)},onMouseMove:function(i,o){emedia.config.disableTrack||(!0===r&&(i.x=-i.x),I.call(p,e,t,n,i,o,u&&u.onMouseMove,u))}});var h;(e.current.__pannelBuffers||(e.current.__pannelBuffers={}))[t]=new c({_cId:l,_callbacks:u,trackBufferSize:emedia.config.trackBufferSize||1e3});(e.current.__pannelMouses||(e.current.__pannelMouses={}))[t]=p,p.grab(),f&&(h=new a({_target:document,_focused:!0,onKeyPress:function(n,r){var i=r?s.BTN.KEYBOARD_DOWN:s.BTN.KEYBOARD_UP,o=n;E.call(h,e,t,i,o,u&&u.onKeyboard,u)}}),(e.current.__pannelKeyboards||(e.current.__pannelKeyboards={}))[t]=h)}(e,t,n,r,d,u,l,!0),void(u&&u.onAccept&&u.onAccept(f));i.warn("Unkown result\uff1a",m.result),u&&u.onNotAllowRemoteControl&&u.onNotAllowRemoteControl(f)}else u&&u.onNotAllowRemoteControl&&u.onNotAllowRemoteControl(f);else u&&u.onRemoteControlTimeout&&u.onRemoteControlTimeout(f);else u&&u.onBusy&&u.onBusy(f);else u&&u.onReject&&u.onReject(f)}))}function P(e,t,n){var r=t;r&&(e.mouseTrack=r),e.keyboard=n}var O=function e(t){var n,o;(e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((function(){e(t)}),emedia.config.ctrlCheckIntervalMillis),t.current)&&((n=t.current.__remoteControls)&&r.forEach(n,(function(e,t){if(void 0!==t.id&&e==t.id){var n=(new Date).getTime();t._lastRecvTimestamp&&n-t._lastRecvTimestamp>emedia.config.ctrlTimeoutMillis&&(i.warn("Timeout for remote controller. it is ",t.id,t._ctrlStream.id,t._controller.memName),t._free(),t._callbacks&&t._callbacks.onRemoteFreeControl&&t._callbacks.onRemoteFreeControl(t._ctrlStream,t._controller,t._cId))}})),(o=t.current.__pannelBuffers)&&r.forEach(o,(function(e,n){var r=t.getStreamById(e);r&&!r.located()&&t.current.message({op:1002,memId:r.owner.id,arg:JSON.stringify({op2:30,streamId:r.id,evt:3,cId:n._cId}),_reqOps:[100230]}).post((function(e){}))})))};e.exports={mirrorControlled:function(e,t,n,i){var o={};r.forEach(arguments,(function(e,t){"function"===typeof t&&(o[t.name]=t)})),M(e,t,n,!0,i,o)},controlled:function(e,t,n,i){var o={};r.forEach(arguments,(function(e,t){"function"===typeof t&&(o[t.name]=t)})),M(e,t,n,!1,i,o)},disControlled:T,controlling:P,graffiti:function(e,t,n,r){var i=new o({_target:e,_focused:!0,onMouseEnter:function(){},onMouseExit:function(){t.releaseTrigger()},onMouseButton:function(e,i){e.xy={x:e.xy.x/e.xy.width,y:e.xy.y/e.xy.height},!0===r&&(e.xy.x=-e.xy.x),n&&(e.xy=emedia.Service.prototype.eventXYAtMedia.call(null,e.xy,n)),e.xy&&t.trigger(e)},onMouseMove:function(e,i){e={x:e.x/e.width,y:e.y/e.height},!0===r&&(e.x=-e.x),n&&(e=emedia.Service.prototype.eventXYAtMedia.call(null,e,n)),e&&t.track(e)}});return i.grab(),i},echoControl:function(e,t,n,r){var i=e.getStreamById(t),o={_ctrlStream:i,_controller:i.owner,_service:e};P(o,n,r),(e.current.__remoteControls||(e.current.__remoteControls={}))[t]=o},disEchoControl:function(e,t){r.removeAttribute(e.current.__remoteControls,t)},support:function(e){var t={};r.forEach(arguments,(function(e,n){0!=e&&"function"===typeof n&&(t[n.name]=n)})),p(e),l(e),d(e),h(e,t),O(e)},getController:function(e,t){var n=e.getStreamById(t),r=S(e,n);if(r&&0!==r.length)return r[0]._controller.memName}}},272:function(e,t,n){var r=n(7),i=(r.tagLogger("Mouse"),n(101));e.exports=r.prototypeExtend({__init__:function(){this._handlers=r.extend({mousedown:this._handleMouseDown.bind(this),mouseup:this._handleMouseUp.bind(this),mousemove:this._handleMouseMove.bind(this),mousewheel:this._handleMouseWheel.bind(this),mousedisable:this._handleMouseDisable.bind(this),mouseover:this._handleMouseOver.bind(this),mouseout:this._handleMouseOut.bind(this)},this._handlers||{})},onMouseButton:function(e,t){},onMouseMove:function(e,t){},onMouseEnter:function(){},onMouseExit:function(){},_onMouseButton:function(e,t,n){var r=(new Date).getTime(),o=new i({xy:e,oper:t,btn:n,_time:r});this.onMouseButton&&this.onMouseButton(o,this._lastTrigger),this._lastTrigger=o},_onMouseMove:function(e){this.onMouseMove&&this.onMouseMove(e,this._lastTrigger)},_captureMouse:function(){this._target.setCapture&&this._target.setCapture(),this._mouseCaptured=!0},_releaseMouse:function(){this._target.releaseCapture&&this._target.releaseCapture(),this._mouseCaptured=!1},_resetDoubleClickTimer:function(){this._doubleClickTimer=null},_handleMouseOver:function(e){!1!==this._mouseExit&&(this._mouseExit=!1,this.onMouseEnter&&this.onMouseEnter())},_handleMouseOut:function(e){!0!==this._mouseExit&&(this._mouseExit=!0,this.onMouseExit&&this.onMouseExit()),this._lastTrigger=void 0},_handleMouseDown:function(e){this._captureMouse(),this._handleMouseButton(e,i.BTN.KEY_DOWN)},_handleMouseUp:function(e){this._mouseCaptured&&(this._handleMouseButton(e,i.BTN.KEY_UP),this._releaseMouse())},_handleMouseWheel:function(e){if(this._focused){e=e||window.event;var t=r.getEventElementXY(e,this._target,this._scale),n=(e.detail?-1*e.detail:e.wheelDelta/40)>0?i.BTN.WHEEL_ROLL_UP:i.BTN.WHEEL_ROLL_DOWN;this._onMouseButton(t,i.BTN.KEY_DOWN,n),r.stopEvent(e)}},_handleMouseMove:function(e){if(this._focused){e=e||window.event;var t=r.getEventElementXY(e,this._target,this._scale);this._onMouseMove(t),r.stopEvent(e)}},_handleMouseDisable:function(e){if(this._focused){e=e||window.event;var t=r.getEventElementXY(e,this._target,this._scale);try{return!(t.realX>=0&&t.realY>=0&&t.realX<this._target.offsetWidth&&t.realY<this._target.offsetHeight)}finally{r.stopEvent(e)}}},_handleMouseButton:function(e,t){if(this._focused){e=e||window.event;var n,o=r.getEventElementXY(e,this._target,this._scale);if(e.touches||e.changedTouches){if(t==i.BTN.KEY_DOWN){if(null===this._doubleClickTimer)this._lastTouchPos=o;else{clearTimeout(this._doubleClickTimer);var a=this._lastTouchPos.x-o.x,s=this._lastTouchPos.y-o.y;Math.sqrt(a*a+s*s)<20*window.devicePixelRatio&&(o=this._lastTouchPos)}this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500)}n=i.BTN.LEFT}else n=e.which?1<<e.button:(1&e.button)+2*(2&e.button)+(4&e.button)/2;this._onMouseButton(o,t,n),r.stopEvent(e)}},grab:function(){var e=this._target;r.addEvent(e,"mouseover",this._handlers.mouseover),r.addEvent(e,"mouseout",this._handlers.mouseout),r.addEvent(e,"touchstart",this._handlers.mousedown),r.addEvent(e,"touchend",this._handlers.mouseup),r.addEvent(e,"touchmove",this._handlers.mousemove),r.addEvent(e,"mousedown",this._handlers.mousedown),r.addEvent(e,"mouseup",this._handlers.mouseup),r.addEvent(e,"mousemove",this._handlers.mousemove),r.addEvent(e,r.layoutEngine.gecko?"DOMMouseScroll":"mousewheel",this._handlers.mousewheel),r.addEvent(e,"contextmenu",this._handlers.mousedisable)},ungrab:function(){var e=this._target;r.removeEvent(e,"mouseover",this._handlers.mouseover),r.removeEvent(e,"mouseout",this._handlers.mouseout),r.removeEvent(e,"touchstart",this._handlers.mousedown),r.removeEvent(e,"touchend",this._handlers.mouseup),r.removeEvent(e,"touchmove",this._handlers.mousemove),r.removeEvent(e,"mousedown",this._handlers.mousedown),r.removeEvent(e,"mouseup",this._handlers.mouseup),r.removeEvent(e,"mousemove",this._handlers.mousemove),r.removeEvent(e,r.layoutEngine.gecko?"DOMMouseScroll":"mousewheel",this._handlers.mousewheel),r.removeEvent(e,"contextmenu",this._handlers.mousedisable)}})},273:function(e,t,n){var r=n(7),i=r.tagLogger("Keyboard");e.exports=r.prototypeExtend({__init__:function(){this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),keypress:this._handleKeyPress.bind(this),blur:this._allKeysUp.bind(this)}},getKey:function(e){return"keyCode"in e&&"key"in e?e.key+":"+e.keyCode:"keyCode"in e?e.keyCode:e.key},onKeyPress:function(e,t){},_onKeyPress:function(e,t){this.onKeyPress&&this.onKeyPress(e,t)},_handleRfbEvent:function(e,t){e.shiftKey,e.ctrlKey,e.altKey;var n=e.keyCode||e.which;this._onKeyPress(n,"keydown"==t)},_handleKeyDown:function(e){return!this._focused||!this._handleRfbEvent(e,"keydown")||(r.stopEvent(e),!1)},_handleKeyPress:function(e){return!this._focused||(r.stopEvent(e),!1)},_handleKeyUp:function(e){return!this._focused||!this._handleRfbEvent(e,"keyup")||(r.stopEvent(e),!1)},_allKeysUp:function(){},sync:function(e){},grab:function(){var e=this._target;r.addEvent(e,"keydown",this._eventHandlers.keydown),r.addEvent(e,"keyup",this._eventHandlers.keyup),r.addEvent(e,"keypress",this._eventHandlers.keypress),r.addEvent(e,"blur",this._eventHandlers.blur),i.info("keyboard grab at element")},ungrab:function(){var e=this._target;r.removeEvent(e,"keydown",this._eventHandlers.keydown),r.removeEvent(e,"keyup",this._eventHandlers.keyup),r.removeEvent(e,"keypress",this._eventHandlers.keypress),r.removeEvent(e,"blur",this._eventHandlers.blur),this._allKeysUp(),i.info("keyboard upgrab at element")}})},274:function(e,t,n){var r=n(7),i=(r.tagLogger("TotalBuffer"),n(275)),o=n(276),a=n(101);e.exports=r.prototypeExtend({trackBufferSize:100,_trackBufferCompRadio:.25,_sn:1,__init__:function(){this._eventBuffer=new i({_nextsn:this._nextsn.bind(this)}),this._trackBuffer=new o({_nextsn:this._nextsn.bind(this),_compRadio:this._trackBufferCompRadio,mouseTrackBufferSize:this.trackBufferSize})},_nextsn:function(){return this._sn++},put:function(e){e&&void 0!==e.oper&&(e.oper===a.BTN.MOVE?this._trackBuffer.put(e):this._eventBuffer.put(e))},getUnread1:function(e){function t(e,t){return e._time-t.time}var n;if(!e){var r=this._eventBuffer.getUnread(),i=this._trackBuffer.getUnread();return Array.prototype.push.apply(r,i),(n=r).sort(t),n}n=[];r=this._eventBuffer._getUnread(e),i=this._trackBuffer._getUnread(e);Array.prototype.push.apply(n,r),Array.prototype.push.apply(n,i),n.sort(t),n=n.slice(0,e>n.length?n.length:e);for(var o=0;o<n.length;o++)n[o].oper===a.BTN.MOVE?this._trackBuffer.getUnread(1):this._eventBuffer.getUnread(1);return n},getUnread:function(e){e||(e=this._eventBuffer.getUnreadSize()+this._trackBuffer.getUnreadSize());for(var t=[];t.length!==e;){var n=this._eventBuffer._getUnread(1),r=this._trackBuffer._getUnread(1);if(void 0===n&&r)t.push(this._trackBuffer.getUnread(1));else if(void 0===r&&n)t.push(this._eventBuffer.getUnread(1));else{if(void 0===r&&void 0===n)return t;n.sn<r.sn?t.push(this._eventBuffer.getUnread(1)):t.push(this._trackBuffer.getUnread(1))}}return t},getUnreadSize:function(){return this._trackBuffer.getUnreadSize()+this._eventBuffer.getUnreadSize()},getUnclearSize:function(){return this._trackBuffer.getUnclearSize()+this._eventBuffer.getUnclearSize()},clearRead:function(e){return this._eventBuffer.clearRead(e)+this._trackBuffer.clearRead(e)}})},275:function(e,t,n){var r=n(7);r.tagLogger("EventBuffer");e.exports=r.prototypeExtend({_buffer:[],_sn:1,_beginIndex:0,_readIndex:0,_endIndex:0,_nextsn:function(){return this._sn++},put:function(e){e&&(e.sn=this._nextsn(),this._buffer.push(e),this._endIndex++)},_getUnread:function(e){return this._readIndex===this._endIndex?1===e?void 0:[]:this._buffer[this._readIndex]},getUnread:function(e){var t;try{return t=this._getUnread(e)}finally{t&&(this._readIndex+=1===e?1:t.length)}},getUnreadSize:function(){return this._endIndex-this._readIndex},getUnclearSize:function(){return this._readIndex-this._beginIndex},clearRead:function(e){if(this._readIndex!==this._beginIndex){for(var t=0,n=this._beginIndex;n<this._readIndex&&this._buffer[n].sn<=e;n++)t++;if(0===t)return 0;for(n=0;n<t;n++)this._buffer.shift();return this._beginIndex=0,this._readIndex-=t,this._endIndex-=t,t}}})},276:function(e,t,n){var r=n(7);r.tagLogger("TrackBuffer");e.exports=r.prototypeExtend({mouseTrackBufferSize:1e3,_sn:1,_compRadio:.25,_beginIndex:0,_readIndex:0,_endIndex:0,__init__:function(){this._mouseTrackBuffer=new Array(this.mouseTrackBufferSize)},_nextsn:function(){return this._sn++},_index:function(e){return e%this.mouseTrackBufferSize},comp1:function(e){if(!(e>=1)){for(var t=Math.floor(1/e),n=this._beginIndex,r=n+1;n<this._endIndex;){for(var i=2;i<t&&n+i<this._endIndex;i++)this._mouseTrackBuffer[this._index(r++)]=this._mouseTrackBuffer[this._index(n+i)];n+=t}this._endIndex=r}},put1:function(e){if(e){e.sn=this._nextsn(),this._endIndex-this._readIndex===this.mouseTrackBufferSize&&(this.comp1(this._compRadio),this._readIndex=this._beginIndex);var t=this._index(this._beginIndex),n=(this._index(this._readIndex),this._index(this._endIndex));n<=t&&n>=0&&this._endIndex>this._beginIndex&&this._beginIndex++,this._mouseTrackBuffer[n]=e,this._endIndex++}},compHalfOfUnread:function(){for(var e=this._readIndex+2,t=this._readIndex+1;e<this._endIndex;)this._mouseTrackBuffer[this._index(t++)]=this._mouseTrackBuffer[this._index(e)],e+=2;this._endIndex=t},put:function(e){if(e){e.sn=this._nextsn(),this._endIndex-this._beginIndex===this.mouseTrackBufferSize&&this.compHalfOfUnread();var t=this._index(this._endIndex);this._mouseTrackBuffer[t]=e,this._endIndex++}},_interval:function(e,t){var n=this._index(e),r=this._index(t);if(n<r)return this._mouseTrackBuffer.slice(n,r);var i=this._mouseTrackBuffer.slice(n);return Array.prototype.push.apply(i,this._mouseTrackBuffer.slice(0,r)),i},_getUnread:function(e){return this._readIndex===this._endIndex?1===e?void 0:[]:this._mouseTrackBuffer[this._index(this._readIndex)]},getUnread:function(e){var t;try{return t=this._getUnread(e)}finally{t&&(this._readIndex+=1===e?1:t.length)}},getUnreadSize:function(){return this._endIndex-this._readIndex},getUnclearSize:function(){return this._readIndex-this._beginIndex},clearRead:function(e){if(this._readIndex!==this._beginIndex){for(var t=0,n=this._beginIndex;n<this._readIndex;n++){var r=this._index(n);if(!(this._mouseTrackBuffer[r].sn<=e))break;this._beginIndex++,t++}return t}}})},277:function(e,t,n){var r=n(7),i=r.tagLogger("CompositeCanvas");function o(){}for(var a in CanvasRenderingContext2D.prototype)!function(e){o.prototype[e]=function(){if("function"===typeof this._canvasContext[e])this._canvasContext[e].apply(this._canvasContext,arguments);else{var t=arguments.length>=1?arguments[0]:void 0;if(!t)return this._canvasContext[e];this._canvasContext[e]=t}}}(a);var s=r.prototypeExtend(o,{__init__:function(){this.compositeCanvasTag||(this.compositeCanvasTag=document.createElement("canvas")),this._canvasContext=this.compositeCanvasTag.getContext("2d"),this._canvasContext.globalAlpha=void 0!==this._globalAlpha?this._globalAlpha:1,this._compositeOperation=this._compositeOperation||c.source_over,this.globalCompositeOperation(this._compositeOperation)},setCanvas:function(){for(var e,t=this,n=0;n<arguments.length;n++)"function"===typeof(e=arguments[n])&&e(this.compositeCanvasTag,this._canvasContext),"function"!==typeof e&&r.isPlainObject(e)&&r.forEach(e,(function(e,n){i.debug("Canvas set ",e," = ",n),t.compositeCanvasTag.setAttribute(e,n)}));return t},getCanvasImageData:function(e,t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e.getContext("2d");return i.globalAlpha=t||0,i.getImageData.apply(i,n)},_composite:function(e){return new s(this,{_compositeOperation:e})},composite:function(e){return this.globalCompositeOperation(e),this},requestAnimationFrame:function(e){var t=this;return t.requestFrame(),t._requestAnimationFrameStart=window.requestAnimationFrame((function(e){t.requestAnimationFrame(e)})),t},cancelAnimationFrame:function(){return this._requestAnimationFrameStart&&window.cancelAnimationFrame(this._requestAnimationFrameStart),this},requestFrame:function(e){var t;if("function"!==typeof this.requestOneFrame)throw i.error("Pleas implement requestOneFrame()"),"Pleas implement requestOneFrame()";try{this.requestOneFrame()}catch(r){i.error(r)}if(e&&(t=Math.floor(1e3/e)),!t)return this;var n=this.requestFrame.bind(this);return this.intervalId=setInterval((function(){n(e)}),t),this},stopRequestFrame:function(){return this.intervalId&&clearInterval(this.intervalId),this}});s.CompositeOperation=["source-atop","source-in","source-out","source-over","destination-atop","destination-in","destination-out","destination-over","lighter","darker","xor","copy"];var c=s.operation={source_atop:"source-atop",source_in:"source-in",source_out:"source-out",source_over:"source-over",destination_atop:"destination-atop",destination_in:"destination-in",destination_out:"destination-out",destination_over:"destination-over",lighter:"lighter",darker:"darker",xor:"xor",copy:"copy"};s.compositeVideoOverCanvas=function(e,t,n){var r;return(r=e.compositeCanvas)||(r=new s({compositeCanvasTag:e,requestOneFrame:function(){t&&r.drawImage(t,0,0,e.width,e.height),n&&r.drawImage(n,0,0,e.width,e.height)}}),e.compositeCanvas=r),r},e.exports=s},278:function(e,t,n){var r=n(7);r.tagLogger("Keyboard");e.exports=r.prototypeExtend({onKeyDown:function(e){},onKeyUp:function(e){}})},279:function(e,t,n){window.emedia=window.emedia||{};var r=n(7).tagLogger("electron");emedia.electron=window.require("electron"),emedia.chooseElectronDesktopMedia=function(e,t,n){r.info("Choose desktop. ",e[0]),t(e[0])}},337:function(e,t,n){var r={"./admin-icon.png":338,"./admin-small-icon.png":339,"./apply-icon.png":340,"./apply-to-audience-icon.png":341,"./apply-to-talker-icon.png":342,"./audio-is-close-icon.png":343,"./close-handle-icon.png":344,"./destory-white-board-icon.png":345,"./expand-icon.png":346,"./invite-icon.png":347,"./is-speak-icon.png":348,"./join-white-board-icon.png":349,"./leave-icon.png":350,"./login-bg.png":351,"./logo-text-login.png":352,"./logo-text-room.png":353,"./logo.png":354,"./micro-is-close-icon.png":355,"./micro-is-open-icon.png":356,"./mute-all-icon.png":357,"./no-speak-icon.png":358,"./room-setting-close-icon.png":359,"./room-setting-open-icon.png":360,"./setting-icon.png":361,"./share-desktop-icon.png":362,"./stop-share-desktop-icon.png":363,"./unmute-all-icon.png":364,"./video-icon.png":365,"./video-is-close-icon.png":366,"./video-is-open-icon.png":367,"./volume-0.png":368,"./volume-1.png":369,"./volume-10.png":370,"./volume-11.png":371,"./volume-12.png":372,"./volume-13.png":373,"./volume-14.png":374,"./volume-2.png":375,"./volume-3.png":376,"./volume-4.png":377,"./volume-5.png":378,"./volume-6.png":379,"./volume-7.png":380,"./volume-8.png":381,"./volume-9.png":382,"./warning-icon.png":383};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id=337},338:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAilBMVEUAAAD/////////////////////////////////jQD/jQH/jgP/kQr/kgr/lBD/mRn/mRr/mRz/mh3/mx7/myD/nST/oi//ozH/ozL/pDP/umX/u2b/v3D/wHH/wHL/wXT/xn7/yYb/yof/zI3/69P/7NT/7tj/9Of/9ej/9en/+fH/+fL/+/b////Z11xoAAAACXRSTlMABiuPk7zU8vxOVFVLAAAAmUlEQVQY023PXUrDQBhA0fPNDEG0EAW3UND9b6aQFSgWawItgfnxQXwR7wruCUiRw2ijI4hcjmCpbQhRXoz1Yp7DqY6svPJ57v3q3vO5p1ToF/hqlJTiSO/QG8dIGeUR5gk5BRwK+QCRYF/r3UNbd0iD+rF6mm3vlZEa1xvTxL7R0lhs2G/YLaP0quENutp/1n871fEP7g//G1C/SpfK2LZEAAAAAElFTkSuQmCC"},339:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAhFBMVEUAAAAAAAAAAAAKBQAKBgAQCQARCgAaDQAaDwAbDwAbEAAcEAAuGQAzHQA0HQB/RwCGSgCHSwCPTwCYVACbVgCbVgCcVwCmXACoXQDUdQDWdgDWdwDYeADhfQDkfgDmgADngADogADpgQDrggDyhgD3iQD3iAD8jAD9jAD+jQD/jQD/jQAYi+cHAAAAK3RSTlM7tczNzc7O0NDQ0NDT1NTi4+Tl5+fo6Orq9PT19ff4+Pn5+fn7/P3+/v7+oZWGVwAAAHVJREFUGBkFwQVCAwEQALG9YAWKuxeX+f//SGYWAFhmFgBgGbB1+fFxtQ0G3FTdgoGd76qfXRhYVdUhDLirugcDjj7r6xgMrB96fe5xDYPVpk5P6m0Pg4vqYL+6xmBTnZ1XTxi8V79/1QsGAGAWAGCZWQBgmX918QyBT14d/wAAAABJRU5ErkJggg=="},34:function(e,t,n){var r=n(7),i=(r.logger,r.prototypeExtend({msg:"",__init__:function(){this.day=new Date},execTime:function(){var e=this.day.getHours();e<10&&(e="0"+e);var t=this.day.getMinutes();t<10&&(t="0"+t);var n=this.day.getSeconds();return n<10&&(n="0"+n),e+":"+t+":"+n}})),o=i.extend({_webrtcDesc:function(){this.webrtc;return this.webrtc.getRtcId()}});e.exports={Exception:i.extend(),NetworkChanaged:i.extend({message:function(){var e=this.execTime()+" : Network chanage ("+this.preIp+" -> "+this.nowIp+").";return e}}),WSClose:i.extend({message:function(){var e=this.execTime()+" WSClose: Websocket close ("+(this.retry||0)+").";return this.online||(e+=" offline."),this.event&&(e+=" wscode: "+this.event.code),this.cause&&(e+=" cause: "+this.cause.message),this.url&&(e+=" url: "+this.url),e+=" retry: "+(this.retry||0),this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),e}}),WSError:i.extend({message:function(){var e=this.execTime()+" WSError: Websocket error. ready state:"+(this.event.srcElement&&this.event.srcElement.readyState||this.event.currentTarget.readyState)+". online = "+this.online;return this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),this.url&&(e+=" url: "+this.url),e}}),WSConnected:i.extend({message:function(){var e=this.execTime()+" WSConnected: Websocket success. ready state:"+(this.event.srcElement&&this.event.srcElement.readyState||this.event.currentTarget.readyState);return this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),e}}),ICEChanage:o.extend({message:function(){return this.execTime()+" ICEChanage: "+this._webrtcDesc()+" state: "+this.state}}),AddIceCandError:o.extend({message:function(){return this.execTime()+" AddIceCandError: "+this._webrtcDesc()+", add cand error"}}),ICEConnectFail:o.extend({message:function(){return this.execTime()+" ICEConnectFail: "+this._webrtcDesc()+" failed"}}),ICEConnected:o.extend({message:function(){return this.execTime()+" ICEConnected: "+this._webrtcDesc()+" connected"}}),ICEDisconnected:o.extend({message:function(){return this.execTime()+" ICEDisconnected: "+this._webrtcDesc()+" disconnected"}}),ICEClosed:o.extend({message:function(){return this.execTime()+" ICEClosed: "+this._webrtcDesc()+" closed"}}),ICERemoteMediaStream:o.extend({message:function(){return this.execTime()+" ICERemoteMediaStream: "+this._webrtcDesc()+" got remote stream"}}),StreamState:i.extend({message:function(){return this.execTime()+" StreamState:  stream "+this.stream.id+" state: "+this.state+" "+this.msg},iceFail:function(){this.state=1,this.msg="network anomaly. media lost"}}),OpenMediaError:i.extend({message:function(){return this.execTime()+" OpenMediaError:  open media error. caused by "+(this.event.name?this.event.name:this.event.message?this.event.message:this.event.toString())}}),Hangup:i.extend({message:function(){return this.self?"hangup id = "+(this.self.id||"--")+" reason\uff1a"+(this.reason||0):this.execTime()+" Hangup: "+(this.parnter&&(this.parnter.name||this.parnter.id||" ")||"")+" hangup, reason\uff1a"+(this.reason||0)}}),ServerRefuseEnter:i.extend({message:function(){return this.execTime()+" ServerRefuseEnter: server refuse, cause\uff1a"+this.failed+", msg:"+(this.msg||"")}}),RspFail:i.extend({__init__:function(){this.day=new Date,this.failed=this.response.result,this.msg=this.response.msg||this.response.message||"--"},message:function(){return this.execTime()+" RspFail: "+this.request.tsxId+", "+(this.response.sessId||"--")+" op: "+this.request.op+", cause: "+this.failed+" "+this.msg}}),RecvResponse:i.extend({__init__:function(){this.day=new Date,this.failed=this.response.result,this.msg=this.response.msg},message:function(){return this.request?this.execTime()+" RecvResponse: "+(this.request&&this.request.tsxId)+", "+(this.response.sessId||"--")+" op: "+(this.request&&this.request.op)+", cause: "+this.failed+" "+this.msg:this.execTime()+" RecvMessage: "+(this.response&&this.response.tsxId)+", "+(this.response.sessId||"--")+" op: "+(this.response&&this.response.op)+" "+this.msg}}),EnterFail:i.extend({message:function(){return this.execTime()+" EnterFail: enter fail\uff1a"+(this.cause?this.cause.message():"unkown")}}),EnterSuccess:i.extend({message:function(){return this.execTime()+" EnterSuccess: enter success "+(this.ip?", ip = "+this.ip:"")}}),PushSuccess:i.extend({message:function(){return this.execTime()+" PushSuccess: push success, streamId = "+this.stream.id+", "+this.stream.optimalVideoCodecs+", webrtc = "+this.stream.rtcId}}),PushFail:i.extend({message:function(){return this.execTime()+" PushFail: push fail, streamId = "+this.stream.id+", "+this.stream.optimalVideoCodecs+", webrtc = "+this.stream.rtcId+" cause\uff1a"+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),RemoteControlFail:i.extend({message:function(){return this.execTime()+" RemoteControlFail: "+(this.type||"remote control")+" fail, "+(this.stream?this.stream.id:"")+" failed = "+this.failed+" cause\uff1a"+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubSuccess:i.extend({message:function(){return this.execTime()+" SubSuccess: sub success, streamId = "+this.stream.id+", "+this.stream.vcodes+", webrtc = "+this.stream.rtcId}}),SubFail:i.extend({message:function(){return this.execTime()+" SubFail: sub fail, streamId = "+this.stream.id+", "+this.stream.vcodes+", webrtc = "+this.stream.rtcId+" cause\uff1a"+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubFailNotSupportVCodes:i.extend({message:function(){return this.execTime()+" SubFailNotSupportVCodes: sub fail, streamId = "+this.stream.id+" cause\uff1a"+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubFailSafariNotAllowSubBeforePub:i.extend({message:function(){return this.execTime()+" SubFailSafariNotAllowSubBeforePub: sub fail, streamId = "+this.stream.id+" cause\uff1aSafari without access to capture devices, WebKit only exposes Server Reflexive and TURN ICE candidates, which expose IPs that could already be gathered by websites."}}),SwitchVCodes:i.extend({message:function(){return this.execTime()+" SwitchVCodes: pub streamId = "+this.stream.id}}),CurrentCalling:i.extend({message:function(){return this.execTime()+" CurrentCalling: warn! current calling..."}}),OpenDesktopMedia:i.extend({message:function(){return this.execTime()+" OpenDesktopMedia: shared desktop, desktopStreamId = "+desktopStreamId}}),OpenDesktopMediaAccessDenied:i.extend({message:function(){return this.execTime()+" OpenDesktopMediaAccessDenied: shared desktop not allow"}}),ShareDesktopExtensionNotFound:i.extend({message:function(){return this.execTime()+" ShareDesktopExtensionNotFound: shared desktop plugin required"}}),OtherDeviceAnswer:i.extend({message:function(){return this.execTime()+" other device answer, webrtc = "+this.rtcId}}),AudioMixerStreamNotAllowSub:i.extend({message:function(){return this.execTime()+" audio mixer stream not allow sub, webrtc = "+this.rtcId+", streamId = "+this.stream.id}}),AudioMixerStreamNotAllowOnlySubVideo:i.extend({message:function(){return this.execTime()+" audio mixer stream not allow only sub video, webrtc = "+this.rtcId+", streamId = "+this.stream.id}}),AudioMixerStreamRepeatPublish:i.extend({message:function(){return this.execTime()+" audio mixer stream repeat publish"}})}},340:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAMAAAANIilAAAAB3VBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQECAgIFBQUHBwcJCQkMDAwPDw8QEBARERESEhIWFhYXFxcZGRkaGhocHBwkJCQoKCgpKSkqKioqKiosLCwtLS0uLi4xMTE0NDQ2NjY3Nzc8PDw9PT0+Pj5ERERGRkZHR0dHR0dRUVFTU1NXV1dfX19gYGBhYWFubm5vb29wcHBxcXFzc3N0dHR1dXV4eHh3d3d9fX1+fn5/f3+BgYGCgoKDg4OFhYWHh4eHh4eIiIiLi4uMjIyNjY2QkJCRkZGSkpKWlpaVlZWWlpaYmJiZmZmampqdnZ2fn5+fn5+goKCjo6OkpKSnp6eoqKirq6uurq6urq6vr6+xsbG0tLS2tra3t7e2tra5ubm8vLy7u7u8vLy+vr7AwMDAwMDCwsLFxcXFxcXGxsbIyMjJycnKysrMzMzV1dXW1tba2tre3t7g4ODn5+fo6Ojr6+vr6+vs7Ozt7e3v7+/x8fHy8vL09PTz8/P09PT19fX29vb39/f5+fn6+vr7+/v7+/v8/Pz+/v7///////9fcc+yAAAAnnRSTlMABQgLERIUMjM4RFlhd4CFj5ebnJ+lsrzAx8nMzMzMzc3Ozs7Oz8/P0NDQ0tLS0tPT09PU1NXV1dbW19fX2Nna2tzc3N/f39/g4ODg4eHi4uLi4+Pj5OTk5OXl5ubm5+fn5+jo6Onp6enq6uvr7Ozs7e3t7u7u7+/v7/Dw8PHx8fHy8vX19vf3+fn5+vr6+vv7+/z8/Pz9/f39/v7+/ihEPVQAAALySURBVEjHpVf3QxMxFL6yS/egg7S0qCCIRVRUqggoiIIoiiwFFEEFFbC4UMEJWESmA7Cl39/q9a6Ou6TQku+XvLx7X5PmjbwIAhMZWr3R7nC63U6H3ajXZggpI1tndRMF3FZddkrUXHMhYaDQnLsrNc9GksKWtyM1x0R2hCknOTffRXaBKz8JVWMgKcCgYXEzLSQlWDJpblYBSREFWdS6KXNFtmptjYWkAYvyfxtIWjAofETSxH8ey3GlS3b9ixYTSRumv/FM9oA/cW7bC9mWyEHWt5Lu8LQvLvimw10lLAs5Q830B0/bGoD31YRUfxCFtTYPbWOW6gad+yVvgHDLR8SWloBPlz4Drw/Q1SFeW3T0jz7A5nUv8XcvAF96/MTbvon7tJVOJFtpdTNuykJZuTz24gJtZRXrpJtWn8RTpSKEE7SVO0PQMg7yLF4qFc9xhmGmFfQM7TD6lIpbGGaY6QUjrayLRKtkj1VUyD4KRCN1tJ1RsKs0xfUjEXRK4kXxtBeaJbEDkZH6YpWpXXAQ9dlg7XLiiLG1BfRIk1YxakIqU4fgVGnCuLpfEiqj6PL5uhAJSNN9VxBWmToFtad+4qgsXMNMfJhBuzyvxA+1ryhyFIdk4Q6G4sMQbicCBlGKrN72Oo7LQitmvYR4Z9Eiz49hndq2+sDm8ahGXuk7JmtqJvHtoDQ99RDz1IGpXTUIxMb8cel8RMxG/DonZfXjGGKDlKuoICltWsYTSQpOray8CEriOJabSukgYYRnYFUdyqexGmCFJysxOnFPHeydzMRgpWQQr5SKKQSZKckqBkFMKBVjLLKVXYY6cFcajzQ2ViVccINdhhgFsB+YKCeH38ZEt70LkLJxoJ9dABml1zuwjY3RRSyGQov4OrqB7QEvu/Qyi37tnBgffUWEFIm7wFxt0qLPvG48Dc8SFbR3ssGT/Lrhu+i4rli+y52rreBraPhaKa4mjq995Gtc+Vpmvmad85nA90DhfBpxPsrSeA7+Bu9qmCYUWR3vAAAAAElFTkSuQmCC"},341:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADJUlEQVRIS82VS2gTURSG/3MzmcxkMm2Spg9sV8WFm+7qxo26LMVtsQ8pRUSkoAsXFgSNFkVUtFIQRFxZEVuQttDuuuxCrO4UEdSNStqaxOY1kyZzr9xMBvHRZhQEB4bZnDsf//+fcy7hHz/k5//i4kVmd3cPoVjspkTshTYwuOTnnKxpCBBv3pj282d3sV0ZgaqCGBNQFFuU7Rwx5Yo2MjK9G2xXgP3g/m0hcJpMk5FhAGoIYAyoViAsCygWhYiYI1pX1zz19pZ+B9oRUHr48ACs0ipraQFFoyAjAtI8QBWiVILI5cAzGaBQSFE0fFA7Ovr2Z8iOAHtmpg9qcJlaEmCxKCgSqSmgQACiIhWUILZyEJk0+OYmULIu6OPjk/4Bi4t9pKrLLJEANTeDIq5FxBhE1VOwBZFOg6+vQ3zNJvWTpy75BlRXVvq4pi1TPA4mAeEwoAZBrK7As6gGSEklSX3s+O6A9MxMU7hYeELx+GFKJD6w5ug+CSDTBGkaKBh0Q5YW2Ra4Z1EqBZ7OJPVjx3YHlKZunUVAucna2yHf7/6boFAIUBSACJAWWVY9ZNcifEknQ8PDDQDTd86ABaZYRwdYWxtc/92Aa4BA4EdAPg9etwiZdDI02ACQmZ1t1rLZVywW62Ttba4C2aIe4CcFPJerh5wClxkMN7BIdkBl7vEhZ9tZoUQrqymQLVqbAQ0IKu7wexblc9J78I11N+TRMX9dZM09uUYB5RxLtIJiMTdkXa+HTBCVKiBDzuXdOdjYgMhkk/qJE/4Aa2trwZ7371ZhGPspFnfnIBwGqarbRY4M2YaQCjJSwQZQ2T6vj45d9T0H9sLCXtjWS2pqMt2gDVBIcwHc+Q7IZmUOnBmRntDAwGvfAFloz88fQWX7ERmGWVsVchbkqnAcwC5DFPIQ+bwDh49rQ0P3/mjZecWFpaUOBRgkoInJoGUncQ5u2/JbFsBTrb//lyXnnW94H/i9WHaqawgoTk5+BKNOGGE3AzlsQtTXhQ1RLIAc/sm4PNn1dxZNTHwSgu8hXQPJC8cDyFkol2trm1jgc+T6jc6/Avxzi/57wDdbZ4AoY1vMvAAAAABJRU5ErkJggg=="},342:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABLElEQVRIS83VvytFYRzH8fdHEeMtGztF7mL3IxObf+EOJhldiyilZDIZlEUmk1UZFCsDq5RsVkXKR6fOLenc8zzPrSfO/DnfV8/n9HyPyPwodr7tJWAKuJJ0HfteELA9AOwDq+VQAy/AG7Aj6aQOqwVsbwIbwGCXIV/AInAp6bMq0xWw3QTuIqt4BGYlPf/O1wELwEUkUMTWJe3lBLYkbf8tYLv4mMfAHFD0OZ1QUfgEtleAw4ShP6NRQAs4ygkMAbfAWA9I+ATFUNtF7zdAfyISB5RIG9jNCfSVl2w+AVmTdJByD0bKVTEcgXwA45KeooGyqhngDKhD3oGWpNOkZdcJ224Ay8BoxYBX4LxqyXWywf9BRD21kSBg+x6YCEAPkiZ7rSgvkL2ifw98A1t0aRn5ZuG2AAAAAElFTkSuQmCC"},343:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAABm0lEQVQ4T2NkYGAQZmBgUGNgYGBnIB38ZGBguMXIwMBgSaYBMCt/ggxxIN0BqDpwGsLPwsK829gw889/hp9Wp07PhmmboaVhOfHBo4vXv337BhPDaoiHsLDQNC31BkEWVt27375vNDl5agJIAwcDA9MTB7sNr3//vqR59HgNhiGT1NVNNbk5VRgZGZl0eHgD2ZkYQQHOADOkWklBY/bTJ3f71dTtvEREapa9eFGeff3mKZAauEveOdrtZGRgZEMPH5AhNidPTXziaLflwbcfu0xOnpr42NZ6zue//55qHTtej2LIe0f7/dgCGOaSw2YmSdpcXBGWp8/6zdXSiFHl5vYQP3AohCRDQN6NlZLoKrt1J85fTMTMWkAgXXD/QTeSDDlkapKsw80VjtclxITJ/W8/dpniC5OJGqommlw8Kszg2OEOZGNiEkGOnRoFBfVZT57cm6ChYe8pKlyNNXaQAxWUTqZradQLsLDooaeTxw52G9/+/nNB4+ixWryJDSSJK8VO19CwmPzo0cVr3759J2gIKfmJarmY4vIEAAXJz+qOcbcSAAAAAElFTkSuQmCC"},344:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAACk0lEQVRYR+2XzU4TURTHz7lDWzoLO60kSos2wZXCQpeVIjtjjDFuiG/AE1DCQtM2uiCUJ+ANTDfGGGPcIcUucYG6kqSWFk2gHy6mzJS5x1zMJLV26Ew/zMT0bu+95/zmfz7uGQSXL3Q5H4wA+43QSMGRgv0q0O/9/zsHk8mkV1WNKwA4hcgCjDG/UIxz3iDidQA6kGWpmE6n9V6V7EnBxcVFKRqduS5JdAMAvF2c64aBnwuFT1+y2azhFNQx4NJSSg4GcQGAX3TmjB1Xq7S1uZlSndxzBCjgFIXuIYLsxIl5lgjUWg3fOoG0DSjCOj09e9e5cu2fwo739/fe2Q23bcDl5dSsJNHNXpRrv2MY+HFjI7Vnx5YtQFGtJyfwqL0gdB3eeDx0CxEnOzkjopKu467PBw/a9vXxcXhpp7ptASYST64xJsXaITjnBVlmeU3DO0QUbt0XcH4/bquqNMeYaEV/Ls6NfCbz/Gs3FW0CPl1gjP3l5Ldx/FatlvOhUHjehDThNA3iRDDVCYJzXsxknm0NBHBlJfkQES5YGRPO6vUfHyYmIvHTU4BarZQLhSbnrOCEHSL4ub6efjUQwNXV9GMi7jnPGCIcVCqHO+KMolyOI2Lk/POsubaWfPHPAEVYa7XvOeGwm3pniYEDBOwWYlM9RYnEx8YAjo5KuUDg0m3rvB1wiBMJ6yIRcD4f5BoNmjfDiojlSqW8HQyGYwB0dehFYt1mpKIsGzutcCaMgPT56L2q8hhjLDrUNmPVqDUNXnu9Z426Y0EQ0WGzibteL9wfaqMWxl391AlA1w8LAtLV45aZQ64eWE1IV4/8rdXo2p+mbu/nIPdtjVuDdOjU1gjQqWLt50cKjhTsV4F+77s+B38BCfFUOGOOt8cAAAAASUVORK5CYII="},345:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABcVBMVEUAAAD/s7Pznp71ra36oqL2oaH4vb31k5P8t7f1kZH5lJH5r6/5qKj2oaH3i4j3qan6rqz4oZ74o6H4nZr4nZ34mZf1lZX1j431j4/4oqL2g4H2kpD4oZ/2mJf1hYX4kY/1kI/0fXv4o6L3l5b4oqH0eXf2hYT2kpH2hYT2hYT0c3H0dHP1gH74r670eXf0eXj0fXz0fn31h4X1h4b1iIf1iYj2jo32kI/2kZD2kpH2k5L2l5b2mJf3mZj3m5r3nJv3nZz3np33n573oJ/3oqH3o6L4p6b4qaj4q6r4raz4rq34r674sbD5srH5s7L5tLP5tbT5t7b5vLv5vbz6wL/6wcH6xMP6xcT6xsX6xsb6x8b6yMj6ycn7ysr7y8v7zMv7zMz7zcz7z8770tH71NT81dT81dX819b82dn82tn82tr829r83d383t7939/94eD94uH95OP95ub95+b96ej+6un+6ur+6+r+6+v+7Oz+7e1makWPAAAALnRSTlMAChUZNzxNTk5PT1BSVGVlZWdnaGhpamtra4qMmLPNz9TY4eTk8vL6+/z9/f7+akfdCQAAAO5JREFUGBm1wTlOA0EQQNFf1TU92BaYJUIEEBJxAu6fEyEiMiBAAlvCnqW6Gg+LyBG8x/84v+CH8W0pSQ/rii8G2KzWEtdJifs7TSLdCAJcHs3zXmqSEmUs3bB5vQUDlot5O2+yCjUGt14CMCDnvN+2SZSoudfqGTDAzFKjpkKN2riZAQaIqEBUJSqIigAGRHgpUplEKR4BGDCOTYcJk+qdjyNggPsgnpOw44MP7vyGAFfW5izCpNZx6P0GDHAdqydlElE8HBBgdlBLHNu6h8XpQydpvQEDtltoz14egdVMn/mgfDp5e2CnPLXKX3sHT95qO9c6uBUAAAAASUVORK5CYII="},346:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAXCAMAAAA4Nk+sAAAAQlBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////8IX9KGAAAAFnRSTlMAAQYQFRwiN0BKZXuUlqWptbq/w8rMKd3iyQAAAEpJREFUKM9jYKAL4OCHYFTAKsQLxqiAiU+QBYTRhLlF2MEYFXCKcoExKmAT5mEEYTRhPgFmMCZOGIchOKzE5UBc3sHheVxBRTcAACI/A9XZetZDAAAAAElFTkSuQmCC"},347:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABn0lEQVRIS9WUvUtWYRiHr59DNCgIQVDoINZU6drg5Bw4iIom4ZA0RNDiohgl5hCBi6iDgoIvKIIoQn9BDg1hgWDQEgRt4iDUpD954Lxwej+ec/Tg4LOe+7mu++Pcj7jioyvmkymw3QC8Al4A94DfwDwwK+ksK8E8gsUEXslalvS8kMB2B/AN6lb6WNKXmCRage0pYDICmJE0UURQAoYigHVJg0UEq8CzCKAkabiIIJQ/HQG8lfSuiKAT2I8MuUvS3qUF4aLtbaCnBuQQeCDJRQW3ga9ASwoUoE8kfSq0B+XLtueAlynYlqTeLHj4nmeTm4DvQFsKuCRpNGlhH/AGuA/8BKYkbZZj6wpsB3A/8Bp4WJFtaFHYj1NgI0n0D3A3jA0YKEuqBLbvAGNAyLAx0oZQ0W5KPgKsJPEHkh5Vtch2eDE/ZoDLzhvACXAEjAOfgS5gBrgl6eZ/Atsh6H2ewSUx7cBO7gpsHwPNFxCEwf7IPQPbodxYzyvd/4BuoDXXX2T7KbCQkkQ3NLH9BT4Aa8CvWluduQcXaFnN0OsvOAdWSYAZi7kFOQAAAABJRU5ErkJggg=="},348:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAABmklEQVQ4T2NkYGAQZmBgUGNgYGBnIB38ZGBguMXIwMBgSaYBMCt/ggxxIN0BqDpwGsLCz8FsuNsvk+HP35+nrdbOhmnTmOFo+WjihYvfrr//BhPDaoiwh7yQ+jSHBlZBdt3vdz9uPGWycgJYAwcLk92ThA2/X3+/dFxzaQ2GIeqTbE05NYVVGBkZmXh1hAIZ2ZlBAc4AM0Sh2ljjyewbd9X7re1EvBRqXiy7WX4z++ApkBq4S+zepe5kZGRkQw8fsCE2ayfaPUnc8uPBx12nTFZNtH6cMOff599Pj2strUcxxP592n5sAQxzicnh4CQubaGIs5Zr/TTmOsVwq/J7HBKfG0KSIeqT7E0lYtW77pQdixPxVzATsJZKPyg4y40kQ0wOBSdz6QiF43UJUWFy/+OuU6Z4wkR1op0Jj6agCiMzAxO3jmggExuTCErs1JioP5l1+Z7GBHt7YU+FaqyxgxyooHSiMd2hnkWAXQ8jnTxO2Pjn7Y8LxzSW1OJNbCBJnCl2uoPFo8kXL3679v47QUNIyU9Uy8UUlycAM6HP6oG5UX0AAAAASUVORK5CYII="},349:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAV1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////+ORg7oAAAAHHRSTlMABg0RJyo7QFVXWF14eoCnu7/H1NXY4un2+fr+mIQ8vAAAAFtJREFUKM9jYKAJEBDEKszJJSLKxYkixMIOAjIgIA1mskIlJGTQgCRUQgYDDGoJ0gFOo6RwBQkbFxAIS3ADSX4ZPiDJhmQcuzQviGIWR48THiFGMM0hxkT1BAAAd+0WgxuE4yAAAAAASUVORK5CYII="},350:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAB80lEQVQ4T0WSP28UQQzFf56Zu80BCrQEiZIAOkT+EEIuQAg1LR8AhBAdBYICGiioUiChdBR8AGryBWiQ6GioI2iQIkBJDnS7Ozby7Al2tZqVx36233syf/6iiQAiSPkBM/+sOzHEXxFUteSZKnJ2uGieFGLwLEeYFnmBTkPdnfqdKm3OyPxwwTw5hkBWJYZYuhRU6bpLCGhWTAJ1XRdgOXdhyVSNGENBOpUSNXCzn0rhxyaXgt1JjUiXo95xuLBiPnuIkZOqvDlxhFe/a07HUJD3zHgw6HPnx5ivbUanu8vCpTXLORdSXgwSvwy2xg13B4kgwttJ5tEgMQs8+TkuYCFEZGllZI7i++3MVjzcn/ClVW7PJEIIvPvTcCYIr49X3Ph+UGIpBWRxZVRYdUJ3jvV4fNjwORd6CzNOzDDA1tEem3tjQhBijMjy6rqZdjo+r4SDrLwct0Ue188hns4EKoxnh03BS353ee16GdWfOWB7RvhQK+8b1xFuVZFRhHv7NbtNS0yRXkrI6mjDfD+dumVO4H4/sBy7aT81xvbhhG9Tc7hsvRSR1fUNa9uplcxom1z28r0zRnbhO++RYiREIbo9r1zdLB3dPa6nJ3a2g0ZzibnwnZ3dYUK/l5C1a5vWjck/dHeSd2nV/hcW+1khpqr6/AXKThbItLMXFgAAAABJRU5ErkJggg=="},351:function(e,t,n){e.exports=n.p+"static/media/login-bg.35ac64e9.png"},352:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAAAcCAYAAAAHgGM3AAAJsElEQVRoQ92aeZBcVRWHv/N6GZJJprsDA0UIogiSkEiiDAiaABENSsh09wTRAixMqSXKUkABgVhACShIoJTFrVQUkEJSyXTPECIUBQpaBbImBASCRbGLZOnXGTJxennHuu91z3RPb68nMZbeP9892/3dc88959wntBrpzKMox7UiazovPEYidvwuyfhvMD/4XidZS1zVme4RviX53WmGJ7jR6M+chfDb3aJQ+Rp9sTt2i6w9ISSViQJbAaukbiHJ2J8aqjYbNRy+fXRewteSmLKxmamNwV9rx8jzMui+rgBlA0KhvXXLZNBZHo+8T4iZnBLNNJWxeutsAoFnfemRYA+a/zPIJF/044ksbiUevbgub8peBPpgyfZNJCIzEdGGely8dNvovMoi+qIPTQz8tP0zVM/2cJN1JKKL215gOnMzyvlj3iA/JxH9dvPTtm0OIk09ZpTfCs3FyT8OTG7bNo/hZpKxC+rypjO3oZxTmluGyBdQPtRETxD0qIr5v4FkG9KLc0d9zx/MHkXBeQJxj9xOijKHU6OvtbXAQfuTFPVJIDDmDThI8ViS+5jv9Yeq8AfCo5MjtvGeBSBb6IjMqGL6Irkq2vKkkz2AvL5aChnvkv/gEKbMcGoUTqLIQqk9zeu0g3/Z7yJMA14gH51HOPsiqoe1hUFTt5fv14KvapG2DThHlnivJBm7pi2lV6nFvOzjoEfX8skzJCJHI1ILRj0lqYyJs+ay3kIy1u3Ljv7MRQg3lWhvIhmrH1oaCUtlzgNu8ablVJLRNaQy8whYe/nS74fIKbxTC34qey44t5YUb6IjcgQny4gfeaM06ex3UOcnDXks6zzikdt8yZwY+OZ+OgIoYlkziUf+7kuXIRrYPBUn+Aqwv8vjhKeztPMfvvnbIKwGf+CD/XDyLwPmpgcfl0aNrvEy6htjk8/P4rR932tpa7vgp7d8Cg08UXKee0lGv9JSRyVBKmM83ni+NyrBX6dd5Ic+3pa8GmJnhHj0afdMVc2lM79DOcP9JnIviTYNN3wp+27Q01saaMkNxKPLW9K1Db59D6oG8CLBwByWdBln8jdWZ08i4KyrSC+rwR8cOp5ioXG66U/LmyRjB1WDP5BZiMPDpQ3ZjlWYRbz7XX/ySlQp+0SEhzCXZvORIxiY6wuYdsBfvWUmweBGVIOACZWbQJaRjD7Tch2D9kco8lfQbpA3QF2Aqjx/7dAcCoXrW8pqRqBsJhlbNgb+qhfChGasH8vJuZBk7MdtKVn3age57g3+MgK5jmR0RV35d77XSbSzZ3SuWDB2zAOyBILx0e9O7jUSe79VfXLt+1E9ueqbcgKBwrPEu4carmeVhglnny/Z/jDIw6A/qAG/LUBaE3semtp2OYinDFlPPtLDaVJszV5BkcpeAc7VPnheJ7hzNkumD7snJDW0mL6utaN8/T7zfEsuJR5dOcqXzp6OOncbXwVMWnyIO2fAF86nI3p608QhlVkD9JAP9hAqLgP94X8e/Pt3HkRupykITKHioIH59HWZwsX/SNkfBTWFUetK0yHO0tigt+n218G5hfCkw1k86Q3327rhGeRy3sJd8PRzgKmyRxAxAHnDce6hb5q3aWt27I+V3+CGDNEbUdkP+GoF+Pe44TARO6vhotJDh6PFSW6IStmX1gXfhDUrcLl/YOpSbqUvdpGZEdKZAZRel0zkVySi32xbeNp+ANWTWvIJgyRiXujo3743UjSX4T5Ufh8vpFXMX6UBwllzzyzENPAi0ROxbdNjqQBfLgc9CbGuJhG5qqWdjcDf7RduKpsGpxxLf00y9g3XuOoT0dLe1gQ6XOXhafuXqHq6sAZIRhJ1ZbQCv9++FtHvgryCWp+hr2srqcydVeAX8q8QCj4LYnL3i0nGygVYfbMbgW8chuL81mttQhGQYeJez0dYkzmIAC+idII4qDUWdqrugl1SaVStIBm9ruT1xyLFv7gpnbCDIrNZGvPCTjueP2B/CUfvdWO8OAtHL+Dx4PfFHqV/23yQRxCCiHUBiUipgq2ns0HY2VUIxvF7F27avgxVDxjYQD56pHvh1mZBE1QvL5F/ex6nzclhwkTINqnfXE+YriA5razbP/gDQ8fhFB4AeR2nuIile789ylwPfHedmfNRbna7k46zgr5p9dPGRp4/wdU3YvPAf1pDvJU1F1ap/WtdSDLipZrV+f9E1CsWJxKP/dFlTmVMF/FHniB5iQMjc+lp8kjRKOykM4+h0kHQWsySri1VhjUC3xD1Z/oRkiX9N5CsU+g1Az9lbwU1DbeJDRnr7I4VQ6mhE6DwiBuKhO1IeBbxTq/Iqqx821Up3E0idqa3kTum4+ReArrcJJDgZ0lObV4xNgTfXk4gcitLZLjGpGbgm757QTeiHADyFB2bF3DyodW9K3/gm5R2Rym1bYWK6dKappxQF3zPK+8CPKAq2wv++jX1DKju4aTt36P6ZU9+xaY0M308+AOZT6DWEixrDb1TX6zL2gx87zT3UtRfENqrhyWT36ndvCYxv+z5ImejMp+A/obeqHHa2mHqmHT2EtCpiBzitj0agj8eZEsWlW9mBrLn4pS7na02ujRf2b3stz+PxYOl1oONFZpJfMo/m0pa9f4UQiFzMo4EyaG6GTEea14JAgvo7TKXdu1oBb7naB8mGXu9Pr8f8AO9PDf1fuZlliOyF8+tv4bvLRx7GzBYanElone5GJajR0Pw3RCTPQd1Su1eGWspu33+7JOg5T5/ix2o6Nub1sNI9/OgH/OY9DyS0+q3lO/LHkqRU1BnMcgC0LGHFY/ZZEVprNx1xPerv3l+wG962nyCn+i6zxWT3v5p1DmXQPgyeie/ifcEeSZW7pJRG32BX/OYYl1JMuI9pgxsPwzH8fcXgmU9SrzL9MWNl10BlFsPz5CINn5MSdu3o+o2nirGRsRKIU6aeOy5luduT4NvDDJ3SZGVKIrDJpKRG6vefH2BbwSNf0YMyRxOafMZsYzQavtgAvqC23owZgWtY+iNPNUQwHT2SlSvQngSoR8k1dZjiLfZ1UWWyfPbGX4uXAn0Uvb8StlrhmewdPJY2lue8w2+uwD7p6DeY/dEH9DdI1nRaayIdw2xWGsfzEgxV5W3twPcngIfMc+k7bxwmcf1AxFZSSJ6qQtrExDMrxCm9zLxX0fUVJPlYor3CUnrX0faBboe/Z7w/InZmcMKH0O80w2d/58/Te0q+Gl7Oape9Tv+DTe9bQU6gf+ElLzbQEzG1pf3rdWLkymw/vd+Fxwcmk2hON1d5E6e5owWP2qN92KThlpyqPs5tPmxmiJsYl5fw/VvTLhwPBiRwwsAAAAASUVORK5CYII="},353:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAAAcCAYAAAAHgGM3AAAHtklEQVRoQ91ae+yWZRm+Lkvt6LTjQixMKwOCCsow0tQ8TApqq9msZk7bKqVhAyKctAFFKawILZ1HJEb9QaSVqzErrK2DdjA751hSpAaU1qSB4uWur/v99nzv7z087/f78dvy3r5/vue5n8P13M99X/f9vESLSNoG4OS2fi3td5I8ZZRjjLu6pGcDYEy8j+RjY7mIYuDKMSWdD+DmMZrwgyTXj9FYB30YSUcC2APgkJjsVJI/qJs4DurGpH0lyXubFloLvqSjAPwBwItigHsAPN5x188C8OrQ+QeAE0j+q2kMSVMA/CJznpkAfgjgmZn9y93WkVxYpSvpTADfjbY/xdrVAL7x+mfSfibJrcOC/2UAHw7l20nO6bpBSWsBfCzRu4bkR1rAnwqg0WIS/ekAfgzAhzyMrCW5oAb8qwBcHG0XADgbwEsbJnk6gDck7b8D8EhD//WVli/Jg/wkrtx/AUwlub3L7iS9HsDPADwt0XsCwCyS/r9SJHlNhyWNtp63ANgNYGJJaX+pb9F8NIA/x/r/DuB4AJ67LAdIjrjNkg4HYL3nAfgNgNcC+C2AV3XBoKXvp0eAL8k+zuDMCOVlJFd0mTTGsEW+sULv5/6fZBUYI7pLsp91sN5N8oU565D0cQBrou+aOtfSYADzAXwx2t9NcrMkH8AzcubP7LOzCvxLAKyLAezrppHclzlgr5ukjwK4ukFnPklf61YZEnzHp2kADoSvvq91ougg6bkA/gjgJfHXBJIP5Op36TcAvqQXR5B1pLe0Bo3yZBVjVK3nYQdikg+2LbYr+JJODJfpob9G8r1tc6TtkmzxtvxC+uBLOgLAa7qMV9HXlPVu/18G/ysA3hcKnRceVr8RwHkZC7yC5Cfa+g0B/iYABtxW71hlxpYlks4CcHtCL62Xgm/3V0s3syYBdpB82QD4kk4FcEccyL/DMh10skXS6QAcIBvzBwAOlNNzgOkCvqQTgimZedhV2m1eQNJxplEkHQvgpwAcV+4H0AOoBL6Z2Gfbxmpp30XS7Ol/IEkyu/hVwskvJfmFLpMEQ7CvzWEEq0gurRo/khXz90K8Dgc707Z5yf/bSf41HUPStwGcUxr3rc4bSP6nbj+x/1/H2m2A/n2mDH4XPHL6FuB/MpnMhzCTpK9ttki6HMDyDIW/AJhCcm/Qyjkkv1XoScrl+YtJXpno2dXZ5ZlFmRabXloMvnON85qIg6TN3nf8bJmfO+jgS/L1ckLgRMULn03SNDFbJB0X1z0n05xH8ra4cRcGpZtM0lfdt9Bcvti4/3pbZNl2IwaokE3FoUkyM/Gts8tYDcDE4QMJ+I4DW0m6XFIpkiY7U7aLkrS4CvxwazbU0cgekqbCoKRbAcyN0a4n+aGuI0v6DgAHqza5jWTPdUh6fjCrFwDo/18eoM3nS3IS5zjjmHUnAMcd11hS8A2Y17ec5KfaFtkA/tgGXEnfSHzpDSQvCnDSG9G23pz2vQBSC78OQG8uALeSfGfVIBngrwRwWXDzN5PcI+mWEvjm7a4X+YYsJFkkYHW3oM7ybTCzczbb0GdvUfOx5Rtkp84unw64HUlpLBjlnFhKclUc7CwAPwpK92jEgJ7b6WL5kt5jLh8+3lXHXgAug09ymySD9j0AZkILSBYZbNWcleCPFoCyfhFwlwDoARO+c4YDbgULGnb+35uxkNwfbsLUz0UxS/9QuoAvyW8MdncO4E4G/1boV4Efh+LA62Kfq5Oet5I21rmdYTdfp1eAf2iAXpR/+1SzxP+Hmd8bPZ3k9wMAVxE/HwP5UMz3ax8p6tyOJPt3F8DMllx060sd+DH/1wG8KzpXJnpN4Etyjd8Ft2GlX9ntJ0OSTMl8Lf3fQJIlKc18u066keT7Y+MTABhwp+k+lNOaHihCp7KwJsnZsevxjiUD0gK+6+4uWbvyeZcrpmUKmgm+XbRdZk6B0HmUi3LGdiT4sdENAHpApXWRzHpN1aEM1HAkfRXAudGxfyhNp1m2fEmvA/AO006SjlUjpAn82KfZ3bWRz+ysOLxan59Yvt86HEduImmjrVqHwV4EwMU65x0ue9SCX1tYk5RWO3Otv1+9lHRGvAx5QT4Uv2o91AL8c6KW4vK2SxK7wmKtZot10O4MfhzAJJKOF1X6OeD7AJ1R+wbaqlekbwNhsE4CN5jdJN6jGvxYlF9vinJvv6RcUedvO4B+3T5KD07fXxlKtSVlSa8A8Hb78nhESR9WrG5WZHrsEkXl4bVZftvCM93OXJLfDMxOAmDjXEJyRzxB2oMsKtaYC37tY4ok121yv0LYRtL82tQvLT00PqZIcoLUKzwlYh+9xaCT/GUGeAM831SzTSdt7wp+7NGxxJbuWGajXU2y/+abBX4MNOpnxGIzkl4eT3EuPTg4vYmkA12lSFoGwFmoX9PMTLaQzH4MifWPO/jJfiemtDf5vyAt9W4n6fwlAMVj91AP6AFEWmnMeUD3Ye2v2kCu9Y6T23H9q8sLlw36GN8Oko4p9XX3Mfp0xNlkkUxlfTqSC3BTv3ECf5ilmjT45vdc51Pyo6kxAN8Mpsh+B95wJfkdIqd6Wz4cJ5IuILpk35O2FycHy/+7zwXjwysndJa72z7UKqMkaRIAsy6LP3Xs9AFB7pV4EgPu0klJ9YNdAAAAAElFTkSuQmCC"},354:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAKu0lEQVR4Xu2ce6wcVR3HP7/Ze+2D9u7sLRR8FKJG6YMWGiogBUFUMC10d26xQBSQAKKFRFFSMCoE0MhDAWOAIAICRqWhu3t5FASVR0nBQNNCbAsSIII0PLx3Z28ppend+Zm5FCjcM7vzXGiz8+/8Ht/z2bNnzpzfmSN0rrYQkLZk6SShA7pNnaADugO6TQTalKbTozug20SgTWk6PboDuk0E2pSm06M7oNtEoE1pOj26A7pNBNqUptOjdzrQFfdu0Hltale4NCLLKdnzwxkns2pPj64OOWijnExqRt4WCykWMteWPei/6i5srq9Ddc+MUCUN+xLj7WkcJZuSBmrmnz3oinsp6JIsG5E4tujllHoz1Zgt6NsHZmBZqxG6E8PIMoCyla6u2SyYuDarNNmCrtYeQvlSVuJTjSs8TKlwWKoxtwuWHehq7SSUm43CRVYjW49mGM2qYca4Xd1FPL02MKdYJ1PK35KFpmxAV2o28Aww2SDaI2fNZUH+sSwaFBjTfyi/6a4HpjTJ+xpvylS+adfS1pYRaPca0O8F9ObrKdnfSbshLeOVBy9H5JyWdsi1OPbi1nbRLNIH3e/OweMx0NxoKfI6ak2jr2cgmsyE1tXBmai1CjTEQ1kaePJFFuYfT5j1fe7pgr5ALfZz/wnMMYpUTqWvcGOaDWgZS1Xod1egzG1p+57BKkr2AYh4EXyamqYLulpfjHpXmzPqSkqFQxBp7wOw4p4K+vvIwMQ6i1I+oC2Ro6W4r6O8cTJW42lUCwYZw1i6P8Xep6JLTOBx59CuDDeeBibFiOJidU+lOOHVGL6jXNLr0ZWaPy060SzKugIn/6M0BEeKUa3diHJKJJ/3G/8RpxDQpmhR0wFdrh2G8AAY/iHKy+SGp1HcbWM0aQmty0OHII2HjZrCh/aHuSNwCg+GdzFbJgd9nXYz2V0DTA9IcRyOvTSp0Ej+D2gXrrsa2CeSn8lYWMen7P2YI1uTxEoOuuIuAb00APJ9OPZRSQTG8m2qKUZEkfMo2QFtDBcvGeilg3vSzTqQXUaP/vIWwzKLY/PPhpOSktUdg3vSCNAUP8UmcmOms2D8i3FDJANddcuoOsbkwkWUChfEFRbbr1KrAsXY/kGOwi2UCifHjRsf9LLB+VhyV8CQ8Rx2fh++LG/FFRbLb1ltARb9sXxbOSkL6YtfiYkHeulL4+ie8C/gM0Z9OWseC/L3tNKe6v07dTzD7jpgr1TjjgSTe3DsRPXOeKD7axfh8bOABpVxCgvTb2yLiFX3ElTPzSDvZpCZOPZzSWJHB10e+jzS8N/wxhgSv4F40ylNeimJqMi+dwzMYDirSo51Pk7+4siaPuAQHXTFvQ/0a8bEKkvosy9PKiqavwoV9yHg0Gh+IayVZxlrz2SebAlh3dQkGuiqexyqfzFDZi2vPzebM+YkmthHblCl9m3gpsh+YRwsOZKifb/R9O439mD+hFfChBkZ5cMa0q8T8Vx/geYTBh/F43AWFvxX3vZd99Z72axPg+6WelKR2yjZxxvjVgemo9ZyLHsmRQm1tBAedKV2JfADc4Osm3Hyfs9q71V1r0f1tNSTCkPIyPrMBmPsSs1f1zkcuAqncHaY/OFAl2v7IjwBdBmC1tAtU+nb47UwCVOzqQ4cjOZWgFqpxXw3kHU2Tv4qM+T6t8C7dds9v7w8h77Ck600tAb9doXiEZSDzcF0MU5vcGW5lYI49/1Fo7q7CmVWHPcWPk+y1d6fRdIYZXe/5tlU99fc93j3nrCSot2yoNEadNMKhTzOmvxBXJheyScUuErNX9v+VSjbSEbiIY1DKU1aGTBk/BY4a/Q9OQ3HvqFZqtagq+56VKcag6ieQF+veRbSPzgXT74aqZ3hjH3NPugJ4cwjWd2AUzCP+RV3f1C/HmooOuszOL1mRtvStwYdt0f/acOujBsXt4wUiU5KxgNobm9jhX6k6Fx/FPQAc640erQ/RlfdRyBojJbFOLZ5jO53T8fT36UEItswIqdTss1F3H73u4E7nFIbo/3mtZx1dE2lb+LoWcfIg7S+EtWDsqWUNLo8Sik/11ihL78yGRnj/zPNRefUZh3vtKFavwL1zHPGZmu1ldp+iDyOqmlqmJRQcn+RYVS/gFPwy3Gjr0rtD0DQOnTK82g/ff/rE9Gu9SifNMhp/mZYqflz0u8np5JJhN/gFMwvYtWhQ9GGv45iepZtwLKnpv9m6Lex4i4Cvc08A2my1rF8oIctlv/3+3gmqOIGFTbwMW8a8yYNjQrRqsArcjwl28zCoKf1rOODTs1W76zcEoo95tW7/vrxeN6f4zLJxM+yTqCYN09Pq0PnoI2AlUi5H8c+Moqm6KCTrEdXan8DvhJFYIa2f8cpmOf51YEpqOVXa0xz9S1obhZ9Pf+Ooi066JEhpHYRBFVYpIxjmyss/UN743lPgpqKBlF0J7SVLVjWvhR7/D3cpgfgMqDPeM/iYoqF86MKiAc6Sc2w6v4c1Z9EFZqqvcgvKNk/Ncbsr38dzwuqdz7P1jf2YdGUzVH1xAPtZ2laBed5bHuGsQq+VMfR7fof5Xw6qtiU7F9gqz2DRTIa1k0vjMW2/aLzZ425PD2ahb13x9ERH7SfrVoro5j3dcDFOAF/sTuGjqbRuDOO4MQ+udwxLOgxb5Mo1y5EMA8LIhVKtnk4CSEqIeg3p6BvrQ/cqZSTWRwTsFMpq40uzRvdj1MoGU1ur3+OLn0K1bGj7+smZOw0SuNjF52TgR55MDbZeydyH6WAvXfLanuRYy3K6O1kIXpIZBNhEw1msLDwH6Nv1b0X1YB9gnIujn1Z5JzbOSQH7e8m3d1djTLDLESCd5OWB89D5JdJGhDaV+XH9NmXGO3L7jcQNe94Fdbyqj2bMz7s3aS+8mb7o4WXt9XfRhcxn9Bu/uuuQYO2/IbG2MJQ1jMlv69x662/tNDoWo8ELC0oX6av4L+GJ7qS9+h30lfrN6PeSUY1ypX0FX5ovFfZeDgM/yNSRT5akxW6jsCZaN5MXqn/GjyzNrgVp2BuUzQNEbYbtAqc5BuWtyvs6W+A8TVb1gqKefOqY//gLDxZZSw6i9Twcubl31YsDPfT69F+8OrgYlQ+Wl9lBUHx18or7gok4LM4sc6klL8mBlOjS7qgW31naOVOpdjT3u8Mg0hVh05BG0FanmCNfWCaRed0QfuNavrlLP9D/b9jm7+c/SDspfVeuoN2OEkDi4Mo2v4+ltSu9EGPDCHu1aiav6cW+XC+Bd8eWcW9DtT8PbrINZTsM1MjvC1QNqBHTjcQf0/c7gbBH87pBu/Njg5EPX/fhmGHk7wKOhWn4O4YoH2VlfqJ4AWdfbEGa3h++8/rQNCuu1BmBzyxTqZU2IHO63inFRX3QdDMTnVJtdftsCfQjIzVG6fjDa/ZIc5U8rzZHDtpBz1TaWQIGbwUJNMTuJL3bLkMx87i+5d3pWXzMNy+5be8sgs9Y9ahfDTPvRN5kXH56Tv+uXcjQ0jNQcn8tMRYPVvoo1SoxPKN4JR9j37vwfjRO5sUWY6zM51NGuGX31lN29ejd1aCIdvVAR0SVFKzDuikBEP6d0CHBJXUrAM6KcGQ/h3QIUElNeuATkowpH8HdEhQSc06oJMSDOnfAR0SVFKzDuikBEP6d0CHBJXUrAM6KcGQ/h3QIUElNfs/ueZGiEBce48AAAAASUVORK5CYII="},355:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABPlBMVEUAAAD////////////////////fQED////////wPDzxOTnkQzbpQzf0QzfqQED0QED////rPT3////////5pKT////////6tbX////8ysrwQD3wPz/////wQT7wQD7yQD7////////vQj/vQT7////yQD7wPz/////yYGD0amr0bWryamfwQT/yaWb0ZmbyZWP93d373d3939/94uL////////////////////////////////////////////////////////////wQT7////////////////wQD/////vQT/vQT7////vQT7wQT7vQD/wQD/vQT/////vQT/////vQT7wQT7////vQD7uQD////////////////////////////////////////////////////////////////9+GtcDAAAAaXRSTlMAAQIDBAYIDhAREhMXFxgYGBkgIioqLDRFUlRVVVZXX19gYWJiY2VwcnNzdHV1dXd3eHh6ent8gIGRkpOVoq6vs7S1ubm6v8DKysvMzM3Nzs7Pz9DQ0dHR0tPV1tfY2eHp7/Dy8/T4/f622Q8FAAABAUlEQVQYGYXBh1LCQBQF0AtJzGLFhg17x45iQcGOIlhZLAkG0STr+/8fMGSYyWac0XPwv3iu0cjF8YtukcfS4WmDJEO+DIDRc0gK5CsAY2+9kHDycYy/9kDGyXc18dyNEE5NVqrahTBOnvdUtRMyJQJORLXlyggiCgL8Ak9EtZXKZhmXLwjYXzgjc+1xS5zCcREwqG/aWH9IC5rqJwOBQ9qLLt2nBeWj+5RFICGKk3cD+eM5JeGIQUgWN26H4Bn+oAPIZkrbopg9Kn/TiQbJbKlj1ybP544CyfxNO6AnXTepQ7ZwHUOTbSNsNQaojDHHYYypCNHq1FLXIFNNajFV/O0HqttAllsTUR0AAAAASUVORK5CYII="},356:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAjVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8DizOFAAAALnRSTlMAAQIDBAYOEBgiKyxFVV9ienuBkZKVoq6vs7S5ur/MztDR1dbZ4env8PP0+P3+wpkPNAAAALRJREFUGBmFwYcOgjAUBdCrBeree/EUXEXv/3+e5MWkUI2eg/9ai+t10cKHJGcpTxAaU40R2lPtERIqQUioBCGhEoSESlBjGhAqQcPAO26RUqXYHeEVDhuqDVwB78T2gGrQ5gnejJPmkqVlc8IZvM7Ddc1wtRqarnt0UDHlpYdS78IpquI1n4f5/PDkOkaNGd1Yuo0MQkm/KPoJvrnf8Smy1jpnrY1QE5/5do5RFWV8yyL89gJXDRtk/Nu5+QAAAABJRU5ErkJggg=="},357:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAoCAYAAABjPNNTAAACp0lEQVRYR+2Xz2sTURDHv7NbjIgk3ZCqx4qYgz8uglakZDdNEW/iQYpelCp4VBpB/wQFG72KP/CklB7Em0LT3Q0iEsGLxIM96NVYExIUrHTfyCppk3YT3sZNTXHf9c3OfN53ZufNI2yCRZuAESFkUFkKlQyVDEqBoPyENdk3Sn7JjCYHhDoB4ASAYQAJAIsAPgF4vqw4M0P5lx/+BrjrdNcNIyEINxh8HoDaAcIh0COFcT1qWS6879UVZGU8dVBx6BkDu2UjEvBRqHwyPld4J/tNw843ZNUwhgEugjDkPxiXmZURzbLcUpBeviD5NNTaol5k4FBLBMZTIhxjYGfT6T8z4xUIp5ptCXgbS9hHaBaOLKUvyGo6NQnQgzVBRcy0B+pjqZxgurKyR3xncL4wVUvrywworUB8QTMLD3sCWUnrJQL2rXEuNNNWa2l9WgBTjT0FyMVMO1tN665iLZAMvI+b9v7AIWup1F6hklcr8Q3pwikOJ2OFwoIMqHS6K2P6GWI89nDaFSQTzsbn7SeBQlaNVBZEt7ycEvgSM10E4fDKPuMNEd9n0F1PEOarmlWYDhYyrbv1JuVUJjCArGbaORnbINItE2edTU/S3eHHAcA/AeUegScYSNCfu3uWgUkAEa9T9OTHcQO1aUHuVnmQac9XZSmm8tZrDv24KUSktoV4gYFd6yGppJnWAdkUSKfbdejVzFf7IpWWGEd3WNa3smFsjxBeC3CbXtjDZt7uWmTguwolEzXNYi2jj8fy9lzdMEYEiTxA2zb0WvytpseA4dagAJ8D6DIBxwn0gkC3BYTbV+Or9/kGDBiNYH0/qjVA+37oba6xemY06XR4PqiKMxP9V88H2fYRhJ2vFhREwG58hJDdqOY9ZQXlqYd+wnQHJW6o5H+l5C8dLhs4tJGDbgAAAABJRU5ErkJggg=="},358:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAABgElEQVQoU5VSPU8CQRCdOT6MGg0XIyAWYGLFLzAQYO8iNbHCxN5YaGFCq4W2JBYWJvYmUBlq4rFAgH9AZ8BCRCw4NGo8uBuzcBRXWLjNTmZ23nvzZhHsQ9Go9z3oPySiAwIIijQC9BHxbrU/uMV227BzAF+qummQVSIEDmBcy1rzSRSHaiwM4D0BAraAUmZJ055RII8C/iYBXsqVSumbscgi513RMI+HipIBoDPf6yCGI5UdWwARWeO5t0Riw+2SijKvJqcMLFWbmFZ2vV5/GaosLwF0UVdSLcLxvpDxmU6HjIlRlCvVxLRBSdW9bm92uVzuCXlIngIOlVRHrlS3xAOKx1d0j+tC5rXTGUPyyjc2z7HR+LABOo6GuWN/3QLcIWmGypjLNemJ2DTdIZlzPnNMDSOZBcfQojDaZTtk0j0BoCXB3tpDtSXyusryKIYWtuoBfxNsW3WV5QAgbstq+DSed9gqCmJxP2SVAIEjSDc+TXucsjG2bUlw5Fjcf7/GL/rAyYe/tTdUAAAAAElFTkSuQmCC"},359:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAC1ElEQVRoQ+2Zu69NURDGf58WlcbrCrUeISGICo1LXIX3o/IqPK6/wLPwqrwfBYLboBKEhKDXi+ctqFytkUnWSU72PfvutfY+556zk7PKvWfPzDez1sw3a4uaL9Xcf/oAup3Bfgb6GagYgf4W8gCa2TRgA7AJGJO0ZaLAmtl9YCrwEBiRNFY2EZUyEBzfDxwBZjQ5sVPSrVZOmdkO4GbTu9/AOeByGSBVAWwGPJrZZcBF4IykHyFLs4FjwEFo2X+GJD1IzURVAHOBrwVGR8P7mQVy8yQV6RqnYjIAxAa1KwD84D6O9bBAbqOkZF2lM2BmU4CXwIo2AXgDrJT0L0VfKQDB+VPA0RRjEbJejY6ngCgEEErlWuBdcGARcKCNkc/ieh0q2MfwYhnwLK/ExgAYBk5GRK+TIickecbTqlCI/udMk+qko3m6vdnNb5WFCTNgZtuA293wuIXN7ZLuZJ8XAXgCrCsBwDvxNeA68Cl8vxDYDezJ6cRFZp5KWp8KwGmC04WU9RPYKulFq4/MbDVwF5iVotQpSyuSGHOInXzdiIyaR35NnvMNhwOI5wk6d+WRw0IAbtTMzgOHIiJ2VdK+CDnXeQXYGyF7QdLhPLlYAM4kv0cYWyLpQ4ScA1gMvI+QndNgtMlltPkDM/O9XcQop8dy+lCi/xQAGJU04VmJykDYRvUFYGb13kK1PsRhhq1nGTWze8BQRKVoFumdRmZmtacStSdzfmHVC3T6F7AgmU6H+t8LA82wpNOlOnHTSPk2KPCR0i+n2jXMZ/3ykfIS0Bgpl1YaKXMosd9IeET8SrGd6yzg0Y6+mYimElkvw83EK2B5mxB45FelOO92SwMI52MQeNQmAIOSRlJ1VQUwAHxJNZojPyDpW6quyQAQe7nbFQBOM5xujDsidble90ZX3x8cjbBnfjH9lTQhAeyZX0ypB64T8pUOcSccStXZB5AasXbL/wektixAh5acaQAAAABJRU5ErkJggg=="},360:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAF60lEQVRoQ+1Za28UZRR+3pnZmdndtlsoEZUC1gtSWmIMxl9g/eIHQaJGjWjUEFS8oAnxhty8BaN4QSVEjcGoUYKtH/xi/QVGYgwtRURrsagkFLpt9zLXY87MvuxSd7u73VLcpJO8adLdmTnPeZ7nnPO+K1Dnl6jz+DEH4GIzOMfAHAM1ZmBGJLRnmFqSqezTIzZW6yrSr62I3jBVXM8cyfxoe4i16OhJxM03NraKkeniqAkAB356Irv7jxTdTiAzoghEBNCRUHdsbDO2Fgtqz6C1vT/pvegQ4PgEAZG9Ii4OLGgwN00HSE0Adh23XuhLujtNRUBXAJ0BKIAmQIuiyjcJTd98z2LxKwP57E+6Junau05m/FtdgnB8wPYJtg9kfUJnQtuy+WrjpWqZqAnAviGr4+dRr89QBIwAACBZUATASxciyUHZRAmfAF4y+xy8FSzC9fPUlQ8tMfpmFcD+v6i9/2z2iKkAhiqgixCAlgteASByKSIOHiEANycfmwDLI2R9oL1B6bx/qdE/qwA+HrIfH874b5sqwCwEDAhADZYIgpcUEwAG4REFAHiFDBCyHrAoqmx6cKn+1qwB2EqkLBi0+2yf2qWEZPYlAxz8eQAKGJAsSAlFFHF0pE3v2C4EE1XxNS0PcPCtJ+zPxx2601Sl/kPp8GIGguCZhVwoIQME/usFTIReYCMziKxHaIyIr4aX6HdVA6IsAC6V6az98HwdPRqBPIiutEfrHZ/aowXB56pPIJ1C7U9OpfSClJKsRgwi4xF7aCCuir1aJNKbdWxl1MGamKl/UKrElgWw7Whm/+8p/95GTaBBE4irAnEN4OAD8+ZLJ5QywUsweUOHfmAvMBNsZgaR9oAJl4I17hKujCufblseXVdMV1MC4OwfOpUZ1hSYDKBRA+KaQEwViBYYN9T8+ZnnIFkuhVcoq/A/xUCwoTMekPYIqSD4EIjjI7tqYbS1GAtTAnj5l8wrxyb8Z8PgBWs0YCCmAqx9WXVk8OcyHJg11LsEIQ3N3y18KTtWyiloajkGUh5h3AkZ4LWsQXn1+Wujz01mYUoATx3OHBlzqb0pl30GwQxI+bDupeblgzkgIiJdFd2Ghr0ktB/4M0HujZaLDbZHa4QQgn1SeA+DYD9IGYUMhCyMuYQmTQy8uTK6oioAPHQlbVrVFMkxEHggzD53Xi6b0rBSEgDOxHWxvqtFO1hMs70j7tqUTfsAzJ98L89GsiKlPJzL/phDSOjiULEhsayJefj6O+NvadSEYAZYPswAy0fLNSsONBwTiBoM5fZSwUtADGLC8g8ozESBJ1wKZyNp5Jx86LKosrPUcFgWAL/0vUGrO+3SalmFuPPy4Mb1XhqSJaCr4utbFkbWVtKFvj3lHLQ9uk12bL6He0NQjTyAPcAGjmui55E2Y02pZ1YEgCfJfyzrWAMbWAvLJ8tHAuDsM4AmQ9x8U0uktxIA3484XWMWfRd4KBdF0Nxy5TTNZdQjXGoYy+REW3UZLbzh3d+sUUNFgkuoBCBfHA5ohCYz0tw1P5w+y129ZygxlnVGWYaFzzkHwCNYHpKPXWU0T/WsihjgB9Q1gLqX0PuDVnfqIpk4pomeR2sxcV2X0bpvZHU/SlQyzIUbmHCk+N8Nc3KcjigwuQtfjHGaxwmXkFl1SXRx1eM0Z3TyhoaByHmIGxqPFOFc9N89QakGVG5Dk3Lzo0SwoYkp+7e1R++bVieWW8rmCLrNiO67jtOV8mjDhdxSxlSxTwX1ugLijI3VNW0pi6HObeq/GHfojsJNff5IpfymPn+0ct6m/svhJfrdM7qpLyUDBtEyaPc7Pi2fiWMVXREDp9v0zmqC59gqnoWKAfloyH7yZMbfXXiwlT9aKX2wlT9SyR9stUaVJx5Yqr9Tbgic/HlNAD4ZsjoGJvy+mTha7Jhnrlh3uRiYVQAfnrA6fzrrHZ6Jw93rmtXO9bN9Nvr6cWvL4aS7o26P1+v+Bw6p17r9ialaw12I79dUhS5EQNU+cw5AtRmb6e/XPQP/AvQdtm0LdKT7AAAAAElFTkSuQmCC"},361:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAACHklEQVRYR+1XXUvbUBg+H0lL7YZflTknm/PCDfRiFPpX+i/qTWnXQEoMDcRFvJn/on9FKLtwsHmhTly1TN2Ga0ubvMk4nTBpAjlpRA5bzl04z/u+z3nOOc95g5HgAwvODyUE4+5QomCiYFwF4sb/02cQK4qSo3RqbjBwfu7s6Bd31apUtMV0WpoG6F2bpnmJEPImUXNiBVW18dJxvDlWlBDqOc7wot+fv2LfmczVvCSlFl0XbvPD9+1t/ehBCVar2jIh9AlPUddNdyzr7RkPdhwzsYKKoq15Hn3MUxRjuDFN/ZAHey8Ey+WtnCyTF1EK2rb7ZXd3i53FSINXQayqjZXh0LEpRVO8yvnUwHADgHqplCQbRv2E5+JwEVQUZcHzMs8jLT0EjHH/1DTNb2E5uQiqauOV43iPwpJFmZck/Msw6p/DYrgIMk+T5dTSX9vwpXUB4LxQWB8psr//cYFS+pQ5UBABZku2PWyPe2cQlosgC6xWtSVCRkV9AwC+Bhk1pfRZEN514dyy9HaYemyem2Cp9D6dzf7YCEqaz7/+UCwW4e5cs9mkrdanN0H4bnfmYG9vc/B/ERR6i4W/JMLbjPBGzW670E/duB2I2Cz4LEvoduvPy/JumZABZ8MKHcvSH7ZhrdW0VYToLCMb1vJLEr42jPoxz8vha9EmCbqNEfunKcbCIoVyNwuRst4jOCEYV8xEwUTBuArEjRf+DP4G1ewiOH+zPakAAAAASUVORK5CYII="},362:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABGElEQVRIS+3VLUuEQRTF8d8FLWaDRTBYDH4GUVCTiiAGo8kPYzUJgs1kECwKviSzTTCJFoNNLC5ceWRd8OF5QZcNyk6dmfOfOXPPnTDgEQPW988AmTmJA8xh9If2veMa2xHx+LX3m0WZeYH5HwqXl19GxEIdoDjFSJ+ATkT0bl++QfYp/rk9Inq6Q0Clo0OLWgvttxbdYAdv2MVaHakJUBe0K6xExGshmplFGA+xVQFpDFpVqzjDOsZwUuQIq3jBftF7SpDGVlFudqfYwDgK0ExX7A5LeMJe17pOa7Or8jQzp3GOqdL8AxYj4r7p1Rs/nMyc7Z58okbkGcsRcVv74E30zDzCZktdHkdEYWN1qluLus8Ff/9P/gDzWmUZAY/RtgAAAABJRU5ErkJggg=="},363:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABs1BMVEUAAAD/f3//qqr/////xsboubnr2MT/xcX0vLz3tbX3t7f3lpb42Nj5pqb5qKj61dX6lJT1k474rq76wcH80ND1f3/82Nj0f334r677xML70dD2kI/2kZD3kI/2j4/819f7wsL7wsH6uLf6t7f4qaj4qaf3k5P2kpH3lpX3mJf2lJP2lZT1goD1goH1iYj2iYj2j432j472kZD3oqH2mJf2mZj3nZz3np33oJ/3oqH3paT3pqX3p6b4qKf4qaj4qqn4q6r4rKv4rKz4raz4srH4s7L4s7P5tLT5tbT5t7b5t7f5uLf5urn5u7r5u7v5vbz5vb36wcD6wsH6w8L6w8P6xMT6xcT6xcX6xsX6xsb6yMf6ycn6ysr7zMz7zc37zs37z8/70ND70dH71NP71NT719b719f81tX819f82Nf82Nj82dn82tn82tr829v83dz83d383t7839/84OD84eH84uH94eH94uL94+P95ub95+f96Oj96ej96en96ur96+v97Ov+6+v+7Oz+7u7+7+/+8PD+8fD+8fH+8vL+8/P+9fX/9/b/9/f/+Pf/+Pj/+fn/+vlssJuBAAAANHRSTlMAAgMECQsNFhcfICInKCkxMjSboaevsrO5vcLDw8PGyMnK2Nni4+rr/Pz9/f7+/v7+/v7+gk4JywAAARZJREFUKM+1kVFOwzAMQJ3EadNt3YoADSHgn/NwVrgAZ+CXL/gAprFurKSJnZC24QZgybJeXiInDsD/h0g5b+qV0jgyeW4PuyPAgKfrqjKIQkCMRLasVRZ1tVwaLIfDsSe7hxomsZgt56sCR0GuBeqzQGNWCyPHHsECG/wVCosSEWK6C5UuYRYKtRQihAgiVaGVyiLGyCQgBBAKfEiYRfCO+sA8COV8TyELT94KH9NeqQXZhFmw7aTHcL/j2Z3g/vjNQ+OUDaoQ/MN75+zzTVrv2o9JVIYDP27k9Un39XJ+7PrPdhJELJ82+vL2zNvDxuy3Wz9Nd4x6faWAX9/2mVWuzUXD3ruySDMZA7PQpZPDG3Xx93/+A3wsi2ldjJzCAAAAAElFTkSuQmCC"},364:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAACMElEQVRYR+2XPWgVURCFvyPYqlhKbGKjFlYWkQghndioiGJhISRWKRKCv4UYSaFGCTZWRrCwEEU0TbATQTFFKgu10ULE1p9WcMI85oV185DdvdnnFnu7t+ww354zM3eeaPhRw/loAVMdahVsFUxVIDW+rcH/qqCZbQaOAkeA/cCOAPoGrACLwHNJv6uCVrbYzI4Bt4BdwGfgJfA1QAaAUWAQ+AScl/SsCmRpQDPbBNwAzgGvgcuS3vRKbmbDwHXgIHAbuCTpTxnQKoBzATcLzEiyfyU0M88xA1xxSEkXagMMW58Cs5KueiIzczv3SVrKJjazw8A7SR3bzexaQB4vY3dhBaMhPgDeACNd5czMQSclbc8BfgfuSHIwB/Rcr6KR9hRtnDKAJ4DHXk/ZmgtlpiRtzQH+DMCO0gHpNel1e1LSkyJWlwF8CByQ5F27dsoABqR39VtJpzca8KN/vaTxRMCFcGH3RgP+AuYleUdmFRzxQS1pOvd83ge1JK+77PsePy1pS18AiyTpF2BPiysA1mZxzyaJwh8Ctkl6Eb8PAT8kLec/wMxqa5KeYyaAbgJ+Q7g6fryR5iRdzNlb65jxzWXdoA5AH1f3gLEAug+czV6DtQ/qAPEN5q+rLp6fAh4AX6DzV3YncEbSo66CtV91mUTrlgUzmwD2Al1L3fL3ku72dVkItZq9bmWUbObCmuvK5q78ZQd01fcLbzNVE6TGtYCtgqkKpMa3NdgqmKpAavwqlBQbOKzvDTIAAAAASUVORK5CYII="},365:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAv0lEQVQ4T2NkYGAQZmBgUGNgYGBnIB38ZGBguMXIwMBgSaYBMCt/ggxxIN0BqDqoa8iHDx+m8/Pza+Bz1aNHj3bLy8u3gdTw8/Mzf/z48S+IDXfJ////9xPy1rdv3x5zc3PHLV++3DYoKCifnZ09hGRDfvz48erFixcXFBQU3MCaGRkdSTYE3aVD3BBomJxXUFBwJztMYLGzdOlSm5CQkAKM2CE1nfDw8DB9+fLlH0rsEEoj+OSpluypkospLk8Atbxd6uCfBjkAAAAASUVORK5CYII="},366:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABblBMVEUAAAD////////////////////////////////////////////yPDz////rOzv////tQTvuQEDzQEDuPj7////////////////vPj7wQTz////xQTztQDvxQDvxbW3yPz/////yQj7////////zPj7zQT3vQDz////////////////////////////////2pKT////2mJj////3kpD////1kZH4kJD4lZP4n5/4oaH4qKj4q6j4q6v1kZH4tbP6tbX6uLj////////////////////wQT/////////////////////////////uQT7////////////////////////////////////////////////////////////////////wQD/vQD/vQT/wQT/////vQT/////////////////////////////////////////////////////////////////////////////////2+7lQAAAAeXRSTlMAAQMEBQcMEhMbHyUmJicpKywsLS0uLzAxMzQ3ODg4OTk6Ozw+P0BAQkVHSElLTlRWWV1eZWhqampqampqa2tra3J9fpWZmpqcnaGjpKeprbG0uby9vsHDyMzNz9HV19ja29vb29zd3+jq6+3u7/Hy9PX2+Pn6/P3+Y7IaUQAAARRJREFUGBmFwWVbwmAABdA7MVCxxcBOVGxRsbu7G3ETlOGAyYz77x28exh+0XPwH2loP5JKPe/247faG1quSpHDpzNL62w8hMWt06bNhBsgSLfMUGMktUB4DJZhpp25gbrzt4AyG/dCOKDpwgFT/oQyF+c2hBeaPEhrUuYT5CMEg6SOtGal5pWkDuGd5EcegBalOs8gaUAI0uQD2pQqDNAUgbBFU9DZIVeiKEjTHoQumtRJubV4PMK0QVhOyej002KSwrUES4kaXZCXdAqJCmR5puRlnULcC1t3aESncFkGW0+oHO3rd2rsfsOLHL0hF+oLkFE46kDWpgsrX9rRqt+/dpzkiQM2yaCtDzl2Pmn5fnDiTz8ldm+ACCmVNgAAAABJRU5ErkJggg=="},367:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAACHElEQVRIS7WVS29OURSGnzfEfSQm0gjRARMiVKSo0EY1lWBIRCSkf6C/wFziBzQpE0lHbWLQtIhrtCUMxKRJRQ0YGCAuUdWQJSvZnxz723ufz8Canb0u77q8ax3xn0Wl+Gbm+n7gDNAJtAX7N8A0cF3S7VKMLICZ7QCuAXtqinwEXJD0MmWXBDCzPmAUWNNiBz8DxyVNxfZNAGa2E5j5h+CNmJ+ADkmvqiB/AYSePwN2ZzJ/H943ZPQPJB0uAZwAbiSc7wCDkl64LlR5BehJ2HZLutd4jysYAU5HTm7cK+ln9d3MlgO3gCOR/VVJF3MAr4EtkcNeSd62JjGzDuBppJiTtC0H8ANYUXFYkLS2Zle+RYRYlLQ6B/AdWFUJuOTOkn5lKlgGLERJLUlamQOYBbZHwfok3cwAHAMmI928pPYcwBAwEDk46EFJH6Mhrwd8seKE/HycywF0AQ8T2c4Dl4C7QdcdvrcmbPslTSQBAsedekdLgy3onvhRlGQlgM2A0zK3rbn4X4F9krylfyR37JzfXmarIF+Ak5Lux+ilc+2V+NB7a9rlMxuQNJeyK/5wwkwOAGeB/cCmEOQt8BgYSWVd26KGgZntAmYl+YY3iZmtC3+8sfhWZYdcCT4IXAa8v07P58C7oN8Y/nR+Tf2UjAOnUiC5Ifv7YnQC6pjbI6mxJ2UWhd4PA+cBvzclcc47NQ9J+tAyi+rSbVX/G4RZsBnkowTSAAAAAElFTkSuQmCC"},368:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAjVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8DizOFAAAALnRSTlMAAQIDBAYOEBgiKyxFVV9ienuBkZKVoq6vs7S5ur/MztDR1dbZ4env8PP0+P3+wpkPNAAAALRJREFUGBmFwYcOgjAUBdCrBeree/EUXEXv/3+e5MWkUI2eg/9ai+t10cKHJGcpTxAaU40R2lPtERIqQUioBCGhEoSESlBjGhAqQcPAO26RUqXYHeEVDhuqDVwB78T2gGrQ5gnejJPmkqVlc8IZvM7Ddc1wtRqarnt0UDHlpYdS78IpquI1n4f5/PDkOkaNGd1Yuo0MQkm/KPoJvrnf8Smy1jpnrY1QE5/5do5RFWV8yyL89gJXDRtk/Nu5+QAAAABJRU5ErkJggg=="},369:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAkFBMVEUAAAD///////////////+Z/5n///////////////////////////////////////9R8XT///////////////////////////////////////9I8G3////////////////////////////////////////////////////////////////////////////////9remcAAAAL3RSTlMAAQIDBAUGDhAYIissRVVfbnp7gZGSlaKus7S5ubq/zM7Q0dXW2eHp7/Dz9Pj9/g05MZYAAAC1SURBVBgZhcEHDoJAFATQURDW3rGXr4Jlkbn/7SQ/Jgur0ffwX3txuy3a+BCnLKUxfBOqCXx7qj18QiXwCZXAJ1QCn1AJaoIGhErQCOCctjhSHbE7wckt1lRr2BzOmZ0h1bDDM5w5p80lS8vmlHM43afttUabzajVs88uKma89lHqXzlDVbRicUiSQ8FVhJpgfGfpPg7giwd5PojxzeOBT6ExxlpjTIiaKONbFqEqvPDtEuK3Fz2tHC6gD78OAAAAAElFTkSuQmCC"},370:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAnFBMVEUAAAD///+q/6r///////+Z/5n///////////////////////////////////9S8XZR8XVQ8XX///////////////////////////////9J8G7///9L8XD///9I8G3///////////////////////9J8G5J8G5K8G5K8G////////////////////////////////////8/72b////JX9JrAAAAMnRSTlMAAQMDBAUGDhAYIissRVVqa216e4GRkpWis7m5urq8v8zR1dbZ2tzc3eHp7/Dz9Pj9/gz0LfIAAAC6SURBVBgZhcEHEoIwEAXQryDEXrEX7FEg6O797yaz40wgOvoe/mvOk2TexIfwxIVTCNeYxRiuHYsdXFcSF7g0CQ2XJqHh0iQ0KrwaNAmNmgdrv8KZxBmbPazcYEtiC5PDOnCrT2LQ4gOsKU/qayqs6xOewmo/TKcxXC6HjY55tFES8b2LQvfOEcqCBT/j2Sx+8iJAhTdKuZCOPLjCXp73QnyTZfjkK6WMUUr5qAhu/HYLUOYf+e3o47cXpVkeKeaqKxgAAAAASUVORK5CYII="},371:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAmVBMVEUAAAD///+q/6r///////+Z/5n///////////////////////////////////9S8XZR8XVQ8XX///////////////////////////////9J8G7///9L8XD///9I8G1F8Gr///////////////////9J8G5J8G5K8G////////////////////////////////////8/72b////MZmusAAAAMXRSTlMAAQMDBAUGDhAYIissRVVqa216e4GRkpWis7m5urq8x8zR1dbZ2tzd4env8PP0+P3+wQRYnAAAALpJREFUGBmFwQcSgjAQBdCPIMSu2HtBCJagu/c/nMyOM4Ho6Hv4r7W4XhctfIjOXDpHcI1ZjOHak9jDlZHI4NIkNFyahIZLk9Co8T1oEhqeD+u4RkoixfYIqzDYkdjBFLBO3B6QGLb5BGvGk8aGSpvGhGewOg/TbY5Wq1Gzax4dVEz50kOpd+EpqsIlPw/z+eHJyxA1fnzj0i324Yr6RdGP8M39jk+BUsoYpVSAmjDntzxEVZDwWxLgtxf/sx2iIkNIcAAAAABJRU5ErkJggg=="},372:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAmVBMVEUAAAD///+q/6r///////+Z/5n///////////////////////////////////9S8XZR8XVQ8XX///////9P8nL///////////////////9J8G7///9L8XD///9I8G1F8Gr///////////////////9J8G5J8G5K8G////////////////////////////////////8/72b///+DMAvqAAAAMXRSTlMAAQMDBAUGDhAYIissRVVqa216gYiRkpWis7m5urq8x8zR1dbZ2tzd4env8PP0+P3+9B7C1gAAALpJREFUGBmFwQcSgjAQBdCPIMSu2HtBCJagu/c/nMyOM4Ho6Hv4r7W4XhctfIjOXDpHcE1ITODak9jDlZHI4NIkNFyahIZLk9Co8T1oEhqeD+u4RkoixfYIqzDYkdjBFLBO3B6QGLb5BGvG48aGSpvGmGewOg/TbY5Wq1Gzax4dVEz50kOpd+EpqsIlPw/z+eHJyxA1fnzj0i324Yr6RdGP8M39jk+BUsoYpVSAmjDntzxEVZDwWxLgtxf1pB2csnl/+QAAAABJRU5ErkJggg=="},373:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAn1BMVEUAAAD///+q/6r///////+Z/5n///////////9r8ob///////////////////////9S8XZR8XVQ8XX///////9Q8nT///////////////////9J8G7///9L8XD///9I8G1F72tG72v///////////////9J8G5J8G5K8G9G8Gz///////////////////////////////////8/72b///8BEpvzAAAAM3RSTlMAAQMDBAUGDhATGCIrLEVVamtteoGGkZKVorO5ubq6vMXFzNHV1trc3eHh6e/w8/T4/f51citoAAAAu0lEQVQYGYXBBxKCMBAF0K8gxoqCvVeINeju/c8ms+NMIDr6Hv5rTq/XaRMfGifKnRpwDUkM4dqS2MCVkkjh0iQ0XJqEhkuT0CjxKtAkNCoerP0CCYkEqz2szGBNYg2TwTpwq0ei3+IDrDEPqkvKLasDHsNqP0ynFs3nUa1jHm0UjPjSRa574RGKghk/d5PJ7smzACVefOPcLfbgqodZFtbxzf2OT75SyhillI+S4Mxv5wBF/pHfjj5+ewF0ux7dSdOXwQAAAABJRU5ErkJggg=="},374:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAnFBMVEUAAAD///+q/6r///////+Z/5n///////////9r8oZm7oj///////////////////9S8XZR8XVQ8XX///////9P8HP///////////9K8G////9J8G7///9L8XD///9I8G1G8Gv///////////////9J8G5J8G5K8G9F8Gz///////////////////////9H8Gz///////8/72b////gzZ6EAAAAMnRSTlMAAQMDBAUGDhATHiIrLEVVamtteoGHkZKVrbO5ubq6vMbM0dXW2tzd4eHp8PP0+Pn9/gzRgLkAAAC7SURBVBgZhcEHEoIwEAXQryDE3rtYAI0tqLv3v5vMjjOB4Oh7+K+1fDyWLVQ0z5Q7N+GakpjCtSexh+tE4gSXJqHh0iQ0XJqERolXgyahUfNgxRscSRyxjWFlBjsSO5gMVsLtAYlhmxNYc57UI8pF9QnPYXWeptsYrdejRtc8OyiY8bWHXO/KMxQFK34dFovDi1cBSrzxjXO3sQdX2M+yfohv7ndU+UopY5RSPkqCC39cAhT5KX+kPn57A9BBHkgIY7KNAAAAAElFTkSuQmCC"},375:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAk1BMVEUAAAD///////9/v3+//7////////////////////////////////////////////9S8XX///////////////////////////////////////9H8GxN8HD///////////////////////////////////////////////////////////////////////8/72b///+yOX0uAAAAL3RSTlMAAQMEBAQGDhAYIissRVVfbXp7gZGSlaKztLm6urq/zM7Q0dXW2eHp7/Dz9Pj9/pF1+DQAAAC2SURBVBgZhcEHDoJAFATQEQXW3nvBL1gXde5/OsmPycJq9D3815xfLvMmPsRHFo4xfCOqEXw7qh18QiXwCZXAJ1QCn1AJKoIahEpQC+AcVthT7bE9wMktllRL2BxOylafqt9iCmfKcX3zLGzqY07htO+20xis14NGx97bKJnw3EWhe+YEZdGCj2Q2Sx5cRKgIhlcWrsMAvriX570Y39xu+BQaY6w1xoSoiE58O0UoCzO+ZSF+ewGvmRyM7IpwUQAAAABJRU5ErkJggg=="},376:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAk1BMVEUAAAD///////9//3////+Z/5n///////////////////////////////////9T8XVR8XT///////////////////////////////////9I8G3///////9K8G7///////////////////////////////////////////////////////////////////8/72b///92MoCSAAAAL3RSTlMAAQMEBAUGDhAYIissRVVrbnp7gZGSlaKztLm5uru/zM7Q0dXW2eHp7/Dz9Pj9/jX+F5MAAAC2SURBVBgZhcEHDoJAFATQERHW3nvBL1gXde5/OsmPycJq9D3815xfLvMmPsRHFo4xfCOqEXw7qh18QiXwCZXAJ1QCn1AJKoIahEpQC+Ac1thT7bE5wMktllRL2BxOylb/qfotpnCmHNe3z8K2PuYUTvtuO43BajVodOy9jZIJz10UumdOUBYt+Ehms+TBRYSKYHhl4ToM4It7ed6L8c3thk+hMcZaY0yIiujEt1OEsjDjWxbitxep+hyEGOh1fQAAAABJRU5ErkJggg=="},377:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAllBMVEUAAAD///////9//3////+Z/5n///////////////////////////////////9S83ZU83ZQ8XX///////////////////////////////9J8G7///////9L8HBI8Gz///////////////////////////////////////////////////////////////////8/72b///+bZcbkAAAAMHRSTlMAAQMEBAUGDhAYIissRVVqam16e4GRkpWis7m5uru9v8zO0NHV1tnh6e/w8/T4/f5AQbNuAAAAt0lEQVQYGYXBBw6CQBQE0BER1t57Qb9dF2XufznJj8nCavQ9/FefXa+zOj7EJ+ZOMXxDqiF8CVUCn1AJfEIl8AmVwCdUgpKgAqESVAI4+yV2VDus9nBSi02mNrApnAMb3Uz1GjzAmXBUXWe5dXXECZzmw7Zq/cWiX2vZRxMFY17ayLUvHKMomvO5nU63T84jlASDG3O3QQBf3EnTToxv7nd8Co0x1hpjQpREZ76dIxSFR74dQ/z2AnF8HSubvLfMAAAAAElFTkSuQmCC"},378:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAllBMVEUAAAD///+q/6r///////+Z/5n///////////////////////////////////9S8XZR8XVQ8XX///////////////////////////////9J8G7///9L8XD///9I8G3///////////////////////////9J8G7///////////////////////////////////8/72b///+h1cuQAAAAMHRSTlMAAQMDBAUGDhAYIissRVVqa216e4GRkpWis7m5urq8v8zQ0dXW2drh6e/w8/T4/f6u3cT0AAAAt0lEQVQYGYXBBw6CQBQE0FEQ1t57wW8vizL3v5zkx2RhNfoe/qvPrtdZHR/iI3PHGL4h1RC+hCqBT6gEPqES+IRK4BMqQUlQgVAJKgGc3RKnTJ2w3sFJLTaZ2sCmcPZsdDPVa3APZ8JRdZXlVtURJ3CaD9uq9ReLfq1lH00UjHlpI9e+cIyiaM7ndjrdPjmPUBIMbszdBgF8cSdNOzG+ud/xKTTGWGuMCVESnfl2jlAUHvh2CPHbC16RHR5S91G1AAAAAElFTkSuQmCC"},379:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAmVBMVEUAAAD///+q/6r///////+Z/5n///////////////////////////////////9S8XZR8XVQ8XX///////////////////////////////9J8G7///9L8XD///9I8G3///////////////////////////9J8G5K8G////////////////////////////////////8/72b////7EXAcAAAAMXRSTlMAAQMDBAUGDhAYIissRVVqa216e4GRkpWis7m5urq8v8zQ0dXW2drd4env8PP0+P3+/xN+dwAAALhJREFUGBmFwYcOgjAUBdCrIBT33qtuxaK9//9xkheTQjV6Dv5LprfbNMGH+MjcMYZvQDGAb0OxgU9TaPg0hYZPU2j4NIVGSVDB2YozKgGc3QInK05Y7eBkBmsr1jAZnD3rHSu6de7hjDmsLm1uWR1yDKfxMM1abz7v1Zrm0UDBiNcWcq0rRyiKZnxuJ5Ptk7MIJUE/ZS7tB/DF7Sxrx/jmfsenUClljFIqREl04dslQlF44NshxG8v8ugdnOPneLsAAAAASUVORK5CYII="},380:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAmVBMVEUAAAD///+q/6r///////+Z/5n///////////////////////////////////9S8XZR8XVQ8XX///////////////////////////////9J8G7///9L8XD///9I8G3///////////////////////////9J8G5K8G////////////////////////////////////8/72b////7EXAcAAAAMXRSTlMAAQMDBAUGDhAYIissRVVqa216e4GRkpWis7m5urq8v8zQ0dXW2drd4env8PP0+P3+/xN+dwAAALlJREFUGBmFwYcOgjAUBdCrINS998C6cBXt/f+Pk7yYFKrRc/BffXa9zur4EB+ZO8bwDSmG8CUUCXyaQsOnKTR8mkLDl1qRoiSoILUiRSWAs1viZMUJ6x2czGBjxQYmg7Nno2tFr8E9nAlH1ZXNraojTuA0H6ZV6y8W/VrLPJooGPPSRq594RhF0ZzP7XS6fXIeoSQY3Ji7DQL44k6WdWJ8c7/jU6iUMkYpFaIkOvPtHKEoPPDtEOK3F/v9HaLAHfklAAAAAElFTkSuQmCC"},381:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAmVBMVEUAAAD///+q/6r///////+Z/5n///////////////////////////////////9S8XZR8XVQ8XX///////////////////////////////9J8G7///9L8XD///9I8G3///////////////////////////9J8G5K8G////////////////////////////////////8/72b////7EXAcAAAAMXRSTlMAAQMDBAUGDhAYIissRVVqa216e4GRkpWis7m5urq8v8zQ0dXW2drd4env8PP0+P3+/xN+dwAAALtJREFUGBmFwYcOgjAUBdCrrLoHuHAgrgpaoO//P07yYlKoRs/Bf711nq97+BBcqXYNYAuJhbAlxBLYUmIpbCmxFDapmYRNaibR4nQgNZPoODBOW9w0u2F/glEoHDQ7QBUwztSfaDbt0xnGkqLuTtd23YiWMAalGnqzOJ55Q1UO0LCgbITaKKMFmvwNVcfV6ljRxkeLM39Q7TF3YAvGRTEO8M3ziU+uEEIpIYSLFv9Ob3cfTe6F3i4ufnsBBbcdqHLgiBwAAAAASUVORK5CYII="},382:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAmVBMVEUAAAD///+q/6r///////+Z/5n///////////////////////////////////9S8XZR8XVQ8XX///////////////////////////////9J8G7///9L8XD///9I8G3///////////////////////////9J8G5K8G////////////////////////////////////8/72b////7EXAcAAAAMXRSTlMAAQMDBAUGDhAYIissRVVqa216e4GRkpWis7m5urq8v8zQ0dXW2drd4env8PP0+P3+/xN+dwAAALxJREFUGBmFwQsTgUAUBtAvpZaIEPLIo1iPNvb+/x+nuWNmaxnOwX+95e227OFDcKLaKYBtSmwK247YDrYDsQNsUjMJm9RMwiY1k2hxHUjNJBwXxnGNs2ZnbI8wKoVMswyqgpFTf6TZuE85jDnNOhtd23RmNIcRPtSgG69WcXegHiEaEroOURteKUGTn9Jzv1jsn5T6aHEnd6rdJy5sQVRVUYBvyhKfPCGEUkIIDy3+hd4uPpq8gt4KD7+9AA/4Ha7O8FpQAAAAAElFTkSuQmCC"},383:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAGVElEQVR4Xu2cPWwcRRTH/2/WNhSkCMbQEAQEEoNEw0cDKeK7C4gGpQCUCCQkRPjwrQ0FJHwIYqOIiECB7DsDsSgiIYiAIqJBkDs7RaAB0wExKIDiNMQYJAIS2N55aPfuzNk+cju7s7Nrea69N+/N+83b+XjzQbA/IwTIiBVrBBa0oSCwoC1oQwQMmbERbUEbImDIjI1oC9oQAUNmbERb0IYIGDJjI3o9g+aR7Vd6wtlGRL1g3kqE68G4FIQNYGwI2BDOg3EehN+Y8QOIppn5lCO9kzR44qwhfqHNZCKieT/EYk9fnyDnXmLOMbAltActBAn4nokmJHsfdcxOTtIwZBx9OsqmCtqPXIjOfoZ8kIFNOhxaqYOAGYJ4F3JhLM1ITwU0j+Q2SxL7AH4IhK4kAK/SyZgH6Ihg+SoNTpw2YrPJiFHQXN5+CajjJSn5KQCdpp2t21sQgt4AL75MxRN/mqqDMdA8tuMeZi4xcyJdhCowIpohIpf6j3+sWjaKfOKg+YP7uuS5udd9p5izlf8mAvuNLy7vfpru/3A+CsCwZRIF7Q92TOIYE90StkJpyBHzFLHcmeRgmRhofvvOXrngfQrgqjTgRbB5RnQ6d9Fjn52KULZtkURAz5fztzmMTwB0t61BtgTmPMLdXcXql7qrpR10PZJPrkHIDbZzotPZpjuytYL2+2QpnM/XUHfxf4F7RkjvDp19tjbQ/uyCf5n7IusDX9guIRggr+i+XddsRBtor5QbAWggrCMR5P4QRIcAnKuX7WaWexm0MYKukEV41HEnBkMKX1BMC+jaYkQeS3SeTDTsFCtDzd545dyzYDqoA0QrHf48m0js1LGoiQ3aX1YzOr5NfMXHNOgMVEabgXAp94gEjScF2tcbrCCxeGPc5Xp80GOFQ1LyM0k6G+hOCbRvWgh6jfore+P4GAt0kIUT9J2RBFGKoAEsCMk3xMn6xQLtjRYOg3hPnJYOXTZd0H4fMu4UK4+Gru8KwciggzkzOafN5ZPT6aOXeDHmBXubo86to4Mu7XhFQj4XtYWVy6Ud0X5fDXGQ3OPPK9c92OKM8PP3+Lgn/3NS208tq5QB0MG22Gz16ih7kJFAL5T68gKiEqGNohfJAGi/8hKy0OlOVlUdiQTaKxfeBPPjqsZiyWcENIjecoqVJ1R9iQRalvLTcY8EqFY0zXl0c139owzCrW5Vrb8y6HqGbkbVUGz5rES0PyhKb5Pq7EMZ9GIpv4uA92ODU1WQIdAM7O5wq0dVXFAGzeXCkGTer2JEi2yGQAuiYVqR4GrnozJor5T3o3lXO8Xa/88QaABHHbe6W8XHKKCnANysYkSLbLZAf+24VaWdfWXQspT/kYFrtMBTUZIh0AT8JNzqtSrVVwddzs8y4zIVI1pkswSa8KsoVntU/FIHXcr/zcBFKka0yGYJNPCPcKsXq/hlQavQqsuSEdC26wAZ6jrsYGhoMPyKGUpTmwhf5+oiWeqjCVOiWL1VxS/lPtouWAK8BhYs5cIQ1vkSHC3OmLSLbuWITiupJJgGacW5jsWR3B4SdLidk7r/N5NUqh1kNJ8mBb/nuBMPNEPzSvl3ADysG2Q7fUbSpH4lUkn81zY4vwEwWwfRzcBN7aDo/t9Y4t+veCpbWbqJRdVncisrlc3ZqGA0lzO6OZvKcQPNwKKoM37cwK8kmz5AE4WM5jLGD9AEoE0fCQNSOIj+X0v5iSSS3nWqm7INDcrz6GXTK5OHHFM4iL7sg2AadwZSOORYi2p7bDds7xQrogPY9iB6KNbxQdurFWZA16LawGWhFNKkmbos1GjOpK+/CdABcisvNocPl3MvSKYDoUIqklDGrr8FUZ38hc6/AIwI0NI9Qwn5JEC1x6w0/zJ7oXNpbm2vKLds8tiD4Uqt9tJ9609LO2jfjH1GYjXsREAH3Yh9GGUZ7cRAN/ps+9RPjXeioBuzEft4lQHQje8na8+xATgrhCjqeLkgzMwy8YhevsCwDwyGaRRtMkHWzxH7IA0/mSnoiPDWwZOZq+bc9hFYbcEbSpF91jgUJv1CjYe6HaJeyexfntxCwMZWD3Uz8Dv8S5ZE0559qFt/Y6w1jUZnHWsNjs76WtA6aV5AlwVtQRsiYMiMjWgL2hABQ2ZsRFvQhggYMmMj2oI2RMCQGRvRhkD/C6aEaIjDMHoSAAAAAElFTkSuQmCC"},4:function(e,t,n){var r=window.emedia=window.emedia||{},i=r.util=n(7),o=n(19);if(r.config=function(e){for(var t in e=i.extend({},e))r.config[t]=e[t],"logLevel"===t&&(r.LOG_LEVEL=e[t]);r.config.loglastConfrCount&&!r._logContext&&(r._logContext=new Array(r.config.loglastConfrCount),r._logContextIndex=-1)},r.config({autoSub:!0,onlyEnter:!1,reconnect:13,reconnectDelay:3e3,getCopyIntervalMillis:3e4,checkConnectIntervalMillis:1e3,iceRebuildCount:3,iceRebuildIntervalMillis:500,enterTimeout:2e4,useRTCCfgIfServerReturn:!1,forceUseRTCCfgIfServerReturnWhenP2P:!0,allowRepeatAudioMixerPublish:!1,logVolumeWhenInstantGE:.5,getMediaMeterIntervalMillis:400,_useRequestAnimationFrame:!1,meterWithTrackAudioLevel:!1,judgeTalkingByInstantGE:.05,_printSoundData:!1,trackBufferSize:20,allowSendWhenLessThan:4,disableTrack:!1,ctrlCheckIntervalMillis:1e4,ctrlTimeoutMillis:3e4,_printDebugStats:!1,statsSeconds:10,remainLastStatsCount:120,loglastConfrCount:2,loglastStoreArray:!0,consoleLogger:!0,printStatsWhenPCClose:!0,rebuildPeerConnectionWhenNetworkChanaged:!0,useDeployMore:!1,useDTX:!0,uploadStats:!0,liveCfgs:[],rtcStatsTypeMath:function(e,t){switch(e.type){case"remote-candidate":case"local-candidate":case"track":case"stream":case"inbound-rtp":case"outbound-rtp":case"transport":return!0}return!1}}),i.logger.count(),function(){var e=n(259).default;if(r.browser=e.__browser,r.browserVersion=e.__browserVersion,void 0===r.browser)throw"Not discern browser. may require adapter error. eg. it.default"}(),i.logger.info("Current browser",r.browser,r.browserVersion),r.AudioContext=window.AudioContext||window.webkitAudioContext,r.config.getMediaMeterIntervalMillis){try{"function"===typeof r.AudioContext?(r.__audioContext=new r.AudioContext,r.__usingWebAudio=!0):r.__usingWebAudio=!1}catch(u){r.__usingWebAudio=!1}r.__usingWebAudio&&"suspended"===r.__audioContext.state&&o((function(){var e=function e(){"suspended"===r.__audioContext.state&&r.__audioContext.resume(),i.logger.warn("AudioContext state suspended ->",r.__audioContext.state),setTimeout((function(){"running"===r.__audioContext.state&&(document.body.removeEventListener("touchend",e,!1),document.body.removeEventListener("click",e,!1))}),0)};document.body.addEventListener("touchend",e,!1),document.body.addEventListener("click",e,!1)})),r.__usingWebAudio||console.warn("'new AudioContext()' failed. can not know who talking."),r.__audioContext&&"suspended"===r.__audioContext.state&&console.warn("audioContext.state is suspended. can not know who talking. You can resume() emedia.__audioContext, but only in response to a tap.")}if(window.requestAnimationFrame&&r.config._useRequestAnimationFrame?r.requestAnimationFrame=function(e){window.requestAnimationFrame(e)}:r.requestAnimationFrame=function(e,t){return setTimeout(e,t||r.config.getMediaMeterIntervalMillis)},window.cancelAnimationFrame&&r.config._useRequestAnimationFrame?r.cancelAnimationFrame=function(e){window.cancelAnimationFrame(e)}:r.cancelAnimationFrame=function(e){clearTimeout(e)},r.isWifi=function(){try{var e=!0,t=window.navigator.userAgent,n=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;if(/MicroMessenger/.test(t)){if(t.indexOf("WIFI")>=0)return!0;e=!1}else if(n){var r=n.type;"wifi"!==r&&"2"!==r&&"unknown"!==r&&(e=!1)}return e}catch(u){return!1}},r.stopAudioTracks=function(e){e&&e.getAudioTracks().forEach((function(t){t.stop(),i.logger.info("Media stream stop audio track. stream =",e.id,"track =",t.id,t.kind)}))},r.stopAndRemoveAudioTracks=function(e){var t=[];e&&e.getAudioTracks().forEach((function(n){n.stop(),t.push(n),i.logger.info("Media stream stop and remove audio tracks. stream =",e.id,"track =",n.id,n.kind)})),i.forEach(t,(function(t,n){e.removeTrack(n)}))},r.stopTracks=function(e){try{if(!e||!1===e.active)return void i.logger.debug("stream tracks had been stoped. it ",e&&e.id);e.getTracks().forEach((function(t){t.stop(),i.logger.info("Media stream stop track. stream =",e.id," track =",t.id,t.kind)})),e._bindAttendee&&(i.removeAttribute(e._bindAttendee._openedRtcMediaStreams,e.id),e._bindAttendee=null),i.logger.info("stream tracks stoped. it ",e.id)}catch(u){i.logger.error(u)}},r.enableVideoTracks=function(e,t){e&&e.getVideoTracks().forEach((function(n){if("function"===typeof n.enable)return n.enable(),i.logger.info("Media stream enable video track. stream =",e.id,"track =",n.kind,n.enabled,n.id),void(n.enabled===t||n.enable(t));n.enabled===t||(n.enabled=t),i.logger.info("Media stream enable video track. stream =",e.id,"track =",n.kind,n.enabled,n.id)}))},r.enableAudioTracks=function(e,t){e&&e.getAudioTracks().forEach((function(n){if("function"===typeof n.enable)return n.enable(),i.logger.info("Media stream enable audio track. stream =",e.id,"track =",n.kind,n.enabled,n.id),void(n.enabled===t||n.enable(t));n.enabled===t||(n.enabled=t),i.logger.info("Media stream enable audio track. stream =",e.id,"track =",n.kind,n.enabled,n.id)}))},r.hasEnabledTracks=function(e){if(!e||"function"!==typeof e.getAudioTracks)return!1;if(!e.active)return!1;var t=e.getAudioTracks();if(0===t.length)return!1;for(var n in t)if("function"===typeof t[n].enable&&t[n].enable(),t[n].enabled)return!0;return!1},r.genReportName=function(){var e=r._lastSetupDate||new Date;return(r._lastSetupTktId||r._lastSetupConfr)+"_"+r._lastSetupMemName+"_"+e.getTime()+".log"},r.getReportUploadUrl=function(e,t,n){var r=new XMLHttpRequest;r.open(e,t,!0),r.addEventListener("load",(function(e){n&&n(e)}),!1),r.send(null)},r.uploadReport=function(e,t,n,o,a,s){var c=r.genReport();if(c){"function"===typeof n&&(s=a,a=o,o=n,n=void 0);var d=new Blob([c],{type:"text/plain"}),u=new FormData;u.append(e,d,e),n&&"function"===typeof u.set&&i.forEach(n,(function(e,t){u.set(e,t)}));var l=new XMLHttpRequest;l.open("POST",t,!0),l.setRequestHeader("X-File-Name",e),s&&s(l),l.addEventListener("load",(function(n){console.info("log begin upload. result = ",n.currentTarget.status,e," > ",t),200===n.currentTarget.status?o&&o(n):a&&a(n)}),!1),l.send(u),console.info("log begin upload. ",e," > ",t)}else a&&a("not logs")},r.genReport=function(){if(r._logContext&&r._logContext instanceof Array&&!("undefined"===typeof r._logContextIndex||r._logContextIndex<0)){var e=0,t=r._logContextIndex;r._logContextIndex>=r._logContext.length&&(e=r._logContextIndex-r._logContext.length+1);for(var n="",i=e;i<=t;i++){var o=i%r._logContext.length;n+=r._logContext[o].join("\r\n")+"\r\n"}return r._logContext.loadlogs&&r._logContext.loadlogs instanceof Array&&(n+="-------------------------------------------------------------\r\n",n+=r._logContext.loadlogs.join("\r\n")+"\r\n"),n}},r.fileReport=function(e,t){var n=r.genReport();if(n){t&&(n="\u9047\u5230\u7684\u5f02\u5e38\u63cf\u8ff0\u5982\u4e0b\uff1a\r\n ".concat(t," \r\n ").concat(n));var i=encodeURIComponent(n),o=document.createElement("a");o.style.display="none",o.download=e||"emedia-"+(new Date).toJSON()+".log",o.href="data:text/plain;charset=utf-8,"+i,document.body.appendChild(o),o.click(),o.parentNode.removeChild(o)}},navigator.mediaDevices){var a=navigator.mediaDevices.getSupportedConstraints();i.logger.info("Supported constraints",a)}r.config({globalConstraints:{}});var s=n(261),c=n(34);r.Webrtc=n(174),r.Service=s,r.P2P=n(269),r.XService=s,r.XServiceWithP2P=r.P2P(s),r.mgr=n(488).outer,r.ctrl=n(271),r.CompositeCanvas=n(277),r.pannel||(r.pannel={}),r.pannel.DefaultMouseTrack=n(176),r.pannel.MouseTrack=n(140),r.pannel.KeyboardTrack=n(278);var d=r.PCStats=n(175);if(r.helper=r.helper||{},r.helper.PCStats=d,r.helper.pcstats=d.echo,r.helper.intervalPcstats=d.intervalEcho,r.helper.inboundAudio=d.inboundAudio,r.helper.inboundVideo=d.inboundVideo,r.helper.outboundAudio=d.outboundAudio,r.helper.outboundVideo=d.outboundVideo,r.event=c,r.LOG_LEVEL=0,r.isFirefox="firefox"===r.browser,r.isChrome="chrome"===r.browser,r.isSafari="safari"===r.browser,r.isEdge="edge"===r.browser,r.isElectron=/Electron/.test(navigator.userAgent),r.isElectron)try{n(279)}catch(u){i.logger.error(u)}r.youInSomeBrowsers=function(){if(r.isSafari){var e=new RegExp("(Version)/([0-9.]+)","i"),t=navigator.userAgent.match(e);if(null!=t){var n=unescape(t[2]);return(n=parseInt(n))<13}}return!1},r.replaceIpAndPortOfCandidate=function(e,t,n){var r="string"===typeof e?e:e.candidate;return r=r.replace(/(candidate:\d+\s+\d+\s+udp\s+\d+\s+)([\d\.]+)\s+(\d+)(\s+.*)/g,(function(e,r,i,o,a){return r+t+" "+n+a})),e.candidate?(e=i.extend(!0,{},e)).candidate=r:e=r,e},r.replaceIpAndPort=function(e,t){if("function"!==typeof t)return e;var n="string"===typeof e?e:e.candidate;return n=n.replace(/(candidate:\d+\s+\d+\s+udp\s+\d+\s+)([\d\.]+)\s+(\d+)(\s+.*)/g,(function(e,n,r,i,o){var a=t(r,i);return"string"===typeof a?n+(a=a.replace(":"," "))+o:n+r+" "+i+o})),e.candidate?(e=i.extend(!0,{},e)).candidate=n:e=n,e},r.replaceURL=function(e,t){return"function"!==typeof t?e:e.replace(/([^:\/?&#=]+):\/\/([^\/:?#]+)(:\d+)?(\/[^?#]*)?(\?[^\/#]*)?(#[^\/?]*)?/g,(function(n,r,i,o,a,s,c){o&&(o=o.substring(1));var d=t(n,r,i,o,a,s,c);if(!d)return e;if("string"===typeof d)return d;var u=d.protocol||r,l=d.host||i,f=d.port||o,m=d.path||a,p=d.query||s,h=d.fragment||c;return u+"://"+l+(f?":"+f:"")+(m||"")+(p||"")+(h||"")}))},r.requireTrustBeforeJoin=function(){return!1},r.isWebRTC=window.RTCPeerConnection&&/^https\:$/.test(window.location.protocol),(r.isChrome||r.isSafari)&&(r.supportPRAnswer=!0),r.supportPRAnswer=!1,r.config({baseAcptOps:[102,104,105,106,107,300,302,303,304,301,204,206,400,401,1001,100221,100222,100223,100224,100201,100202,100203]}),r.config({clientType:"WEB",version:"3.2.2",userAgent:navigator.userAgent,acptOps:[100230,100205,1003,1004]}),e.exports=r},487:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(5),a=n.n(o),s=n(37),c=n(38),d=n(48),u=n(46),l=n(213),f=n(65),m=(n(223),n(224),n(168)),p=(n(226),n(212)),h=n(44),v=(n(228),n(166)),g=n(20),_=(n(230),n(138)),b=(n(232),n(97)),A=n(64),y=(n(235),n(51)),S=(n(237),n(10)),w=(n(239),n(214)),C=(n(241),n(136)),k=(n(169),n(72)),I=(n(244),n(215)),x=(n(246),n(167)),E=(n(248),n(135)),R=(n(100),n(23)),T=n(12),M=n.n(T),P=(n(170),n(13)),O=n(18),D=(n(252),n(96)),N=(n(489),n(137)),j=(n(256),n(205)),B=(n(258),n(4)),U=n.n(B),L=n(202),V=n.n(L),F=n(92),G=n.n(F);function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET";return new Promise((function(r,i){("GET"===n?G.a.get(e,{params:t}):G.a.post(e,t)).then((function(e){r(e.data)})).catch((function(e){P.a.error("\u8bf7\u6c42\u51fa\u9519\u4e86: "+e.message),i(e)}))}))}var W="easemob-demo#chatdemoui",Q="https://a1.easemob.com",X=W.split("#")[0],z=W.split("#")[1],H="".concat(Q,"/").concat(X,"/").concat(z,"/users"),Y="".concat(Q,"/").concat(X,"/").concat(z,"/token"),J=function(e){return q(H,e,"POST")},K=function(e){return q(Y,e,"POST")};var Z=(new function(){var e=this;this.user={},this.get_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},this.register=Object(O.a)(M.a.mark((function t(){var n,r,i;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={username:e.get_uuid().split("-").join(""),password:"123456"},t.next=3,J(n);case 3:(r=t.sent).entities&&r.entities[0]&&r.entities[0].activated&&(i={username:n.username,password:n.password},e.user=i,window.sessionStorage.setItem("easemob-user",JSON.stringify(e.user)));case 5:case"end":return t.stop()}}),t)}))),this.login=Object(O.a)(M.a.mark((function t(){var n,r,i;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={grant_type:"password",username:e.user.username,password:e.user.password,timestamp:(new Date).getTime()},t.next=3,K(n);case 3:if((r=t.sent).access_token){t.next=6;break}return t.abrupt("return");case 6:return i={username:r.user&&r.user.username,token:r.access_token,uuid:r.user&&r.user.uuid},t.abrupt("return",i);case 9:case"end":return t.stop()}}),t)}))),this.init=Object(O.a)(M.a.mark((function t(){var n,r;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.user=JSON.parse(window.sessionStorage.getItem("easemob-user")),e.user&&e.user.username&&e.user.password){t.next=10;break}return t.next=4,e.register();case 4:return t.next=6,e.login();case 6:return n=t.sent,t.abrupt("return",n);case 10:return t.next=12,e.login();case 12:return r=t.sent,t.abrupt("return",r);case 14:case"end":return t.stop()}}),t)})))}).init;function $(e,t){j.a[e]({message:t,placement:"bottomRight",className:"openNotification"})}var ee=n(337),te=function(e){if(e){var t=ee.resolve("./".concat(e,".png"));return n(t)}},ne=function(e){var t=function(e){return e.slice(0,4)+"****"+e.slice(-4)};return!e.nickName||e.nickName.split("_")[1]?t(e.name.split("_")[1]):e.nickName.length<15?e.nickName:t(e.nickName)},re=N.a.Item,ie=D.a.Header,oe=D.a.Content,ae=D.a.Footer,se=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={checked_talker:null,show:!1},e.show=function(t){e.handle_apply_talker_callback=t,e.setState({show:!0})},e.hide=function(){e.setState({show:!1,checked_talker:null})},e.onChange=function(t){e.setState({checked_talker:t.target.value})},e.confirm=Object(O.a)(M.a.mark((function t(){var n,r;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props.user_room,r=e.state.checked_talker,t.prev=2,t.next=5,U.a.mgr.grantRole(n,[r],1);case 5:e.handle_apply_talker_callback&&"function"==typeof e.handle_apply_talker_callback&&e.handle_apply_talker_callback(),e.hide(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),P.a.error("\u9009\u4eba\u4e0b\u9ea6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");case 12:case"end":return t.stop()}}),t,null,[[2,9]])}))),e}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.stream_list,t=this.state,n=t.show,r=t.checked_talker;return i.a.createElement(I.a,{placement:"left",closable:!1,visible:n,mask:!1,getContainer:!1,width:"336px",className:"to-audience-list",destroyOnClose:!0},i.a.createElement("div",{className:"title"},i.a.createElement(R.a,{style:{background:"transparent",color:"#fff"},onClick:this.hide},"\u8fd4\u56de"),i.a.createElement("span",{style:{textAlign:"center"}},"\u4e3b\u64ad\u4eba\u6570\u5df2\u6ee1",i.a.createElement("br",null),"\u53ef\u9009\u62e9\u66ff\u6362\u4e3b\u64ad"),i.a.createElement(R.a,{onClick:this.confirm},"\u786e\u5b9a")),i.a.createElement(x.a.Group,{onChange:this.onChange,value:r,name:"to-audience"},e.map((function(e){if(e&&e.member&&!e.member.is_me&&e.stream.type!=U.a.StreamType.DESKTOP){var t=e.member.ext&&e.member.ext.headImage;return i.a.createElement("div",{className:"info-wrapper",key:e.member.name},i.a.createElement(E.a,{src:"https://download-sdk.oss-cn-beijing.aliyuncs.com/downloads/RtcDemo/headImage/"+t}),i.a.createElement("span",{className:"name"},ne(e.member)+(7==e.member.role?"(\u4e3b\u6301\u4eba)":"")),i.a.createElement(x.a,{value:e.member.name}))}}))))}}]),n}(r.Component),ce=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={mute_all:!1},e.mute_all_action=Object(O.a)(M.a.mark((function t(){var n;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props.user_room.confrId,t.next=3,U.a.mgr.muteAll(n);case 3:e.setState({mute_all:!0});case 4:case"end":return t.stop()}}),t)}))),e.unmute_all_action=Object(O.a)(M.a.mark((function t(){var n;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props.user_room.confrId,t.next=3,U.a.mgr.unmuteAll(n);case 3:e.setState({mute_all:!1});case 4:case"end":return t.stop()}}),t)}))),e}return Object(c.a)(n,[{key:"render",value:function(){var e=this.state.mute_all;return i.a.createElement(k.a,{title:e?"\u89e3\u9664\u9759\u97f3":"\u5168\u4f53\u9759\u97f3",placement:"left"},e?i.a.createElement("img",{className:"mute-action",src:te("mute-all-icon"),onClick:this.unmute_all_action}):i.a.createElement("img",{className:"mute-action",src:te("unmute-all-icon"),onClick:this.mute_all_action}))}}]),n}(r.Component),de=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).mute=function(){var t=e.props.user_room.confrId,n=e.props.member.id;U.a.mgr.muteBymemberId(t,n)},e.unmute=function(){var t=e.props.user_room.confrId,n=e.props.member.id;U.a.mgr.unmuteBymemberId(t,n)},e.more_action=function(t){var n=t.key;"appoint_as_admin"==n?e.appoint_as_admin():"move_out"==n&&e.move_out()},e.appoint_as_admin=Object(O.a)(M.a.mark((function t(){var n,r,i,o;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props.user_room,r=e.props.member,i=r.memName,o=(o=r.nickName)||i,n&&i){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,t.next=8,U.a.mgr.grantRole(n,[i],7);case 8:P.a.success("\u5df2\u628a".concat(o,"\u8bbe\u4e3a\u4e3b\u6301\u4eba")),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),P.a.error("\u8bbe\u4e3a\u4e3b\u6301\u4eba\u5931\u8d25");case 14:case"end":return t.stop()}}),t,null,[[5,11]])}))),e.move_out=function(){var t=e.props.user_room,n=e.props.member.memName;t&&n&&U.a.mgr.kickMembersById(t,[n])},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t=this.props.stream.aoff,n=this.props.member.role,r=i.a.createElement(C.a,{onClick:this.more_action},i.a.createElement(C.a.Item,{key:"appoint_as_admin"},"\u8bbe\u4e3a\u4e3b\u6301\u4eba"),i.a.createElement(C.a.Item,{key:"move_out"},"\u79fb\u51fa\u4f1a\u8bae"));return i.a.createElement("div",{className:"manage-talker-mask"},i.a.createElement("div",{className:"action",ref:"action-wrapper"},t?i.a.createElement(R.a,{size:"small",onClick:function(){return e.unmute()}},"\u89e3\u9664\u9759\u97f3"):i.a.createElement(R.a,{size:"small",onClick:function(){return e.mute()}},"\u9759\u97f3"),7!=n?i.a.createElement(w.a,{overlay:r,placement:"bottomLeft",trigger:["click"],getPopupContainer:function(){return e.refs["action-wrapper"]}},i.a.createElement(R.a,{size:"small"},"\u66f4\u591a")):""))}}]),n}(r.Component),ue=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={visible:!1,url_list:{},headimg_url_suffix:""},e.show=function(){e.setState({visible:!0})},e.handleCancel=function(){e.setState({visible:!1,headimg_url_suffix:""})},e.handleSubmit=function(){var t=e.state.headimg_url_suffix;e.props.headimg_change(t),e.setState({visible:!1})},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.get_url_json()}},{key:"get_url_json",value:function(){var e=Object(O.a)(M.a.mark((function e(){var t;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://download-sdk.oss-cn-beijing.aliyuncs.com/downloads/RtcDemo/headImage/headImage.conf",e.next=3,G()({method:"get",url:"https://download-sdk.oss-cn-beijing.aliyuncs.com/downloads/RtcDemo/headImage/headImage.conf"});case 3:t=e.sent,this.setState({url_list:t.data.headImageList});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"change",value:function(e){e&&this.setState({headimg_url_suffix:e})}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,r=t.url_list,o=t.headimg_url_suffix;return i.a.createElement(y.a,{title:"\u8bf7\u9009\u62e9\u5934\u50cf",visible:n,onOk:this.handleSubmit,onCancel:this.handleCancel,footer:null,getContainer:!1,className:"head-images-modal",width:"470px"},i.a.createElement("div",{className:"head-image-list"},Object.keys(r).map((function(t,n){return i.a.createElement("div",{className:"avatar-wrapper",key:n,onClick:function(){return e.change(r[t])}},i.a.createElement(E.a,{src:"https://download-sdk.oss-cn-beijing.aliyuncs.com/downloads/RtcDemo/headImage/"+r[t]}),o==r[t]?i.a.createElement("div",{className:"checked-mask"},i.a.createElement(S.a,{type:"check"})):"")}))),i.a.createElement("div",{className:"action"},i.a.createElement(R.a,{type:"primary",onClick:this.handleSubmit},"\u4fdd\u5b58\u5e76\u8fd4\u56de")))}}]),n}(r.Component),le=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={visible:!1,headimg_url_suffix:"",push_cdn:!1,cdn:"",rec:!1,recMerge:!1,join_as_audience:!1},e.show=function(){var t=e.props,n=t.push_cdn,r=t.cdn,i=t.rec,o=t.recMerge,a=t.join_as_audience;e.setState({visible:!0,push_cdn:n,cdn:r,rec:i,recMerge:o,join_as_audience:a})},e.handleCancel=function(){e.setState({visible:!1})},e.handleSubmit=function(){var t=e.state,n=t.headimg_url_suffix,r=t.cdn,i=t.push_cdn,o=t.rec,a=t.recMerge,s=t.join_as_audience;e.props._get_setting_values({headimg_url_suffix:n,cdn:r,push_cdn:i,rec:o,recMerge:a,join_as_audience:s}),e.setState({visible:!1}),window.sessionStorage.setItem("easemob-headimg_url_suffix",n)},e.headimg_change=function(t){t&&e.setState({headimg_url_suffix:t})},e.handleChange=function(t){var n=t.target,r="cdn"===n.name?n.value:n.checked,i=n.name;e.setState(Object(A.a)({},i,r))},e.get_headimg_url=function(){e.head_images.show()},e}return Object(c.a)(n,[{key:"componentWillReceiveProps",value:function(e){this.setState({headimg_url_suffix:e.headimg_url_suffix})}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,r=t.headimg_url_suffix,o=this;return i.a.createElement(y.a,{visible:n,onOk:this.handleSubmit,onCancel:this.handleCancel,destroyOnClose:!0,footer:null,getContainer:!1,className:"setting-modal",width:"470px"},i.a.createElement("form",{action:"",onSubmit:this.handleSubmit},i.a.createElement("div",{className:"avatar-wrapper "},i.a.createElement(E.a,{src:"https://download-sdk.oss-cn-beijing.aliyuncs.com/downloads/RtcDemo/headImage/"+r,onClick:this.get_headimg_url,className:"setting-avatar"}),i.a.createElement(ue,{ref:function(t){return e.head_images=t},headimg_change:this.headimg_change})),[{key:"push_cdn",text:"\u5f00\u542f\u63a8\u6d41 CDN"},{key:"cdn",text:"\u63a8\u6d41CDN\u5730\u5740"},{key:"rec",text:"\u5f00\u542f\u5f55\u5236"},{key:"recMerge",text:"\u5f00\u542f\u5f55\u5236\u5408\u5e76"},{key:"join_as_audience",text:"\u4ee5\u89c2\u4f17\u8eab\u4efd\u52a0\u5165\u4f1a\u8bae"}].map((function(e,t){var n=e.key,r=e.text;return"cdn"==n?i.a.createElement(b.a,{key:t,placeholder:r,name:n,value:o.state[n],onChange:o.handleChange,disabled:!o.state.push_cdn}):i.a.createElement(_.a,{key:t,checked:o.state[n],name:n,onChange:o.handleChange},r)})),i.a.createElement("div",{className:"join_as_audience_tips"},"\u52a0\u5165\u540e\u53ea\u80fd\u89c2\u770b\uff0c\u9700\u7533\u8bf7\u4e0a\u9ea6"),i.a.createElement("div",{className:"action"},i.a.createElement(R.a,{type:"primary",onClick:this.handleSubmit},"\u4fdd\u5b58\u5e76\u8fd4\u56de"))))}}]),n}(r.Component);function fe(e){var t=e.my_username,n=e.my_role,r=e.stream_list,o=e.user_room;if(3==n){return i.a.createElement("div",{className:"admin-change-handle",onClick:function(){P.a.success("\u4e3b\u6301\u4eba\u7533\u8bf7\u5df2\u53d1\u51fa\uff0c\u8bf7\u7b49\u5f85\u4e3b\u6301\u4eba\u540c\u610f"),U.a.mgr.requestToAdmin(o.confrId)}},"\u7533\u8bf7\u4e3b\u6301\u4eba")}if(7==n){var a=0;if(r.map((function(e){e&&e.member&&7==e.member.role&&e.stream.type!=U.a.StreamType.DESKTOP&&a++})),a<2)return"";var s=function(){var e=Object(O.a)(M.a.mark((function e(){var n;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return console.warn("ApplyAdmin username is required"),e.abrupt("return");case 3:return n=W+"_"+t,e.prev=4,e.next=7,U.a.mgr.grantRole(o,[n],3);case 7:P.a.success("\u60a8\u5df2\u7ecf\u53d8\u4e3a\u4e86\u4e3b\u64ad"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),P.a.error("\u53d8\u66f4\u4e3b\u64ad\u5931\u8d25");case 13:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(){return e.apply(this,arguments)}}();return i.a.createElement("div",{className:"admin-change-handle",onClick:s},"\u653e\u5f03\u4e3b\u6301\u4eba")}return""}window.addEventListener("offline",(function(){P.a.error("\u60a8\u7684\u7f51\u7edc\u94fe\u63a5\u65ad\u5f00\u4e86")})),window.addEventListener("online",(function(){return P.a.success("\u60a8\u7684\u7f51\u7edc\u94fe\u63a5\u6210\u529f")}));var me=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.network_status;e=void 0==e?2:e;return i.a.createElement("div",{className:"network-wrapper ".concat({0:"dis",1:"weak",2:""}[e])},i.a.createElement("div",{className:"network-item one ".concat(e>0?"high-light":"")}),i.a.createElement("div",{className:"network-item two ".concat(e>0?"high-light":"")}),i.a.createElement("div",{className:"network-item three ".concat(e>1?"high-light":"")}),i.a.createElement("div",{className:"network-item four ".concat(e>1?"high-light":"")}),i.a.createElement("div",{className:"icon"},i.a.createElement("span",{className:"line"})))}}]),n}(r.Component);function pe(e){var t=e.room_setting_modal_show,n=e.roomName,r=e.stream_list,o=e.user,a=e.user_room,s=o.username,c=a.role;return i.a.createElement("div",{className:"room-setting".concat(t?" open":"")},i.a.createElement("div",{className:"toast-title"},i.a.createElement("span",null,"\u4f1a\u8bae\u540d\u79f0"),i.a.createElement(S.a,{type:"close-circle",onClick:function(){return e.toggle_room_setting_modal()}})),i.a.createElement("div",{className:"text"},n),i.a.createElement("div",{className:"item-wrapper"},i.a.createElement("div",{className:"title"},"\u4e3b\u6301\u4eba"),function(){var e=[];return r.map((function(t){t&&t.member&&7==t.member.role&&t.stream.type!=U.a.StreamType.DESKTOP&&e.push(ne(t.member))})),e}().map((function(e,t){return i.a.createElement("div",{key:t,className:"text"},e)}))),i.a.createElement(fe,{my_username:s,stream_list:r,my_role:c,user_room:a}))}function he(e){var t=document.createElement("div");function n(){a.a.unmountComponentAtNode(t)&&t.parentNode&&t.parentNode.removeChild(t)}document.body.appendChild(t),a.a.render(i.a.createElement("div",{className:"toast"},i.a.createElement("div",{className:"toast-title"},i.a.createElement("span",null,"\u63d0\u793a"),i.a.createElement(S.a,{type:"close-circle",onClick:function(){return n()}})),i.a.createElement("div",{className:"text"}," \u9000\u51fa\u540e\u5c06\u7ed3\u675f\u4e92\u52a8\u767d\u677f "),i.a.createElement("div",{className:"handle"},i.a.createElement("span",{className:"leave",onClick:function(){return function(){var t=e.onOk;t&&"function"==typeof t&&(t(),n())}()}},"\u7ee7\u7eed\u9000\u51fa"),i.a.createElement("br",null),i.a.createElement("span",{className:"end",onClick:function(){return n()}},"\u53d6\u6d88"))),t)}function ve(e){var t=document.createElement("div");t.id="toast-msg",t.innerText=e,document.body.appendChild(t),setTimeout((function(){document.querySelector("#toast-msg")&&document.body.removeChild(document.querySelector("#toast-msg"))}),2e3)}var ge=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={visible:!1},r.handle_click=r.handle_click.bind(Object(g.a)(r)),r.handleCancel=r.handleCancel.bind(Object(g.a)(r)),r.handleOk=r.handleOk.bind(Object(g.a)(r)),r.onChange=r.onChange.bind(Object(g.a)(r)),r}return Object(c.a)(n,[{key:"handle_click",value:function(){this.setState({visible:!0})}},{key:"handleOk",value:function(){var e=this,t=this.state.msg;this.setState({confirmLoading:!0}),setTimeout((function(){e.setState({visible:!1,confirmLoading:!1}),U.a.fileReport("",t),y.a.success({title:"\u60a8\u7684\u4f1a\u8bae\u65e5\u5fd7\uff0c\u5df2\u7ecf\u4fdd\u5b58\u5230\u4e86\u672c\u5730",content:"\u8bf7\u6dfb\u52a0QQ\uff1a454374569, \u8fdb\u884c\u95ee\u9898\u53cd\u9988",okText:"\u77e5\u9053\u4e86"})}),500)}},{key:"handleCancel",value:function(){this.setState({visible:!1})}},{key:"onChange",value:function(e){var t=e.target.value;this.setState({msg:t})}},{key:"render",value:function(){var e=this.state,t=e.visible,n=e.confirmLoading,r=b.a.TextArea;return i.a.createElement("div",null,i.a.createElement(y.a,{title:"\u8bf7\u586b\u5199\u60a8\u9047\u5230\u7684\u95ee\u9898",visible:t,onOk:this.handleOk,confirmLoading:n,onCancel:this.handleCancel,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88"},i.a.createElement(r,{rows:4,onChange:this.onChange})),i.a.createElement("div",{className:"exception-feedback-action",onClick:this.handle_click},"\u95ee\u9898\u53cd\u9988"))}}]),n}(r.PureComponent),_e=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={visible:!1,sources:[],accessApproved:null,choosed_stream:null},e}return Object(c.a)(n,[{key:"show",value:function(e,t,n){this.setState({sources:e,accessApproved:t,accessDenied:n,visible:!0})}},{key:"hide",value:function(){this.setState({visible:!1,choosed_stream:null});var e=this.state.accessDenied;e&&"function"==typeof e&&e()}},{key:"choose",value:function(e){e&&this.setState({choosed_stream:e})}},{key:"share",value:function(){var e=this.state,t=e.accessApproved,n=e.choosed_stream;t&&n&&"function"==typeof t&&(t(n),this.setState({visible:!1,choosed_stream:null}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,r=t.sources,o=t.choosed_stream,a=[],s=[];r.map((function(e){e&&(/window/.test(e.id)?s.push(e):/screen/.test(e.id)&&a.push(e))}));var c=v.a.TabPane;return i.a.createElement(y.a,{title:"\u5171\u4eab\u5c4f\u5e55",visible:n,destroyOnClose:!0,mask:!1,maskClosable:!1,okText:"\u5206\u4eab",cancelText:"\u53d6\u6d88",closable:!1,onOk:function(){return e.share()},okButtonProps:{disabled:!o},onCancel:function(){return e.hide()},wrapClassName:"electorn-choose-desktop-media",getContainer:!1,width:600,style:{top:20}},i.a.createElement("div",null,"Electorn \u60f3\u8981\u5171\u4eab\u60a8\u5c4f\u5e55\u4e0a\u7684\u5185\u5bb9\u3002\u8bf7\u9009\u62e9\u4f60\u5e0c\u671b\u5171\u4eab\u54ea\u4e9b\u5185\u5bb9"),i.a.createElement(v.a,{defaultActiveKey:"1"},i.a.createElement(c,{tab:"\u60a8\u7684\u6574\u4e2a\u5c4f\u5e55",key:"1"},i.a.createElement("div",{className:"tab-content"},a.map((function(t,n){var r={};return o&&o.id==t.id&&(r={borderColor:"rgba(146, 210, 241, 0.7)"}),i.a.createElement("div",{className:"img-wrapper",onClick:function(){return e.choose(t)},style:r,key:n},i.a.createElement("img",{src:t.hxThumbDataURL}),i.a.createElement("div",{className:"name"}," ",t.name," "))})))),i.a.createElement(c,{tab:"\u5e94\u7528\u7a97\u53e3",key:"2"},i.a.createElement("div",{className:"tab-content"},s.map((function(t,n){var r={};return o&&o.id==t.id&&(r={borderColor:"rgba(146, 210, 241, 0.7)"}),i.a.createElement("div",{className:"img-wrapper",onClick:function(){return e.choose(t)},style:r,key:n},i.a.createElement("img",{src:t.hxThumbDataURL}),i.a.createElement("div",{className:"name"}," ",t.name," "))}))))))}}]),n}(r.PureComponent);function be(e){if(!e)return"";var t=window.location.href.split("?")[1];if(!t)return"";var n="";return t.split("&").map((function(t){var r=t.split("=")[0],i=t.split("=")[1];e==r&&(n=i)})),decodeURI(n)}var Ae=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).join_handle=function(e){e&&e.preventDefault();var t=Object(g.a)(r);r.props.form.validateFields((function(e,n){var r=n.roomName,i=n.nickName,o=n.audio,a=n.video;t.setState({roomName:r,audio:o,video:a,nickName:i},(function(){e||t.join()}))}))},r._get_setting_values=function(e){if(e){for(var t in e)r.setState(Object(A.a)({},t,e[t]));console.log("values",e),e.join_as_audience?r.setState({user_room:{role:1}}):r.setState({user_room:{role:3}})}},r._set_nickname=function(e){var t=r.state.user.username;r.setState({nickName:e||t},r.join_handle),r.state.is_localStorage_nickName_admin&&window.localStorage.setItem("easemob-nickName",e)},r.video_change=function(e){r.setState({video:e.target.checked})},r.close_audio=Object(O.a)(M.a.mark((function e(){var t,n;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.state.user_room.role,n=r.state.own_stream,1!=t){e.next=4;break}return e.abrupt("return");case 4:if(n){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,U.a.mgr.pauseAudio(n);case 8:r.setState({audio:!1});case 9:case"end":return e.stop()}}),e)}))),r.open_audio=Object(O.a)(M.a.mark((function e(){var t,n;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.state.user_room.role,n=r.state.own_stream,1!=t){e.next=4;break}return e.abrupt("return");case 4:if(n){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,U.a.mgr.resumeAudio(n);case 8:r.setState({audio:!0});case 9:case"end":return e.stop()}}),e)}))),r.audio_change=function(e){r.setState({audio:e.target.checked})},r.control_talker_list=function(){r.setState((function(e){return{talker_list_show:!e.talker_list_show}}))},r.close_talker_model=function(){r.setState({talker_is_full:!1})},r.state={roomName:be("roomName")||"",nickName:"",user:{},user_room:{role:3},own_stream:null,own_desktop_stream:null,own_member:null,time:0,stream_list:[null],talker_list_show:!1,audio:!0,video:!1,headimg_url_suffix:"",joined:!1,loading:!1,talker_is_full:!1,talker_full_btn_disable:!1,shared_desktop:!1,set_nickname_modal_show:!1,room_setting_modal_show:!1,cdn:"",push_cdn:!1,liveCfg:{cdn:"",layoutStyle:"GRID",canvas:{bgclr:0,w:640,h:480,fps:20,bps:12e5,codec:"H264"}},cdn_zorder:1,use_white_board:!0,white_board_url:"",white_board_is_created:!1,am_i_white_board_creator:!1,not_visible_arr:[],leaveConfirmModal_show:!1,prev_volumes:{},subed_v_els:{},join_btn_disable:!1,main_loading:!1,main_loading_text:""},r.toggle_main=r.toggle_main.bind(Object(g.a)(r)),r.join_handle=r.join_handle.bind(Object(g.a)(r)),r.talker_is_full_handle=r.talker_is_full_handle.bind(Object(g.a)(r)),r.leave=r.leave.bind(Object(g.a)(r)),r.toggle_audio=r.toggle_audio.bind(Object(g.a)(r)),r.toggle_video=r.toggle_video.bind(Object(g.a)(r)),r.apply_talker=r.apply_talker.bind(Object(g.a)(r)),r.apply_audience=r.apply_audience.bind(Object(g.a)(r)),r.stop_share_desktop=r.stop_share_desktop.bind(Object(g.a)(r)),r.share_desktop=r.share_desktop.bind(Object(g.a)(r)),r.toggle_room_setting_modal=r.toggle_room_setting_modal.bind(Object(g.a)(r)),r.confirm_destory_white_board=r.confirm_destory_white_board.bind(Object(g.a)(r)),r.create_white_board=r.create_white_board.bind(Object(g.a)(r)),r.talker_list_scroll=r.talker_list_scroll.bind(Object(g.a)(r),r.talker_list_scroll_stop.bind(Object(g.a)(r)),1e3)(),r.hide_leaveConfirmModal=r.hide_leaveConfirmModal.bind(Object(g.a)(r)),r.leave_handle=r.leave_handle.bind(Object(g.a)(r)),r.leave=r.leave.bind(Object(g.a)(r)),r}return Object(c.a)(n,[{key:"whetherCanUse",value:function(){navigator.userAgent.indexOf("Mobile")>-1?this.setState({join_btn_disable:!0}):U.a.isChrome||U.a.isElectron||U.a.isEdge||U.a.isSafari||this.setState({join_btn_disable:!0})}},{key:"join",value:function(){var e=Object(O.a)(M.a.mark((function e(){var t,n,r,i,o,a,s,c,d,u,l,f,m;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0,talker_is_full:!1}),t=this.state,n=t.roomName,r=t.nickName,i=t.headimg_url_suffix,o=t.push_cdn,a=t.cdn,s=t.rec,c=t.recMerge,d=this.state.user_room.role,u={roomName:n,password:n,role:d,config:{nickName:r,ext:{headImage:i},rec:s,recMerge:c}},o&&a&&((l=this.state.liveCfg).cdn=a,u.config.liveCfg=l),e.prev=5,e.next=8,U.a.mgr.joinRoom(u);case 8:if(f=e.sent,this.startTime(),this._set_config_to_localStorage(),this.setState({joined:!0,user_room:f}),window.location.hash="",f.role!=U.a.mgr.Role.AUDIENCE){e.next=15;break}return e.abrupt("return");case 15:this.publish(),e.next=26;break;case 18:if(e.prev=18,e.t0=e.catch(5),!/cause: -523|cause:-523/.test(e.t0.errorMessage)){e.next=23;break}return this.setState({talker_is_full:!0,loading:!1,talker_full_btn_disable:!0}),e.abrupt("return");case 23:m={"-530":"\u521b\u5efasession\u5931\u8d25","-531":"\u8bbe\u7f6e\u5e03\u5c40\u5931\u8d25","-532":"\u753b\u5e03\u4e0d\u80fd\u4e3a\u7a7a","-533":"\u5220\u9664session\u5931\u8d25","-534":"\u81ea\u5b9a\u4e49\u5f55\u5236\u5931\u8d25","-200":"\u53c2\u6570\u9519\u8bef"},P.a.error(m[e.t0.error]||e.t0.errorMessage||e.t0.message),this.setState({loading:!1});case 26:case"end":return e.stop()}}),e,this,[[5,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"talker_is_full_handle",value:function(){this.setState({join_as_audience:!0,user_room:{role:1}},this.join_handle)}},{key:"componentDidMount",value:function(){var e=Object(O.a)(M.a.mark((function e(){var t,n,r;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.whetherCanUse(),this.setState({loading:!0}),e.next=4,Z();case 4:t=e.sent,this.setState({loading:!1}),this.setState({user:t}),this.init_emedia_callback(),this.init_white_board(),n=this,window.onbeforeunload=function(e){e=window.event||e;n.state.am_i_white_board_creator&&(n.emit_white_board_is_destroyed(),n.destroy_white_board()),n.state.shared_desktop&&n.stop_share_desktop(),U.a.mgr.exitConference()},this._get_config_from_localStorage(),this._get_headimg_url_suffix_from_session(),be("roomName")&&(r=this,setTimeout((function(){r.join_handle()}),1e3));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){clearInterval(this.timeID)}},{key:"init_emedia_callback",value:function(){var e=this,t=this.state.user,n=t.username,r=t.token;U.a.config({restPrefix:"https://a1.easemob.com",appkey:W});var i=W+"_"+n;U.a.mgr.setIdentity(i,r),U.a.mgr.onStreamAdded=function(t,n){console.log("onStreamAdded >>>",t,n),e._on_stream_added(t,n)},U.a.mgr.onStreamRemoved=function(t,n){console.log("onStreamRemoved",t,n),e._on_stream_removed(n)},U.a.mgr.onMemberJoined=function(e){console.log("onMemberJoined",e),P.a.success("".concat(e.nickName||e.name," \u52a0\u5165\u4e86\u4f1a\u8bae"))},U.a.mgr.onMemberLeave=function(e,t,n){console.log("onMemberLeave",e,t,n),P.a.success("".concat(e.nickName||e.name," \u9000\u51fa\u4e86\u4f1a\u8bae"))},U.a.mgr.onConferenceExit=function(t,n){var r="\u6b63\u5e38\u6302\u65ad";t&&(r={0:"\u6b63\u5e38\u6302\u65ad",1:"\u6ca1\u54cd\u5e94",2:"\u670d\u52a1\u5668\u62d2\u7edd",3:"\u5bf9\u65b9\u5fd9",4:"\u7f51\u7edc\u539f\u56e0",5:"\u4e0d\u652f\u6301",6:"\u8d85\u65f6",10:"\u5176\u4ed6\u8bbe\u5907\u767b\u5f55",11:"\u4f1a\u8bae\u5173\u95ed",12:"\u88ab\u8e22\u51fa\u4e86\u4f1a\u8bae"}[t]),4==t&&n&&(r=function(e){return{"-9527":"\u5931\u8d25,\u7f51\u7edc\u539f\u56e0","-500":"Ticket\u5931\u6548","-502":"Ticket\u8fc7\u671f","-504":"\u94fe\u63a5\u5df2\u5931\u6548","-508":"\u4f1a\u8bae\u65e0\u6548","-510":"\u670d\u52a1\u7aef\u9650\u5236"}[e]}(n)),console.log("onConferenceExit",t,n),e.state.am_i_white_board_creator&&e.destroy_white_board(),e.state.shared_desktop&&e.stop_share_desktop(),P.a.warn(r,1,(function(){e.state.talker_is_full?e.setState({talker_full_btn_disable:!1}):window.location.reload()}))},U.a.mgr.onConfrAttrsUpdated=function(t){console.log("onConfrAttrsUpdated",t),e.confrAttrsUpdated(t)},U.a.mgr.onRoleChanged=function(t){e._on_role_changed(t)},U.a.mgr.onAdminChanged=function(t){t.memberId&&e.admin_changed(t)},U.a.mgr.onPubVideoTooMuch=Object(O.a)(M.a.mark((function t(){var n;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(P.a.warn("\u5df2\u8fbe\u5230\u6700\u5927\u89c6\u9891\u6570\uff0c\u53ea\u80fd\u5f00\u542f\u97f3\u9891"),!(n=e.state.own_stream)){t.next=5;break}return t.next=5,U.a.mgr.unpublish(n);case 5:e.setState({audio:!0,video:!1},e.publish);case 6:case"end":return t.stop()}}),t)}))),U.a.mgr.onPubDesktopTooMuch=function(){P.a.warn("\u5171\u4eab\u684c\u9762\u6570\u5df2\u7ecf\u8fbe\u5230\u6700\u5927"),e.stop_share_desktop()},U.a.mgr.onRequestToTalker=function(t,n,r){e.handle_apply_talker(t,n,r)},U.a.mgr.onRequestToTalkerReply=function(e){1==e&&P.a.error("\u7ba1\u7406\u5458\u62d2\u7edd\u4e86\u4f60\u7684\u4e0a\u9ea6\u7533\u8bf7")},U.a.mgr.onRequestToAdminReply=function(e){1==e&&P.a.error("\u7ba1\u7406\u5458\u62d2\u7edd\u4e86\u4f60\u7684\u4e3b\u6301\u4eba\u7533\u8bf7")},U.a.mgr.onRequestToAdmin=function(e,t,n){var r=e.memberId,i=e.nickName;r&&(0,y.a.confirm)({title:"\u662f\u5426\u540c\u610f".concat(i||r,"\u7684\u4e3b\u6301\u4eba\u8bf7\u6c42"),onOk:function(){return t(r)},onCancel:function(){return n(r)},cancelText:"\u62d2\u7edd",okText:"\u540c\u610f"})},U.a.mgr.onMuted=function(){P.a.warn("\u4f60\u88ab\u7ba1\u7406\u5458\u9759\u97f3\u4e86"),e.close_audio()},U.a.mgr.onUnmuted=function(){P.a.success("\u4f60\u88ab\u7ba1\u7406\u5458\u53d6\u6d88\u4e86\u9759\u97f3"),e.open_audio()},U.a.mgr.onMuteAll=function(){P.a.warn("\u7ba1\u7406\u5458\u542f\u7528\u4e86\u5168\u4f53\u9759\u97f3"),setTimeout(e.close_audio,500)},U.a.mgr.onUnMuteAll=function(){P.a.success("\u7ba1\u7406\u5458\u53d6\u6d88\u4e86\u5168\u4f53\u9759\u97f3"),e.open_audio()},U.a.mgr.onNetworkQuality=function(t,n){var r=e.state,i=r.stream_list,o=r.n_weak_ms_t,a=!1;i.map((function(r){if(r&&r.stream&&r.stream.id==t&&(r.stream.network_status!=n&&(a=!0,r.stream.network_status=n,console.log("onNetworkQuality change: sid=".concat(t,", status=").concat(n))),r.member&&r.member.is_me&&2!=n)){var i=(new Date).getTime();o?i-o>1e4&&(e.setState({n_weak_ms_t:i}),ve("\u60a8\u7684\u7f51\u7edc\u72b6\u6001\u4e0d\u4f73")):(e.setState({n_weak_ms_t:i}),ve("\u60a8\u7684\u7f51\u7edc\u72b6\u6001\u4e0d\u4f73"))}})),a&&e.setState({stream_list:i})},U.a.isElectron&&(U.a.chooseElectronDesktopMedia=function(t,n,r){e.choose_desktop_media&&e.choose_desktop_media.show(t,n,r)})}},{key:"init_white_board",value:function(){this.white_board=new V.a({restApi:"https://wbrtc.easemob.com",appKey:W})}},{key:"_on_role_changed",value:function(e){if(e){var t=this.state.user_room,n=t.role;t.role=e;var r=this;this.setState({user_room:t},(function(){return 1==n&&3==e?(r.setState({audio:!0},r.publish),void P.a.success("\u4f60\u5df2\u7ecf\u4e0a\u9ea6\u6210\u529f,\u5e76\u4e14\u63a8\u6d41\u6210\u529f")):3!=n&&7!=n||1!=e?void(3!=n||7!=e||P.a.success("\u4f60\u5df2\u7ecf\u662f\u4e3b\u6301\u4eba\u4e86")):(P.a.success("\u4f60\u5df2\u7ecf\u4e0b\u9ea6\u4e86,\u5e76\u4e14\u505c\u6b62\u63a8\u6d41"),void r.setState({join_as_audience:!0}))}));!function(){var t=r.state.user_room.joinId,n=r.state.stream_list;n.map((function(n){n&&n.member&&n.member.id==t&&(n.member.role=e)})),r.setState({stream_list:n})}()}}},{key:"confrAttrsUpdated",value:function(e){var t=e.filter((function(e){return"whiteBoard"==e.key}));if(t.length>0){var n=t[0],r=n.op,i=n.val;if("DEL"==r)return P.a.success("\u767d\u677f\u7ba1\u7406\u5458\u9500\u6bc1\u4e86\u767d\u677f"),void this.setState({white_board_is_created:!1});i=JSON.parse(i);var o=this.state.user.username;if(i.creator==o)return;P.a.success("\u6709\u4eba\u521b\u5efa\u4e86\u767d\u677f");var a=i,s=a.roomName,c=a.roomPswd,d=this.state.user,u={roomName:s,password:c,userName:d.username,token:d.token};this.setState({join_white_board_params:u,talker_list_show:!0},this.join_white_board)}}},{key:"_get_nickname_from_session",value:function(){var e=window.localStorage.getItem("easemob-nickName"),t=window.localStorage.getItem("easemob-nickName-used");return e?"true"==t?void 0:(window.localStorage.setItem("easemob-nickName-used",!0),void this.setState({is_localStorage_nickName_admin:!0,nickName:e})):(window.localStorage.setItem("easemob-nickName-used",!0),void this.setState({is_localStorage_nickName_admin:!0}))}},{key:"_get_config_from_localStorage",value:function(){var e=window.localStorage.getItem("em-meeting-config");for(var t in console.log("config",e),e=JSON.parse(e))this.setState(Object(A.a)({},t,e[t]))}},{key:"_set_config_to_localStorage",value:function(){var e=this.state,t={nickName:e.nickName,audio:e.audio,video:e.video};window.localStorage.setItem("em-meeting-config",JSON.stringify(t))}},{key:"_get_headimg_url_suffix_from_session",value:function(){var e=window.sessionStorage.getItem("easemob-headimg_url_suffix");e||(e="Image1.png"),this.setState({headimg_url_suffix:e})}},{key:"hide_leaveConfirmModal",value:function(){this.setState({leaveConfirmModal_show:!1})}},{key:"get_leaveConfirmModal",value:function(){if(!this.state.leaveConfirmModal_show)return"";var e=this.state.user_room.confrId;return i.a.createElement("div",{className:"leave-confirm-modal"},i.a.createElement("div",{className:"toast-title"},i.a.createElement("span",null,"\u8b66\u544a"),i.a.createElement(S.a,{type:"close-circle",onClick:this.hide_leaveConfirmModal})),i.a.createElement("div",{className:"text"},"\u5982\u679c\u60a8\u4e0d\u60f3\u7ed3\u675f\u4f1a\u8bae",i.a.createElement("br",null),"\u8bf7\u5728\u79bb\u5f00\u4f1a\u8bae\u524d\u6307\u5b9a\u65b0\u7684\u4e3b\u6301\u4eba"),i.a.createElement("div",{className:"handle"},i.a.createElement("span",{className:"leave",onClick:this.leave},"\u79bb\u5f00\u4f1a\u8bae"),i.a.createElement("br",null),i.a.createElement("span",{className:"end",onClick:function(){return U.a.mgr.destroyConference(e)}},"\u7ed3\u675f\u4f1a\u8bae")))}},{key:"leave_handle",value:function(){7==this.state.user_room.role?this.setState((function(e){return{leaveConfirmModal_show:!e.leaveConfirmModal_show}})):window.confirm("\u786e\u5b9a\u9000\u51fa\u4f1a\u8bae\u5417\uff1f")&&this.leave()}},{key:"leave",value:function(){var e=this.state,t=e.am_i_white_board_creator,n=e.shared_desktop;t&&(this.emit_white_board_is_destroyed(),this.destroy_white_board()),n?y.a.info({title:"\u60a8\u8fd8\u5728\u5171\u4eab\u684c\u9762\uff0c\u8bf7\u5148\u505c\u6b62\u5171\u4eab\u684c\u9762"}):setTimeout(U.a.mgr.exitConference,300)}},{key:"publish",value:function(){var e=this.state,t=e.audio,n=e.video,r={audio:t,video:n};t||n||(r={audio:!0});var i=this;Object(O.a)(M.a.mark((function e(){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.a.mgr.publish(r);case 3:e.sent,$("success","\u53d1\u5e03\u6d41\u6210\u529f"),t||n||i.close_audio(),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("\u53d1\u5e03\u6d41\u5931\u8d25",e.t0),$("error","\u53d1\u5e03\u6d41\u5931\u8d25"),-201==e.t0.error&&$("error","\u8bf7\u68c0\u67e5\u6444\u50cf\u5934\u6216\u9ea6\u514b\u98ce\u662f\u5426\u88ab\u5141\u8bb8");case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))()}},{key:"apply_talker",value:function(){var e=this.state.user_room.confrId;P.a.success("\u4e0a\u9ea6\u7533\u8bf7\u5df2\u53d1\u51fa\uff0c\u8bf7\u7b49\u5f85\u4e3b\u6301\u4eba\u540c\u610f"),U.a.mgr.requestToTalker(e)}},{key:"handle_apply_talker",value:function(e,t,n){var r=e.memberId,i=e.nickName;if(r){var o=y.a.confirm;o({title:"\u662f\u5426\u540c\u610f".concat(i||r,"\u7684\u4e0a\u9ea6\u8bf7\u6c42"),onOk:function(){return t(r,s)},onCancel:function(){return n(r)},cancelText:"\u62d2\u7edd",okText:"\u540c\u610f"});var a=this,s=function(){o({title:"\u4e3b\u64ad\u4eba\u6570\u5df2\u6ee1\uff0c\u8bf7\u9009\u4eba\u4e0b\u9ea6",cancelText:"\u53d6\u6d88",okText:"\u786e\u5b9a",onOk:function(){a.to_audience_list.show((function(){return t(r)}))},onCancel:function(){return n(r)}})}}}},{key:"apply_audience",value:function(){var e=Object(O.a)(M.a.mark((function e(){var t,n,r,i,o,a,s,c;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.stream_list,r=t.am_i_white_board_creator,i=t.shared_desktop,!r){e.next=4;break}return P.a.warn("\u5f53\u524d\u60a8\u6b63\u5728\u5171\u4eab\u767d\u677f\uff0c\u8bf7\u9000\u51fa\u767d\u677f\u540e\uff0c\u518d\u4e0b\u9ea6"),e.abrupt("return");case 4:if(1!=n.filter((function(e){return e})).length){e.next=7;break}return P.a.warn("\u5f53\u524d\u60a8\u662f\u552f\u4e00\u4e3b\u64ad\uff0c\u4e0d\u5141\u8bb8\u4e0b\u9ea6"),e.abrupt("return");case 7:if(o=this.state.user.username,a=this.state.user_room.confrId,o){e.next=11;break}return e.abrupt("return");case 11:s=W+"_"+o,c=this,y.a.confirm({title:"\u4e0b\u9ea6\u540e\u4e0d\u80fd\u53d1\u5e03\u8bed\u97f3\u89c6\u9891",okText:"\u786e\u8ba4\u4e0b\u9ea6",cancelText:"\u53d6\u6d88",onOk:function(){var e=Object(O.a)(M.a.mark((function e(){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.a.mgr.degradeRole(a,[s],U.a.mgr.Role.AUDIENCE);case 3:i&&c.stop_share_desktop(),e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}()});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reset_state",value:function(){this.setState({shared_desktop:!1,room_setting_modal_show:!1})}},{key:"admin_changed",value:function(e){if(e){var t=e.memberId,n=e.role,r=this.state.stream_list;r.map((function(e){if(e&&e.member&&t==e.member.id){e.member.role=n;var r=e.member.nickName||e.member.name,i=7==n?"\u6210\u4e3a\u4e86\u4e3b\u6301\u4eba":"\u53d8\u6210\u4e86\u4e3b\u64ad";P.a.success(r+i)}})),this.setState({stream_list:r})}}},{key:"toggle_main",value:function(e){var t=this._check_has_shared();if(t)P.a.warn("".concat("desktop"==t?"\u6709\u4eba\u5728\u5171\u4eab\u684c\u9762\uff0c\u4e0d\u53ef\u5207\u6362\u5927\u56fe":"\u6709\u4eba\u5728\u5171\u4eab\u767d\u677f\uff0c\u4e0d\u53ef\u5207\u6362\u5927\u56fe"));else{var n=this.state.stream_list,r=n.splice(e,1)[0];n.unshift(r),this.setState({stream_list:n},this.move_v_els)}}},{key:"upload_stream_by_id",value:function(e,t){if(e==this.state.own_stream.id){var n=Object.assign(this.state.own_stream,t);this.setState({own_stream:n})}var r=this.state.stream_list;r.map((function(n){n&&n.stream&&n.stream.id==e&&Object.assign(n.stream,t)})),this.setState({stream_list:r})}},{key:"toggle_video",value:function(){var e=Object(O.a)(M.a.mark((function e(t){var n,r,i,o,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.user_room.role,r=this.state.own_stream,1!=n){e.next=4;break}return e.abrupt("return");case 4:if(r){e.next=6;break}return e.abrupt("return");case 6:if(!(i=this.state.video)){e.next=14;break}return e.next=10,U.a.mgr.pauseVideo(r);case 10:i=!i,this.setState({video:i}),e.next=20;break;case 14:return t&&((o=t.target).style.cursor="wait"),e.next=17,U.a.mgr.resumeVideo(r);case 17:o&&(o.style.cursor="pointer"),i=!i,this.setState({video:i});case 20:a=r.id,this.upload_stream_by_id(a,{voff:i?0:1});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"toggle_audio",value:function(){var e=Object(O.a)(M.a.mark((function e(){var t,n,r;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.user_room.role,n=this.state.own_stream,1!=t){e.next=4;break}return e.abrupt("return");case 4:if(n){e.next=6;break}return e.abrupt("return");case 6:if(!(r=this.state.audio)){e.next=14;break}return e.next=10,U.a.mgr.pauseAudio(n);case 10:r=!r,this.setState({audio:r}),e.next=18;break;case 14:return e.next=16,U.a.mgr.resumeAudio(n);case 16:r=!r,this.setState({audio:r});case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"share_desktop",value:function(){var e=Object(O.a)(M.a.mark((function e(){var t,n,r;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.user_room.confrId,e.prev=1,n=this,r={withAudio:!0,confrId:t,stopSharedCallback:function(e){return n.stop_share_desktop(e)}},e.next=6,U.a.mgr.shareDesktopWithAudio(r);case 6:this.setState({shared_desktop:!0}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),-201==e.t0.error&&e.t0.errorMessage.indexOf("ShareDesktopExtensionNotFound")>0&&P.a.error("\u8bf7\u786e\u8ba4\u5df2\u5b89\u88c5\u5171\u4eab\u684c\u9762\u63d2\u4ef6 \u6216\u8005\u662f\u5426\u4f7f\u7528\u7684 https\u57df\u540d");case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"stop_share_desktop",value:function(e){var t=this.state.own_desktop_stream;t&&(U.a.mgr.unpublish(t),this.setState({shared_desktop:!1,own_desktop_stream:null}))}},{key:"_on_stream_added",value:function(e,t){if(t.type==U.a.StreamType.DESKTOP&&t.located())this.setState({own_desktop_stream:t});else if(e&&t){var n=this.state.stream_list;if(t.located()){var r=this.state.user_room.role;e.role=r,e.is_me=!0,t.type!=U.a.StreamType.DESKTOP&&this.setState({own_stream:t}),this.setState({own_member:e})}t.type==U.a.StreamType.DESKTOP?n.unshift({stream:t,member:e}):this._check_has_shared()||!t.located()||n[0]?n.push({stream:t,member:e}):n.unshift({stream:t,member:e});var i=this;this.setState({stream_list:n,talker_list_show:!0},(function(){i.insert_video_by_stream(e,t),1==t.type&&i.move_v_els();var n=i.state,r=n.push_cdn,o=n.user_room;r&&o.isCreator&&i.setState((function(e){return{cdn_zorder:e.cdn_zorder+1}}),i._update_live_layout)}))}}},{key:"insert_video_by_stream",value:function(e,t){var n=document.createElement("video");n.autoplay=!0,t.located()&&1!=t.type&&n.setAttribute("is-main-media",!0);var r=document.querySelector("[sid="+t.id+"]"),i=this._get_video_loading_el();if(r.appendChild(i),setTimeout((function(){for(var e=document.querySelectorAll(".v-wrapper .loading-wrapper"),t=0;t<e.length;t++){var n=e[t];n.parentNode.removeChild(n)}}),1e3),t.located())U.a.mgr.streamBindVideo(t,n);else{var o={video:!0,audio:!0};console.log("%c sub","color:green"),U.a.mgr.subscribe(e,t,o.video,o.audio,n).then((function(){})).catch((function(t){console.error("\u8ba2\u9605\u6d41\u5931\u8d25",t),$("error","\u8ba2\u9605".concat(e.nickName,"\u7684\u6d41\u5931\u8d25"))}))}r.appendChild(n),this._on_media_chanaged_by_stream(n,t);var a=this.state.subed_v_els;a[t.id]=n,this.setState({subed_v_els:a})}},{key:"move_v_els",value:function(){for(var e=document.querySelectorAll(".v-wrapper[sid]"),t=0;t<e.length;t++){var n=e[t],r=n.getAttribute("sid"),i=this.state.subed_v_els[r],o=n.querySelector("video");o&&n.removeChild(o),n.appendChild(i)}}},{key:"_on_stream_removed",value:function(e){if(e){var t=this.state.stream_list;t.map((function(n,r){n&&n.stream&&n.stream.id==e.id&&t.splice(r,1)}));var n=this;this.setState({stream_list:t},(function(){n.move_v_els();var e=n.state,t=e.push_cdn,r=e.user_room;t&&r.isCreator&&n.setState((function(e){return{cdn_zorder:e.cdn_zorder+1}}),n._update_live_layout)}));var r=this.state.subed_v_els;r[e.id]&&delete r[e.id],this.setState({subed_v_els:r})}}},{key:"_check_has_shared",value:function(e){var t=this.state,n=t.own_desktop_stream,r=t.white_board_is_created,i=t.am_i_white_board_creator,o=this.state.stream_list[0];if(e){var a=!1;return"desktop"==e&&(r&&(a="white-board"),o&&o.stream&&1==o.stream.type&&(a="desktop")),"white-board"==e&&((n||o&&o.stream&&1==o.stream.type)&&(a="desktop"),r&&!i&&(a="white-board")),a}return n||o&&o.stream&&1==o.stream.type?"desktop":!!r&&"white-board"}},{key:"_on_media_chanaged_by_stream",value:function(e,t){var n=this;this.set_stream_item_changed=function(e,t){if(t&&e){var r=n.state.stream_list,i=e.aoff,o=e.voff;r=r.map((function(e){return e&&e.stream&&e.stream.id==t&&(e.stream.aoff=i,e.stream.voff=o),e})),n.setState({stream_list:r})}},this.sound_chanaged=function(e,t){if(e){var r=n.state.stream_list;r=r.map((function(n){return n&&n.stream&&n.stream.id==e&&(n.stream.volume=t),n})),n.setState({stream_list:r})}};var r=this;U.a.mgr.onMediaChanaged(e,(function(e,t){r.set_stream_item_changed(e,t.id)})),U.a.mgr.onSoundChanaged(e,(function(e,t){var n=e.instant,i=Math.round(n/(.15/14));i=i>14?14:i;var o=r.state.prev_volumes;o[t.id]!=i&&(r.sound_chanaged(t.id,i),o[t.id],r.setState({prev_volumes:o}))}))}},{key:"_update_live_layout",value:function(){var e=this.state.stream_list,t=this,n=function(){var e=0;t.state.stream_list.map((function(t){t&&e++}));var n=Math.ceil(Math.sqrt(e)),r=Math.ceil(e/n),i=t.state.liveCfg.canvas,o=i.w,a=i.h;return{col_num:n,row_num:r,cell_width:parseInt(o/n),cell_height:parseInt(a/r)}}(),r=[],i=0,o=this.state.cdn_zorder;e.map((function(e){if(e){var t=function(e,t){var n={x:0,y:0},r=t.col_num,i=t.cell_width,o=t.cell_height,a=Math.ceil(e/r),s=e%r;return 0==s&&(s+=r),n.x=i*(s-1),n.y=o*(a-1),n}(++i,n),a=e.stream.id;r.push({sid:a,x:t.x,y:t.y,z:o,w:n.cell_width,h:n.cell_height,style:"AspectFit"})}}));var a=this.state.user_room.confrId,s=U.a.config.liveCfgs;s&&s[0]&&U.a.mgr.updateLiveLayout(a,s[0].id,r)}},{key:"_get_header_el",value:function(){var e=this.state,t=e.roomName,n=e.own_stream;return i.a.createElement("div",{className:"header-wrapper"},i.a.createElement("img",{className:"logo",src:te("logo-text-room")}),i.a.createElement("div",{className:"name-wrapper"},i.a.createElement("div",{className:"name"},t||"\u623f\u95f4\u540d\u79f0"),i.a.createElement("div",{className:"time"},this._get_tick())),i.a.createElement("div",{className:"leave-action-wrapper"},n?i.a.createElement("div",{className:"network-icon"},i.a.createElement(me,{network_status:n.network_status})):"",i.a.createElement("div",{onClick:this.leave_handle,className:"leave-action"},i.a.createElement("img",{src:te("leave-icon")}),i.a.createElement("span",null,"\u79bb\u5f00\u4f1a\u8bae")),i.a.createElement(ge,null)))}},{key:"_voff_show",value:function(e,t){if(!e)return i.a.createElement("div",{className:"voff-show"});var n=e.member.ext;if(!n||!n.headImage)return i.a.createElement("div",{className:"voff-show"});return i.a.createElement("div",{className:"voff-show"},i.a.createElement("div",{className:"avatar-wrapper"},i.a.createElement("img",{className:"avatar",src:"https://download-sdk.oss-cn-beijing.aliyuncs.com/downloads/RtcDemo/headImage/"+n.headImage}),"main"==t?i.a.createElement("div",{className:"nick-name"},ne(e.member),7==e.member.role?i.a.createElement("img",{src:te("admin-icon")}):""):""))}},{key:"_get_video_loading_el",value:function(){var e=document.createElement("div");e.classList.add("loading-wrapper");return e.innerHTML=['<div class="loading">\n                <div class="circle circle1">\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                </div>\n                <div class="circle circle2">\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                </div>\n                <div class="circle circle3">\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                </div>\n            </div>'],e}},{key:"talker_list_scroll",value:function(e,t){var n,r=this;return function(){for(var i=document.querySelectorAll(".talker-list-wrapper video"),o=function(e){return r.state.not_visible_arr.indexOf(e)>-1},a=function(e){if(!e)return null;var t=null;return r.state.stream_list.map((function(n){n&&n.member&&n.stream&&n.stream.id==e&&(t=n)})),t},s=0;s<i.length;s++){var c=i[s],d=c.parentNode,u=c.getAttribute("hx_stream");if(!a(u).stream.voff)if(!r.talker_is_not_visble(c)&&o(u))d.querySelector(".loading-wrapper")||d.appendChild(r._get_video_loading_el());else{var l=d.querySelector(".loading-wrapper");l&&d.removeChild(l)}}n&&clearTimeout(n),n=setTimeout(e,t)}}},{key:"talker_list_scroll_stop",value:function(){for(var e=document.querySelectorAll(".talker-list-wrapper video"),t=this,n=function(e){if(!e)return null;var n=null;return t.state.stream_list.map((function(t){t&&t.member&&t.stream&&t.stream.id==e&&(n=t)})),n},r=function(e,n){var r=t.state.not_visible_arr;if("not-visible"==n&&r.indexOf(e)>-1)return!1;if("not-visible"==n&&-1==r.indexOf(e))return r.push(e),t.setState({not_visible_arr:r}),!0;if("visible"==n&&r.indexOf(e)>-1){var i=r.indexOf(e);return r.splice(i,1),t.setState({not_visible_arr:r}),!0}return("visible"!=n||-1!=r.indexOf(e))&&void 0},i=function(e){var t=e.querySelector(".loading-wrapper");t&&e.removeChild(t)},o=0;o<e.length;o++){var a=e[o],s=a.getAttribute("hx_stream");if(s){var c=n(s);if(!c.stream.voff)if(!c.stream.located())i(a.parentNode),this.talker_is_not_visble(a)?r(s,"not-visible")&&U.a.useCurrentXService.subscribe(c.stream.id,{subSVideo:!1,subSAudio:!0}):r(s,"visible")&&U.a.useCurrentXService.subscribe(c.stream.id,{subSVideo:!0,subSAudio:!0})}}}},{key:"talker_is_not_visble",value:function(e){var t=document.body.getBoundingClientRect().height,n=document.querySelectorAll(".talker-list-wrapper .v-wrapper")[0].getBoundingClientRect().height,r=document.querySelector("footer").getBoundingClientRect().height,i=e.getBoundingClientRect().top;return i>=t-r||i<125&&Math.abs(i-125)>n}},{key:"_get_drawer_component",value:function(){var e=this,t=this.state,n=t.stream_list,r=t.talker_list_show,o=this.state.user_room.role;return i.a.createElement("div",{className:"talker-list-placeholder"},i.a.createElement("div",{className:"talker-list-wrapper",style:r?{}:{transform:"translateX(calc(100% + 10px))"}},i.a.createElement("div",{className:"control-btn",onClick:this.control_talker_list},i.a.createElement("img",{src:te("expand-icon"),style:r?{transform:"rotateY(180deg)"}:{}})),i.a.createElement("div",{className:"header"},"\u53c2\u4f1a\u4eba\u6570 ",function(){var t=0;return e.state.stream_list.map((function(e){e&&e.stream&&e.stream.type!=U.a.StreamType.DESKTOP&&t++})),t}(),7==o?i.a.createElement(ce,this.state):""),i.a.createElement("div",{className:"content",onScroll:this.talker_list_scroll},n.map((function(t,n){if(0!=n&&t)return e._get_video_item(t,n)})))))}},{key:"_get_main_el",value:function(){var e=this.state.stream_list[0];if(e){var t=e.stream,n=t.volume,r=t.type,o=t.voff,a=t.aoff;return i.a.createElement("div",{className:"main-video-wrapper v-wrapper",sid:e.stream.id},1==r?"":a?i.a.createElement("img",{src:te("micro-is-close-icon"),className:"is-speak-icon"}):i.a.createElement("img",{src:te("volume-"+(n||0)),className:"is-speak-icon"}),o?this._voff_show(e,"main"):""," ")}return i.a.createElement("i",null)}},{key:"_get_video_item",value:function(e,t){var n=this,r=e.stream,o=e.member;if(!r||!o||0==Object.keys(r).length||0==Object.keys(o).length)return"";var a=r.id,s=r.aoff,c=r.volume,d=r.type,u=r.voff,l=o.role,f=o.is_me,m=this.state.user_room.role,p=this.state.user.username,h=this.state.user_room,v=ne(o);return i.a.createElement("div",{key:a,className:"item v-wrapper",sid:r.id,onDoubleClick:function(){return n.toggle_main(t)}},i.a.createElement("div",{className:"info"},i.a.createElement("span",{className:"name"},v+(f?"(\u6211)":"")),i.a.createElement("div",{className:"status-icon"},i.a.createElement("div",{className:"network-icon"},i.a.createElement(me,{network_status:r.network_status})),7==l?i.a.createElement("img",{className:"admin",src:te("admin-small-icon")}):"",s?i.a.createElement("img",{src:te("micro-is-close-icon")}):i.a.createElement("img",{src:te("volume-"+(c||0))}))),u?this._voff_show(e):"",7!=m||f||d==U.a.StreamType.DESKTOP?"":i.a.createElement(de,{stream:r,member:o,my_username:p,user_room:h}))}},{key:"_get_action_el",value:function(){var e=this,t=this.state.user_room.role,n=this.state,r=n.audio,o=n.video,s=n.shared_desktop,c=n.room_setting_modal_show,d=n.roomName,u=(n.own_member,n.join_as_audience),l=n.nickName,f=this._check_has_shared("desktop");return i.a.createElement("div",{className:"actions"},i.a.createElement("div",{className:"wrapper"},i.a.createElement("img",{className:1==t?"disabled":"",src:te(1==t?"micro-is-close-icon":r?"micro-is-open-icon":"micro-is-close-icon"),onClick:function(){return e.toggle_audio()}}),i.a.createElement("span",{className:"text"},1==t?"\u89e3\u9664\u9759\u97f3":r?"\u9759\u97f3":"\u89e3\u9664\u9759\u97f3")),i.a.createElement("div",{className:"wrapper"},i.a.createElement("img",{className:1==t?"disabled":"",src:te(1==t?"video-is-close-icon":o?"video-is-open-icon":"video-is-close-icon"),onClick:function(t){return e.toggle_video(t)}}),i.a.createElement("span",{className:"text"},1==t?"\u5f00\u542f\u89c6\u9891":o?"\u5173\u95ed\u89c6\u9891":"\u5f00\u542f\u89c6\u9891")),u?i.a.createElement("div",{className:"wrapper"},1==t?i.a.createElement("img",{src:te("apply-to-talker-icon"),onClick:function(){return e.apply_talker()}}):i.a.createElement("img",{src:te("apply-to-audience-icon"),onClick:function(){return e.apply_audience()}}),i.a.createElement("span",null,1==t?"\u4e0a\u9ea6":"\u4e0b\u9ea6")):"",this.get_white_board_action_btn(),i.a.createElement("div",{className:"wrapper"},i.a.createElement("img",{src:te("invite-icon"),onClick:function(){return function(e){if(e&&!document.querySelector("#inviteModal")){var t=document.createElement("div");t.id="inviteModal",document.body.appendChild(t);var n=e.roomName||"",r=e.invitees||"",o=r+"\u9080\u8bf7\u60a8\u53c2\u52a0\u89c6\u9891\u4f1a\u8bae\r\n\u4f1a\u8bae\u540d\u79f0\uff1a"+n+"\r\n\r\n\u70b9\u51fb\u94fe\u63a5\u76f4\u63a5\u52a0\u5165\u4f1a\u8bae:\r\nhttps://meeting.easemob.com/invite/index.html?roomName="+encodeURI(n)+"&invitees="+encodeURI(r)+"\r\n\r\napp\u4e0b\u8f7d\u5730\u5740\uff1ahttp://www.easemob.com/download/rtc";a.a.render(i.a.createElement("div",{className:"inviteModal"},i.a.createElement("span",{className:"close",onClick:function(){a.a.unmountComponentAtNode(t)&&t.parentNode&&t.parentNode.removeChild(t)}},"x"),i.a.createElement("div",{className:"title"},"\u4f1a\u8bae\u540d\u79f0\uff1a",n),i.a.createElement("textarea",{value:o,readOnly:!0,id:"invite"}),i.a.createElement(R.a,{type:"primary",onClick:function(){document.querySelector("textarea#invite").select();try{document.execCommand("copy"),P.a.success("\u5df2\u590d\u5236\u9080\u8bf7\u6587\u672c\u5230\u7c98\u8d34\u677f")}catch(e){P.a.error("\u590d\u5236\u9080\u8bf7\u6587\u672c\u5931\u8d25")}}},"\u590d\u5236")),t)}}({roomName:d,invitees:l})}}),i.a.createElement("span",null,"\u9080\u8bf7\u4ed6\u4eba")),i.a.createElement("div",{className:"wrapper"},1==t?i.a.createElement(k.a,{title:"\u89c2\u4f17\u4e0d\u53ef\u5171\u4eab\u684c\u9762"},i.a.createElement("img",{src:te("share-desktop-icon"),style:{opacity:"0.7",cursor:"not-allowed"}})):f?i.a.createElement(k.a,{title:"desktop"==f?"\u6709\u4eba\u5728\u5171\u4eab\u684c\u9762\uff0c\u4e0d\u53ef\u518d\u5171\u4eab\u684c\u9762":"\u6709\u4eba\u5728\u5171\u4eab\u767d\u677f\uff0c\u4e0d\u53ef\u518d\u5171\u4eab\u684c\u9762"},i.a.createElement("img",{src:te("share-desktop-icon"),style:{opacity:"0.7",cursor:"not-allowed"}})):s?i.a.createElement("img",{src:te("stop-share-desktop-icon"),onClick:function(){return e.stop_share_desktop()}}):i.a.createElement("img",{src:te("share-desktop-icon"),onClick:function(){return e.share_desktop()}}),i.a.createElement("span",null,s?"\u505c\u6b62\u5171\u4eab":"\u5171\u4eab\u684c\u9762")),i.a.createElement("div",{className:"wrapper"},i.a.createElement("img",{src:te(c?"room-setting-open-icon":"room-setting-close-icon"),onClick:function(){return e.toggle_room_setting_modal()}}),i.a.createElement("span",null,"\u4f1a\u8bae\u4fe1\u606f")))}},{key:"toggle_room_setting_modal",value:function(){var e=this.state.room_setting_modal_show;this.setState({room_setting_modal_show:!e})}},{key:"get_white_board_action_btn",value:function(){var e=this,t=this.state,n=t.use_white_board,r=t.white_board_is_created;if(!n)return"";if(this.state.user_room.role==U.a.mgr.Role.AUDIENCE)return"";var o=this._check_has_shared("white-board");return o?i.a.createElement("div",{className:"wrapper"},i.a.createElement(k.a,{title:"desktop"==o?"\u6709\u4eba\u5728\u5171\u4eab\u684c\u9762\uff0c\u4e0d\u53ef\u518d\u53d1\u8d77\u767d\u677f":"\u6709\u4eba\u5728\u5171\u4eab\u767d\u677f\uff0c\u4e0d\u53ef\u518d\u53d1\u8d77\u767d\u677f"},i.a.createElement("img",{src:te("join-white-board-icon"),style:{opacity:"0.7",cursor:"not-allowed"}})),i.a.createElement("span",null,"\u53d1\u8d77\u767d\u677f")):r?i.a.createElement("div",{className:"wrapper"},i.a.createElement("img",{src:te("destory-white-board-icon"),onClick:function(){return e.confirm_destory_white_board()}}),i.a.createElement("span",null,"\u9000\u51fa\u767d\u677f")):i.a.createElement("div",{className:"wrapper"},i.a.createElement("img",{src:te("join-white-board-icon"),onClick:function(){return e.create_white_board()}}),i.a.createElement("span",null,"\u53d1\u8d77\u767d\u677f"))}},{key:"get_white_board_content_el",value:function(){var e=this.state,t=e.white_board_is_created,n=e.white_board_url;return t?("https:"==location.protocol&&(n=n.replace(/http:\/\//g,"https://")),i.a.createElement("iframe",{name:"white-board",src:n})):""}},{key:"emit_white_board_is_created",value:function(){var e=this.state.user.username,t=this.state.roomName,n={key:"whiteBoard",val:JSON.stringify({creator:e,roomName:t,roomPswd:t,timestamp:(new Date).getTime()})};U.a.mgr.setConferenceAttrs(n)}},{key:"emit_white_board_is_destroyed",value:function(){U.a.mgr.deleteConferenceAttrs({key:"whiteBoard"})}},{key:"create_white_board",value:function(){var e=this,t=this.state.roomName,n=this.state.user,r=n.username,i=n.token,o=this,a={roomName:t,password:t,userName:r,token:i,suc:function(t){var n=t.whiteBoardUrl;o.setState({white_board_url:n,white_board_is_created:!0,am_i_white_board_creator:!0,talker_list_show:!0}),P.a.success("\u521b\u5efa\u767d\u677f\u6210\u529f"),o.emit_white_board_is_created(),o.set_main_stream_to_talker_list(),e.setState({white_board_info:t})},error:function(e){P.a.error(e)}};this.setState({main_loading:!0,main_loading_text:"\u6b63\u5728\u521b\u5efa\u767d\u677f..."}),this.white_board.join(a)}},{key:"join_white_board",value:function(){var e=this.state.join_white_board_params;if(e){var t=this;this.white_board.join(Object(h.a)({},e,{suc:function(e){var n=e.whiteBoardUrl;t.setState({white_board_url:n,white_board_is_created:!0}),P.a.success("\u52a0\u5165\u767d\u677f\u6210\u529f"),t.set_main_stream_to_talker_list()},error:function(e){console.log("\u52a0\u5165\u767d\u677f\u5931\u8d25",e)}}))}}},{key:"set_main_stream_to_talker_list",value:function(){var e=this.state.stream_list;e.unshift(null),this.setState({stream_list:e},this.move_v_els)}},{key:"confirm_destory_white_board",value:function(){he({onOk:this.destroy_white_board.bind(this)})}},{key:"destroy_white_board",value:function(){var e=this.state.white_board_info;if(e){var t=e.roomId,n=this.state.user,r=n.username,i=n.token;this.setState({main_loading:!0,main_loading_text:"\u6b63\u5728\u9500\u6bc1\u767d\u677f..."});var o=this;this.white_board.destroy({roomId:t,userName:r,token:i,suc:function(e){P.a.success("\u5df2\u7ecf\u9000\u51fa\u4e86\u767d\u677f"),o.setState({white_board_is_created:!1,am_i_white_board_creator:!1,main_loading:!1,main_loading_text:""}),o.emit_white_board_is_destroyed()},error:function(e){P.a.error("\u9000\u51fa\u767d\u677f\u5931\u8d25")}})}}},{key:"startTime",value:function(){var e=this;this.timeID=setInterval((function(){e.setState((function(e){return{time:e.time+1}}))}),1e3)}},{key:"_get_tick",value:function(){var e=this.state.time;function t(e){return e<10?"0"+e:e}var n="";if(e<60)n="00:"+t(e);else if(e>=60){n=function(e){return e<10?"0"+e:e}(parseInt(e/60))+":"+t(e%60)}return n}},{key:"_get_loading_el",value:function(){var e=this.state,t=e.main_loading,n=e.main_loading_text;return t?i.a.createElement("div",{className:"main-loading-wrapper"},i.a.createElement(p.a,{tip:n}," ")):""}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,n=this.state.joined,r=this.state.user_room.role,o=this.state,a=o.audio,s=o.video,c=o.nickName,d=(o.headimg_url_suffix,o.roomName),u=o.talker_full_btn_disable,l=o.shared_desktop,f=o.join_btn_disable;return i.a.createElement("div",{style:{width:"100%",height:"100%"}},i.a.createElement("div",{className:"login-wrap",style:{display:n?"none":"flex",background:"url("+te("login-bg")+")",backgroundSize:"cover"}},f?i.a.createElement(m.a,{message:"\u4e3a\u4e86\u6700\u4f73\u4f7f\u7528\u4f53\u9a8c\uff0c\u8bf7\u4f7f\u7528chrome\u6d4f\u89c8\u5668",type:"warning",closable:!0}):"",i.a.createElement("div",{className:"header"},i.a.createElement("img",{src:te("logo-text-login")})),i.a.createElement(N.a,{className:"login-form",onSubmit:this.join_handle},i.a.createElement("img",{src:te("setting-icon"),className:"setting-handle",onClick:function(){return e.setting_modal.show()}}),i.a.createElement("img",{src:te("logo")}),i.a.createElement("div",{className:"app-name"},"\u73af\u4fe1\u89c6\u9891\u4f1a\u8bae"),i.a.createElement(re,null,t("roomName",{initialValue:d||Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_RTC_HOST:"https://a1.easemob.com",REACT_APP_IM_HOST:"https://a1.easemob.com",REACT_APP_WHITE_BOARD_HOST:"https://wbrtc.easemob.com"}).REACT_APP_ROOMNAME,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4f1a\u8bae\u540d\u79f0"},{min:3,message:"\u4f1a\u8bae\u540d\u79f0\u4e0d\u80fd\u5c11\u4e8e3\u4f4d"},{pattern:/^[\u4e00-\u9fa5\w-]*$/,message:"\u8bf7\u8f93\u5165\u4e2d\u6587\u3001\u82f1\u6587\u3001\u6570\u5b57\u3001\u51cf\u53f7\u6216\u4e0b\u5212\u7ebf"}]})(i.a.createElement(b.a,{prefix:i.a.createElement(S.a,{type:"home",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"\u4f1a\u8bae\u540d\u79f0",maxLength:18,autoComplete:"off"}))),i.a.createElement(re,null,t("nickName",{initialValue:c||"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u60a8\u7684\u6635\u79f0"}]})(i.a.createElement(b.a,{prefix:i.a.createElement(S.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"\u8bf7\u8f93\u5165\u60a8\u7684\u6635\u79f0",autoComplete:"off"}))),i.a.createElement("div",{className:"control-contraints"},t("video",{valuePropName:"checked",initialValue:s})(i.a.createElement(_.a,null,"\u6253\u5f00\u6444\u50cf\u5934")),t("audio",{valuePropName:"checked",initialValue:a})(i.a.createElement(_.a,null,"\u6253\u5f00\u9ea6\u514b\u98ce"))),i.a.createElement("div",{className:"action"},i.a.createElement(R.a,{type:"primary",htmlType:"submit",onClick:this.join_handle,loading:this.state.loading,style:{width:"100%"},disabled:f},"\u52a0\u5165\u4f1a\u8bae"),i.a.createElement("div",{className:"info-tips"},i.a.createElement(S.a,{type:"info-circle"}),"\u4e0d\u7528\u521b\u5efa\u4f1a\u8bae\uff0c\u521d\u6b21\u52a0\u5165\u5219\u81ea\u52a8\u521b\u5efa")),i.a.createElement("div",{className:"version-text"},"Version:","2.1.0")),i.a.createElement(y.a,{visible:this.state.talker_is_full,closable:!1,onOk:function(){return e.talker_is_full_handle()},onCancel:this.close_talker_model,okText:"\u4ee5\u89c2\u4f17\u8eab\u4efd\u767b\u5f55",cancelText:"\u6682\u4e0d\u767b\u5f55",centered:!0,mask:!1,maskClosable:!1,width:"470px",className:"talker-is-full-modal",okButtonProps:{disabled:u},cancelButtonProps:{disabled:u}},i.a.createElement("div",null,i.a.createElement("img",{src:te("warning-icon")})),i.a.createElement("div",null,"\u4e3b\u64ad\u4eba\u6570\u5df2\u6ee1",i.a.createElement("br",null),"\u662f\u5426\u4ee5\u89c2\u4f17\u8eab\u4efd\u8fdb\u5165\uff1f")),i.a.createElement(le,Object.assign({},this.state,{_get_setting_values:this._get_setting_values,ref:function(t){return e.setting_modal=t}}))),i.a.createElement(D.a,{className:"meeting",style:{display:n?"block":"none"}},i.a.createElement(ie,null,this._get_header_el()),i.a.createElement(oe,null,this._get_loading_el(),this.get_white_board_content_el(),this._get_main_el()),this._get_drawer_component(),i.a.createElement(ae,null,this._get_action_el(),i.a.createElement(pe,Object.assign({},this.state,{toggle_room_setting_modal:this.toggle_room_setting_modal}))),this.get_leaveConfirmModal(),7==r?i.a.createElement(se,Object.assign({},this.state,{ref:function(t){return e.to_audience_list=t}})):i.a.createElement("i",null),U.a.isElectron?i.a.createElement(_e,{ref:function(t){return e.choose_desktop_media=t}}):"",l?i.a.createElement(m.a,{className:"shared-desktop-alert",message:"\u60a8\u6b63\u5728\u5171\u4eab\u684c\u9762",type:"info",showIcon:!0}):""))}}]),n}(r.Component),ye=N.a.create()(Ae),Se=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return i.a.createElement(l.a,null,i.a.createElement(f.c,null," ",i.a.createElement(f.a,{path:"/room",component:ye}),i.a.createElement(f.a,{path:"/",component:ye})))}}]),n}(r.Component);a.a.render(i.a.createElement(Se,null),document.getElementById("root"))},488:function(e,t,n){"use strict";n.r(t),n.d(t,"outer",(function(){return he}));var r=n(12),i=n.n(r),o=n(18),a=n(44),s=n(7),c=n.n(s),d=n(19),u=n.n(d),l=n(55),f=n.n(l),m=n(64),p=n(37),h=n(38),v=n(34),g=n.n(v),_=function(){function e(t){Object(p.a)(this,e),this.emedia=t,this.streams=[],this._intervals_get=null,this._intervals_upload=null,this.data=[],this.counterId=1,this.prev_obj={},this.sessionId=null,this.network_quality_obj={},this.network_quality_threshold={RTT:{time:8e3,value:500},aPLR:{time:8e3,value:18},vPLR:{time:8e3,value:23},disconnect:{time:5e3}},this.re_timer_count=0}return Object(h.a)(e,[{key:"_get_url",value:function(){var e="",t=this.emedia.useCurrentXService.current;if(!t)return e;var n=t.ticket,r=n.qoeUpUrl,i=n.memName;i=i.split("_")[1];var o=emedia.config.appkey,a=o.split("#")[0],s=o.split("#")[1],c=(new Date).getTime(),d=emedia.mgr.identityToken;return e="".concat(r,"?orgName=").concat(a,"&appName=").concat(s,"&memName=").concat(i,"&ts=").concat(c,"&access_token=").concat(d)}},{key:"connect_ws",value:function(){var e=this._get_url();if(e){var t=new WebSocket(e),n=this;t.onopen=function(){console.log("upload stats ws connected"),n.ws_connected=!0,n.socket=t,n.re_connect&&(console.log("has Reconnectioned"),console.log("before joinS"),n.sessionId&&(console.log("have sessID"),n.join_success(n.sessionId)))},t.onclose=function(e){n.stop(),n.ws_connected=!1,console.error("upload stats ws close"),navigator.onLine&&n.reconnection()},t.message=function(e){console.log("upload stats ws recv msg",e)},t.onerror=function(e){console.error("upload stats ws error",e)},window.addEventListener("online",(function(){n.re_timer_count=0,n.reconnection()}))}else console.error("upload stats not have ws url")}},{key:"reconnection",value:function(){if(!this.ws_connected){var e=this;this.reconnection_timer=setInterval((function(){e.ws_connected||e.re_timer_count>=10?clearInterval(e.reconnection_timer):(console.log("reconnection..."),e.re_connect=!0,e.connect_ws(),e.re_timer_count++)}),5e3)}}},{key:"start",value:function(){this._intervals_get=setInterval(this.get.bind(this),2e3),this._intervals_upload=setInterval(this.upload.bind(this),500)}},{key:"join_success",value:function(e){e&&(this.sessionId=e,this.data.unshift(this._get_init_data()),this.start())}},{key:"join_fail",value:function(){this.socket&&this.socket.send({type:0,result:1,errorInfo:"join fail"})}},{key:"get",value:function(){if(this.emedia.useCurrentXService&&this.emedia.useCurrentXService.current&&this.emedia.useCurrentXService.current._cacheStreams){var e=this.emedia.useCurrentXService.current._cacheStreams,t=this;Object.keys(e).map((function(n){t.push_stats_to_data(e[n])}))}}},{key:"upload",value:function(){if(0!=this.data.length){if(this.socket){var e=this.data.shift();if(void 0==e.counterId&&(e.counterId=this.counterId,this.counterId=this.counterId+1),this.socket.send(JSON.stringify(e)),1==e.type){var t=document.querySelector("#".concat(e.sId));if(t){var n="";Object.keys(e).map((function(t){n+="<div>".concat(t," : ").concat(e[t],"</div>")})),t.innerHTML=n}}}}else console.warn("upload_stats upload fun -- this.data.length == 0")}},{key:"upload_event",value:function(e){if(e){var t=this._get_format_event_obj(e);t&&this.data.splice(1,0,t)}}},{key:"_get_format_event_obj",value:function(e){var t={type:2,time:(new Date).getTime()};if("object"!=typeof e.event&&void 0!=e.event)return Object.assign(t,e);var n=this.sessionId;if(e instanceof g.a.ICEConnected){var r=this._get_ice_connect_state_obj(e.webrtc,2);t=Object.assign(t,r)}else if(e instanceof g.a.ICEConnectFail){var i=this._get_ice_connect_state_obj(e.webrtc,4);t=Object.assign(t,i)}else if(e instanceof g.a.ICEDisconnected){var o=this._get_ice_connect_state_obj(e.webrtc,5);t=Object.assign(t,o)}else if(e instanceof g.a.PushSuccess){if(!e.hidden)return;var a=e.stream,s={event:14,sessionId:n,rtcId:a.rtcId,voff:a.voff,aoff:a.aoff,streamType:a.type,result:0};t=Object.assign(t,s)}else if(e instanceof g.a.SubSuccess){var c=e.stream,d=c.rtcId,u=c.id,l=c.type,f=c.memId,m={event:16,rtcId:d,sId:u,sessionId:n,result:0,streamType:l,subMemName:c.memName,subMemId:f};t=Object.assign(t,m)}else if(e instanceof g.a.EnterSuccess){var p={event:0,ip:e.ip};t=Object.assign(t,p)}return void 0!=t.event?t:void 0}},{key:"_get_ice_connect_state_obj",value:function(e,t){var n=this.emedia.useCurrentXService.current,r=null;for(var i in n._linkedStreams)n._linkedStreams[i].rtcId==e.getRtcId()&&(r=n._linkedStreams[i]);if(!r)return{};var o={event:20,rtcId:r.rtcId,connState:t,isPub:r.located(),sId:r.id,rtcCfg:r.rtcCfg,voff:r.voff,aoff:r.aoff};if(!r.located()){var a={subSId:r.id,subMemName:r.memName,subMemId:r.memId,subVideo:r.subSVideo,subAudio:r.subSAudio};o=Object.assign(o,a)}return o}},{key:"stop",value:function(){clearInterval(this._intervals_get),clearInterval(this._intervals_upload)}},{key:"push_stats_to_data",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._webrtc){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t._webrtc._rtcPeerConnection.getStats();case 4:n=e.sent,r=this._get_format_upload_obj(n,t),this.data.push(r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_get_init_data",value:function(){var e=this.emedia.useCurrentXService.current;if(e){var t=this.emedia.config,n=t.appkey,r=t.version,i=e.confrId,o=e._memberId,a=e.memName,s=this.sessionId,c=this.emedia,d=c.browser,u=c.browserVersion;c.isWifi;return{type:0,counterId:0,appkey:n,confrId:i,memId:o,memName:a,time:(new Date).getTime(),joinConfrTime:e.ticket.timestamp,sessionId:s,networkType:"WIFI",sdkOS:"Web",sdkVersion:r,deviceInfo:d,osVersion:u,result:0}}}},{key:"_get_format_upload_obj",value:function(e,t){var n={type:1,time:(new Date).getTime(),streamType:t.type,sId:t.id,rtcId:t.rtcId};if(t.located()){n.isPub=!0;var r=this._get_outbound_stats(e);n=Object.assign(n,r)}else{n.isPub=!1,n.subMemName=t.memName,n.subMemId=t.memId;var i=this._get_inbound_stats(e);n=Object.assign(n,i)}return n=this._calc_KBps_and_PLR(n),n=this._set_stats_int(n)}},{key:"_get_outbound_stats",value:function(e){var t={};return e.forEach((function(e){"outbound-rtp"==e.type&&("audio"==e.mediaType&&(t.aP=e.packetsSent,t.aB=e.bytesSent),"video"==e.mediaType&&(t.vW=e.frameWidth,t.vH=e.frameHeight,t.vP=e.packetsSent,t.vB=e.bytesSent)),"remote-inbound-rtp"==e.type&&("audio"==e.kind&&(t.aPL=e.packetsLost),"video"==e.kind&&(t.vPL=e.packetsLost)),"media-source"==e.type&&("audio"==e.kind&&(t.audioInputLevel=1e3*e.audioLevel),"video"==e.kind&&(t.vFps=e.framesPerSecond)),"candidate-pair"==e.type&&(t.RTT=1e3*e.totalRoundTripTime/e.responsesReceived)})),t}},{key:"_get_inbound_stats",value:function(e){var t={};return e.forEach((function(e){"inbound-rtp"==e.type&&(("audio"==e.kind||e.id.indexOf("AudioStream")>-1)&&(t.aP=e.packetsReceived,t.aPL=e.packetsLost,t.aB=e.bytesReceived),("video"==e.kind||e.id.indexOf("VideoStream")>-1)&&(t.vP=e.packetsReceived,t.vPL=e.packetsLost,t.vB=e.bytesReceived)),"track"==e.type&&("video"==e.kind&&(t.vW=e.frameWidth,t.vH=e.frameHeight,t.vFR=e.framesReceived),"audio"==e.kind&&(t.audioInputLevel=1e3*e.audioLevel)),"candidate-pair"==e.type&&(t.RTT=1e3*e.totalRoundTripTime/e.responsesReceived)})),t}},{key:"_calc_KBps_and_PLR",value:function(e){var t=e.sId,n=e.aB,r=e.vB,i=e.time;e.aKBps=this._get_KBps_by_sId(t,"audio",n,i)||0,e.vKBps=this._get_KBps_by_sId(t,"video",r,i)||0;var o=e.aP,a=e.aPL,s=e.vP,c=e.vPL,d=this._get_PLR_by_sId(t,"audio",o,a),u=this._get_PLR_by_sId(t,"video",s,c);if((d||0==d)&&(e.aPLR=d),(u||0==u)&&(e.vPLR=u),!e.isPub){var l=e.vFR;if(this.prev_obj[t]&&this.prev_obj[t].video&&this.prev_obj[t].video.framesReceived){var f=this.prev_obj[t].time,m=(l-this.prev_obj[t].video.framesReceived)/((i-f)/1e3);m<0&&(m=0),e.vFps=m}}var p=this._get_w_quality(e);if(2!=p){var h={time:(new Date).getTime(),event:4,type:2,counterId:this.counterId,sessionId:this.sessionId,rtcId:e.rtcId,sId:e.sId,isPub:e.isPub,streamType:e.sId,aoff:e.aoff,voff:e.voff,subMemName:e.subMemName,subMemId:e.subMemId};this.data.push(h)}if(this.emedia.mgr&&this.emedia.mgr.onNetworkQuality){var v=this.emedia.mgr.onNetworkQuality;"function"==typeof v&&v(e.sId,p)}return this._set_prev_obj(e),delete e.aB,delete e.vB,delete e.vFR,delete e.RTT,e}},{key:"_set_stats_int",value:function(e){var t=["audioInputLevel","vKBps","vFps","vW","vH","vP","vPL","vPLR","aKBps","aP","aPL","aPLR"];for(var n in e)t.indexOf(n)>-1&&(e[n]=Math.round(e[n]));return e}},{key:"_get_KBps_by_sId",value:function(e,t,n,r){if(!e||!t||!n)return null;var i=this.prev_obj[e];if(!i||!i[t]||!i[t].bytes)return null;var o=i.time,a=n-i[t].bytes;return a<0&&(a=0),a/(parseInt(r-o)/1e3).toFixed(2)/1e3}},{key:"_get_PLR_by_sId",value:function(e,t,n,r){if(!e)return null;if(!t||!n||!r)return 0;var i=this.prev_obj[e];if(!i||!i[t]||!i[t].packets||!i[t].packets_lost)return 0;var o=i[t],a=o.packets,s=r-o.packets_lost,c=s/(n-a+s);return c=Math.round(100*c)}},{key:"_set_prev_obj",value:function(e){var t=e.sId;if(t){var n=e.aB,r=e.vB,i=e.time,o=e.aP,a=e.aPL,s=e.vP,c=e.vPL,d=e.vFR,u={},l={};n&&(u.bytes=n),o&&(u.packets=o),(a||0==a)&&(u.packets_lost=a),r&&(l.bytes=r),s&&(l.packets=s),(c||0==c)&&(l.packets_lost=c),d&&(l.framesReceived=d),0==Object.keys(u).length&&0==Object.keys(l).length||(this.prev_obj[t]||(this.prev_obj[t]={}),this.prev_obj[t].time=i,Object.keys(u).length>0&&(this.prev_obj[t].audio=u),Object.keys(l).length>0&&(this.prev_obj[t].video=l))}}},{key:"_get_w_quality",value:function(e){e.RTT,e.aPLR,e.vPLR;var t=e.time,n=e.vKBps,r=e.aKBps,i=e.sId;if(!i)return 2;var o=this,a=function(e){if(!e||!t)return!1;var n=o.network_quality_obj[i];if(!n)return o.network_quality_obj[i]=Object(m.a)({},e,{time:t}),!1;if(!n[e])return o.network_quality_obj[i][e]={time:t},!1;var r=n[e].time,a=o.network_quality_threshold[e].time;return t-r>=a},s=function(e){var t=o.network_quality_obj[i];t&&t[e]&&(o.network_quality_obj[i][e]=void 0)};if(n||r){!function(){var e=o.network_quality_obj[i];e&&e.disconnect&&(o.network_quality_obj[i].disconnect=void 0)}();for(var c=["RTT","aPLR","vPLR"],d=2,u=0;u<c.length;u++){var l=c[u],f=this.network_quality_threshold[l].value;e[l]>=f?a(l)&&(d=1):s(l)}return d}return function(){var e=o.network_quality_obj[i];if(!e)return o.network_quality_obj[i]={disconnect:{time:t}},!1;if(!e.disconnect)return o.network_quality_obj[i]={disconnect:{time:t}},!1;var n=e.disconnect.time,r=o.network_quality_threshold.disconnect.time;return t-n>=r}()?0:2}}]),e}(),b=n(24),A=n(495),y=n(493),S=n(492),w=n(201),C=n(494),k=n(113),I=n.n(k),x=c.a.tagLogger("mgr");window.emedia=window.emedia||{};function E(){this._confrs={},this._services={},this._events={},this._videos={}}E.prototype.ConfrType={COMMUNICATION:10,COMMUNICATION_MIX:11,LIVE:12,P2P:13,INTERCOMM:14},E.prototype.Role={ADMIN:7,TALKER:3,AUDIENCE:1},E.prototype.StreamType={VIDEO:0,DESKTOP:1,MIXVIDEO:2};var R;R={createConfr:"/easemob/rtc/req/ticket",reqTkt:"/easemob/rtc/req/ticket",chanageRoles:"/easemob/rtc/chanage/roles",disbandConfr:"/easemob/rtc/disband/conference",kickMember:"/easemob/rtc/kick/member",selectConfr:"/easemob/rtc/select/confr"},c.a.forEach(R,(function(e,t){E.prototype[e]=function(n){var r=t;r=r+"?_ct="+(new Date).getTime(),n.region&&(r=r+"&REGION="+n.region),n.confrId&&(r=r+"&CONFRID="+n.confrId);var i,o,a=this.createUrl(r,e);return i=a,o=n,function(e){u.a.ajax({type:"POST",url:i,data:JSON.stringify(o),contentType:"application/json",dataType:"json",success:function(t,n,r){x.debug("REST: ",t," -> ",o,i),0===t.error?(c.a.removeAttribute(t,"error"),e.next(t),e.complete()):(c.a.extend(t,{errorType:"server_refuse"}),e.error(t))},error:function(t,n,r){var a={errorType:"http_error",error:t.status,errorMessage:r};x.debug("REST: ",a," -> ",o,i),e.error({errorType:"http_error",error:t.status,errorMessage:r})}})}}})),E.prototype.createUrl=function(e,t){return(emedia.config&&emedia.config.restPrefix||"")+e},E.prototype.setUrlCreator=function(e){this.createUrl=e.bind(this)},E.prototype.destroy=function(){},E.prototype.ZeroStream=I.a.extend({__init__:function(){this.type=2,this.id="0",this._located=!1,this.mutedMuted=!1},onGotRemoteMediaStream:function(e){if(!this.remotePlayAudioObject){this.id;var t=document.createElement("audio");t.style.display="none",t.id="__o_remote_play_audio_"+this.id,t.autoplay=!0,t.playsinline=!0,this.remotePlayAudioObject=t,document.body.appendChild(t)}this.remotePlayAudioObject.srcObject=e}}),E.prototype.setIdentity=function(e,t,n){this.identityName=e,this.identityToken=t,this.ext=n,this._terminalInfo={browser:emedia.browser,browserVersion:emedia.browserVersion,version:window._emediaVersion||emedia.config.version,userAgent:emedia.config.userAgent},x.info("set identity: ",e,t),this.destroy(),emedia.config({autoSub:!1,onlyEnter:!0})},E.prototype.EventsObservable=n(270).default;var T=Object(S.a)((function(e,t){throw x.error(e),e}));function M(e,t,n,r){var i=this,o=void 0,a=void 0;if(arguments.length>=0&&"object"===typeof arguments[0]){var s=arguments[0];o=s.region,e=s.confrType,t=s.password,n=s.rec,r=s.recMerge,a=s.liveCfg}return"string"===typeof e&&(e=parseInt(e)),b.a.create(E.prototype.createConfr.call(i,{region:o,uid:i.identityName,token:i.identityToken,confrType:e,password:t,terminal:i._terminalInfo,rec:n,recMerge:r,liveCfg:a})).pipe(Object(w.a)((function(e){return e.mixed=11===e.type||12===e.type,e.id=e.serverConfrId=e.confrId,i._confrs[e.confrId]=f.a.extend({},e),c.a.removeAttribute(e,"rtcCfg"),e})),T)}function P(e,t,n,r,i){var o=this,s={};if(arguments.length>=0&&"object"===typeof arguments[0]){var d=arguments[0];s=Object(a.a)({uid:o.identityName,token:o.identityToken,terminal:o._terminalInfo},d)}else s={uid:o.identityName,token:o.identityToken,terminal:o._terminalInfo,confrType:e,password:t,rec:n,recMerge:r,supportWechatMiniProgram:i};return s.confrType&&(s.confrType=parseInt(s.confrType)),i&&(s.useVCodes=["VP8","H264"]),b.a.create(E.prototype.createConfr.call(o,s)).pipe(Object(w.a)((function(e){return e.mixed=11===e.type||12===e.type,e.id=e.serverConfrId=e.confrId,o._confrs[e.confrId]=f.a.extend({},e),c.a.removeAttribute(e,"rtcCfg"),e})),T)}function O(e,t){var n,r=this;if(arguments.length>=0&&"object"===typeof arguments[0]){var i=arguments[0];e=i.confrId,t=i.password,n=i.role}var o=r._confr(e),a={uid:r.identityName,token:r.identityToken,confrId:o&&o.id||e,password:t,role:n,terminal:r._terminalInfo};return r._confrs[e]&&(a.roleToken=r._confrs[e].roleToken),b.a.create(E.prototype.reqTkt.call(r,a)).pipe(Object(w.a)((function(t){return t.mixed=11===t.type||12===t.type,t.id=t.serverConfrId=t.confrId=e,r._confrs[e]=c.a.extend(r._confrs[e]||{},t),c.a.removeAttribute(t,"rtcCfg"),t})),T)}function D(e,t,n){var r=this._confr(n),i=this._service(n),o={confrId:r&&r.id||n,uids:t,role:e,roleToken:r.roleToken};return b.a.create(E.prototype.chanageRoles.call(this,o)).pipe(Object(w.a)((function(e){return i&&i.current&&i.current._sysCopy(),r.id})),T)}function N(e,t){var n=this,r=n._confr(e),i={confrId:r&&r.id||e,roleToken:r&&r.roleToken||t};return b.a.create(E.prototype.disbandConfr.call(n,i)).pipe(Object(w.a)((function(t){return n.upload_stats&&setTimeout((function(){return n.upload_stats.stop()}),3e3),c.a.removeAttribute(n._confrs,e),r.id})),T)}function j(e,t){var n=this._confr(t),r={confrId:n&&n.id||t,uids:e,roleToken:n.roleToken};return b.a.create(E.prototype.kickMember.call(this,r)).pipe(Object(w.a)((function(e){return n.id})),T)}function B(e,t){var n=this._confr(e),r={uid:this.identityName,token:this.identityToken,confrId:n&&n.id||e,password:t};return n&&(r.password=t||n.password,r.roleToken=n.roleToken),b.a.create(E.prototype.selectConfr.call(this,r)).pipe(T)}function U(e,t){}function L(e,t){var n=this,r=n._confr(e),i=n._service(e);switch(r.type){case 0:case 10:case 11:break;case 12:var o=new n.ZeroStream;if(i.current._cacheStreams[o.id]=o,i.current.role==le.Role.AUDIENCE)return re.call(n,e,o,!1,!0).pipe(Object(C.a)((function(){return Object(A.a)(c.a.extend({},n._confrs[e]))})));break;case 13:case 14:default:return Object(y.a)("not support conf type: "+r.type)}return Object(A.a)(c.a.extend({},n._confrs[e]))}function V(e,t,n){var r=this;return emedia.ctrl.support(n,(function(t,n,i){r.onHasRemoteControl(t,n,i,e)}),(function(t,n,i){r.onRemoteFreeControl(t,n,i,e)})),x.info("support remote control. ",e,t),Object(A.a)(c.a.extend({},r._confrs[e]))}function F(e,t,n){var r=this;if(r.joined(e))return Object(y.a)("had joined confr "+e+", if you want join again, please call exitConference");var i=r._events[e]=new r.EventsObservable(r,e,(function(t){U.call(r,e,t)}));r.confrEventsObserver&&i.subscribe(r.confrEventsObserver);var o=r._service(e);return(o=r._services[e]=new emedia.XService({listeners:i,nickName:n&&n.nickName})).setup(t,n),b.a.create((function(t){if(emedia.config.uploadStats){r.upload_stats=new _(emedia);try{r.upload_stats.connect_ws()}catch(n){console.error("upload_stats.connect_ws error",n)}}o.join((function(n){if(r.upload_stats){var i=o.current._session._sessionId;r.upload_stats.join_success(i)}r.__current_confrId=e,r._confrs[e].joinId=n,r._confrs[e].role=o.current&&o.current.role,t.next(r._confrs[e]),t.complete()}),(function(e){r.upload_stats&&r.upload_stats.join_fail(),o.exit(),t.error({errorType:"join_fail",error:-200,errorMessage:e.message()})}))})).pipe(Object(C.a)((function(t,n){return V.call(r,e,t,o)})),Object(C.a)((function(t,n){return L.call(r,e,t)})),T)}function G(e,t,n){var r=this;return O.call(r,e,t,n).pipe(Object(C.a)((function(t,i){return F.call(r,e,t.ticket,n)})))}function q(e,t,n){var r=this;return B.call(r,e,t,n).pipe(Object(C.a)((function(i,o){return G.call(r,e,t,n)})))}function W(e,t){var n=this._service(e);return b.a.create((function(e){n.openUserMedia(t).then((function(){e.next(t),e.complete()}),(function(t){e.error({errorType:"open_user_media_fail",error:-201,errorMessage:t.message()})}))})).pipe(T)}function Q(e,t){var n=this._service(e);return b.a.create((function(e){n.push(t,(function(t){e.next(t),e.complete()}),(function(t){e.error({errorType:"push_fail",error:-203,errorMessage:t.message()})}))})).pipe(T)}function X(e,t,n){this._confr(n);var r=this._service(n);return(e="string"===typeof e?r.getStreamById(e):r.getStreamById(e.id))?t?f.a.isEqual(t,e.constaints.video)?H.call(this,n,e,0):Y.call(this,n,e,t):H.call(this,n,e,1):Object(y.a)("pub stream not exsits. it is "+e)}function z(e,t){if(this.upload_stats&&e&&t){var n=this._services[this.__current_confrId].current;if(n){var r={event:e,rtcId:t.rtcId,sId:t.id,sessionId:n._session._sessionId,streamType:t.type,voff:t.voff,aoff:t.aoff};this.upload_stats.upload_event(r)}}}function H(e,t,n){var r=this,i=r._service(e);return b.a.create((function(e){i.voff(t,n,(function(t){e.error({errorType:"voff_fail",error:-203,errorMessage:t.message()})}),(function(){var o=i.getStreamById(t.id);e.next(o),e.complete();var a=1==n?8:6;z.bind(r)(a,o)}))})).pipe(T)}function Y(e,t,n){var r=this._service(e);return b.a.create((function(e){var i={};f.a.isObject(t.constaints)&&(i=c.a.extend(!0,{},t.constaints)),i.video=n,r.chanageConstraints(t,i,(function(t){e.error({errorType:"ChanageVideoConstraints_fail",error:-203,errorMessage:t.message()})}),(function(){e.next(r.getStreamById(t.id)),e.complete()}))})).pipe(T)}function J(e,t,n){var r=this._confr(n),i=this._service(n);return(e="string"===typeof e?i.getStreamById(e):i.getStreamById(e.id))?r.type!==this.ConfrType.COMMUNICATION_MIX&&r.type!==this.ConfrType.LIVE||1!==e.type||t?K.call(this,n,e,t):(x.warn("confr mix. not allow desktop with audio."),Object(y.a)("confr mix. not allow desktop with audio.")):Object(y.a)("pub stream not exsits. it is "+e)}function K(e,t,n){var r=this,i=r._service(e);return b.a.create((function(e){i.aoff(t,n,(function(t){e.error({errorType:"aoff_fail",error:-203,errorMessage:t.message()})}),(function(){var o=i.getStreamById(t.id);e.next(o),e.complete();var a=1==n?7:5;z.bind(r)(a,o)}))})).pipe(T)}function Z(e,t,n,r){var i=this,o=i._confr(e),a=i._service(e);if(a.current.role==i.Role.AUDIENCE)return Object(y.a)("Audience not allow publish");if(o.av)return Object(y.a)("Audio and video stream has been published. not allow repeat publish.");var s=o.mixed?a.AudioMixerPubstream:a.AVPubstream,d=o.av=new s({constaints:t,aoff:0,voff:0,ext:r});return W.call(i,o.id,d).pipe(Object(C.a)((function(e){return n&&c.a.targetDOM(n)&&attachMediaStream(n,e.localStream),Q.call(i,o.id,e,r)})),Object(w.a)((function(e){return o.av=e,n&&i.streamBindVideo(o.av,n),o.type==i.ConfrType.LIVE&&i.hungup(0),c.a.extend({},e)})),Object(S.a)((function(e,t){throw o.av&&i.hungup(o.av),o.av=void 0,x.error(e),e})))}function ee(e){var t=this._confr(e),n=this._service(e);return n.current.role==this.Role.AUDIENCE?Object(y.a)("Audience not allow publish"):b.a.create((function(e){n.switchMobileCamera(t.av,(function(t){e.error({errorType:"switch_camera_fail",error:-203,errorMessage:t.message()})}),(function(){e.complete()}))})).pipe(T)}function te(e){var t=this._confr(e),n=this._service(e);return n.current.role==this.Role.AUDIENCE?Object(y.a)("Audience not allow publish"):b.a.create((function(e){n.chanageCamera(t.av,(function(t){e.error({errorType:"switch_camera_fail",error:-203,errorMessage:t.message()})}),(function(){e.complete()}))})).pipe(T)}function ne(e){var t=e.confrId,n=e.constaints,r=e.videoTag,i=e.ext,o=e.stopSharedCallback,a=this,s=a._confr(t),d=a._service(t);if(d.current.role==a.Role.AUDIENCE)return Object(y.a)("Audience not allow publish");if(s.desktop)return Object(y.a)("desktop stream has been published. not allow repeat publish.");if((s.type===a.ConfrType.COMMUNICATION_MIX||s.type===a.ConfrType.LIVE)&&n.audio)return x.warn("confr mix. not allow desktop with audio."),Object(y.a)("confr mix. not allow desktop with audio.");n.audio||!s.av||s.av.aoff||x.warn("repeat audio. desktop and av");var u=s.desktop=new d.ShareDesktopPubstream({screenOptions:n.video&&n.video.screenOptions||["screen","window","tab"],mandatory:n.video&&n.video.mandatory||{},vbitrate:n.video&&n.video.bitrate,abitrate:n.audio&&n.audio.bitrate,aoff:n.audio?0:1,ext:i,onMediaInactive:function(){"function"==typeof o&&o()}});return W.call(a,s.id,u).pipe(Object(C.a)((function(e){return r&&c.a.targetDOM(r)&&attachMediaStream(r,e.localStream),Q.call(a,s.id,e,i)})),Object(w.a)((function(e){return s.desktop=e,r&&c.a.targetDOM(r)&&a.streamBindVideo(s.desktop,r),c.a.extend({},e)})),Object(S.a)((function(e,t){throw s.desktop=void 0,x.error(e),e})))}function re(e,t,n,r,i){var o=this,a="string"===typeof t?t:t.id,s=o._confr(e),d=o._service(e);return 2===t.type&&1==r&&0!=t.id&&(r=!1,x.warn("Mixed audio stream. not allow repeat sub audio. force reset subSAudio = false")),i&&c.a.targetDOM(i)&&o.streamBindVideo(a,i),b.a.create((function(e){d.subscribe(a,(function(t){try{if("0"!=a){var n=d.getStreamById(a),r={video:n.subArgs?n.subArgs.subSVideo:!n.voff,audio:n.subArgs?n.subArgs.subSAudio:!n.aoff};2===n.type&&(r.audio=!0),o._onMemberMediaChanaged(n.owner,n,r,s.confrId)}}finally{e.next(t),e.complete()}}),(function(t){e.error({errorType:"sub_fail",error:-203,errorMessage:t.message()})}),{subSVideo:n,subSAudio:r})})).pipe(T)}function ie(e,t,n){var r=this,i=r._service(n);e=i.current._cacheStreams["string"===typeof e?e:e.id];var o=t||r.crtAndReturnVideo(e.owner,e);if(o){r._videos[e.id]=o,o.setAttribute("autoplay","autoplay"),o.setAttribute("playsinline","playsinline"),o.setAttribute("hx_stream",e.id),e.aoff?o.setAttribute("aoff","aoff"):o.removeAttribute("aoff"),e.voff?o.setAttribute("voff","voff"):o.removeAttribute("voff"),e.ifMediaStream((function(e){o&&attachMediaStream(o,e),o.hasAttribute("flow")&&r.onMediaTransmission(o,(function(e,t,n,r){u()(o).trigger("onMediaTransmission",[e,t,n,r])}))}));var a=u()(o);a.off("hungup"),a.on("hungup",(function(t,i,o){r.hungup(e,n),o&&o()})),a.off("subscribe"),a.on("subscribe",(function(t,i,o,a,s){e.located()?a&&a("local stream not allow sub"):(i=e.subArgs&&e.subArgs.subSVideo||!0,o=e.subArgs&&e.subArgs.subSAudio||!0,r.subscribe(e.owner,e,i,o,n).then(s).catch(a))})),a.off("pauseVideo"),a.on("pauseVideo",(function(t,o,s){(e=i.current._cacheStreams["string"===typeof e?e:e.id]).located()?(a[0].__constaints_video=e.constaints&&e.constaints.video,r.pauseVideo(e,n).then(s).catch(o)):r.subscribe(e.owner,e,!1,e.subArgs&&e.subArgs.subSAudio||!e.aoff,n).then(s).catch(o)})),a.off("resumeVideo"),a.on("resumeVideo",(function(t,o,s,c){(e=i.current._cacheStreams["string"===typeof e?e:e.id]).located()?(void 0===c&&(void 0!==(c=a[0].__constaints_video)&&null!=c||(c=!0)),a[0].__constaints_video=void 0,r.resumeVideo(e,c,n).then(s).catch(o)):r.subscribe(e.owner,e,!0,e.subArgs&&e.subArgs.subSVideo||!e.voff,n).then(s).catch(o)})),a.off("pauseAudio"),a.on("pauseAudio",(function(t,i,o){e.located()?r.pauseAudio(e,n).then(o).catch(i):r.subscribe(e.owner,e,e.subArgs.subSVideo,!1,n).then(o).catch(i)})),a.off("resumeAudio"),a.on("resumeAudio",(function(t,i,o){e.located()?r.resumeAudio(e,n).then(o).catch(i):r.subscribe(e.owner,e,e.subArgs.subSVideo,!0,n).then(o).catch(i)})),a.off("remoteControl"),a.on("remoteControl",(function(t,i,a,s,c,d,u,l){if(e.located())throw x.error("not allow remote control at local"),"not allow remote control at local";r.remoteControl(e,o,o,i,a,s,c,d,u,l,n)})),a.off("chanageCamera"),a.on("chanageCamera",(function(e,t,i){r.chanageCamera(n).then(i).catch(t)})),a.off("captureVideo"),a.on("captureVideo",(function(e,t,i,a){var s=r.captureVideo(o,i,a,n);t&&t(s)})),a.off("capturePictureRemote"),a.on("capturePictureRemote",(function(t,i,o){r.capturePictureRemote(e,!1,n).then(o).catch(i)})),a.off("freezeFrameRemote"),a.on("freezeFrameRemote",(function(t,i,o){r.freezeFrameRemote(e,n).then(o).catch(i)})),a.off("zoomRemote"),a.on("zoomRemote",(function(t,i,o,a){r.zoomRemote(e,i,n).then(a).catch(o)})),a.off("torchRemote"),a.on("torchRemote",(function(t,i,o,a){r.torchRemote(e,i,n).then(a).catch(o)})),a.off("freeRemoteControl"),a.on("freeRemoteControl",(function(t,i,o){try{r.freeRemoteControl(e,n)}finally{o&&o()}}));var s={video:!e.voff,audio:!e.aoff,voff:e.voff,aoff:e.aoff};e.located()||(s={video:e.subArgs?e.subArgs.subSVideo:!e.voff,audio:e.subArgs?e.subArgs.subSAudio:!e.aoff,voff:e.voff,aoff:e.aoff}),a.trigger("onMediaChanaged",[s,e,e.owner,n]),o.getAttribute("sound")&&(i.current._monitSoundChanagedStreams=i.current._monitSoundChanagedStreams||{},i.current._monitSoundChanagedStreams[e.id]=e.id)}}function oe(e,t,n,r){"string"!==typeof t&&(t=t.id);this._confr(e);var i=this._service(e);return b.a.create((function(e){i.focusExpoRemote(t,n,r,(function(t){e.error({errorType:"focusexpo_remote_fail",error:-203,errorMessage:t.message()})}),(function(){e.complete()}))})).pipe(T)}function ae(e,t,n){"string"!==typeof t&&(t=t.id);this._confr(e);var r=this._service(e);return b.a.create((function(e){r.capturePictureRemote(t,n,(function(t){e.next(t),e.complete()}),(function(t){e.error({errorType:"capture_remote_fail",error:-203,errorMessage:t.message()})}))})).pipe(T)}function se(e,t,n){"string"!==typeof t&&(t=t.id);this._confr(e);var r=this._service(e);return b.a.create((function(e){r.zoomRemote(t,n,(function(t){e.error({errorType:"capture_remote_fail",error:-203,errorMessage:t.message()})}),(function(){e.complete()}))})).pipe(T)}function ce(e,t,n){"string"!==typeof t&&(t=t.id);this._confr(e);var r=this._service(e);return b.a.create((function(e){r.torchRemote(t,n,(function(t){e.next(t),e.complete()}),(function(t){e.error({errorType:"torch_remote_fail",error:-203,errorMessage:t.message()})}))})).pipe(T)}function de(e,t){"string"!==typeof t&&(t=t.id);this._confr(e);var n=this._service(e);return b.a.create((function(e){n.freezeFrameRemote(t,(function(t){e.next(t),e.complete()}),(function(t){e.error({errorType:"freeze_remote_fail",error:-203,errorMessage:t.message()})}))})).pipe(T)}var ue=c.a.extend(new E,{_confr:function(e){return e||(e=this.__current_confrId),this._confrs[e]},_service:function(e){return e||(e=this.__current_confrId),this._services[e]},getStreamById:function(e,t){var n=this._service(t);return n&&n.getStreamById(e)},getMemberById:function(e,t){var n=this._service(t);return n&&n.getMemberById(e)},streamBindVideo:function(e,t,n){ie.call(this,e,t,n)},getBindVideoBy:function(e){if("string"!==typeof e&&e&&e.id&&(e=e.id),"string"!==typeof e)throw x.error("Bad stream ",e),"Bad stream "+e;return this._videos[e]},createConfr:function(e,t,n,r){return M.apply(this,arguments).toPromise()},createConfrSptMnPrg:function(e,t,n,r){return P.apply(this,arguments).toPromise()},reqTkt:function(e,t){return O.apply(this,arguments).toPromise()},chanageRoles:function(e,t,n){return D.apply(this,arguments).toPromise()},disbandConfr:function(e,t){return N.apply(this,arguments).toPromise()},kickMember:function(e,t){return j.apply(this,arguments).toPromise()},selectConfr:function(e,t){return B.apply(this,arguments).toPromise()},joinUsePassword:function(e,t,n){return q.call(this,e,t,n).toPromise()},joinUseTicket:function(e,t,n){return F.call(this,e,t,n).toPromise()},joined:function(e){return e&&this._confrs[e]&&this._confrs[e].joinId},shareDesktopWithAudio:function(e){if(navigator.mediaDevices.getDisplayMedia&&!emedia.isElectron)return this.shareDesktopWithAudioNew(e);var t=e.videoConstaints,n=e.withAudio,r=e.videoTag,i=e.ext,o=e.confrId,a=e.sharedCallback,s=e.stopSharedCallback;c.a.targetDOM(r)||(o=i,i=r,r=void 0);var d={confrId:o,constaints:{video:t,audio:n},videoTag:r,ext:i,sharedCallback:a,stopSharedCallback:s};return ne.call(this,d).toPromise()},shareDesktopWithAudioNew:function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r,o,a,s,c,d,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.confrId,r=t.withAudio,o=t.ext,a=t.video,s=t.stopSharedCallback,n){e.next=3;break}throw new Error("shareDesktop confrId is required");case 3:return c={video:a||!0,audio:r},e.next=6,navigator.mediaDevices.getDisplayMedia(c);case 6:return(d=e.sent)._located=!0,u={localStream:d,type:1,aoff:r?0:1,voff:0,constaints:c,_located:!0},e.prev=9,e.next=12,Q.call(this,n,u,o).toPromise();case 12:return l=e.sent,d.getVideoTracks()[0].addEventListener("ended",(function(){"function"==typeof s&&s(l.id)})),e.abrupt("return",l);case 17:e.prev=17,e.t0=e.catch(9);case 19:case"end":return e.stop()}}),e,this,[[9,17]])})));return function(t){return e.apply(this,arguments)}}(),changeCamera:function(e){return te.call(this,e).toPromise()},switchMobileCamera:function(e){return ee.call(this,e).toPromise()},shareVideoWithAudio:function(e,t,n,r,i){c.a.targetDOM(n)||(i=r,r=n,n=void 0);var o={video:e,audio:t};return Z.call(this,i,o,n,r).toPromise()},captureVideo:function(e,t,n,r){return this._service(r).captureVideo(e,t,n)},openUserMedia:function(e,t){var n=this._service(t);return b.a.create((function(t){n.__getUserMedia(e,(function(e,n){t.next(n),t.complete()}),(function(e){t.error(e)}))})).pipe(T).toPromise()},mediaDevices:function(e){return"function"===typeof e&&(e=void 0),b.a.create((function(t){navigator.mediaDevices.enumerateDevices().then((function(n){for(var r=[],i=0;i!==n.length;++i){var o=n[i];o.deviceId;e||r.push(o),e&&e===o.kind?r.push(o):"audioinput"===o.kind||"audiooutput"===o.kind||"videoinput"===o.kind||x.info("Some other kind of source/device: ",o)}t.next(r),t.complete()})).catch((function(e){x.warn("navigator.getUserMedia error: ",e),t.error(e)}))})).pipe(T).toPromise()},resumeVideo:function(e,t,n){return X.call(this,e,t||!0,n).toPromise()},pauseVideo:function(e,t){return X.call(this,e,!1,t).toPromise()},resumeAudio:function(e,t){return J.call(this,e,!1,t).toPromise()},pauseAudio:function(e,t){return J.call(this,e,!0,t).toPromise()},freezeFrameRemote:function(e,t){return de.call(this,t,e).toPromise()},torchRemote:function(e,t,n){return ce.call(this,n,e,t).toPromise()},zoomRemote:function(e,t,n){return se.call(this,n,e,t).toPromise()},capturePictureRemote:function(e,t){return ae.call(this,t,e,!1).toPromise()},focusExpoRemote:function(e,t,n,r){return oe.call(this,r,e,t,n).toPromise()},onFocusExpoRemoteWhenClickVideo:function(e,t,n,r){var i=this;return"function"===typeof t&&(r=n,n=t,t=void 0),u()(e).off(t||"click"),u()(e).on(t||"click",(function(t){var o=e.getAttribute("hx_stream");i.focusExpoRemote(o,e,t).then(r).catch(n)})),t},offEventAtTag:function(e,t){t&&u()(e).off(t)},hungup:function(e,t){var n;n="string"===typeof e?e:e.id||e+"";var r=this._service(t),i=this._confr(t);if(i&&r){r.hungup(n);var o=!1;if(i.av&&(o=i.av.id===n)&&(i.av=void 0),i.desktop&&i.desktop.id===n&&(i.desktop=void 0),o&&i.type==this.ConfrType.LIVE&&r.current.role==le.Role.AUDIENCE){var a=r.current&&r.current._cacheStreams[0];this.subscribe(r.current,a,!1,!0,t)}}else x.warn("when hungup stream. not found confr and service.",e)},subscribe:function(e,t,n,r,i,o){return c.a.targetDOM(i)||(o=i,i=void 0),re.call(this,o,t,n,r,i).toPromise()},exit:function(e,t){var n=this,r=n._service(t);r?(r.exit(e),n.upload_stats&&setTimeout((function(){return n.upload_stats.stop()}),3e3)):x.warn("when exit. not found service.",t)},_onExit:function(e,t,n){try{this.__current_confrId=void 0,this.onExit(t,n,e)}finally{c.a.removeAttribute(this._confrs,e),c.a.removeAttribute(this._services,e),c.a.removeAttribute(this._videos,e),c.a.removeAttribute(this._events,e)}},onExit:function(e,t,n){},_onRoleUpdated:function(e,t){},onMemberJoin:function(e,t){},onMemberLeave:function(e,t,n){},_onRecvRemoteMessage:function(e,t,n){},crtAndReturnVideo:function(e,t,n){},unloadVideo:function(e,t,n,r){},remoteControl:function(e,t,n,r,i,o,a,s,c,d,u){var l=this._service(u);r=!!r;var f="string"===typeof e?e:e.id;r?emedia.ctrl.mirrorControlled(l,f,t,n,i,o,a,s,c,d):emedia.ctrl.controlled(l,f,t,n,i,o,a,s,c,d)},freeRemoteControl:function(e,t){var n=this._service(t),r="string"===typeof e?e:e.id;emedia.ctrl.disControlled(n,r)},zeptoTrigger:function(e,t){var n=[];return Array.prototype.push.apply(n,Array.prototype.slice.call(arguments,2)),b.a.create((function(r){var i=[function(){r.error.apply(r,arguments)},function(){r.next.apply(r,arguments),r.complete()}];Array.prototype.push.apply(i,n),u()(e).trigger(t,i)})).pipe(T).toPromise()},_onAddMemberStream:function(e,t){},_onRemoveMemberStream:function(e,t){},_onUpdateMemberStream:function(e,t,n){},_onMemberMediaChanaged:function(e,t,n,r){var i=this._videos[t.id];n&&(n.voff=t.voff,n.aoff=t.aoff),i&&u()(i).trigger("onMediaChanaged",[n,t,e,r])},onMediaChanaged:function(e,t){this.addVideoEventListener(e,"onMediaChanaged",t)},_onMemberSoundChanaged:function(e,t,n,r){var i=this._videos[t.id];i&&u()(i).trigger("onSoundChanaged",[n,t,e,r])},onSoundChanaged:function(e,t){if(!emedia.config.getMediaMeterIntervalMillis||emedia.config.getMediaMeterIntervalMillis<=0)throw x.error("monit sound chanaged not config. please config getMediaMeterIntervalMillis"),"monit sound chanaged not config. please config getMediaMeterIntervalMillis";e.setAttribute("sound","sound"),this.addVideoEventListener(e,"onSoundChanaged",t)},onMediaTransmission:function(e,t){if(emedia.helper&&"function"===typeof emedia.helper.inboundVideo){var n=this._service(),r=e.getAttribute("hx_stream"),i=r&&n.getStreamById(r),o=e.getAttribute("flowWebrtc");i&&i._webrtc&&o==i._webrtc.__id||(e.hasAttribute("flow")&&i&&i._webrtc?(i.located()?emedia.helper.outboundVideo(i,t,1e3):emedia.helper.inboundVideo(i,t,1e3),e.setAttribute("flowWebrtc",i._webrtc.__id)):(this.addVideoEventListener(e,"onMediaTransmission",t),e.setAttribute("flow","flow")))}else x.warn("please import helper. <script>")},_onTalking:function(e,t,n,r){},_onNotSupportMemberPublishVideoCodecs:function(e,t,n){var r=this._videos[t.id];r&&u()(r).trigger("onNotSupportVideoCodecs",[t,e,n])},onNotSupportVideoCodecs:function(e,t){this.addVideoEventListener(e,"onNotSupportVideoCodecs",t)},_onStreamIceStateChanged:function(e,t,n,r){var i=this._videos[t.id];i&&u()(i).trigger("onIceStateChanged",[n,t,e,r])},onIceStateChanged:function(e,t){this.addVideoEventListener(e,"onIceStateChanged",t)},onHasRemoteControl:function(e,t,n,r){var i=this._videos[e.id];i&&u()(i).trigger("onRemoteControl",[t,n,e,r])},onRemoteControl:function(e,t){this.addVideoEventListener(e,"onRemoteControl",t)},onRemoteFreeControl:function(e,t,n,r){var i=this._videos[e.id];i&&u()(i).trigger("onFreeControl",[t,n,e,r])},onFreeControl:function(e,t){this.addVideoEventListener(e,"onFreeControl",t)},addVideoEventListener:function(e,t,n){u()(e).off(t),u()(e).on(t,(function(){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);n&&n.apply(e,t)}))}});f.a.each(["hungup","subscribe","pauseVideo","resumeVideo","pauseAudio","resumeAudio","chanageCamera","freeRemoteControl","capturePictureRemote","freezeFrameRemote"],(function(e,t){var n=e.replace(/\b[a-z]/g,(function(e){return e.toUpperCase()}));ue["trigger"+n]=function(t){var n=[];return n.push(t),n.push(e),Array.prototype.push.apply(n,Array.prototype.slice.call(arguments,1)),ue.zeptoTrigger.apply(ue,n)}})),ue.triggerTorchRemote=function(e,t){return b.a.create((function(n){u()(e).trigger("torchRemote",[t,function(){n.error.apply(n,arguments)},function(){n.next.apply(n,arguments),n.complete()}])})).pipe(T).toPromise()},ue.triggerZoomRemote=function(e,t){return b.a.create((function(n){u()(e).trigger("zoomRemote",[t,function(){n.error.apply(n,arguments)},function(){n.next.apply(n,arguments),n.complete()}])})).pipe(T).toPromise()},ue.triggerSubscribe=function(e,t,n){return b.a.create((function(r){u()(e).trigger("subscribe",[t,n,function(){r.error.apply(r,arguments)},function(){r.next.apply(r,arguments),r.complete()}])})).pipe(T).toPromise()},ue.triggerRemoteControl=function(e,t,n,r,i,o,a,s){u()(e).trigger("remoteControl",[t,n,r,i,o,a,s])},ue.triggerCaptureVideo=function(e,t,n){return b.a.create((function(r){u()(e).trigger("captureVideo",[function(){r.next.apply(r,arguments),r.complete()},t,n])})).pipe(T).toPromise()};var le=ue,fe={};function me(e){if(e&&0!=Object.keys(e).length)if(e.key){var t=e.key,n=e.val,r=e.success,i=e.error,o=e.type;if(this.__current_confrId){var a=this._confrs[this.__current_confrId].roleToken;if(a){var s={roleToken:a,cattrs:[{key:t,val:n,op:o}]};$.ajax({type:"POST",url:emedia.config.restPrefix+"/easemob/rtc/confr/attrs/update",data:JSON.stringify(s),contentType:"application/json",success:function(e){r&&"function"==typeof r&&r(e)},error:function(e){i&&"function"==typeof i&&i(e)}})}else console.warn("roleToken is not have")}else console.warn("please set_confr_attrs after joined")}else console.warn("options.key is not have");else console.warn("options is not have")}function pe(e,t){var n={type:"POST",url:emedia.config.restPrefix+"/easemob/rtc/confr/attrs/update",data:JSON.stringify({roleToken:e,cstate:{muteAll:t}}),contentType:"application/json"};return new Promise((function(e,t){$.ajax(Object(a.a)({},n,{success:function(n){0==n.error?e(n):t(n)},error:function(e){t(e)}}))}))}le.onMemberJoin=function(e,t){emedia.decodeMemeberName(e),this.onMemberJoined(e,le._confr(t))},le.onMemberLeave=function(e,t,n){emedia.decodeMemeberName(e),this.onMemberExited(e,t,le._confr(n))},le._onRoleUpdated=function(e,t){this.onRoleChanged(e,le._confr(t))},le._onAddMemberStream=function(e,t){e&&emedia.decodeMemeberName(e.owner),this.onStreamAdded(e.owner,e,le._confr(t))},le._onRemoveMemberStream=function(e,t){e&&emedia.decodeMemeberName(e.owner),this.onStreamRemoved(e.owner,e,le._confr(t))},le._onUpdateMemberStream=function(e,t,n){e&&emedia.decodeMemeberName(e.owner),this.onStreamUpdated&&this.onStreamUpdated(e.owner,e,t,le._confr(n))},le.onExit=function(e,t,n){this.onConferenceExit(e,t,le._confr(n))},fe.onMemberJoined=function(e){},fe.onMemberExited=function(e,t){},fe.onRoleChanged=function(e){},fe.onStreamAdded=function(e,t){},fe.onStreamRemoved=function(e,t){},fe.onConferenceExit=function(e,t){},fe.joinConferenceWithTicket=le.joinUseTicket,fe.joinConference=le.joinUsePassword,fe.getConferenceTkt=le.reqTkt,fe.publish=function(e,t,n){return le.shareVideoWithAudio(e.video,e.audio,t,n)},fe.unpublish=function(e){return le.hungup(e)},fe.unsubscribe=function(e){return le.hungup(e)},fe.exitConference=function(e){return le.exit(e||!1)},fe.getConferenceInfo=function(e,t){return le.selectConfr(e,t)},fe.createConference=le.createConfrSptMnPrg,fe.grantRole=function(e,t,n){return le.chanageRoles(n,t,e.id)},fe.degradeRole=function(e,t,n){if(e)if(t&&t instanceof Array!=0&&0!=t.length){if(n){var r=this._confrs[e];if(r){var i=r.role,o=r.roleToken;if(!(Number(n)>=Number(i))){var s={type:"POST",url:emedia.config.restPrefix+"/easemob/rtc/role/degrade",data:JSON.stringify({roleToken:o,uids:t,role:n}),contentType:"application/json"};return new Promise((function(e,t){$.ajax(Object(a.a)({},s,{success:function(n){0==n.error?e(n):t(n)},error:function(e){t(e)}}))}))}console.warn("only degradeRole,oldRole: "+i+" >>> toRole: "+n)}else console.warn("confr is not exist")}}else console.warn("members is must Array also length > 0")},fe.kickMembersById=function(e,t){return le.kickMember(t,e.id)},fe.destroyConference=function(e){return le.disbandConfr(e,e.roleToken)},fe.setConferenceAttrs=function(e){e.type="UPDATE",me.call(this,e)},fe.deleteConferenceAttrs=function(e){e.type="DEL",me.call(this,e)},fe.onConfrStateUpdated=function(e){var t=this,n=this.__current_confrId;if(n){var r=this._services[n];if(r){var i=r.current;i&&i.role&&i.role!=this.Role.ADMIN&&function(){var n=e.muteAll;void 0!==n&&(n?t.onMuteAll&&"function"==typeof t.onMuteAll&&t.onMuteAll():t.onUnMuteAll&&"function"==typeof t.onUnMuteAll&&t.onUnMuteAll())}()}}},fe.joinRoom=function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r,o,s,c,d,u,l,f,m,p,h,v,g,_,b,A,y,S,w;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e){var t=emedia.config,n=t.restPrefix,r=t.appkey;if(!r)throw new Error("in joinRoom appkey is not defined");var i=r.split("#")[0],o=r.split("#")[1],a="".concat(n,"/").concat(i,"/").concat(o,"/conferences/room");return new Promise((function(t,n){var r={url:a,data:JSON.stringify(e),type:"POST",contentType:"application/json",success:function(e){e.error?n(e):t(e)},error:function(e){n(e)}};$.ajax(r)}))},r=this,o=function(e){var t=emedia.config.restPrefix+"/easemob/rtc/req/ticket?_ct="+(new Date).getTime();e.region&&(t+="&REGION=".concat(e.region)),e.confrId&&(t+="&CONFRID=".concat(e.confrId));var n={type:"POST",url:t,data:JSON.stringify(e),contentType:"application/json",dataType:"json"};return new Promise((function(e,t){$.ajax(Object(a.a)({},n,{success:function(n){0==n.error?e(n):t(n)},error:function(e){t(e)}}))}))},s=t.roomName,c=t.password,d=t.role,u=t.config,l=this.identityName,f=this.identityToken,s){e.next=7;break}throw new Error("the roomName is required at joinRoom");case 7:if(c){e.next=9;break}throw new Error("the password is required at joinRoom");case 9:if(l){e.next=11;break}throw new Error("the memName is required at joinRoom");case 11:if(f){e.next=13;break}throw new Error("the token is required at joinRoom");case 13:if(d){e.next=15;break}throw new Error("the role is required at joinRoom");case 15:return m=Object(a.a)({roomName:s,password:c,memName:l,token:f},u),u&&u.supportWechatMiniProgram&&(m.useVCodes=["H264","VP8"]),e.next=19,n(m);case 19:return p=e.sent,h=p.confrId,v={uid:l,token:f,confrId:h,password:c,role:d,terminal:this._terminalInfo},e.next=24,o(v);case 24:return(g=e.sent).mixed=11===g.type||12===g.type,g.id=g.serverConfrId=g.confrId=h,this._confrs[h]=Object.assign(this._confrs[h]||{},g),_=g.ticket,A=(b=u||{}).nickName,y=b.ext,S=p.isCreator,e.next=33,r.joinConferenceWithTicket(h,_,Object(a.a)({nickName:A},y));case 33:return w=e.sent,S&&(w.isCreator=S),e.abrupt("return",w);case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),fe.requestToTalker=function(e){e?this._services[e].requestToTalker():console.warn("requestToTalker confrId is required")},fe.requestToAdmin=function(e){e?this._services[e].requestToAdmin():console.warn("requestToTalker confrId is required")},fe.muteBymemberId=function(e,t){e&&t?this._services[e].muteBymemberId(t):console.warn("muteBymemberId confrId and memberId is required")},fe.unmuteBymemberId=function(e,t){e&&t?this._services[e].unmuteBymemberId(t):console.warn("muteBymemberId confrId and memberId is required")},fe.muteAll=function(e){if(!e)throw new Error("muteAll confrId is required");var t=this._confrs[e];if(!t)throw new Error("confr is not exist");var n=t.role,r=t.roleToken;if(7!=n)throw new Error("only admin can action");if(!r)throw new Error("roleToken is not exist");return pe.call(this,r,!0)},fe.unmuteAll=function(e){if(!e)throw new Error("unmuteAll confrId is required");var t=this._confrs[e];if(!t)throw new Error("confr is not exist");var n=t.role,r=t.roleToken;if(7!=n)throw new Error("only admin can action");if(!r)throw new Error("roleToken is not exist");return pe.call(this,r,!1)},fe.addLive=function(e,t){if(!e)throw new Error("addLive confrId is required");if(!t)throw new Error("addLive liveCfg is required");var n=this._confrs[e];if(!n)throw new Error("confr is not exist");var r=n.role,i=n.roleToken;if(7!=r)throw new Error("only admin can addLive");if(!i)throw new Error("addLive roleToken is required");var o=emedia.config.restPrefix+"/easemob/rtc/livecfg",a={confrId:e,roleToken:i,liveCfg:t};return new Promise((function(e,t){$.ajax({url:o,type:"POST",data:JSON.stringify(a),contentType:"application/json",dataType:"json",success:function(n){0==n.error?e(n):t(n)},error:function(e){t(e)}})}))},fe.updateLiveLayout=function(e,t,n){if(!e)throw new Error("updateLiveLayout confrId is required");if(!t)throw new Error("updateLiveLayout liveId is required");if(!n)throw new Error("updateLiveLayout regions is required");var r=this._confrs[e];if(!r)throw new Error("confr is not exist");var i=r.role,o=r.roleToken;if(7!=i)throw new Error("only admin can updateLiveLayout");if(!o)throw new Error("updateLiveLayout roleToken is required");var a=emedia.config.restPrefix+"/easemob/rtc/live/layout",s={confrId:e,liveId:t,regions:n,roleToken:o};return new Promise((function(e,t){$.ajax({url:a,type:"POST",data:JSON.stringify(s),contentType:"application/json",dataType:"json",success:function(n){0==n.error?e(n):t(n)},error:function(e){t(e)}})}))},fe.deleteLive=function(e,t){if(!e)throw new Error("deleteLive confrId is required");if(!t)throw new Error("deleteLive liveId is required");var n=this._confrs[e];if(!n)throw new Error("confr is not exist");var r=n.role,i=n.roleToken;if(7==r){if(i){var o=emedia.config.restPrefix+"/easemob/rtc/delete/live",a={confrId:e,liveId:t,roleToken:i};return new Promise((function(e,t){$.ajax({url:o,type:"DELETE",data:JSON.stringify(a),contentType:"application/json",dataType:"json",success:function(n){0==n.error?e(n):t(n)},error:function(e){t(e)}})}))}console.error("updateLiveLayout roleToken is required")}else console.warn("only admin can deleteLive")},emedia.decodeMemeberName=function(e){if("function"!==typeof emedia.decodeMemeberNameString)return e;if("string"===typeof e)return emedia.decodeMemeberNameString(e);if(f.a.isArray(e)){for(var t=0;t<e.length;t++)e[t]=emedia.decodeMemeberName(e[t]);return e}return e.name?(e.globalName=e.name,void(e.memName=e.name=emedia.decodeMemeberName(e.name))):e.memName?(e.globalName=e.memName,void(e.memName=e.name=emedia.decodeMemeberName(e.memName))):void 0},emedia.ConfrType=le.ConfrType,emedia.Role=le.Role,emedia.StreamType=le.StreamType,u()((function(){var e=window.WebIM;if(e&&e.conn&&"function"===typeof e.conn.onOpened){function t(){emedia.decodeMemeberNameString=function(t){if("string"===typeof t){if(t.indexOf(e.conn.orgName)<0)return t;var n=t.indexOf("_");n<0?n=0:n++;var r=t.indexOf("@");return r<0&&(r=t.length),t.substring(n,r)}return t},le.setUrlCreator((function(t,n){return e.conn.apiUrl+t})),le.setIdentity(e.conn.orgName+"#"+e.conn.appName+"_"+e.conn.user,e.conn.token),emedia.config({appkey:e.conn.appKey})}var n=e.conn.onOpened;e.conn.onOpened=function(){n.apply(e.conn,arguments),t()},e.conn.token&&t()}}));var he=f.a.extend(le,fe)},7:function(module,exports){function Util(){}!function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(t,n){var r,i,o=e,a=[];if(n=n||o.length,t)for(r=0;r<t;r++)a[r]=o[0|Math.random()*n];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",r=0;r<36;r++)a[r]||(i=0|16*Math.random(),a[r]=o[19==r?3&i|8:i]);return a.join("")},Math.uuidFast=function(){for(var t,n=e,r=new Array(36),i=0,o=0;o<36;o++)8==o||13==o||18==o||23==o?r[o]="-":14==o?r[o]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),t=15&i,i>>=4,r[o]=n[19==o?3&t|8:t]);return r.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}(),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t});var Logger=function(e){var t=this,n=0,r=1,i=2,o=3,a=4,s=5,c=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"];function d(n,r){try{!function(n,r){if(emedia&&emedia.LOG_LEVEL&&n<emedia.LOG_LEVEL)return;var i=[];i.push(n),e&&i.push(e);for(var o=0;o<r.length;o++)i.push(r[o]&&r[o]._toString?r[o]._toString.call(r[o]):r[o]);t._log.apply(t,i)}(n,r)}catch(i){if(console){if(console.error)return void console.error(i);if(console.log)return void console.log(i)}throw i}}function u(){if(!(emedia._logContextIndex<0)&&emedia._logContext&&emedia._logContext instanceof Array){var e=emedia._logContextIndex%emedia._logContext.length,t=emedia._logContext[e];t&&t instanceof Array||(t=emedia._logContext[e]=[]);var n=[];n.push(emedia._logContextIndex);var r,i=new Date;"function"===typeof i.toLocaleString?n.push(i.toLocaleString()):i.toJSON?n.push(i.toJSON()):i.toISOString?n.push(i.toISOString()):n.push(i+"");for(var o=0;o<arguments.length;o++){var a=arguments[o];"string"!==typeof a?a?"string"!==typeof a.message?"function"!==typeof a.message?"string"!==typeof a.stack?a.event&&"function"===typeof a.event.toString||a.event&&"function"===typeof a.event.toString?n.push(a.event.toString()):"string"!==typeof a.candidate?"string"!==typeof a.sdp?isPlainObject(a)?n.push(JSON.stringify(a)):n.push(String(a)):n.push(a.sdp):n.push(a.candidate):n.push(a.stack):n.push(a.message()):n.push(a.message):n.push(a):n.push(a)}if(emedia.config.loglastStoreArray&&t.push(r=n.join(" ")),"function"===typeof emedia.config.onSdkLog)try{r||(r=n.join(" ")),emedia.config.onSdkLog(r)}catch(s){console.error(s)}}}function l(){try{u.apply(null,arguments)}catch(e){console.warn(e)}}this._log=function(){var e=arguments[0];e=arguments[0]=c[e],emedia._logContext&&l.apply(null,arguments),!0===emedia.config.consoleLogger&&(emedia&&emedia.isElectron?console.log.apply(console,arguments):console&&e&&(console[e.toLowerCase()]||console.warn).apply(console,arguments))},this.log=function(){this._log&&d(i,arguments)},this.trace=function(){this._log&&d(n,arguments)},this.debug=function(){this._log&&d(r,arguments)},this.info=function(){this._log&&d(i,arguments)},this.warn=function(){this._log&&d(o,arguments)},this.error=function(){this._log&&d(a,arguments)},this.fatal=function(){this._log&&d(s,arguments)}};Logger.prototype.count=function(){if(emedia._logContext){emedia._logContextIndex++;var e=emedia._logContextIndex%emedia._logContext.length;0===e&&0!==emedia._logContextIndex&&(emedia._logContext.loadlogs=emedia._logContext[e]),emedia._logContext[e]=[]}},Util.prototype.logger=new Logger,Util.prototype.tagLogger=function(e){return new Logger(e)},Util.prototype.parseJSON=function(e){return JSON.parse(e)};var stringifyJSON=Util.prototype.stringifyJSON=function(e){return JSON.stringify(e)},class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,fnToString=hasOwn.toString,ObjectFunctionString=fnToString.call(Object),isPlainObject=Util.prototype.isPlainObject=function(e){var t,n;return!(!e||"[object Object]"!==toString.call(e)||"<JSAPI-Auto Javascript Object>"===e.toString()||"[object IFBComJavascriptObject]"===e.toString())&&(!(t=Object.getPrototypeOf(e))||"function"===typeof(n=hasOwn.call(t,"constructor")&&t.constructor)&&fnToString.call(n)===ObjectFunctionString)};Util.prototype.isArray=Array.isArray,Util.prototype.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},Util.prototype.type=function(e){return null==e?e+"":"object"===typeof e||"function"===typeof e?class2type[toString.call(e)]||"object":typeof e},Util.prototype.extend=function(){var e,t,n,r,i,o,a=this,s=arguments[0]||{},c=1,d=arguments.length,u=!1;for("boolean"===typeof s&&(u=s,s=arguments[c]||{},c++),"object"===typeof s||a.isFunction(s)||(s={}),c===d&&(s=this,c--);c<d;c++)if(null!=(e=arguments[c]))for(t in e)n=s[t],s!==(r=e[t])&&(u&&r&&(a.isPlainObject(r)||(i=a.isArray(r)))?(i?(i=!1,o=n&&a.isArray(n)?n:[]):o=n&&a.isPlainObject(n)?n:{},s[t]=a.extend(u,o,r)):void 0!==r&&(s[t]=r));return s},Util.prototype.removeAttribute=function(e,t){if(null!==e&&void 0!==e){var n=e[t];return delete e[t],n}},Util.prototype.prototypeExtend_000=Util.prototype.classExtend=function(){var e,t=this;function n(){for(var e=0;e<arguments.length;e++){var n=arguments[e]||{};t.extend(!0,this,n)}this.__init__&&this.__init__.apply(this,arguments)}for(var r=0;r<arguments.length;r++){var i=arguments[r]||{};"function"===typeof i?e?(i.constructor=e,i.__proto__=e.prototype):e=i:t.extend(!0,n.prototype,i)}return e&&(n.prototype.__proto__=e.prototype),e&&(n.prototype.constructor=e),n.extend||(n.extend=function(e){return t.prototypeExtend(n,e)}),n},Util.prototype.prototypeExtend=Util.prototype.classExtend=function(){var e=this;function t(){for(var t=0;t<arguments.length;t++){var n=arguments[t]||{};e.extend(!0,this,n)}this.__init__&&this.__init__.apply(this,arguments)}for(var n=0;n<arguments.length;n++){var r=arguments[n]||{};"function"===typeof r&&(r=r.prototype),e.extend(!0,t.prototype,r)}return t.extend||(t.extend=function(n){return e.prototypeExtend(t,n)}),t},Util.prototype.hasLocalStorage=function(e){return null!=localStorage.getItem(e)&&"{}"!=localStorage.getItem(e)},Util.prototype.toggleClass=function(e,t){e.hasClass(t)?e.removeClass(t):e.addClass(t)},Util.prototype.setCookie=function(e,t,n){var r=new Date;r.setTime(r.getTime()+60*n*60*1e3),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()},Util.prototype.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null},Util.prototype.parseURL=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},Util.prototype.forEach=function(e,t){if(e&&(!this.isArray(e)||0!==e.length)&&(void 0===e.length||0!==e.length))if(e.length)for(var n=0;n<e.length;n++)t(n,e[n]);else if(e&&!this.isEmptyObject(e)){e=e||{};var r=this.extend(!1,{},e);for(var i in r)t(i,e[i])}},Util.prototype.isInt=function(e){return Number(e)===e&&e%1===0},Util.prototype.isFloat=function(e){return Number(e)===e&&e%1!==0},Util.prototype.list=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return e},Util.prototype.addEvent=function(e,t,n){if(e.attachEvent)return e.attachEvent("on"+t,n);if(e.addEventListener)return e.addEventListener(t,n,!1);throw"Handler could not be attached"},Util.prototype.removeEvent=function(e,t,n){if(e.detachEvent)return e.detachEvent("on"+t,n);if(e.removeEventListener)return e.removeEventListener(t,n,!1);throw"Handler could not be removed"},Util.prototype.stopEvent=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1},Util.prototype.getDomPageRect=function(e){var t=e.getBoundingClientRect();return{x:t.left+(window.pageXOffset||window.document.documentElement.scrollLeft),y:t.top+(window.pageYOffset||window.document.documentElement.scrollTop),width:t.width||e.offsetWidth,height:t.height||e.offsetHeight}},Util.prototype.getEventElementXY=function(e,t,n){var r,i,o=(e=e||window.event).changedTouches?e.changedTouches[0]:e.touches?e.touches[0]:e;void 0!=o.pageX&&void 0!=o.pageY?(r=o.pageX,i=o.pageY):void 0!=o.clientX&&void 0!=o.clientY&&(r=o.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=o.clientY+document.body.scrollTop+document.documentElement.scrollTop);var a=this.getDomPageRect(t),s=r-a.x,c=i-a.y;return(0===n||void 0==n)&&(n=1),{x:Math.round(Math.max(Math.min(s,a.width-1),0)/n),y:Math.round(Math.max(Math.min(c,a.height-1),0)/n),width:Math.round(a.width/n),height:Math.round(a.height/n),realX:s,realY:c}},Util.prototype.layoutEngine=function(){var e={presto:!!window.opera,trident:!!window.ActiveXObject&&(window.XMLHttpRequest?document.querySelectorAll?6:5:4),webkit:function(){try{return!navigator.taintEnabled&&(i.Features.xpath?i.Features.query?525:420:419)}catch(e){return!1}}(),gecko:!(!document.getBoxObjectFor&&null==window.mozInnerScreenX)&&(document.getElementsByClassName?19:18)};return e.webkit&&(e.webkit=function(e){var t=(navigator.userAgent.match(/WebKit\/([0-9\.]*) /)||["",e])[1];return parseFloat(t,10)}(e)),e}(),Util.prototype.targetDOM="object"===typeof HTMLElement?function(e){return e instanceof HTMLElement}:function(e){return e&&"object"===typeof e&&1===e.nodeType&&"string"===typeof e.nodeName},Util.prototype.cloneCSS=function(e,t){var n=window.getComputedStyle&&window.getComputedStyle(e,null)||e.currentStyle;for(var r in n){var i=n[r];/^[a-z]/i.test(r)&&[null,"",void 0].indexOf(i)<0&&(t.style[r]=i)}},Util.prototype.canYield=function(){try{return eval("!!Function('yield true;')().next()")}catch(e){return!1}}(),module.exports=new Util}},[[218,1,2]]]);
//# sourceMappingURL=main.3f4c3c8e.chunk.js.map